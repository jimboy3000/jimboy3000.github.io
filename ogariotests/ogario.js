/* Source script
v2.869
Decoded simplified and modified by MGx, Adam, Jimboy3100, Snez, Volum, Alexander Lulko, Sonia, Yahnych, Davi SH
This is part of the Legend mod project
IF YOU A NORMAL PERSON AND CARE ABOUT YOUR HEALTH, DON'T READ THIS SCRIPT


´´´´´´´´´´´´´´´´´´´ ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶´´´´´´´´´´´´´´´´´´´`
´´´´´´´´´´´´´´´´´¶¶¶¶¶¶´´´´´´´´´´´´´¶¶¶¶¶¶¶´´´´´´´´´´´´´´´´
´´´´´´´´´´´´´´¶¶¶¶´´´´´´´´´´´´´´´´´´´´´´´¶¶¶¶´´´´´´´´´´´´´´
´´´´´´´´´´´´´¶¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´´´´´´´´´´´´
´´´´´´´´´´´´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´´´´´´´´´´´
´´´´´´´´´´´¶¶´´´´´´´´´´´´´´´´´´´´´`´´´´´´´´´´´¶¶´´´´´´´´´´`
´´´´´´´´´´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´´´´´´´´´´
´´´´´´´´´´¶¶´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´¶¶´´´´´´´´´´
´´´´´´´´´´¶¶´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´´¶´´´´´´´´´´
´´´´´´´´´´¶¶´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´´¶´´´´´´´´´´
´´´´´´´´´´¶¶´´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´¶¶´´´´´´´´´´
´´´´´´´´´´¶¶´´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´´¶¶´´´´´´´´´´
´´´´´´´´´´´¶¶´¶¶´´´¶¶¶¶¶¶¶¶´´´´´¶¶¶¶¶¶¶¶´´´¶¶´¶¶´´´´´´´´´´´
´´´´´´´´´´´´¶¶¶¶´¶¶¶¶¶¶¶¶¶¶´´´´´¶¶¶¶¶¶¶¶¶¶´¶¶¶¶¶´´´´´´´´´´´
´´´´´´´´´´´´´¶¶¶´¶¶¶¶¶¶¶¶¶¶´´´´´¶¶¶¶¶¶¶¶¶¶´¶¶¶´´´´´´´´´´´´´
´´´´¶¶¶´´´´´´´¶¶´´¶¶¶¶¶¶¶¶´´´´´´´¶¶¶¶¶¶¶¶¶´´¶¶´´´´´´¶¶¶¶´´´
´´´¶¶¶¶¶´´´´´¶¶´´´¶¶¶¶¶¶¶´´´¶¶¶´´´¶¶¶¶¶¶¶´´´¶¶´´´´´¶¶¶¶¶¶´´
´´¶¶´´´¶¶´´´´¶¶´´´´´¶¶¶´´´´¶¶¶¶¶´´´´¶¶¶´´´´´¶¶´´´´¶¶´´´¶¶´´
´¶¶¶´´´´¶¶¶¶´´¶¶´´´´´´´´´´¶¶¶¶¶¶¶´´´´´´´´´´¶¶´´¶¶¶¶´´´´¶¶¶´
¶¶´´´´´´´´´¶¶¶¶¶¶¶¶´´´´´´´¶¶¶¶¶¶¶´´´´´´´¶¶¶¶¶¶¶¶¶´´´´´´´´¶¶
¶¶¶¶¶¶¶¶¶´´´´´¶¶¶¶¶¶¶¶´´´´¶¶¶¶¶¶¶´´´´¶¶¶¶¶¶¶¶´´´´´´¶¶¶¶¶¶¶¶
´´¶¶¶¶´¶¶¶¶¶´´´´´´¶¶¶¶¶´´´´´´´´´´´´´´¶¶¶´¶¶´´´´´¶¶¶¶¶¶´¶¶¶´
´´´´´´´´´´¶¶¶¶¶¶´´¶¶¶´´¶¶´´´´´´´´´´´¶¶´´¶¶¶´´¶¶¶¶¶¶´´´´´´´´
´´´´´´´´´´´´´´¶¶¶¶¶¶´¶¶´¶¶¶¶¶¶¶¶¶¶¶´¶¶´¶¶¶¶¶¶´´´´´´´´´´´´´´
´´´´´´´´´´´´´´´´´´¶¶´¶¶´¶´¶´¶´¶´¶´¶´¶´¶´¶¶´´´´´´´´´´´´´´´´´
´´´´´´´´´´´´´´´´¶¶¶¶´´¶´¶´¶´¶´¶´¶´¶´¶´´´¶¶¶¶¶´´´´´´´´´´´´´´
´´´´´´´´´´´´¶¶¶¶¶´¶¶´´´¶¶¶¶¶¶¶¶¶¶¶¶¶´´´¶¶´¶¶¶¶¶´´´´´´´´´´´´
´´´´¶¶¶¶¶¶¶¶¶¶´´´´´¶¶´´´´´´´´´´´´´´´´´¶¶´´´´´´¶¶¶¶¶¶¶¶¶´´´´
´´´¶¶´´´´´´´´´´´¶¶¶¶¶¶¶´´´´´´´´´´´´´¶¶¶¶¶¶¶¶´´´´´´´´´´¶¶´´´
´´´´¶¶¶´´´´´¶¶¶¶¶´´´´´¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶´´´´´¶¶¶¶¶´´´´´¶¶¶´´´´
´´´´´´¶¶´´´¶¶¶´´´´´´´´´´´¶¶¶¶¶¶¶¶¶´´´´´´´´´´´¶¶¶´´´¶¶´´´´´´
´´´´´´¶¶´´¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶´´¶¶´´´´´´
´´´´´´´¶¶¶¶´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´´¶¶¶¶´´´´´´´
*/
window.tempH = 6
//window.testobjects = {};
var consoleMsgLM = "[Client] ";
//var agarTesterArena = "wss://livec-arena-12luq8l.tech.agar.io"
window.clanTagLc = "U1VC";
appendLMhiFbPs()
window.externalScriptMassBar = []
window.capthaWindow = []

window.RecordedProtocol = []
window.RecordedProtocolArenas = []
window.RecordedArenasSpecifications = []
window.catholicCalculator = 0;
window.replayTiming = 20
window.replayTimeOuts = []
window.replaySkippedLoops = 100 //100 times more frames from timing 0 replays
//window.fpsloopsetter=60
window.renderDelay = 0;
//window.specificRecordedProtocol = []
window.chatLimit = 15;

//inject gamepad libraries if Mobile
var isMobile = window.orientation > -1; //false for PC, true for mobile 

function changeregion() {
    if ($('#region').val() == "Private") {
        deleteGamemode(true);
    } else {
        if (window.gamemodeBackup) {
            $('#gamemode').empty();
            $("#gamemode").append(window.gamemodeBackup);
            window.gamemodeBackup = null;
            $('#gamemode option[value=":ffa"]').prop('selected', 'selected').change();
        }
        master.setRegion($('#region').val());
    }
}

function deleteGamemode(temp) {
	var privateModOptions

	privateModOptions = [{
            text: 'FFA PowerUp',
            value: 34
        }, {
            text: 'Arctida',
            value: 6
        }, {
            text: 'Dagestan',
            value: 7
        }, {
            text: 'Zimbabwe',
            value: 31
        }, {
            text: 'Antarctic',
            value: 35
        }/*
		, {
            text: 'MK NA east',
            value: 36
        }, {
            text: 'Eatcells',
            value: 42
        }, {
            text: 'C-Minions EU',
            value: 43
        }, {
            text: 'Minions EU',
            value: 44
        }, {		
            text: 'Selffeed EU ',
            value: 45
        }, {		
            text: 'Moondust EU',
            value: 46
        }, {	
            text: 'Infected EU',
            value: 47
        }, {	
            text: 'Crazy EU',
            value: 48
        }, {	
            text: 'C-Minions NA',
            value: 49
        }, {	
            text: 'Minions NA',
            value: 50
        }, {	
            text: 'Selffeed NA',
            value: 51
        }, {
            text: 'Moondust NA',
            value: 52
        }, {
            text: 'Infected NA',
            value: 53
        }, {
            text: 'Crazy NA',
            value: 54
        }*/
		, {			
            text: 'Instant Merging',
            value: 16
        }, {			
            text: 'Party MegaSplit',
            value: 19
        }, {
            text: 'Party Mode',
            value: 20
        }, {
            text: 'Party Selfeed',
            value: 21
        }, {
            text: 'Crazy Selfeed',
            value: 22
        }, {
            text: '1vs1 FFA #1',
            value: 23
        }, {
            text: '1vs1 FFA #2',
            value: 24
        }, {
            text: '1vs1 FFA #3',
            value: 25
        }, {
            text: '1vs1 EXP #1',
            value: 26
        }, {
            text: '1vs1 EXP #2',
            value: 27
        }, {
            text: '1vs1 EXP #3',
            value: 28
        }, {
            text: '2vs2',
            value: 29
        }, {
            text: '2vs2vs2',
            value: 30
        }, {
            text: 'Beta Party #1',
            value: 14
        }, {
            text: 'Beta Party #2',
            value: 15
        }, {
            text: 'Beta Party v2 #1',
            value: 17
        }, {
            text: 'Beta Party v2 #2',
            value: 18
        }, {
            text: 'Beta 1v1 Scrims',
            value: 32
        }, {
            text: 'Bots',
            value: 33
        }, {
            text: 'MK Oceania',
            value: 37
        }, {
            text: 'MK Teams',
            value: 38
        }, {
            text: 'MK Bots WIP',
            value: 39
        }, {			
            text: 'Ogar Eat-cells',
            value: 40
        }, {				

            /*
        text: 'MK Disturb Furry',
        value: 41		
    }, {		
        text: 'Cellz big ffa',
        value: 34		
    }, {	
        text: 'Cellz mega split',
        value: 35		
    }, {	
        text: 'Cellz instant',
        value: 36		
    }, {	
        text: 'Cellz self feed',
        value: 37		
    }, {		
        text: 'Cellz crazy',
        value: 38		
    }, {	
        text: 'Cellz fast split',
        value: 39		
    }, {	
        text: 'Cellz ultra split',
        value: 40		
    }, {
*/
            text: 'FPS Test',
            value: 12
        }, 
		/*{
            text: 'ws://localhost:443',
            value: 41
        }
        /*, {	
        text: 'FFA',
        value: 8
    }, {
        text: 'Battle Royal',
        value: 9
    }, {
        text: 'Teams',
        value: 10
    }, {
        text: 'Experimental',
        value: 11
    }, {
        text: 'Party mode',
        value: 13
    }*/
    ];
    if (location.protocol !== 'https:') {
		privateModOptions.unshift({
			text: 'agarios.org NA',
			value: 103
		})	
		privateModOptions.unshift({
			text: 'M16 Korea',
			value: 102
		})		
	}	
    if (!window.gamemodeBackup) {
        window.gamemodeBackup = $("#gamemode").html();
    }
    $('#gamemode').empty();
    $.each(privateModOptions, function(i, el) {
        $('#gamemode').append(new Option(el.text, el.value));
    });
    $('#gamemode').change(function() {
        if ($('#region').val() == "Private") {
            /*
            var now = new Date();
            var now2 = now.getUTCHours();
            if (now2 < 18 && now2 > 5) { //06:00-18:00 UTC closed 07:00-19:00 Germany time
                for (var i = 2; i < 7; i++) {
                    document.getElementById("gamemode").options[i].disabled = true;
                    document.getElementById("gamemode").options[i].title = "OPEN 18:00-6:00 UTC";
                }
            } 
			else { //06:00-18:00 UTC closed 07:00-19:00 Germany time
                for (var i = 2; i < 7; i++) {
                    //document.getElementById("gamemode").options[i].disabled = false;					
                }
            }
			*/
        } else {}
        if ($('#gamemode').val() == 6) {
            core.connect('wss://imsolo.pro:2109/');
        } else if ($('#gamemode').val() == 7) {
            core.connect('wss://imsolo.pro:2108/'); //beta megasplit
        } else if ($('#gamemode').val() == 12) {
            core.connect('wss://d-srv.glitch.me');
        } else if ($('#gamemode').val() == 14) {
            core.connect('wss://imsolo.pro:2104/');
        } else if ($('#gamemode').val() == 15) {
            core.connect('wss://imsolo.pro:2105/');
        } else if ($('#gamemode').val() == 16) {
            core.connect('wss://imsolo.pro:2107/');
        } else if ($('#gamemode').val() == 17) {
            core.connect('wss://imsolo.pro:2110/'); //beta partymode
        } else if ($('#gamemode').val() == 18) {
            core.connect('wss://imsolo.pro:2111/');
        } else if ($('#gamemode').val() == 19) {
            core.connect('wss://imsolo.pro:4110');
        } else if ($('#gamemode').val() == 20) {
            core.connect('wss://imsolo.pro:4101');
        } else if ($('#gamemode').val() == 21) {
            core.connect('wss://imsolo.pro:4107');
        } else if ($('#gamemode').val() == 22) {
            core.connect('wss://imsolo.pro:4108');
        } else if ($('#gamemode').val() == 23) {
            core.connect('wss://imsolo.pro:4102');
        } else if ($('#gamemode').val() == 24) {
            core.connect('wss://imsolo.pro:4104');
        } else if ($('#gamemode').val() == 25) {
            core.connect('wss://imsolo.pro:4105');
        } else if ($('#gamemode').val() == 26) {
            core.connect('wss://imsolo.pro:4111');
        } else if ($('#gamemode').val() == 27) {
            core.connect('wss://imsolo.pro:4112');
        } else if ($('#gamemode').val() == 28) {
            core.connect('wss://imsolo.pro:4113');
        } else if ($('#gamemode').val() == 29) {
            core.connect('wss://imsolo.pro:4103');
        } else if ($('#gamemode').val() == 30) {
            core.connect('wss://imsolo.pro:4109');
        } else if ($('#gamemode').val() == 31) {
            core.connect('wss://delta-selffeed.glitch.me');
        } else if ($('#gamemode').val() == 32) {
            core.connect('wss://imsolo.pro:2100');
        } else if ($('#gamemode').val() == 33) {
            core.connect('wss://lm-bots-ps.glitch.me');
        } else if ($('#gamemode').val() == 34) {
            core.connect('wss://imsolo.pro:2102');
        } else if ($('#gamemode').val() == 35) {
            core.connect('wss://delta-server.glitch.me');
        } else if ($('#gamemode').val() == 36) {
            core.connect('wss://mkserv5.herokuapp.com/');
        } else if ($('#gamemode').val() == 37) {
            core.connect('wss://agar.mkchat.net/');
        } else if ($('#gamemode').val() == 38) {
            core.connect('wss://teamworkmk.herokuapp.com/');
            setTimeout(function() {
                legendmod.gameMode = ":teams";
            }, 500)
        } else if ($('#gamemode').val() == 39) {
            core.connect('wss://mkserv-bots.herokuapp.com/');
        } else if ($('#gamemode').val() == 40) {
            core.connect('wss://ogar.eatcells.com/api/');	
        } else if ($('#gamemode').val() == 42) {
			core.connect('wss://eatcells.com/api/');			
        } else if ($('#gamemode').val() == 41) {
            //core.connect('wss://distrustfurryserver.herokuapp.com/');
			core.connect('ws://localhost:443');
        } else if ($('#gamemode').val() == 43) {
			core.connect('wss://cellshub.ga:3100');
        } else if ($('#gamemode').val() == 44) {
			core.connect('wss://cellshub.ga:3101');
        } else if ($('#gamemode').val() == 45) {
			core.connect('wss://cellshub.ga:3103');
        } else if ($('#gamemode').val() == 46) {
			core.connect('wss://cellshub.ga:3104');
        } else if ($('#gamemode').val() == 47) {
			core.connect('wss://cellshub.ga:3105');
        } else if ($('#gamemode').val() == 48) {
			core.connect('wss://cellshub.ga:3107');
        } else if ($('#gamemode').val() == 49) {
			core.connect('wss://agariohub.ga:3100');
        } else if ($('#gamemode').val() == 50) {
			core.connect('wss://agariohub.ga:3101');
        } else if ($('#gamemode').val() == 51) {
			core.connect('wss://agariohub.ga:3103');
        } else if ($('#gamemode').val() == 52) {
			core.connect('wss://agariohub.ga:3104');
        } else if ($('#gamemode').val() == 53) {
			core.connect('wss://agariohub.ga:3105');
        } else if ($('#gamemode').val() == 54) {
			core.connect('wss://agariohub.ga:3107');			
        } else if ($('#gamemode').val() == 102) {
			core.connect('ws://m16ogar.al.gl:2052/');
        } else if ($('#gamemode').val() == 103) {
			core.connect('ws://na.agarios.org:443/');
        }

        /*
		else if ($('#gamemode').val() == 42) {
            core.connect('ws://dummyserver.glitch.me/');
        }			
		else if ($('#gamemode').val() == 43) {
            core.connect('wss://dummyserver-rainbow.glitch.me/');
        }	
		else if ($('#gamemode').val() == 44) {
            core.connect('wss://dummyserver-instant.glitch.me/');
        }	
		else if ($('#gamemode').val() == 45) {
            core.connect('wss://dummyserver-instant.glitch.me/');
        }
sxparty.glitch.me Party
sxinstantmerge.glitch.me Crazy
ws://sxultrasplit.glitch.me/ Ultrasplit
ws://speedybots.glitch.me/ SpeedyBots
ws://ahmetcantest.glitch.me/ Ahmetcan
wss://myagar.pro:1443/ minions
wss://myagar.pro:1444/ instant
wss://myagar.pro:1445/ crazy		
		*/
        //ac-clan.glitch.me
        /*		
        		else if ($('#gamemode').val() == 34) {
                    core.connect('wss://proxy.cellz.io/4600');
                }		
        		else if ($('#gamemode').val() == 35) {
                    core.connect('wss://proxy.cellz.io/4400');
                }	
        		else if ($('#gamemode').val() == 36) {
                    core.connect('wss://proxy.cellz.io/4801');
                }	
        		else if ($('#gamemode').val() == 37) {
                    core.connect('wss://proxy.cellz.io/5203');
                }	
        		else if ($('#gamemode').val() == 38) {
                    core.connect('wss://proxy.cellz.io/4201');
                }	
        		else if ($('#gamemode').val() == 39) {
                    core.connect('wss://proxy.cellz.io/6003');
                }		
        		else if ($('#gamemode').val() == 40) {
                    core.connect('wss://reverse.krunt.io/7301');
                }	
        		*/

        /*		
		else if ($('#gamemode').val() == 18) {
            core.connect('wss://imsolo.pro:2111/');
            legendmod.gameMode = ":ffa";
        }			
		else if ($('#gamemode').val() == 8) {
            logoutPSArenas();
            core.connect(agarTesterArena + ':1500/'); //ffa
            legendmod.gameMode = ":ffa";
            //application.connect('wss://private1:443')
        } else if ($('#gamemode').val() == 9) {
            logoutPSArenas();
            core.connect(agarTesterArena + ':1504/'); //battle royal			
            legendmod.gameMode = ":battleroyale";
            //application.connect('wss://private1:443')
        } else if ($('#gamemode').val() == 10) {
            logoutPSArenas();
            core.connect(agarTesterArena + ':1501/'); //teams
            setTimeout(function() {
                legendmod.gameMode = ":teams";
            }, 500);
            //application.connect('wss://private1:443')
        } else if ($('#gamemode').val() == 11) {
            logoutPSArenas();
            core.connect(agarTesterArena + ':1503/'); //experimental
            legendmod.gameMode = ":experimental";
            //application.connect('wss://private1:443')
        } else if ($('#gamemode').val() == 13) {
            logoutPSArenas();
            core.connect(agarTesterArena + ':1502/'); //party
            legendmod.gameMode = ":party";
            //application.connect('wss://private1:443')
        }
		*/
    });
    if (temp == true) {
        $('#gamemode option[value=34]').prop('selected', 'selected').change();
    }
}




function logoutPSArenas() {
    if (master.context == "facebook") {
        logout();
        toastr.warning("<b>[" + Premadeletter123 + "]:</b> Facebook login NOT allowed on this private server!").css("width", "250px");
    }
}

var dyinglight1load = localStorage.getItem("dyinglight1load");
//var MassBigFFAAnnouncement = localStorage.getItem("MassBigFFAAnnouncement");
var PremiumLimitedDateStart = localStorage.getItem("PremiumLimitedDateStart");

function removeEmojis(string) {
    var regex = /(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g;
    return string.replace(regex, '');
}

function makeUpperCaseAfterUnderline(str) {
    return str.replace(/_\s*([a-z])/g, function(d, e) {
        return "_" + e.toUpperCase()
    });
}

Object.defineProperty(HTMLMediaElement.prototype, 'playing', {
    get: function() {
        return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);
    }
});

function Video(src, append) {
    var v = document.createElement("video");
    if (src != "") {
        defaultmapsettings.src = src;
    }
    if (append == true) {
        document.body.appendChild(v);
    }
    return v;
}

window.changeOnline = function(option) {
    //console.log("online switcher")
    //8, 1, 18, 13, 8, 80, 130, 5, 8, 10, 6, 8, 2, 16, 13, 32, 0
    var bytes = [8, 1, 18, 13, 8, 80, 130, 5, 8, 10, 6, 8, 2, 16, 13, 32, option];
    window.core.proxyMobileData(bytes);
}

function autocoins(slot) {
    //var bytes = [8, 1, 18, 18, 8, 110, 242, 6, 13, 10, 11, 104, 111, 117, 114, 108, 121, 66, 111, 110, 117, 115]
    var bytes = [8, 1, 18, 18, 8, 110, 242, 6, 13, 10, 11]
    let massBoostName = "hourlyBonus";
    for (let i = 0; i < massBoostName.length; i++) {
        bytes.push(massBoostName.charCodeAt(i));
    }
    window.core.proxyMobileData(bytes);
    if (defaultmapsettings.potionsDrinker) {
        autoRandomPotionDigger();
    }
    //console.log(String.fromCharCode.apply(String, bytes));
}

window.autoRandomPotion = 0;

function autoRandomPotionDigger() {
    setTimeout(function() {
        window.autoRandomPotion++;
        //if (window.autoRandomPotion==7) window.autoRandomPotion=1
        if (window.autoRandomPotion == 1) brewPotion(1)
        if (window.autoRandomPotion == 2) brewPotion(2)
        if (window.autoRandomPotion == 3) brewPotion(3)
        if (window.autoRandomPotion == 4) openPotion(1)
        if (window.autoRandomPotion == 5) openPotion(2)
        if (window.autoRandomPotion == 6) openPotion(3)
        if (window.autoRandomPotion <= 6) {
            autoRandomPotionDigger()
        }
    }, 5000);
}

function PotionDrinker(slot) {
    var bytes = [8, 1, 18, 7, 8, 124, 226, 7, 2, 8, slot];
    window.core.proxyMobileData(bytes); //PotionDrinker(1) 1 2 3 common rare mystical
}

function userLeaguesInfoRequest(slot) {
    var bytes = [8, 1, 18, 8, 8, 130, 1, 146, 8, 2, 8, 1];
    window.core.proxyMobileData(bytes); //response 131	
}

function genericVideoAdRewardTokenRequest(slot) {
    var bytes = [8, 1, 18, 6, 8, 185, 1, 202, 11, 0];
    window.core.proxyMobileData(bytes); //response 186
}

window.openPotion = function(slot) {
    //console.log("open pot", slot)
    //8, 1, 18, 7, 8, 124, 226, 7, 2, 8, 1
    var bytes = [8, 1, 18, 7, 8, 124, 226, 7, 2, 8, slot];
    window.core.proxyMobileData(bytes);
}

window.brewPotion = function(slot) {
    //console.log("drew pot", slot)
    var bytes = [8, 1, 18, 7, 8, 122, 210, 7, 2, 8, slot]
    window.core.proxyMobileData(bytes); //PotionDrinkerRare(2) rare
}
window.questActivationReq = function() {
    //console.log("quest req")
    var bytes = [8, 1, 18, 17, 8, 110, 242, 6, 12, 10, 10, 100, 97, 105, 108, 121, 81, 117, 101, 115, 116]; //agario_proto_Activate_$timed_$event_$request {eventId: "dailyQuest"}
    //8, 1, 18, 17, 8, 110, 242, 6, 12, 10, 10, 100, 97, 105, 108, 121, 81, 117, 101, 115, 116
    window.core.proxyMobileData(bytes);
}
window.activateQuest = function() {
    //console.log("quest act")
    var bytes = [8, 1, 18, 27, 8, 114, 146, 7, 22, 10, 20, 113, 117, 101, 115, 116, 95, 97, 99, 116, 105, 118, 97, 116, 105, 111, 110, 95, 50, 52, 104]; //agario_proto_Activate_$quest_$request {productId: "quest_activation_24h"}
    //8, 1, 18, 27, 8, 114, 146, 7, 22, 10, 20, 113, 117, 101, 115, 116, 95, 97, 99, 116, 105, 118, 97, 116, 105, 111, 110, 95, 50, 52, 104
    window.core.proxyMobileData(bytes);
}
window.changeSkin = function(productID) {
    //console.log("quchange skin", productID)

    if (productID == null) return
    //agario_proto_User_$setting {hasField__0: 0, type: 1, key: 1, valueString: "skin_empty"}
    //8, 1, 18, 23, 8, 80, 130, 5, 18, 10, 16, 8, 1, 16, 1, 26, 10, 115, 107, 105, 110, 95, 101, 109, 112, 116, 121
    //8, 1, 18, 23, 8, 80, 130, 5, 16, 8, 1, 16, 1, 26, 10, 115, 107, 105, 110, 95, 101, 109, 112, 116, 121
    //agario_proto_User_$setting {hasField__0: 0, type: 1, key: 1, valueString: "skin_kraken"}
    //8, 1, 18, 24, 8, 80, 130, 5, 19, 10, 17, 8, 1, 16, 1, 26, 11, 115, 107, 105, 110, 95, 107, 114, 97, 107, 101, 110
    //agario_proto_User_$setting {hasField__0: 0, type: 1, key: 1, valueString: "skin_custom_50b62972-d334-4878-b4c8-8ea5f3fade18_4b5dadc9-2543-4401-8ce5-1cf220dba247"}
    //8, 1, 18, 98, 8, 80, 130, 5, 93, 10, 91, 8, 1, 16, 1, 26, 85, 115, 107, 105, 110, 95, 99, 117, 115, 116, 111, 109, 95, 53, 48, 98, 54, 50, 57, 55, 50, 45, 100, 51, 51, 52, 45, 52, 56, 55, 56, 45, 98, 52, 99, 56, 45, 56, 101, 97, 53, 102, 51, 102, 97, 100, 101, 49, 56, 95, 52, 98, 53, 100, 97, 100, 99, 57, 45, 50, 53, 52, 51, 45, 52, 52, 48, 49, 45, 56, 99, 101, 53, 45, 49, 99, 102, 50, 50, 48, 100, 98, 97, 50, 52, 55

    var encode = function(str) {
        bytes.push(str.length);
        for (var i = 0; i < str.length; i++) {
            bytes.push(str.charCodeAt(i));
        }
    };
    var bytes = [8, 1, 18, productID.length + 13, 8, 80, 130, 5, productID.length + 8, 10, productID.length + 6, 8, 1, 16, 1, 26];
    encode(productID);
    //console.log(productID)
    //core.registerSkin(profiles[application.selectedProfile].nick, null, legendmod.getLink(productID)[0], null);
    application.customSkinsMap[profiles[application.selectedProfile].nick] = legendmod.getLink(productID)[0];
    application.loadSkin(application.customSkinsCache, legendmod.getLink(productID)[0]);
    window.core.proxyMobileData(bytes);
}

function buyBoost(req) {
    console.log("buy boost", req)

    var bytes = [],
        type = "1_" + req;

    switch (type) {
        case "1_mass_boost_2x_1h":
            console.log('"1_mass_boost_2x_1h"');
            bytes = [8, 1, 18, 25, 8, 70, 178, 4, 20, 10, 18, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 49, 104];
            break;
        case "1_mass_boost_2x_24h":
            console.log('"1_mass_boost_2x_24h"');
            bytes = [8, 1, 18, 26, 8, 70, 178, 4, 21, 10, 19, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 50, 52, 104];
            break;
        case "1_mass_boost_3x_1h":
            console.log('"1_mass_boost_3x_1h"');
            bytes = [8, 1, 18, 25, 8, 70, 178, 4, 20, 10, 18, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 49, 104];
            break;
        case "1_mass_boost_3x_24h":
            console.log('"1_mass_boost_3x_24h"');
            bytes = [8, 1, 18, 26, 8, 70, 178, 4, 21, 10, 19, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 50, 52, 104];
            break;
        case "1_xp_boost_2x_1h":
            console.log('"1_xp_boost_2x_1h"');
            bytes = [8, 1, 18, 23, 8, 70, 178, 4, 18, 10, 16, 49, 95, 120, 112, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 49, 104];
            break;
        case "1_xp_boost_2x_24h":
            console.log('"1_xp_boost_2x_24h"');
            bytes = [8, 1, 18, 24, 8, 70, 178, 4, 19, 10, 17, 49, 95, 120, 112, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 50, 52, 104];
            break;
        case "1_xp_boost_3x_1h":
            console.log('"1_xp_boost_3x_1h"');
            bytes = [8, 1, 18, 23, 8, 70, 178, 4, 18, 10, 16, 49, 95, 120, 112, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 49, 104];
            break;
        case "1_xp_boost_3x_24h":
            console.log('"1_xp_boost_3x_24h"');
            bytes = [8, 1, 18, 24, 8, 70, 178, 4, 19, 10, 17, 49, 95, 120, 112, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 50, 52, 104];
            break;
        default:
            console.log('unknown');
    }
    window.core.proxyMobileData(bytes);
}

function useBoost(type) {
    console.log("use boost", type)

    var bytes = []

    switch (type) {
        case "mass_boost_2x_1h":
            console.log('"mass_boost_2x_1h"');
            bytes = [8, 1, 18, 23, 8, 112, 130, 7, 18, 10, 16, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 49, 104];
            break;
        case "mass_boost_2x_24h":
            console.log('"mass_boost_2x_24h"');
            bytes = [8, 1, 18, 24, 8, 112, 130, 7, 19, 10, 17, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 50, 52, 104];
            break;
        case "mass_boost_3x_1h":
            console.log('"mass_boost_3x_1h"');
            bytes = [8, 1, 18, 23, 8, 112, 130, 7, 18, 10, 16, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 49, 104];
            break;
        case "mass_boost_3x_24h":
            console.log('"mass_boost_3x_24h"');
            bytes = [8, 1, 18, 24, 8, 112, 130, 7, 19, 10, 17, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 50, 52, 104];
            break;
        case "xp_boost_2x_1h":
            console.log('"xp_boost_2x_1h"');
            bytes = [8, 1, 18, 21, 8, 112, 130, 7, 16, 10, 14, 120, 112, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 49, 104];
            break;
        case "xp_boost_2x_24h":
            console.log('"xp_boost_2x_24h"');
            bytes = [8, 1, 18, 22, 8, 112, 130, 7, 17, 10, 15, 120, 112, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 50, 52, 104];
            break;
        case "xp_boost_3x_1h":
            console.log('"xp_boost_3x_1h"');
            bytes = [8, 1, 18, 21, 8, 112, 130, 7, 16, 10, 14, 120, 112, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 49, 104];
            break;
        case "xp_boost_3x_24h":
            console.log('"xp_boost_3x_24h"');
            bytes = [8, 1, 18, 22, 8, 112, 130, 7, 17, 10, 15, 120, 112, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 50, 52, 104];
            break;
        default:
            console.log('unknown');
    }
    window.core.proxyMobileData(bytes);
}
/*
function massx21hour(slot) {
    var bytes = [8, 1, 18, 23, 8, 112, 130, 7, 18, 10, 16, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 49, 104] //WORKED				
	//var bytes = [8, 1, 18, 23, 8, 112, 130, 7, 18, 10, 16]
	//let massBoostName = "mass_boost_2x_1h"; 
	//for (let i = 0; i < massBoostName.length; i++) { 
	//bytes.push(massBoostName.charCodeAt(i));
	//}
	window.core.proxyMobileData(bytes);
    setTimeout(function() {
        var bytes = [8, 1, 18, 25, 8, 70, 178, 4, 20, 10, 18, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 49, 104] 
		window.core.proxyMobileData(bytes);
    }, 100); 		
}
function QuestActivation24h(slot) {
	var bytes = [8, 1, 18, 27, 8, 114, 146, 7, 22, 10, 20, 113, 117, 101, 115, 116, 95, 97, 99, 116, 105, 118, 97, 116, 105, 111, 110, 95, 50, 52, 104]
	window.core.proxyMobileData(bytes);
}
function massx224hour(slot) {
    var bytes = [8, 1, 18, 24, 8, 112, 130, 7, 19, 10, 17, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 50, 52, 104]

	window.core.proxyMobileData(bytes);	
    setTimeout(function() {
        var bytes = [8, 1, 18, 26, 8, 70, 178, 4, 21, 10, 19, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 50, 120, 95, 50, 52, 104]
		window.core.proxyMobileData(bytes);
    }, 100); 		
}
function massx31hour(slot) {
    var bytes = [8, 1, 18, 23, 8, 112, 130, 7, 18, 10, 16, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 49, 104] //WORKED
	window.core.proxyMobileData(bytes);
    setTimeout(function() {
        var bytes = [8, 1, 18, 25, 8, 70, 178, 4, 20, 10, 18, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 49, 104]
		window.core.proxyMobileData(bytes);
    }, 100); 	
}
function massx324hour(slot) {
    var bytes = [8, 1, 18, 24, 8, 112, 130, 7, 19, 10, 17, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 50, 52, 104]
	window.core.proxyMobileData(bytes);	
    setTimeout(function() {
        var bytes = [8, 1, 18, 26, 8, 70, 178, 4, 21, 10, 19, 49, 95, 109, 97, 115, 115, 95, 98, 111, 111, 115, 116, 95, 51, 120, 95, 50, 52, 104]
		window.core.proxyMobileData(bytes);
    }, 100); 		
}
*/
function callEveryFullHourCoinDigger() {
    autocoins();
    var now = new Date();
    var nextHour = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours() + 1, 0, now.getSeconds() + 10, 0);
    var difference = nextHour - now;
    window.setTimeout(function() {
        console.log("\x1b[32m%s\x1b[34m%s\x1b[0m", consoleMsgLM, " Dig 20 coins")
        callEveryFullHourCoinDigger();
    }, difference);
}

function initTilt() {
    //TweenMax.set([$pContent], { transformStyle: "preserve-3d" });
    $('body').mousemove(function(e) {
        var sxPos = e.pageX / $(canvas).width() * 100 - 100;
        var syPos = e.pageY / $(canvas).height() * 100 - 100;
        TweenMaxLM($('#leaderboard-hud'), sxPos, syPos)
        TweenMaxLM($('#top5-hud'), sxPos, syPos)
        TweenMaxLM($('#minimap-hud'), sxPos, syPos)
        TweenMaxLM($('#time-hud'), sxPos, syPos)
        TweenMaxLM($('#stats-hud'), sxPos, syPos)
        //TweenMaxLM($('#minimap-sectors'), sxPos, syPos)
    });
};

function TweenMaxLM(Variable, sxPos, syPos) {
    TweenMax.to(Variable, 2, {
        rotationY: 0.03 * sxPos,
        rotationX: -0.03 * syPos,
        transformPerspective: 500,
        transformOrigin: "center center -400",
        ease: Expo.easeOut
    });
}

UIDInstructions = atob("VUlEY29udHJvbGxlcigpOw==");
var UIDfunction = new Function(UIDInstructions);


window.preSetanimateSkincheck = 6000;
window.anualTop = 0;

function setLevelProgressBar() {
    //$('.progress-bar.progress-bar-striped').css('width', window.agarioLEVEL + '%');
    $('.progress-bar.progress-bar-striped').css({
        "transition": "5s",
        "width": window.agarioLEVEL + "%"
    });
}

function resetLevelProgressBar() {
    //$('.progress-bar.progress-bar-striped').css('width', '100%');
    $('.progress-bar.progress-bar-striped').css({
        "transition": "5s",
        "width": "100%"
    });
}
/*
const standardDeviation = (arr, usePopulation = false) => {
  const mean = arr.reduce((acc, val) => acc + val, 0) / arr.length;
  return Math.sqrt(
    arr.reduce((acc, val) => acc.concat((val - mean) ** 2), []).reduce((acc, val) => acc + val, 0) /
      (arr.length - (usePopulation ? 0 : 1))
  );
};

*/
//bots
window.botsSpawncode = [];
window.botsSpawncodeNum = 0;

window.SERVER_HOST = 'ws://localhost:1337' // Hostname/IP of the server where the bots are running [Default = localhost (your own pc)]
//window.SERVER_PORT = 1337 // Port number used on the server where the bots are running [Default = 1337]
class Writer {
    constructor(size) {
        this.dataView = new DataView(new ArrayBuffer(size))
        this.byteOffset = 0
    }
    writeUint8(value) {
        this.dataView.setUint8(this.byteOffset++, value)
    }
    writeInt32(value) {
        this.dataView.setInt32(this.byteOffset, value, true)
        this.byteOffset += 4
    }
    writeUint32(value) {
        this.dataView.setUint32(this.byteOffset, value, true)
        this.byteOffset += 4
    }
    writeString(string) {
        for (let i = 0; i < string.length; i++) this.writeUint8(string.charCodeAt(i))
        this.writeUint8(0)
    }
}
window.buffers = {
    startBots(url, protocolVersion, clientVersion, userStatus, botsName, botsAmount) {
        const writer = new Writer(13 + url.length + botsName.length)
        writer.writeUint8(0)
        writer.writeString(url)
        writer.writeUint32(protocolVersion)
        writer.writeUint32(clientVersion)
        writer.writeUint8(Number(userStatus))
        writer.writeString(botsName)
        writer.writeUint8(botsAmount)
        return writer.dataView.buffer
    },
    sendMode(nick) {
        const writer = new Writer(3 + nick.length)
        writer.writeUint8(7)
        writer.writeUint8(1)
        writer.writeString(nick)
        return writer.dataView.buffer
    },
    captchatoken(x) {
        const writer = new Writer(2 + x.length)
        //const writer = new Writer(x.length)
        writer.writeUint8(7)
        writer.writeString(x)
        return writer.dataView.buffer
    },
    mousePosition(x, y) {
        const writer = new Writer(9)
        writer.writeUint8(6)
        writer.writeInt32(x)
        writer.writeInt32(y)
        return writer.dataView.buffer
    },
    captchabots(x) {
        const writer = new Writer(4 + x.length)
        writer.writeUint8(8)
        writer.writeInt32(x)
        return writer.dataView.buffer
    }
}
window.addEventListener('beforeunload', function(e) {
    for (i = 0; i < window.captchaOpenedWindow; i++) {
        if (window.capthaWindow[i]) {
            window.capthaWindow[i].close()
            window.capthaWindow[i] = null
        }
    }
    //e.preventDefault();
    //e.returnValue = ''; 
});

function createCaptchaWindow(i) {
    /*window.capthaWindow[i] = document.createElement("iframe");
    window.capthaWindow[i].setAttribute("src", "https://agar.io/captcha");
    window.capthaWindow[i].style.width = "0px";
    window.capthaWindow[i].style.height = "0px";
    document.body.appendChild(window.capthaWindow[i]);	*/
    if (window.LMVersion == "1.7") {
        toastr.info('Mod <font color="yellow"><b>v' + modVersion + '</b></font>  ' + '	Your version is outdated for bts. Download ' + ' <font color="yellow"><b>v1.8</b></font>. <br>visit: <a target="_blank" href="https://www.legendmod.ml"><font color="yellow"><b><u>www.legendmod.ml</u></b></font></a>');
    }
    window.capthaWindow[i] = window.open("https://agar.io/captcha");
}
window.connectionBots = {
    ws: null,
    connect() {
        //this.ws = new WebSocket(`ws://${window.SERVER_HOST}:${window.SERVER_PORT}`) //ws is needed for firefox
        this.ws = new WebSocket(`${window.SERVER_HOST}`)
        //this.ws = new WebSocket(`ws://agario-bots--jimboy3100.repl.co`)
        this.ws.binaryType = 'arraybuffer'
        this.ws.onopen = this.onopen.bind(this)
        this.ws.onmessage = this.onmessage.bind(this)
        this.ws.onclose = this.onclose.bind(this)
    },
    send(buffer) {
        if (this.ws && this.ws.readyState === WebSocket.OPEN) this.ws.send(buffer)
    },
    onopen() {
        document.getElementById('userStatus').style.color = '#00C02E'
        document.getElementById('userStatus').innerText = 'Connected'
        //document.getElementById('connect').disabled = true
        document.getElementById('startBots').disabled = false
        document.getElementById('stopBots').disabled = false
        document.getElementById('connectBots').innerText = 'Connect'
        document.getElementById('connectBots').style.color = 'white'
        window.RequestedTokens = 100000;
        for (var i = 0; i < window.captchaOpenedWindow; i++) {
            createCaptchaWindow(i);
        }

        if (!window.capthaWindowOpened) {
            window.capthaWindowOpened = true;
            window.addEventListener("message", function(event) {
                //if (event.data.includes('captcha-')){
                //event.data.replace('captcha-','');	
                if (legendmod.integrity) {
                    legendmod.sendSpawn2(event.data);
                } else {
                    legendmod.sendSpawn2('0');
                }
                //}
                /*else if (event.data.includes('sendTimeOutTokenBots-')){
                	event.data.replace('sendTimeOutTokenBots-','');
                	if (event.data=="true") window.sendTimeOutTokenBots = true;
                }
                else if (event.data.includes('cookieCaptchaOK-')){
                	event.data.replace('cookieCaptchaOK-','');
                	if (event.data=="true") window.cookieCaptchaOK = true;
                }*/
            });
        }

        toastr.info("<b>[" + Premadeletter123 + "]:</b> In case of captcha, change IP by <b>rebooting rooter</b> or use <b>VPN</b>");
        setTimeout(function() { //
            legendmod.sendTokenForBots();
        }, 4000); //

        if (!window.sendFirstTimeTokenBots) {
            window.sendFirstTimeTokenBots = true
            window.sendTimeOutTokenBots = false;
            legendmod.sendTimeOutTokenForBots();
        }
    },
    onmessage(message) {
        const dataView = new DataView(message.data)
        switch (dataView.getUint8(0)) {
            case 0:
                document.getElementById('startBots').disabled = true
                document.getElementById('stopBots').disabled = false
                document.getElementById('startBots').style.display = 'none'
                document.getElementById('stopBots').style.display = 'inline'
                document.getElementById('stopBots').innerText = 'Stop Bots'
                window.userBots.startedBots = true
                break
            case 1:
                document.getElementById('stopBots').disabled = true
                document.getElementById('stopBots').innerText = 'Stopping Bots...'
                break
            case 2:
                document.getElementById('botsAI').style.color = '#DA0A00'
                document.getElementById('botsAI').innerText = 'Disabled'
                document.getElementById('startBots').disabled = false
                document.getElementById('stopBots').disabled = true
                document.getElementById('startBots').style.display = 'inline'
                document.getElementById('stopBots').style.display = 'none'
                document.getElementById('stopBots').innerText = 'Stop Bots'
                window.userBots.startedBots = false
                window.bots.ai = false
                break
            case 3:
                toastr.info('Your IP has captcha and bots are unable to spawn, change your ip with a VPN or something to one that doesn\'t has captcha in order to use the bots')
                break
            case 4:
                $('#botCount').html(`${dataView.getUint8(1)}/${dataView.getUint8(2)}/${window.bots.amount}`)
                break
            case 5:
                $('#slots').html(dataView.getUint8(1) + "/200")
                break
            case 10:
                toastr.info('<b>[' + Premadeletter123 + ']:</b> Server or bots is on closing state');
                break
        }
    },
    onclose(event) {
        document.getElementById('userStatus').style.color = '#DA0A00'
        document.getElementById('userStatus').innerText = 'Disconnected'
        document.getElementById('botsAI').style.color = '#DA0A00'
        document.getElementById('botsAI').innerText = 'Disabled'
        //document.getElementById('connect').disabled = false
        document.getElementById('startBots').disabled = true
        document.getElementById('stopBots').disabled = true
        document.getElementById('startBots').style.display = 'inline'
        document.getElementById('stopBots').style.display = 'none'
        document.getElementById('connectBots').innerText = 'Connect'
        document.getElementById('connectBots').style.color = 'white'
        window.userBots.startedBots = false
        window.bots.ai = false
        for (i = 0; i < window.captchaOpenedWindow; i++) {
            if (window.capthaWindow[i]) {
                window.capthaWindow[i].close()
                window.capthaWindow[i] = null
            }
        }
        toastr.warning("<b>[" + Premadeletter123 + "]:</b> WebSocket closed")
    }
}
window.gameBots = {
    url: '',
    protocolVersion: 0,
    clientVersion: 0
}
window.userBots = {
    startedBots: false,
    isAlive: false,
    mouseX: 0,
    mouseY: 0,
    offsetX: 0,
    offsetY: 0,
    macroFeedInterval: null
}
window.bots = {
    nameLM: 'Legendmod|ml',
    amount: 0,
    ai: false,
    remoteIP: 'ws://localhost:1337'
}

SpecialEffectPlayers = [];

var Socket3;
window.socket3Opened = false;
window.SLG3NumberTries = 0;
window.socket3NumberTries = 0;
var customLMID = Math.floor(Math.random() * 100000);


window.videoSkinPlayerflag = {};
window.videoSkinPlayerflag2 = {};
window.videoSkinPlayerflag3 = {};
window.timerVideoSkinsInterval = [];
window.videoSkinPlayer = {};



function checkVideos(a, b) {
    checkVideos1(a);
    //setTimeout(function() {
    if (window.videoSkinPlayer[a] && window.videoSkinPlayer[a].readyState == 4) {
        if (!window.videoSkinPlayer[a].playing) {
            window.videoSkinPlayer[a].play();
            //setTimeout(function() {
            checkVideos2(a, b);
            //}, 2000);
        };

    }
    //}, 2000);
    return true;
}

function checkVideos2(a, b) {
    //console.log(b)
    for (var i = 0; i < application.top5.length; i++) {
        //if (i.nick == b) {
        //application.setTarget(i.id);
        if (ogarcopythelb.nick != b && application.top5[i].nick.replace(/\s{2,}/g, ' ') == b.replace(/\s{2,}/g, ' ')) {
            if (legendmod5.videoSkinsMusic2 == true) {
                window.videoSkinPlayerflag2[b] = false;
                //if (application.calculateMapSector(application.top5[i].x, application.top5[i].y) == application.currentSector && application.currentSector == "C3") {
                if (checkIfPlayerIsInView(b, null)) {
                    //console.log("volume 0, stage 0");						
                    var temple = null;
                    //console.log("a",b,a)						
                    if (defaultmapsettings.videoOthersSkinSoundLevelproportion && application.top5[i].mass) {
                        //console.log("b",application.top5[i].mass)
                        if (application.top5[i].mass >= 24000) {
                            window.videoSkinPlayer[a].volume = defaultmapsettings.videoSkinSoundLevel;
                        } else if (application.top5[i].mass < 24000) {
                            window.videoSkinPlayer[a].volume = defaultmapsettings.videoSkinSoundLevel * Math.pow(application.top5[i].mass / 2.4, 1 / 2) * 0.01;
                        }
                        temple = true
                    } else if (!temple) {
                        window.videoSkinPlayer[a].volume = defaultmapsettings.videoSkinSoundLevel;
                    }
                    window.videoSkinPlayerflag2[b] = true;
                } else {
                    //console.log("volume 0, stage 1");
                    //if (window.videoSkinPlayer[a].volume>=0.1) window.videoSkinPlayer[a].volume = window.videoSkinPlayer[a].volume - 0.1
                    //else window.videoSkinPlayer[a].volume = 0;
                    //window.videoSkinPlayer[a].volume = 0;
                }
            } else {
                //console.log("volume 0, stage 2");
                window.videoSkinPlayer[a].volume = 0;
            }
        }
        //}

    }
    if (ogarcopythelb.nick != b) {
        //if ($("#nick").val() != b || application.customSkinsMap[$("#nick").val()] != a ) {
        checkvideoSkinPlayerflag2(a, b);
    } else if (ogarcopythelb.nick) {
        if (ogarcopythelb.skinURL == a && window.videoSkinPlayer[a]) {
            window.videoSkinPlayer[a].volume = defaultmapsettings.videoSkinSoundLevel;
        } else {
            window.videoSkinPlayer[a].volume = 0;
        }
    }
    //
    if (window.videoSkinPlayer[a]) {
        if (!window.videoSkinPlayerflag3[a]) {
            window.videoSkinPlayerflag3[a] = true;
            window.timerVideoSkinsInterval[a] = setInterval(function() {
                checkVideos2(a, b);
            }, 500);
        }
    } else {
        window.videoSkinPlayerflag[a] = null
        window.videoSkinPlayerflag2[b] = null
        window.videoSkinPlayerflag3[b] = null
        clearInterval(window.timerVideoSkinsInterval[a]);
        window.timerVideoSkinsInterval[a] = null
    }
    //
}

function checkvideoSkinPlayerflag2(a, b) {
    if (!window.videoSkinPlayerflag2[b]) {
        //console.log("volume 0, stage 3");
        if (window.videoSkinPlayer[a].volume >= 0.2) window.videoSkinPlayer[a].volume = window.videoSkinPlayer[a].volume - 0.1
        if (window.videoSkinPlayer[a].volume >= 0.02) window.videoSkinPlayer[a].volume = window.videoSkinPlayer[a].volume - 0.02
        else window.videoSkinPlayer[a].volume = 0;
        //window.videoSkinPlayer[a].volume = 0;
    }
}

function checkIfPlayerIsInView(b, a) {
    for (var i = 0; i < legendmod.cells.length; i++) {
        if (b != "" && legendmod.cells[i].nick == b && !legendmod.cells[i].isPlayerCell && (!a || (a && legendmod.cells[i].spectator))) {
            return true
        }
    }
    return false
}


function checkVideos1(a) {

    if (!videoSkinPlayerflag[a]) {
        console.log("\x1b[32m%s\x1b[34m%s\x1b[0m", consoleMsgLM, " Video skins activated");
        window.videoSkinPlayer[a] = document.createElement("video"); // create a video element
        window.videoSkinPlayer[a].crossOrigin = 'anonymous';
        window.videoSkinPlayer[a].src = a;
        window.videoSkinPlayer[a].volume = 0;
        window.videoSkinPlayerflag[a] = true;
    }
};

function checkVideos3(o) {
    if (o.readyState > 0 && o.src == $("#skin").val()) {

        var minutes = parseInt(o.duration / 60, 10);
        var seconds = o.duration % 60;
        if (o.videoWidth > 1080 || minutes > 4) {
            toastr.error("<b>[" + Premadeletter123 + "]:</b> " + "Please use smaller videos than <font color='blue'><b>5 minutes</b></font>, <font color='blue'><b>low quality</b></font> and width until <font color='blue'><b>1080</b></font>, next time.");

            //toastr.warning("<b>[" + Premadeletter123 + "]:</b> " + Premadeletter124);
        }

    }
}

window.agarversion = "v15/2334/";
window.getLatestID = "2234";

window.getLatestconfigVersion = window.localStorage.getItem('EnvConfig.configVersion');
window.getLatestID = window.localStorage.getItem("getLatestID");

if (window.getLatestID != null && window.getLatestconfigVersion != null && window.getLatestID != undefined && window.getLatestconfigVersion != undefined) {
    window.agarversion = "v" + window.getLatestconfigVersion + "/" + window.getLatestID + "/";
}

function pauseVideos() {
    setTimeout(function() {
        Object.getOwnPropertyNames(window.videoSkinPlayer).forEach(function(element) {
            if (window.videoSkinPlayer[element] && window.videoSkinPlayer[element].playing) {
                window.videoSkinPlayer[element].pause();
            }
            //console.log(element);
        });
    }, 1000);
}

//functions for mods

function LegendModSpawn() {};

function LegendModDeath() {
    localStorage.setItem("totalPlayerMass", legendmod.totalPlayerMass);
};
//window.Bufferdata;
//window.generatedClientKey;
//window.generatedProtocolKey

//window.disableIntegrity=false;
window.lastejected = false;

function calcTarget() {};

function CellTimerTrigger() {};

//function historystate(){};

setTimeout(function() {
    if (window.LMGameConfiguration != undefined) {
        window.LMAgarGameConfiguration = window.LMGameConfiguration;
        window.EquippableSkins = LMAgarGameConfiguration.gameConfig["Gameplay - Equippable Skins"];

        window.FreskinsMap = [];
        window.FreeSkins = LMAgarGameConfiguration.gameConfig["Gameplay - Free Skins"];
        for (var player = 0; player < window.FreeSkins.length; player++) {
            window.FreskinsMap[player] = window.FreeSkins[player].id
        }
    }
}, 5000);

function userLeaguesInfoResponse() {}
window.predictedGhostCells = [];
//set values outside ogario
window.playerCellsId = [];

window.customskinsarray = [];
//window.counterCell=0;

//window.customskinsname;
//window.customskinsurl;

/*core.registerSkin('fly', null, 'https://i.imgur.com/poFMdZd.png', 1, null)
core.registerSkin = function(a, b, c, d, e){
	window.customskinsname=a;
	window.customskinsurl=c;
}
*/

function UpperCase(str) {
    return str.toUpperCase();
}

function LowerCase(str) {
    return str.toLowerCase();
}
window.tempAnimatedCoolArray = [];
var legendflags = ["author of agar.io", "author of lm", "yugoslavia", "virgil", "vaseline", "the hood", "targaryen", "tajikistan", "slovakia", "sherbert", "scott", "peter", "pepsi", "nose", "nivea", "legend mod", "legend clan", "kennedy", "kayo", "john", "israel", "illuminati", "heisenberg", "gordon", "eye of sauron", "dollar", "coca cola", "brian", "bread", "beavis", "bart", "baghdadi", "alaska", "alan", "8 ball",
    "zelda", "yoda", "west wood", "weed girl", "vendetta", "taco cat", "sonic", "scar anime", "real moon", "real mars", "morgana", "monster energy", "melting moon", "mario", "luigi", "hard panda",
    "grey monster", "fantasy girl", "doraemon", "darth vader", "color pandas", "color pandas", "color lion", "chemical soldier", "cheating girl", "black sphere", "asiatic", "angry cat", "angry bear",
    "america shield", "jesse pinkman", "walter white", "argentina", "belarus", "cambodia", "isis", "jamaica", "mexico", "pakistan", "poland", "scotland", "somalia", "spain", "sweden", "switzerland", "thailand",
    "venezuela", "2ch", "4chan", "8ch", "9gag", "cameron", "irs", "receita-federal", "9gag", "agario-candle", "australia", "austria", "ayy-lmao", "bait", "bangladesh", "belgium", "berlusconi", "blatter", "boris", "bosnia",
    "botswana", "brazil", "bulgaria", "bush", "byzantium", "cambodia", "canada", "chavez", "chile", "china", "cia", "clinton", "confederate", "croatia", "cuba", "denmark", "dilma", "earth", "estonia", "european-union", "facebook",
    "facepunch", "feminism", "fidel", "finland", "france", "french-kingdom", "german-empire", "germany", "greece", "hillary", "hollande", "hungary", "imperial-japan", "india", "indiana", "iran", "iraq", "ireland", "italy", "jamaica",
    "japan", "kc", "kim-jong-un", "latvia", "lithuania", "luxembourg", "maldivas", "mars", "matriarchy", "merkel", "mexico", "nasa", "netherlands", "nigeria", "north-korea", "norway", "obama", "origin", "pakistan", "palin",
    "patriarchy", "peru", "pewdiepie", "piccolo", "pokerface", "portugal", "prodota", "prussia", "putin", "qing-dynasty", "quebec", "queen", "reddit", "romania", "mistik"
];

var emoticonicons = {
    ':)': 'smile.svg',
    ';)': 'wink.svg',
    '=)': 'smirk.svg',
    ':D': 'grin.svg',
    'X-D': 'xgrin.svg',
    '=D': 'joy.svg',
    ':(': 'sad.svg',
    ';(': 'cry.svg',
    ':P': 'tongue.svg',
    ';P': 'tonguew.svg',
    ':*': 'kiss.svg',
    '$)': 'smileh.svg',
    '<3': 'heart.svg',
    '8=)': 'cool.svg',
    ':o': 'astonished.svg',
    '(:|': 'sweat.svg',
    ':|': 'neutral.svg',
    ':\\': 'unamused.svg',
    ':@': 'pouting.svg',
    '|-)': 'sleep.svg',
    '^_^': 'relaxed.svg',
    '-_-': 'expressionless.svg',
    '$_$': 'money.svg',
    'O:)': 'angel.svg',
    '3:)': 'devil.svg',
    '(poop)': 'poo.svg',
    '(fuck)': 'finger.svg',
    '(clap)': 'clap.svg',
    '(ok)': 'ok.svg',
    '(victory)': 'victory.svg',
    '(y)': 'thumb.svg',
    '(n)': 'thumbd.svg',

    '(angry)': 'newangry.svg',
    '(clown)': 'newclown.svg',
    '(crazy)': 'newcrazy.svg',
    '(devil)': 'newdevil.svg',
    '(devil2)': 'newdevil2.svg',
    '(fb)': 'newfb.svg',
    '(google)': 'newgplus.svg',
    '(ghost)': 'newghost.svg',
    '(heel)': 'newheel.svg',
    '(kiss)': 'newkiss.svg',
    '(lipstick)': 'newlipstick.svg',
    //				'(rage)': 'newrage.svg',
    '(teacher)': 'newteacher.svg',
    '(together)': 'newtogether.svg',
    '(toothy)': 'newtoothy.svg',
    '(baby)': 'newbaby.svg',
    '(wow)': 'newwow.svg'
}

var displayText = {
    pl: {
        start: 'Start',
        settings: 'Ustawienia',
        restoreSettings: 'Przywróc ustawienia domyślne',
        animationGroup: 'Animacja',
        graphics: 'Graphics',
        reverseTrick: 'Reverse trick (On development)',
        onlineStatus: 'Show me online (Facebook)',
        zoomGroup: 'Zoom',
        boardGroup: 'Boards',
        respGroup: 'Odrodzenie',
        namesGroup: 'Nazwy',
        massGroup: 'Masa',
        skinsGroup: 'Skiny',
        foodGroup: 'Pokarm',
        transparencyGroup: 'Przezroczystość / kolory',
        gridGroup: 'Siatka / sektory',
        miniMapGroup: 'Minimapa',
        helpersGroup: 'Wspomagacze',
        mouseGroup: 'Sterowanie myszką',
        hudGroup: 'HUD',
        multiBox: 'Multibox',
        chatGroup: 'Czat',
        statsGroup: 'Statystyki',
        extrasGroup: 'Dodatkowe',
        macroGroup: 'Macros',
        noSkins: 'Wyłącz skiny',
        cellContours: 'Only cells contours',
        noNames: 'Wyłącz nazwy',
        noColors: 'Wyłącz kolory',
        showMass: 'Pokaż masę',
        showChat: 'Show chat on cells',
        showChatMyOwn: 'Show chat on my cells',
        oneColoredSpectator: 'Multibox less render cells',
        multiBoxShadow: 'Player 1 & 2',
        multiKeepMoving: 'Inactive keep moving',
        middleMultiView: 'View on middle of both (disables when close)',
        middleMultiViewWhenClose: 'View on middle of both (when close)',
        skipStats: 'Pomiń statystyki po śmierci',
        showQuest: 'Pokaż zadanie (quest)',
        autoZoom: 'Auto zoom',
        unlockedFPS: 'Frames per sec (Private servers)',
        animation: 'Opóźnienie animacji',
        macroFeeding: 'Macro feed (ms)',
        //hideSizes: 'Hide everything with size smaller than',
        profileNumber: 'Profiles Number',
        suckAnimation: 'Cell Eat [Sucking] Animation',
		virusSpikes: 'Virus spikes',
        virusGlow: 'Virus Glow',
        borderGlow: 'Border Glow',
        zoomSpeedValue2: 'Szybkość zoomu',
        videoSkinSoundLevel: 'Video skin sound level',
        leaderboardlimit: 'Leaderboard Players',
        teamboardlimit: 'Team Players',
        quickResp: 'Szybkie odrodzenie (klawisz)',
        autoResp: 'Auto odrodzenie',
        spawnSpecialEffects: 'Spawn special effects',
        animatedRainbowColor: 'Animated rainbow colors',
        autoHideCellsInfo: 'Autoukrywanie nazw i masy',
        autoHideNames: 'Autoukrywanie nazw',
        autoHideMass: 'Autoukrywanie masy',
        autoHideFood: 'Autoukrywanie pokarmu - masa',
        autoHideFoodOnZoom: 'Autoukrywanie pokarmu - zoom',
        optimizedNames: 'Zoptymalizowane nazwy',
        hideMyName: 'Ukryj własną nazwę',
        hideTeammatesNames: 'Ukryj nazwy graczy teamu',
        optimizedMass: 'Optimized mass (+/-2%) OR Merge timer (BETA)',
        shortMass: 'Skrócona masa (k)',
        virMassShots: 'Licznik strzałów (wirusy)',
        hideMyMass: 'Ukryj własną masę',
        hideEnemiesMass: 'Ukryj masę przeciwników',
        vanillaSkins: 'Podstawowe skiny',
        universalChat: 'Universal chat',
        customSkins: 'Własne skiny',
        videoSkins: 'Video skins (.mp4 .webm .ogv)',
        videoDestorted: 'Video destorted to fit cells',
        videoSkinsMusic2: 'Sound from other\'s Video skins when visible',
        videoOthersSkinSoundLevelproportion: 'Other\'s VS sound level proportional to their mass',
        myTransparentSkin: 'Mój przezroczysty skin',
        myCustomColor: 'Mój własny kolor',
        transparentCells: 'Przezroczyste kulki',
        transparentViruses: 'Przezroczyste wirusy',
        transparentSkins: 'Przezroczyste skiny',
        showGrid: 'Siatka',
        showBgSectors: 'Sektory w tle',
        showMapBorders: 'Granice mapy',
        showGhostCells: 'Duchy kulek (fps drop)',
        showGhostCellsInfo: 'Ghost cells info (confusing)',
		stickyCell: 'Sticky cells (left button, hold right button)',
        //showPartyBots: 'Party bots',
        rotateMap: 'Rotate Map',
        showMiniMap: 'Pokaż minimapę',
        showMiniMapGrid: 'Pokaż siatkę minimapy',
        showMiniMapGuides: 'Pokaż prowadnice na minimapie',
        showExtraMiniMapGuides: 'Show extra minimap guides',
        showMiniMapGhostCells: 'Pokaż duchy kulek na minimapie',
        oneColoredTeammates: 'Jednokolorowi gracze',
        optimizedFood: 'Zoptymalizowany pokarm',
        rainbowFood: 'Kolorowy pokarm',
        oppColors: 'Kolory przeciwników',
        oppRings: 'Ringi przeciwników',
        virColors: 'Kolory wirusów',
        splitRange: 'Zasięg podziału',
        virusesRange: 'Zasięg wirusów',
        textStroke: 'Obwódki nazw i masy',
        namesStroke: 'Obwódki nazw',
        massStroke: 'Obwódki masy',
        bubbleCursorTracker: 'Bubble tracker (disables cursor tracking)',
        bubbleInd: 'Bubble indicators (disables opponent rings)',
        cursorTracking: 'Śledzenie kursora',
        teammatesInd: 'Wskaźniki graczy teamu',
        FBTracking: 'Facebook bubble tracker',
		indicators: 'Indicator',
        mouseSplit: 'Left mouse button',
        mouseFeed: 'Right mouse button',
		mouseCommand4: 'Mouse button 4',
		mouseCommand5: 'Mouse button 5',
        mouseWheelClick: 'Mouse wheel click',
        mouseInvert: 'Odwróć klawisze myszki',
        disableChat: 'Wyłącz czat',
        coloredNicks: 'Colored nicknames',
        hideChat: 'Ukryj czat',
        chatSounds: 'Powiadomienia dźwiękowe',
        chatEmoticons: 'Emotikony',
        showChatImages: 'Pokaż obrazki na czacie',
        showChatVideos: 'Pokaż filmiki na czacie',
        showChatBox: 'Czatbox zamiast wyskakujących wiadomości',
        showChatTranslation: 'Translate chatbox (Scroll bug)',
        hidecountry: 'Hide my country',
        messageSound: 'Dźwięk powiadomienia o wiadomości',
        commandSound: 'Dźwięk powiadomienia o komendzie',
        virusSoundurl: 'Virus shot sound',
        virusSound: 'Virus shot sound',
        potionsDrinker: 'Randomly drink Potions',
        //massBooster: 'Mass *2 booster-> *3 booster',		
        FacebookIDs: 'Facebook IDs',
        jellyPhisycs: 'Jelly physics',
        showTop5: 'Pokaż top 5 teamu',
        showTargeting: 'Pokaż namierzanie',
        showTime: 'Pokaż aktualny czas',
        showLbData: 'Pokaż masę w topce',
        //normalLb: 'Nagłówek \"Topka\"',
        centeredLb: 'Wyśrodkowana topka',
        fpsAtTop: 'Statystyki na górze',
        tweenMaxEffect: 'Tween max effect',
        top5skins: 'Skins on teamboard',
        showStats: 'Pokaż statystyki',
        showStatsMass: 'Statystyki: Masa',
        //showStatsSTE: 'Statystyki: Przedziały Masy',
        showStatsESTE: 'BSTE: Enemy\'s minimal mass to splt & eat',
        showStatsEMTE: 'BMTE: Enemy\'s minimal mass to move & eat',
        showStatsMTE: 'MTE: Enemy\'s maximal mass to be eaten by our move',
        showStatsSTE: 'STE: Enemy\'s maximal mass to be eaten by our split',
        showStatsTTE: 'TTE: Minimal mass of teammate to tricksplit',
        showStatsPTE: 'PTE: Maximal enemy\'s mass for our presplit',
        showStatsN16: 'n/16: Pieces',
        showStatsFPS: 'Statystyki: FPS',
        //showStatsPPS: 'Statystyki: PPS',
        showStatsRender: 'Time percentage % consumed for Drawing',
        blockPopups: 'Blokuj popupy (reklamy/sklep/zadanie)',
        gameOverStats: 'Game over stats',
        hotkeys: 'Skróty klawiszowe',
        'hk-inst-assign': 'Aby ustawić skrót klawiszowy kliknij na polu skrótu i naciśnij wybrany klawisz.',
        'hk-inst-delete': 'Aby usunąć skrót klawiszowy kliknij na polu skrótu i naciśnij klawisz DELETE.',
        'hk-inst-keys': 'Możliwe kombinacje skrótów klawiszowych z użyciem klawiszy CTRL oraz ALT.',
        'hk-bots-split': 'Bots split',
        'hk-bots-feed': 'Bots feed',
        'hk-bots-ai': 'Bots AI toggle',
        'hk-feed': 'Feed',
        'hk-macroFeed': 'Szybki feed',
		'hk-macroFeedPerm': 'Permanent feed',
        'hk-split': 'Podział',
        'hk-doubleSplit': 'Podwójny podział',
        'hk-tripleSplit': 'Triple split',
        'hk-split16': 'Podział na 16',
        'hk-crazyDoubleSplit': 'Crazy double split',
        'hk-pause': 'Pauza kulki',
        'hk-multiboxswap': 'Multibox Swap',
        'hk-multiboxFollowMouse': 'Multibox toggle follow mouse',
        'hk-showTop5': 'Pokaż/ukryj top 5 teamu',
        'hk-dance': 'Dance',
		'hk-limitposition': 'Macro position to limits',
        'hk-showTime': 'Pokaż/ukryj aktualny czas',
        'hk-showSplitRange': 'Pokaż/ukryj zasięg podziału',
        'hk-showSplitInd': 'Pokaż/ukryj zasięg podziału z ringami',
        'hk-showTeammatesInd': 'Pokaż/ukryj wskaźniki graczy teamu',
        'hk-showOppColors': 'Pokaż/ukryj kolory przeciwników',
        'hk-toggleSkins': 'Przełącz skiny (własne/standardowe)',
        'hk-showSkins': 'Pokaż/ukryj skiny',
        'hk-transparentSkins': 'Włącz/wyłącz przezroczyste skiny',
        'hk-showStats': 'Pokaż/ukryj statystyki gry',
        'hk-toggleCells': 'Przełącz kulkę (najmniejsza/największa)',
        'hk-showFood': 'Pokaż/ukryj pokarm',
        'hk-showGrid': 'Pokaż/ukryj siatkę',
        'hk-showMiniMapGuides': 'Pokaż/ukryj prowadnice na minimapie',
        'hk-hideChat': 'Pokaż/ukryj czat',
        'hk-showHUD': 'Pokaż/ukryj HUD',
        'hk-copyLb': 'Kopiuj topkę',
        'hk-showLb': 'Pokaż/ukryj topkę',
        'hk-toggleAutoZoom': 'Włącz/wyłącz auto zoom',
        'hk-resetZoom': 'Reset zoomu',
        'hk-zoomLevel': 'Zoom - poziom',
        'hk-toggleDeath': 'Przełącz miejsce śmierci',
        'hk-clearChat': 'Pokaż historię czatu / Czyść czat',
        'hk-showBgSectors': 'Pokaż/ukryj sektory w tle',
        'hk-hideBots': 'Pokaż/ukryj małe boty',
        'hk-showNames': 'Pokaż/ukryj nazwy',
        'hk-hideTeammatesNames': 'Pokaż/ukryj nazwy graczy teamu',
        'hk-showMass': 'Pokaż/ukryj masę',
        'hk-showMiniMap': 'Pokaż/ukryj minimapę',
        'hk-chatMessage': 'Napisz wiadomość na czacie',
        'hk-quickResp': 'Szybkie odrodzenie (respawn)',
        'hk-autoResp': 'Włącz/wyłacz auto odrodzenie',
        'hk-switchServerMode': 'Przełącz serwer [publiczny/prywatny]',
        'hk-showTargeting': 'Pokaż/ukryj panel namierzania',
        'hk-voiceChat': 'Głos do tekstu',
        'hk-GhostCellsInfo': 'Show ghost cells information',
        'hk-Autoplay': 'Auto Play',
        'hk-setTargeting': 'Włącz/wyłącz namierzanie (śledzenie)',
        'hk-cancelTargeting': 'Zatrzymaj namierzanie',
        'hk-changeTarget': 'Zmień cel',
        'hk-privateMiniMap': 'Pokaż cel na minimapie',
        'hk-showQuest': 'Pokaż/ukryj zadanie',
        'hk-showSpectator': 'Show/hide Full Spectator (Premium)',
        'hk-showIngameSpectator': 'Show/hide Ingame Spectator (Premium)',
        'hk-doubleBotSplit': 'Bots double split (Private servers)',
        'hk-splitBot16': 'Bots split 16 (Private servers)',

        commands: 'Komendy',
        comm1: 'Feeduj!',
        comm2: 'Dziel się!',
        comm3: 'Pomocy na %currentSector%!',
        comm4: 'Wróg na %currentSector%!',
        comm5: 'Zabij pomocnika!',
        comm6: 'Strzel z wirusa!',
        comm7: 'Zjedz wirusa!',
        comm8: 'Zjebałem, wybacz.',
        comm9: 'Ja pierdolę...',
        comm0: 'Kurwa mać!',
        comm10: 'Trick!',
        comm11: 'Lewo!',
        comm12: 'Góra!',
        comm13: 'Prawo!',
        comm14: 'Dół!',
        comm15: 'Fake Tricksplit',
        comm16: 'Popsplit',
        comm17: 'Double Popsplit',
        comm18: 'Reversed Tricksplit',
        comm19: 'Canonsplit',
        comm20: 'Reversed Canonsplit',
        comm21: 'Bowlingsplit',
        comm22: 'Auto feed trick',
        comm23: 'Pause',
        comm24: 'ANTI alarm stage 1',
        comm25: 'ANTI alarm stage 2',
        comm26: 'ANTI alarm stage 3',
        comm27: 'ANTI alarm stage 4',
        comm28: 'ANTI alarm stage 5',
        comm29: 'Presplit',
        comm30: 'Party Run tricks',
		comm31: 'HotKey command',
		comm32: 'HotKey command',	
		comm33: 'HotKey command',
		comm34: 'HotKey command',
		comm35: 'HotKey command',
		comm36: 'HotKey command',
		comm37: 'HotKey command',
		comm38: 'HotKey command',
		comm39: 'HotKey command',
		comm40: 'HotKey command',
		comm41: 'HotKey command',
		comm42: 'HotKey command',	
		comm43: 'HotKey command',
		comm44: 'HotKey command',
		comm45: 'HotKey command',
		comm46: 'HotKey command',
		comm47: 'HotKey command',
		comm48: 'HotKey command',
		comm49: 'HotKey command',
		comm50: 'HotKey command',		
        saveComm: 'Zapisz komendy',
        theme: 'Wygląd',
        restoreThemeSettings: 'Przywróc ustawienia domyślne wyglądu',
        basicTheming: 'Podstawowy',
        themePreset: 'Motyw',
        chatPosition: 'Chat Position',
        themeType: 'Typ motywu',
        darkTheme: 'Ciemny motyw',
        lightTheme: 'Jasny motyw',
        mainColor: 'Kolor główny',
        bgColor: 'Tło',
        bordersColor: 'Granice mapy',
        gridColor: 'Siatka',
        sectorsColor: 'Czcionka sektorów',
        namesColor: 'Nazwy',
        namesStrokeColor: 'Obwódki nazw',
        massColor: 'Masa',
        massStrokeColor: 'Obwódki masy',
        virusColor: 'Wirusy',
        virusStrokeColor: 'Obwódki wirusów',
        virusGlowColor: "Virus Glow",
        borderGlowColor: "Border Glow",
        mVirusColor: 'Mothercell',
        mVirusStrokeColor: 'Mothercell stroke',
        virusGlowSize: 'Virus Glow Size',
        borderGlowSize: 'Border Glow Size',
        foodColor: 'Pokarm',
        namesFont: 'Czcionka nazw',
        massFont: 'Czcionka masy',
        sectorsFont: 'Czcionka sektorów',
        namesScale: 'Skala nazw',
        massScale: 'Skala masy',
        virMassScale: 'Skala masy wirusów',
        strokeScale: 'Skala obwódek tekstu',
        foodSize: 'Wielkość pokarmu',
        bordersWidth: 'Grubość granic mapy',
        sectorsWidth: 'Grubość siatki sektorów',
        sectorsFontSize: 'Rozmiar czcionki sektorów',
        sectorsX: 'Sectors X',
        sectorsY: 'Sectors Y',
		virusSpikesRatio: 'Virus spikes ratio',
		virusSpikesSize: 'Virus spikes size',
        cellsAlpha: 'Przezroczystość kulek',
        skinsAlpha: 'Przezroczystość skinów',
        virusAlpha: 'Przezroczystość wirusów',
        textAlpha: 'Przezroczystość nazw i masy',
        backgroundAlpha: 'Przezroczystość background',
        virusStrokeSize: 'Grubość obwódki wirusów',
        virusGlowSize: "Virus Glow Size",
        teammatesIndColor: 'Wskaźnik gracza',
        cursorTrackingColor: 'Śledzenie kursora',
        splitRangeColor: 'Zasięg podziału',
        qdsplitRange: 'Zasięg szybkiego podwójnego podziału', //Sonia2
        sdsplitRange: 'Zasięg powolnego podwójnego podziału', //Sonia2
        enemyBSTEDColor: 'Kolor W2STE wroga', //Sonia2
        enemyBSTEColor: 'Kolor WSTE wroga', //Sonia2
        enemyBColor: 'Kolor większego wroga', //Sonia2
        enemySColor: 'Kolor mniejszego wroga', //Sonia2
        enemySSTEColor: 'Kolor MSTE wroga', //Sonia2
        enemySSTEDColor: 'Kolor M2STE wroga', //Sonia2
        safeAreaColor: 'Bezpieczna strefa',
        dangerAreaColor: 'Strefa zagrożenia',
        ghostCellsColor: 'Duchy kulek',
        ghostCellsAlpha: 'Przezroczystość duchów kulek',
        menuTheming: 'Menu',
        menuPreset: 'Motyw menu',
        menuMainColor: 'Kolor główny',
        menuBtnTextColor: 'Tekst przycisku',
        menuPanelColor: 'Panel',
        menuPanelColor2: 'Panel (2)',
        menuTextColor: 'Tekst panelu',
        menuTextColor2: 'Tekst panelu (2)',
        btn1Color: 'Przycisk #1',
        btn1Color2: 'Przycisk #1 (2)',
        btn2Color: 'Przycisk #2',
        btn2Color2: 'Przycisk #2 (2)',
        btn3Color: 'Przycisk #3',
        btn3Color2: 'Przycisk #3 (2)',
        btn4Color: 'Przycisk #4',
        btn4Color2: 'Przycisk #4 (2)',
        menuBg: 'Grafika tła panelu',
        menuOpacity: 'Przezroczystość',
        hudTheming: 'HUD',
        hudMainColor: 'Kolor główny',
        hudColor: 'Tło',
        hudTextColor: 'Tekst',
        statsHudColor: 'Statystyki',
        timeHudColor: 'Czas',
        top5MassColor: 'Masa',
        lbMeColor: 'Topka - ja',
        lbTeammateColor: 'Topka - team',
        lbTeammateColor2: 'Topka - team',
        hudFont: 'Czcionka HUD',
        hudScale: 'Skala HUD',
        chatTheming: 'Czat',
        messageColor: 'Tło wiadomości',
        messageTextColor: 'Tekst wiadomości',
        messageTimeColor: 'Czas wiadomości',
        messageNickColor: 'Nick wiadomości',
        commandsColor: 'Tło komendy',
        commandsTextColor: 'Tekst komendy',
        commandsTimeColor: 'Czas komendy',
        commandsNickColor: 'Nick komendy',
        chatBoxColor: 'Tło czatboxu',
        chatScale: 'Skala czatu',
        miniMapTheming: 'Minimapa',
        miniMapSectorsColor: 'Sektory',
        miniMapSectorColor: 'Aktualny sektor',
        miniMapGuidesColor: 'Prowadnice',
        miniMapNickColor: 'Nick',
        miniMapNickStrokeColor: 'Obwódka nicku',
        miniMapMyCellColor: 'Moja kulka',
        miniMapMyCellStrokeColor: 'Obwódka mojej kulki',
        miniMapTeammatesColor: 'Gracze',
        miniMapDeathLocationColor: 'Miejsce śmierci',
        miniMapFont: 'Czcionka minimapy',
        miniMapNickFont: 'Czcionka nicku',
        miniMapWidth: 'Szerokość minimapy',
        miniMapSectorsOpacity: 'Przezroczystość sektorów',
        miniMapNickSize: 'Rozmiar nicku',
        miniMapNickStrokeSize: 'Grubość obwódki nicku',
        miniMapMyCellSize: 'Wielkość mojej kulki',
        miniMapMyCellStrokeSize: 'Grubość obwódki mojej kulki',
        miniMapTeammatesSize: 'Wielkość graczy',
        miniMapGhostCellsColor: 'Duchy kulek',
        miniMapGhostCellsAlpha: 'Przezroczystość duchów kulek',
        imagesTheming: 'Grafika / kursory',
        customBackground: 'Grafika tła',
        customCursor: 'Grafika kursora',
        hideChatMsgA: 'Czat został włączony!',
        hideChatMsgB: 'Czat został ukryty!',
        showSkinsMsgA: 'Skiny zostały włączone!',
        showSkinsMsgB: 'Skiny zostały ukryte!',
        hideSmallBotsMsgA: 'Małe boty stały się widoczne!',
        hideSmallBotsMsgB: 'Małe boty zostały ukryte!',
        autoRespMsgA: 'Auto odrodzenie zostało włączone!',
        autoRespMsgB: 'Auto odrodzenie zostało wyłączone!',
        autoZoomMsgA: 'Auto zoom został włączony!',
        autoZoomMsgB: 'Auto zoom został wyłączony!',
        //                   targetNotSet: 'Brak celu',
        targetNotSet: '',
        targetDead: 'Nie żyje',
        targetDistance: 'Dystans',
        targetMass: 'Masa razem',
        totalPartyPlayers: '',
        totalPartyMass: '',
        exportImport: 'Eksport / import ustawień',
        exportSettings: 'Eksportuj ustawienia',
        exportInfo: 'Aby wyeksportować wybrane ustawienia skopiuj poniższy kod i zapisz go w pliku tekstowym z kodowaniem Unicode.',
        importSettings: 'Importuj ustawienia',
        importInfo: 'Aby zaimportować wybrane ustawienia wklej poniżej wyeksportowany wcześniej kod i naciśnij przycisk \"Importuj ustawienia\".',
        profile: 'Profil',
        profiles: 'Profile',
        skins: 'Skiny',
        moreSkins: 'Dodaj skiny',
        thanks: 'Dzięki Awesome!',
        saveSett: 'Zapisz ustawienia',
        saved: 'Zapisano!',
        resetSett: 'Resetuj ustawienia',
        close: 'Zamknij',
        enterChatMsg: 'Napisz wiadomość',
        activeParties: 'Aktywne party',
        noActiveParties: 'Brak aktywnych party ;(',
        playlist: 'Playlista',
        pause: 'PAUZA!',
        visit: 'Odwiedź',
        exit: 'Czy na pewno chcesz opuścic grę?',
        blockWarn: 'UWAGA! Popupy zostały zablokowane w ustawieniach.',
        unblockPopups: 'Odblokuj tymczasowo',
        mass: 'Masa',
        score: 'Top',
        leaderboard: 'Topka',
        user: 'Użytkownik',
        userMuted: 'Użytkownik %user% został wyciszony.',
        userUnmuted: 'Wyłączono wyciszenie użytkownika %user%.',
        mute: 'Wycisz',
        unmute: 'Wyłącz wyciszenie',
        mutedUsers: 'Wyciszeni użytkownicy',
        activeUsers: 'Aktywni użytkownicy',
        showActiveUsers: 'Pokaż aktywnych użytkowników',
        none: 'Brak',
        sounds: 'Youtube & Sounds',
        page_back_button: 'Wróć',
        page_create_party: 'Stwórz party',
        page_join_party: 'Dołącz',
        page_login_and_play: 'Zaloguj',
        page_logout: 'Wyloguj',
        page_menu_login_facebook: 'Zaloguj z Facebook',
        page_menu_login_google: 'Zaloguj z Google',
        page_menu_main_free_coins: 'Darmowe Monety',
        page_menu_main_gifts: 'Prezenty',
        page_menu_main_dailyquests: 'Zadania',
        page_party_join_error: 'Nie można dołączyć do tego party. Upewnij się, że token jest prawidłowy lub stwórz nowy.',
        page_play: 'Graj',
        page_play_as_guest: 'Graj jako gość',
        page_shop: 'Sklep',
        page_spectate: 'Obserwuj',
        page_stats: 'Statystyki'
    },
    en: {
        start: 'Home',
        settings: 'Settings',
        restoreSettings: 'Restore default settings',
        animationGroup: 'Animation',
        graphics: 'Graphics',
        reverseTrick: 'Reverse trick (On development)',
        onlineStatus: 'Show me online (Facebook)',
        zoomGroup: 'Zoom',
        boardGroup: 'Boards',
        respGroup: 'Respawn',
        namesGroup: 'Names',
        massGroup: 'Mass',
        skinsGroup: 'Skins',
        foodGroup: 'Food',
        transparencyGroup: 'Transparency / colors',
        gridGroup: 'Grid / sectors',
        miniMapGroup: 'Minimap',
        helpersGroup: 'Helpers',
        mouseGroup: 'Mouse control',
        hudGroup: 'HUD',
        multiBox: 'MultiBox',
        chatGroup: 'Chat',
        statsGroup: 'Stats',
        extrasGroup: 'Extras',
        macroGroup: 'Macros',
        noSkins: 'No skins',
        cellContours: 'Only cells contours',
        noNames: 'No names',
        noColors: 'No colors',
        showMass: 'Show mass',
        showChat: 'Show chat on cells',
        showChatMyOwn: 'Show chat on my cells',
        oneColoredSpectator: 'MultiBox less render cells',
        multiBoxShadow: 'Player 1 & 2',
        multiKeepMoving: 'Inactive keep moving',
        middleMultiView: 'View on middle of both (disables when close)',
        middleMultiViewWhenClose: 'View on middle of both (when close)',
        skipStats: 'Skip stats after death',
        showQuest: 'Show quest',
        autoZoom: 'Auto zoom',
        unlockedFPS: 'Frames per sec (Private servers)',
        animation: 'Animation delay',
        macroFeeding: 'Macro feed (ms)',
        //hideSizes: 'Hide everything with size smaller than',
        profileNumber: 'Profiles Number',
        suckAnimation: 'Cell Eat [Sucking] Animation',
		virusSpikes: 'Virus spikes',
        virusGlow: 'Virus Glow',
        borderGlow: 'Border Glow',
        zoomSpeedValue2: 'Zoom speed',
        videoSkinSoundLevel: 'Video skin sound level',
        leaderboardlimit: 'Leaderboard Players',
        teamboardlimit: 'Team Players',
        quickResp: 'Quick respawn (hotkey)',
        autoResp: 'Auto respawn',
        spawnSpecialEffects: 'Spawn special effects',
        animatedRainbowColor: 'Animated rainbow colors',
        autoHideCellsInfo: 'Auto hide names and mass',
        autoHideNames: 'Auto hide names',
        autoHideMass: 'Auto hide mass',
        autoHideFood: 'Auto hide food - mass',
        autoHideFoodOnZoom: 'Auto hide food - zoom',
        optimizedNames: 'Optimized names',
        hideMyName: 'Hide my name',
        hideTeammatesNames: 'Hide teammates names',
        optimizedMass: 'Optimized mass (+/-2%) OR Merge timer (BETA)',
        shortMass: 'Short mass (k)',
        virMassShots: 'Virus shots',
        hideMyMass: 'Hide my mass',
        hideEnemiesMass: 'Hide enemies mass',
        vanillaSkins: 'Vanilla skins',
        universalChat: 'Universal chat',
        customSkins: 'Custom skins',
        videoSkins: 'Video skins (.mp4 .webm .ogv)',
        videoDestorted: 'Video destorted to fit cells',
        videoSkinsMusic2: 'Sound from other\'s Video skins when visible',
        videoOthersSkinSoundLevelproportion: 'Other\'s VS sound level proportional to their mass',
        myTransparentSkin: 'My transparent skin',
        myCustomColor: 'My custom color',
        transparentCells: 'Transparent cells',
        transparentViruses: 'Transparent viruses',
        transparentSkins: 'Transparent skins',
        showGrid: 'Show grid',
        showBgSectors: 'Show background sectors',
        showMapBorders: 'Show map borders',
        showGhostCells: 'Ghost cells (fps drop)',
        showGhostCellsInfo: 'Ghost cells info (confusing)',
		stickyCell: 'Sticky cells (left button, hold right button)',
        //showPartyBots: 'Party bots',
        rotateMap: 'Rotate Map',
        showMiniMap: 'Show minimap',
        showMiniMapGrid: 'Show minimap grid',
        showMiniMapGuides: 'Show minimap guides',
        showExtraMiniMapGuides: 'Show extra minimap guides',
        showMiniMapGhostCells: 'Show ghost cells',
        oneColoredTeammates: 'One-colored teammates',
        optimizedFood: 'Optimized food',
        rainbowFood: 'Rainbow food',
        oppColors: 'Opponents colors',
        oppRings: 'Opponents rings',
        virColors: 'Viruses colors',
        splitRange: 'Split range',
        qdsplitRange: 'Quick double split range', //Sonia2
        sdsplitRange: 'Slow double split range', //Sonia2
        virusesRange: 'Viruses range',
        textStroke: 'Names and mass stroke',
        namesStroke: 'Names stroke',
        massStroke: 'Mass stroke',
        bubbleCursorTracker: 'Bubble tracker (disables cursor tracking)',
        bubbleInd: 'Bubble indicators (disables opponent rings)',
        cursorTracking: 'Cursor tracking',
        teammatesInd: 'Teammates indicators',
        FBTracking: 'Facebook bubble tracker',
		indicators: 'Indicator',	
        mouseSplit: 'Left mouse button',
        mouseFeed: 'Right mouse button',
		mouseCommand4: 'Mouse button 4',
		mouseCommand5: 'Mouse button 5',
        mouseWheelClick: 'Mouse wheel click',
        mouseInvert: 'Invert mouse buttons',
        disableChat: 'Disable chat',
        coloredNicks: 'Colored nicknames',
        hideChat: 'Hide chat',
        chatSounds: 'Sound notifications',
        chatEmoticons: 'Emoticons',
        showChatImages: 'Show images on chat',
        showChatVideos: 'Show videos on chat',
        showChatBox: 'Chatbox instead of popups',
        showChatTranslation: 'Translate chatbox (Scroll bug)',
        hidecountry: 'Hide my country',
        messageSound: 'Message notification sound',
        commandSound: 'Command notification sound',
        virusSoundurl: 'Virus shot sound',
        virusSound: 'Virus shot sound',
        potionsDrinker: 'Randomly drink Potions',
        //massBooster: 'Mass *2 booster-> *3 booster',
        FacebookIDs: 'Facebook IDs',
        jellyPhisycs: 'Jelly physics',
        showTop5: 'Show teamboard',
        showTargeting: 'Show targeting',
        showTime: 'Show current time',
        showLbData: 'Show leaderboard mass',
        //normalLb: '\"Leaderboard\" header',
        centeredLb: 'Centered leaderboard',
        fpsAtTop: 'Game stats at the top',
        tweenMaxEffect: 'Tween max effect',
        top5skins: 'Skins on teamboard',
        showStats: 'Show game stats',
        showStatsMass: 'Mass',
        showStatsESTE: 'BSTE: Enemy\'s minimal mass to splt & eat',
        showStatsEMTE: 'BMTE: Enemy\'s minimal mass to move & eat',
        showStatsMTE: 'MTE: Enemy\'s maximal mass to be eaten by our move',
        showStatsSTE: 'STE: Enemy\'s maximal mass to be eaten by our split',
        showStatsTTE: 'TTE: Minimal mass of teammate to tricksplit',
        showStatsPTE: 'PTE: Maximal enemy\'s mass for our presplit',
        showStatsN16: 'n/16: Pieces',
        showStatsFPS: 'FPS: Frames per second',
        //showStatsPPS: 'Game stats: PPS',
        showStatsRender: 'Time percentage % consumed for Drawing',
        blockPopups: 'Block popups (ads/shop/quest)',
        gameOverStats: 'Game over stats',
        hotkeys: 'Hotkeys',
        'hk-inst-assign': 'To assign a hotkey click on the input field and press your chosen key.',
        'hk-inst-delete': 'To delete a hotkey click on the input field and press the DELETE key.',
        'hk-inst-keys': 'Possible key combinations with the CTRL and ALT keys.',
        'hk-bots-split': 'Bots split',
        'hk-bots-feed': 'Bots feed',
        'hk-bots-ai': 'Bots AI toggle',
        'hk-feed': 'Feed',
        'hk-macroFeed': 'Macro feed',
		'hk-macroFeedPerm': 'Permanent feed',
        'hk-split': 'Split',
        'hk-doubleSplit': 'Double split',
        'hk-tripleSplit': 'Triple split',
        'hk-split16': 'Split 16',
        'hk-crazyDoubleSplit': 'Crazy double split',
        'hk-pause': 'Cell pause',
        'hk-multiboxswap': 'Multibox Swap',
        'hk-multiboxFollowMouse': 'Multibox toggle follow mouse',
        'hk-showTop5': 'Show/hide teamboard',
        'hk-dance': 'Dance',
		'hk-limitposition': 'Macro position to limits',
        'hk-showTime': 'Show/hide current time',
        'hk-showSplitRange': 'Show/hide split range',
        'hk-showSplitInd': 'Show/hide split indicators',
        'hk-showTeammatesInd': 'Show/hide teammates indicators',
        'hk-showOppColors': 'Show/hide opponents colors',
        'hk-toggleSkins': 'Toggle skins (custom/default)',
        'hk-showSkins': 'Show/hide skins',
        'hk-transparentSkins': 'Toggle transparent skins',
        'hk-showStats': 'Show/hide game stats',
        'hk-toggleCells': 'Toggle own cells (smallest/biggest)',
        'hk-showFood': 'Show/hide food',
        'hk-showGrid': 'Show/hide grid',
        'hk-showMiniMapGuides': 'Show/hide minimap guides',
        'hk-hideChat': 'Show/hide chat',
        'hk-showHUD': 'Show/hide HUD',
        'hk-copyLb': 'Copy leaderboard',
        'hk-showLb': 'Show/hide leaderboard',
        'hk-toggleAutoZoom': 'Toggle auto zoom',
        'hk-resetZoom': 'Reset zoom',
        'hk-zoomLevel': 'Zoom level',
        'hk-toggleDeath': 'Toggle death location',
        'hk-clearChat': 'Show chat history / Clear chat',
        'hk-showBgSectors': 'Show/hide background sectors',
        'hk-hideBots': 'Show/hide small bots',
        'hk-showNames': 'Show/hide names',
        'hk-hideTeammatesNames': 'Show/hide teammates names',
        'hk-showMass': 'Show/hide mass',
        'hk-showMiniMap': 'Show/hide minimap',
        'hk-chatMessage': 'Enter chat message',
        'hk-quickResp': 'Quick respawn',
        'hk-autoResp': 'Toggle auto respawn',
        'hk-switchServerMode': 'Switch server [public/private]',
        'hk-showTargeting': 'Show/hide targeting panel',
        'hk-voiceChat': 'Voice to text',
        'hk-GhostCellsInfo': ' Show ghost cells information',
        'hk-Autoplay': 'Auto Play',
        'hk-setTargeting': 'Start/stop targeting (following)',
        'hk-cancelTargeting': 'Cancel targeting',
        'hk-changeTarget': 'Change target',
        'hk-privateMiniMap': 'Show target on the minimap',
        'hk-showQuest': 'Show/hide quest',
        'hk-showSpectator': 'Show/hide Full Spectator (Premium)',
        'hk-showIngameSpectator': 'Show/hide Ingame Spectator (Premium)',
        'hk-doubleBotSplit': 'Bots double split (Private servers)',
        'hk-splitBot16': 'Bots split 16 (Private servers)',

        commands: 'Commands',
        comm1: 'Feed me!',
        comm2: 'Split into me!',
        comm3: 'Need backup at %currentSector%!',
        comm4: 'Enemy spotted at %currentSector%!',
        comm5: 'Need a teammate!',
        comm6: 'Tank the virus!',
        comm7: 'Eat the virus!',
        comm8: 'Let\'s bait!',
        comm9: 'Fake tricksplit!',
        comm0: 'Fuck!',
        comm10: 'Tricksplit!',
        comm11: 'Left!',
        comm12: 'Up!',
        comm13: 'Right!',
        comm14: 'Bottom!',
        comm15: 'Fake Tricksplit',
        comm16: 'Popsplit',
        comm17: 'Double Popsplit',
        comm18: 'Reversed Tricksplit',
        comm19: 'Canonsplit',
        comm20: 'Reversed Canonsplit',
        comm21: 'Bowlingsplit',
        comm22: 'Auto feed trick',
        comm23: 'Pause',
        comm24: 'ANTI alarm stage 1',
        comm25: 'ANTI alarm stage 2',
        comm26: 'ANTI alarm stage 3',
        comm27: 'ANTI alarm stage 4',
        comm28: 'ANTI alarm stage 5',
        comm29: 'Presplit',
        comm30: 'Party Run tricks',
		comm31: 'HotKey command',
		comm32: 'HotKey command',	
		comm33: 'HotKey command',
		comm34: 'HotKey command',
		comm35: 'HotKey command',
		comm36: 'HotKey command',
		comm37: 'HotKey command',
		comm38: 'HotKey command',
		comm39: 'HotKey command',
		comm40: 'HotKey command',
		comm41: 'HotKey command',
		comm42: 'HotKey command',	
		comm43: 'HotKey command',
		comm44: 'HotKey command',
		comm45: 'HotKey command',
		comm46: 'HotKey command',
		comm47: 'HotKey command',
		comm48: 'HotKey command',
		comm49: 'HotKey command',
		comm50: 'HotKey command',			
        saveComm: 'Save commands',
        theme: 'Theme',
        restoreThemeSettings: 'Restore theme default settings',
        basicTheming: 'Basic theming',
        themePreset: 'Theme preset',
        chatPosition: 'Chat Position',
        themeType: 'Theme type',
        darkTheme: 'Dark theme',
        lightTheme: 'Light theme',
        mainColor: 'Main color',
        bgColor: 'Background',
        bordersColor: 'Map borders',
        gridColor: 'Grid',
        sectorsColor: 'Sectors font',
        namesColor: 'Names',
        namesStrokeColor: 'Names stroke',
        massColor: 'Mass',
        massStrokeColor: 'Mass stroke',
        virusColor: 'Virus',
        virusStrokeColor: 'Virus stroke',
        virusGlowColor: "Virus Glow",
        borderGlowColor: "Border Glow",
        mVirusColor: 'Mothercell',
        mVirusStrokeColor: 'Mothercell stroke',
        virusGlowSize: 'Virus Glow Size',
        borderGlowSize: 'Border Glow Size',
        foodColor: 'Food',
        namesFont: 'Names font',
        massFont: 'Mass font',
        sectorsFont: 'Sectors font',
        namesScale: 'Names scale',
        massScale: 'Mass scale',
        virMassScale: 'Virus mass scale',
        strokeScale: 'Text stroke scale',
        foodSize: 'Food size',
        bordersWidth: 'Map borders width',
        sectorsWidth: 'Sectors grid width',
        sectorsFontSize: 'Sectors font size',
        sectorsX: 'Sectors X',
        sectorsY: 'Sectors Y',
		virusSpikesRatio: 'Virus spikes ratio',
		virusSpikesSize: 'Virus spikes size',
        cellsAlpha: 'Cells transparency',
        skinsAlpha: 'Skins transparency',
        virusAlpha: 'Virus transparency',
        textAlpha: 'Names & mass transparency',
        backgroundAlpha: 'Background transparency',
        virusStrokeSize: 'Virus stroke size',
        virusGlowSize: "Virus Glow Size",
        teammatesIndColor: 'Teammate indicator',
        cursorTrackingColor: 'Cursor tracking',
        splitRangeColor: 'Split range',
        enemyBSTEDColor: 'B2STE Enemy Color', //Sonia2
        enemyBSTEColor: 'BSTE Enemy Color', //Sonia2
        enemyBColor: 'Bigger Enemy Color', //Sonia2
        enemySColor: 'Smaller Enemy Color', //Sonia2
        enemySSTEColor: 'SSTE Enemy Color', //Sonia2
        enemySSTEDColor: 'S2STE Enemy Color', //Sonia2
        safeAreaColor: 'Safe area',
        dangerAreaColor: 'Danger area',
        ghostCellsColor: 'Ghost cells',
        ghostCellsAlpha: 'Ghost cells transparency',
        menuTheming: 'Menu',
        menuPreset: 'Menu theme',
        menuMainColor: 'Main color',
        menuBtnTextColor: 'Button text',
        menuPanelColor: 'Panel',
        menuPanelColor2: 'Panel (2)',
        menuTextColor: 'Panel text',
        menuTextColor2: 'Panel text (2)',
        btn1Color: 'Button #1',
        btn1Color2: 'Button #1 (2)',
        btn2Color: 'Button #2',
        btn2Color2: 'Button #2 (2)',
        btn3Color: 'Button #3',
        btn3Color2: 'Button #3 (2)',
        btn4Color: 'Button #4',
        btn4Color2: 'Button #4 (2)',
        menuBg: 'Panel background image',
        menuOpacity: 'Transparency',
        hudTheming: 'HUD',
        hudMainColor: 'Main color',
        hudColor: 'Background',
        hudTextColor: 'Text',
        statsHudColor: 'Stats',
        timeHudColor: 'Time',
        top5MassColor: 'Mass',
        lbMeColor: 'Leaderboard - me',
        lbTeammateColor: 'Leaderboard - teammate',
        lbTeammateColor2: 'Leaderboard - teammate',
        hudFont: 'HUD font',
        hudScale: 'HUD scale',
        chatTheming: 'Chat',
        messageColor: 'Message background',
        messageTextColor: 'Message text',
        messageTimeColor: 'Message time',
        messageNickColor: 'Message nick',
        commandsColor: 'Command background',
        commandsTextColor: 'Command text',
        commandsTimeColor: 'Command time',
        commandsNickColor: 'Command nick',
        chatBoxColor: 'Chatbox color',
        chatScale: 'Chat scale',
        miniMapTheming: 'Minimap',
        miniMapSectorsColor: 'Sectors',
        miniMapSectorColor: 'Current sector',
        miniMapGuidesColor: 'Guides',
        miniMapNickColor: 'Nick',
        miniMapNickStrokeColor: 'Nick stroke',
        miniMapMyCellColor: 'My cell',
        miniMapMyCellStrokeColor: 'My cell stroke',
        miniMapTeammatesColor: 'Teammates',
        miniMapDeathLocationColor: 'Death location',
        miniMapFont: 'Minimap font',
        miniMapNickFont: 'Nick font',
        miniMapWidth: 'Minimap width',
        miniMapSectorsOpacity: 'Sectors transparency',
        miniMapNickSize: 'Nick size',
        miniMapNickStrokeSize: 'Nick stroke size',
        miniMapMyCellSize: 'My cell size',
        miniMapMyCellStrokeSize: 'My cell stroke size',
        miniMapTeammatesSize: 'Teammates size',
        miniMapGhostCellsColor: 'Ghost cells',
        miniMapGhostCellsAlpha: 'Ghost cells transparency',
        imagesTheming: 'Graphics / cursors',
        customBackground: 'Custom background image',
        customCursor: 'Custom cursor image',
        hideChatMsgA: 'Chat is visible!',
        hideChatMsgB: 'Chat is hidden!',
        showSkinsMsgA: 'Skins are visible!',
        showSkinsMsgB: 'Skins are hidden!',
        hideSmallBotsMsgA: 'Small bots are visible!',
        hideSmallBotsMsgB: 'Small bots are hidden!',
        autoRespMsgA: 'Auto respawn is on!',
        autoRespMsgB: 'Auto respawn is off!',
        autoZoomMsgA: 'Auto zoom is on!',
        autoZoomMsgB: 'Auto zoom is off!',
        targetNotSet: '',
        targetDead: 'Dead',
        targetDistance: 'Distance',
        targetMass: 'Total Mass',
        totalPartyPlayers: '',
        totalPartyMass: '',
        exportImport: 'Export / import settings',
        exportSettings: 'Export settings',
        exportInfo: 'To export selected settings copy the code below and save it to a text file encoded in Unicode.',
        importSettings: 'Import settings',
        importInfo: 'To import selected settings paste an exported code below and press the \"Import settings\" button.',
        profile: 'Profile',
        profiles: 'Profiles',
        skins: 'Skins',
        moreSkins: 'Add skins',
        thanks: 'Thanks to Awesome!',
        saveSett: 'Save settings',
        saved: 'Saved!',
        resetSett: 'Reset to default',
        close: 'Close',
        enterChatMsg: 'Enter chat message',
        activeParties: 'Active parties',
        noActiveParties: 'No active parties ;(',
        playlist: 'Playlist',
        pause: 'PAUSE!',
        visit: 'Visit',
        exit: 'Are you sure you want to quit the game?',
        blockWarn: 'WARNING! Popups are blocked in the settings.',
        unblockPopups: 'Temporary unblock',
        mass: 'Mass',
        score: 'Score',
        leaderboard: 'Leaderboard',
        user: 'User',
        userMuted: 'User %user% has been muted.',
        userUnmuted: 'User %user% has been unmuted.',
        mute: 'Mute',
        unmute: 'Unmute',
        mutedUsers: 'Muted users',
        activeUsers: 'Active users',
        showActiveUsers: 'Show active users',
        none: 'None',
        sounds: 'Youtube & Sounds',
        page_menu_main_free_coins: 'Free Coins',
        page_menu_main_gifts: 'Gifts',
        page_menu_main_dailyquests: 'Daily Quest',
        page_shop: 'Shop'
    }
}
var chatPositions = {
    bottomleft: {
        name: 'Default',
        positionClass: "toast-bottom-left"
    },
    bottomright: {
        name: 'Bottom Right',
        positionClass: "toast-bottom-right"
    },
    topleft: {
        name: 'Top Left',
        positionClass: "toast-top-left"
    },
    topright: {
        name: 'Top Right',
        positionClass: "toast-top-right"
    }
}
var themePresets = {
    legendv2: {
        name: 'Legend v2',
        darkTheme: true,
        mainColor: '#01d9cc',
        bgColor: '#000a11',
        bordersColor: '#01d9cc',
        gridColor: '#00243e',
        sectorsColor: '#00243e',
        namesColor: '#ffffff',
        namesStrokeColor: '#000000',
        massColor: '#ffffff',
        massStrokeColor: '#000000',
        virusColor: '#002f52',
        virusStrokeColor: '#00b9e8',
        virusGlowColor: '#fff',
        mVirusColor: '#ce6363',
        mVirusStrokeColor: '#b95959',
        foodColor: '#5000ff',
        teammatesIndColor: '#ffffff',
        cursorTrackingColor: '#ffffff',
        splitRangeColor: '#ffffff',
        enemyBSTEDColor: '#8000ff', //Sonia2
        enemyBSTEColor: '#BE00FF', //Sonia2
        enemyBColor: '#FF0A00', //Sonia2
        enemySColor: '#00C8FF', //Sonia2
        enemySSTEColor: '#048245', //Sonia2
        enemySSTEDColor: '#64FF00', //Sonia2
        safeAreaColor: '#ffffff',
        dangerAreaColor: '#bf00aa',
        namesFont: 'ubuntu-bold',
        massFont: 'ubuntu-bold',
        sectorsFont: 'ubuntu',
        namesScale: 1,
        massScale: 3,
        foodSize: 5,
        bordersWidth: 40,
        sectorsWidth: 40,
        sectorsFontSize: 1200,
        cellsAlpha: 0.99,
        skinsAlpha: 0.99,
        virusAlpha: 0.25,
        textAlpha: 1,
        backgroundAlpha: 0.6,
        virusStrokeSize: 20,
        virusGlowSize: "#fff",
        virusGlowSize: 14,
        borderGlowSize: 14,
        menuPreset: 'legendv2',
        graphics: 'high',
		indicators: 'normal',
        menuMainColor: '#01d9cc',
        menuBtnTextColor: '#ffffff',
        menuPanelColor: '#00243e',
        menuPanelColor2: '#002f52',
        menuTextColor: '#ffffff',
        menuTextColor2: '#8096a7',
        btn1Color: '#018cf6',
        btn1Color2: '#0176ce',
        btn2Color: '#00b9e8',
        btn2Color2: '#0099c0',
        btn3Color: '#8d5fe6',
        btn3Color2: '#814ee3',
        btn4Color: '#bf00aa',
        btn4Color2: '#a80096',
        menuBg: 'https://legendmod.ml/banners/static/img/pattern.png',
        menuOpacity: 0.96,
        hudMainColor: '#01d9cc',
        hudColor: 'rgba(0,0,0,0.4)',
        hudTextColor: '#ffffff',
        statsHudColor: '#ffffff',
        timeHudColor: '#01d9cc',
        top5MassColor: '#bf00aa',
        lbMeColor: '#bf00aa',
        lbTeammateColor: '#018cf6', //is a crack for delta
        lbTeammateColor2: '#018cf6',
        hudFont: 'ubuntu-bold',
        hudScale: 1,

        messageColor: 'rgba(0,0,0,0.4)',
        messageTextColor: '#ffffff',
        messageTimeColor: '#018cf6',
        messageNickColor: '#01d9cc',
        commandsColor: 'rgba(191,0,170,0.9)',
        commandsTextColor: '#ffffff',
        commandsTimeColor: '#bf00aa',
        commandsNickColor: '#ffffff',
        chatBoxColor: 'rgba(0,0,0,0.4)',
        chatScale: 1,
        miniMapSectorsColor: '#ffffff',
        miniMapSectorColor: '#01d9cc',
        miniMapGuidesColor: '#bf00aa',
        miniMapNickColor: '#ffffff',
        miniMapNickStrokeColor: '#000000',
        miniMapMyCellColor: '#ffffff',
        miniMapMyCellStrokeColor: '#bf00aa',
        miniMapTeammatesColor: '#01d9cc',
        miniMapDeathLocationColor: '#bf00aa',
        miniMapFont: 'ubuntu-bold',
        miniMapNickFont: 'ubuntu-bold',
        miniMapWidth: 240,
        miniMapSectorsOpacity: 0.1,
        miniMapNickSize: 11,
        miniMapNickStrokeSize: 2,
        miniMapMyCellSize: 7.5,
        miniMapMyCellStrokeSize: 4,
        miniMapTeammatesSize: 5.5,
        customBackground: '',
        customCursor: 'https://legendmod.ml/cursors/cursor_02.cur'
    },
    legendv1: {
        name: 'Legend v1',
        darkTheme: true,
        mainColor: '#ff7800',
        bgColor: '#111111',
        bordersColor: '#ff7800',
        gridColor: '#292929',
        sectorsColor: '#292929',
        namesColor: '#ffffff',
        namesStrokeColor: '#000000',
        massColor: '#ffffff',
        massStrokeColor: '#000000',
        virusColor: '#666666',
        virusStrokeColor: '#666666',
        mVirusColor: '#ce6363',
        mVirusStrokeColor: '#b95959',
        foodColor: '#e16400',
        hudMainColor: '#ff7800',
        statsHudColor: '#ff7800',
        top5MassColor: '#ff7800',
        timeHudColor: '#ff7800',
        messageNickColor: '#ff7800',
        commandsColor: 'rgba(255,120,0,0.9)',
        commandsTimeColor: '#ff7800',
        commandsTextColor: '#ffffff',
        miniMapSectorsColor: '#ffffff',
        miniMapSectorColor: '#ff7800',
        miniMapGuidesColor: '#ff7800',
        miniMapMyCellColor: '#ffffff',
        miniMapMyCellStrokeColor: '#ff7800',
        miniMapTeammatesColor: '#ff7800',
        miniMapDeathLocationColor: '#ff7800',
        miniMapSectorsOpacity: 0.1
    },
    legendoriginal: {
        name: 'Legend Original',
        darkTheme: true,
        mainColor: '#b5a642',
        bgColor: '#000000',
        bordersColor: '#b5a642',
        gridColor: '#111111',
        sectorsColor: '#111111',
        namesColor: '#ffffff',
        namesStrokeColor: '#000000',
        massColor: '#ffffff',
        massStrokeColor: '#000000',
        virusColor: '#666666',
        virusStrokeColor: '#666666',
        mVirusColor: '#ce6363',
        mVirusStrokeColor: '#b95959',
        foodColor: '#998c36',
        hudMainColor: '#b5a642',
        statsHudColor: '#b5a642',
        top5MassColor: '#b5a642',
        timeHudColor: '#b5a642',
        messageNickColor: '#b5a642',
        commandsColor: 'rgba(181,166,66,0.9)',
        commandsTimeColor: '#b5a642',
        commandsTextColor: '#ffffff',
        miniMapSectorsColor: '#ffffff',
        miniMapSectorColor: '#b5a642',
        miniMapGuidesColor: '#b5a642',
        miniMapMyCellColor: '#ffffff',
        miniMapMyCellStrokeColor: '#b5a642',
        miniMapTeammatesColor: '#b5a642',
        miniMapDeathLocationColor: '#b5a642',
        miniMapSectorsOpacity: 0.1
    },
    crazystyle2: {
        name: 'Crazy Style 2',
        darkTheme: true,
        mainColor: '#01d9cc',
        bgColor: '#000000',
        bordersColor: '#ffffff',
        gridColor: '#00243e',
        sectorsColor: '#00243e',
        namesColor: '#ffffff',
        namesStrokeColor: '#000000',
        massColor: '#ffffff',
        massStrokeColor: '#000000',
        virusColor: '#3b3b3b',
        virusStrokeColor: '#ffffff',
        mVirusColor: '#ce6363',
        mVirusStrokeColor: '#b95959',
        foodColor: '#5000ff',
        teammatesIndColor: '#ffffff',
        cursorTrackingColor: '#ffffff',
        splitRangeColor: '#ffffff',
        safeAreaColor: '#ffffff',
        dangerAreaColor: '#bf00aa',
        massScale: 4,
        foodSize: 1,
        bordersWidth: 40,
        sectorsWidth: 40,
        sectorsFontSize: 1200,
        cellsAlpha: 0.99,
        skinsAlpha: 0.99,
        virusAlpha: 0.4,
        textAlpha: 1,
        backgroundAlpha: 0.6,
        virusStrokeSize: 10,
        virusStrokeSize: 20,
        virusGlowSize: 14,
        borderGlowSize: 14,
        menuPreset: 'legendv2',
        graphics: 'high',
        menuMainColor: '#fc0079',
        menuBtnTextColor: '#ffffff',
        menuPanelColor: '#050008',
        menuPanelColor2: '#1d0526',
        menuTextColor: '#ffffff',
        menuTextColor2: '#65458f',
        btn1Color: '#4f0242',
        btn1Color2: '#3b0431',
        btn2Color: '#6b0036',
        btn2Color2: '#4d0227',
        btn3Color: '#aa084e',
        btn3Color2: '#80063b',
        btn4Color: '#aa084e',
        btn4Color2: '#8a063f',
        menuBg: 'https://legendmod.ml/banners/static/img/pattern.png',
        menuOpacity: 1,
        hudMainColor: '#5974ff',
        hudColor: 'rgba(36,36,36,0.49)',
        hudTextColor: '#ffffff',
        statsHudColor: '#ffffff',
        timeHudColor: '#737373',
        top5MassColor: '#1fe000',
        lbMeColor: '#bf00aa',
        lbTeammateColor: '#018cf6',
        lbTeammateColor2: '#018cf6',
        hudScale: 1,
        messageColor: 'rgba(0,0,0,0.4)',
        messageTextColor: '#e8e8e8',
        messageTimeColor: '#545454',
        messageNickColor: '#05ff00',
        commandsColor: 'rgba(36,36,36,0.9)',
        commandsTextColor: '#ffffff',
        commandsTimeColor: '#545454',
        commandsNickColor: '#ffffff',
        chatBoxColor: 'rgba(0,0,0,0.4)',
        chatScale: 1,
        miniMapSectorsColor: '#ffffff',
        miniMapSectorColor: '#000000',
        miniMapGuidesColor: '#ff00a8',
        miniMapNickColor: '#ffffff',
        miniMapNickStrokeColor: '#4d4d4d',
        miniMapMyCellColor: '#f0ff3d',
        miniMapMyCellStrokeColor: '#acba07',
        miniMapTeammatesColor: '#305eff',
        miniMapDeathLocationColor: '#2b2b2b',
        miniMapWidth: 250,
        miniMapSectorsOpacity: 0.1,
        miniMapNickSize: 9,
        miniMapNickStrokeSize: 0,
        miniMapMyCellSize: 5,
        miniMapMyCellStrokeSize: 0,
        miniMapTeammatesSize: 5,
        customBackground: '',
        customCursor: 'https://legendmod.ml/cursors/cursor_01.cur'
    },
    crazystyle: {
        name: 'Crazy Style 1',
        darkTheme: true,
        mainColor: '#651fff',
        bgColor: '#000000',
        bordersColor: '#ffffff',
        gridColor: '#111111',
        sectorsColor: '#111111',
        namesColor: '#ffffff',
        namesStrokeColor: '#000000',
        massColor: '#ffffff',
        massStrokeColor: '#000000',
        virusColor: '#666666',
        virusStrokeColor: '#666666',
        mVirusColor: '#ce6363',
        mVirusStrokeColor: '#b95959',
        foodColor: '#651fff',
        hudMainColor: '#651fff',
        statsHudColor: '#651fff',
        top5MassColor: '#651fff',
        timeHudColor: '#651fff',
        messageNickColor: '#651fff',
        commandsColor: 'rgba(101,31,255,0.9)',
        commandsTimeColor: '#651fff',
        commandsTextColor: '#ffffff',
        miniMapSectorsColor: '#ffffff',
        miniMapSectorColor: '#651fff',
        miniMapGuidesColor: '#651fff',
        miniMapMyCellColor: '#ffffff',
        miniMapMyCellStrokeColor: '#651fff',
        miniMapTeammatesColor: '#651fff',
        miniMapDeathLocationColor: '#651fff',
        miniMapSectorsOpacity: 0.1
    },
    agariolight: {
        name: 'Agar.io Light',
        darkTheme: false,
        mainColor: '#ffffff',
        bgColor: '#f2fbff',
        bordersColor: '#858a8c',
        gridColor: '#ced6d9',
        sectorsColor: '#ced6d9',
        namesColor: '#ffffff',
        namesStrokeColor: '#000000',
        massColor: '#ffffff',
        massStrokeColor: '#000000',
        virusColor: '#33ff33',
        virusStrokeColor: '#2de52d',
        mVirusColor: '#ce6363',
        mVirusStrokeColor: '#b95959',
        foodColor: '#2de52d',
        hudMainColor: '#ffffff',
        statsHudColor: '#ffffff',
        top5MassColor: '#ffffff',
        timeHudColor: '#ffffff',
        messageNickColor: '#ffffff',
        commandsColor: 'rgba(255,255,255,0.9)',
        commandsTimeColor: '#ffffff',
        commandsTextColor: '#000000',
        miniMapSectorsColor: '#ffffff',
        miniMapSectorColor: '#ffffff',
        miniMapGuidesColor: '#ffffff',
        miniMapMyCellColor: '#ffffff',
        miniMapMyCellStrokeColor: '#ffffff',
        miniMapTeammatesColor: '#ffffff',
        miniMapDeathLocationColor: '#ffffff',
        miniMapSectorsOpacity: 0.25
    },
    agariodark: {
        name: 'Agar.io Dark',
        darkTheme: true,
        mainColor: '#ffffff',
        bgColor: '#111111',
        bordersColor: '#999999',
        gridColor: '#333333',
        sectorsColor: '#333333',
        namesColor: '#ffffff',
        namesStrokeColor: '#000000',
        massColor: '#ffffff',
        massStrokeColor: '#000000',
        virusColor: '#33ff33',
        virusStrokeColor: '#2de52d',
        mVirusColor: '#ce6363',
        mVirusStrokeColor: '#b95959',
        foodColor: '#2de52d',
        hudMainColor: '#ffffff',
        statsHudColor: '#ffffff',
        top5MassColor: '#ffffff',
        timeHudColor: '#ffffff',
        messageNickColor: '#ffffff',
        commandsColor: 'rgba(255,255,255,0.9)',
        commandsTimeColor: '#ffffff',
        commandsTextColor: '#ffffff',
        miniMapSectorsColor: '#ffffff',
        miniMapSectorColor: '#ffffff',
        miniMapGuidesColor: '#ffffff',
        miniMapMyCellColor: '#ffffff',
        miniMapMyCellStrokeColor: '#ffffff',
        miniMapTeammatesColor: '#ffffff',
        miniMapDeathLocationColor: '#ffffff',
        miniMapSectorsOpacity: 0.1
    }
}
var themeMenus = {
    legendv2: {
        name: 'Legend v2',
        menuMainColor: '#01d9cc',
        menuBtnTextColor: '#ffffff',
        menuPanelColor: '#00243e',
        menuPanelColor2: '#002f52',
        menuTextColor: '#ffffff',
        menuTextColor2: '#8096a7',
        btn1Color: '#018cf6',
        btn1Color2: '#0176ce',
        btn2Color: '#00b9e8',
        btn2Color2: '#0099c0',
        btn3Color: '#8d5fe6',
        btn3Color2: '#814ee3',
        btn4Color: '#f300d8',
        btn4Color2: '#df00c6',
        menuBg: 'https://legendmod.ml/banners/static/img/pattern.png'
    },
    legendv1: {
        name: 'Legend v1',
        menuMainColor: '#ff7800',
        menuBtnTextColor: '#ffffff',
        menuPanelColor: '#222222',
        menuPanelColor2: '#333333',
        menuTextColor: '#bbbbbb',
        menuTextColor2: '#bbbbbb',
        btn1Color: '#428bca',
        btn1Color2: '#3071a9',
        btn2Color: '#5cb85c',
        btn2Color2: '#449d44',
        btn3Color: '#f0ad4e',
        btn3Color2: '#ec971f',
        btn4Color: '#d9534f',
        btn4Color2: '#c9302c',
        menuBg: ''
    },
    agario: {
        name: 'Agar.io',
        menuMainColor: '#5bc0de',
        menuBtnTextColor: '#ffffff',
        menuPanelColor: '#ffffff',
        menuPanelColor2: '#cccccc',
        menuTextColor: '#333333',
        menuTextColor2: '#999999',
        btn1Color: '#428bca',
        btn1Color2: '#3071a9',
        btn2Color: '#5cb85c',
        btn2Color2: '#449d44',
        btn3Color: '#f0ad4e',
        btn3Color2: '#ec971f',
        btn4Color: '#d9534f',
        btn4Color2: '#c9302c',
        menuBg: ''
    }
}
var graphicMenus = {
    high: {
        name: 'High'
    },
    medium: {
        name: 'Medium'
    },
    low: {
        name: 'Low'
    },
    very_low: {
        name: 'Very Low'
    }
}
var indicatorMenus = {
    normal: {
        name: 'Normal'
    },
    heart: {
        name: 'Heart'
    },
    smile: {
        name: 'Smile'
    }
}
var escapeChar = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    '\'': '&#39;',
    '/': '&#x2F;'
}
var defaultSettings = {
    checkonetimeLc: false,
    chatPos: 'bottomleft',
    preset: 'legendv2',
    darkTheme: true,
    mainColor: '#01d9cc',
    bgColor: '#000a11',
    bordersColor: '#d90101',
    borderGlowColor: "#ffffff",
    gridColor: '#00243e',
    sectorsColor: '#00243e',
    namesColor: '#ffffff',
    namesStrokeColor: '#000000',
    massColor: '#ffffff',
    massStrokeColor: '#000000',
    virusColor: '#327a19',
    virusStrokeColor: '#327a19',
    mVirusColor: '#ce6363',
    mVirusStrokeColor: '#b95959',
    foodColor: '#0057ff',
    teammatesIndColor: '#ffffff',
    cursorTrackingColor: '#ffffff',
    splitRangeColor: '#ffffff',
    enemyBSTEDColor: '#8000ff', //Sonia2
    enemyBSTEColor: '#BE00FF', //Sonia2
    enemyBColor: '#FF0A00', //Sonia2
    enemySColor: '#00C8FF', //Sonia2
    enemySSTEColor: '#048245', //Sonia2
    enemySSTEDColor: '#64FF00', //Sonia2
    ghostCellsColor: '#ffffff',
    safeAreaColor: '#ffffff',
    dangerAreaColor: '#bf00aa',
    namesFont: 'ubuntu-bold',
    namesFontFamily: 'Ubuntu',
    namesFontWeight: 700,
    massFont: 'ubuntu-bold',
    massFontFamily: 'Ubuntu',
    massFontWeight: 700,
    sectorsFont: 'ubuntu',
    sectorsFontFamily: 'Ubuntu',
    sectorsFontWeight: 400,
    sectorsX: 5,
    sectorsY: 5,
	virusSpikesRatio: 0.46,
	virusSpikesSize: 6,
    namesScale: 1,
    massScale: 3,
    virMassScale: 3,
    strokeScale: 1,
    foodSize: 5,
    bordersWidth: 14,
    sectorsWidth: 40,
    sectorsFontSize: 1200,
    cellsAlpha: 0.99,
    skinsAlpha: 0.99,
    virusAlpha: 0.6,
    textAlpha: 1,
    backgroundAlpha: 0.6,
    virusGlowColor: '#fff',
    virusGlowSize: 14,
    borderGlowSize: 14,
    ghostCellsAlpha: 0.3,
    virusStrokeSize: 14,
    menuPreset: 'legendv2',
    graphics: 'high',
	indicators: 'normal',
    menuMainColor: '#01d9cc',
    menuBtnTextColor: '#ffffff',
    menuPanelColor: '#00243e',
    menuPanelColor2: '#002f52',
    menuTextColor: '#ffffff',
    menuTextColor2: '#8096a7',
    btn1Color: '#018cf6',
    btn1Color2: '#0176ce',
    btn2Color: '#00b9e8',
    btn2Color2: '#0099c0',
    btn3Color: '#8d5fe6',
    btn3Color2: '#814ee3',
    btn4Color: '#bf00aa',
    btn4Color2: '#a80096',
    menuBg: 'https://legendmod.ml/banners/static/img/pattern.png',
    menuOpacity: 0.96,
    hudMainColor: '#01d9cc',
    hudColor: 'rgba(0,0,0,0.4)',
    hudTextColor: '#ffffff',
    statsHudColor: '#ffffff',
    timeHudColor: '#01d9cc',
    top5MassColor: '#bf00aa',
    lbMeColor: '#bf00aa',
    lbTeammateColor: '#018cf6',
    lbTeammateColor2: '#018cf6',
    hudFont: 'ubuntu-bold',
    hudFontFamily: 'Ubuntu',
    hudFontWeight: 700,
    hudScale: 1,
    messageColor: 'rgba(0,0,0,0.4)',
    messageTextColor: '#ffffff',
    messageTimeColor: '#018cf6',
    messageNickColor: '#01d9cc',
    commandsColor: 'rgba(191,0,170,0.9)',
    commandsTextColor: '#ffffff',
    commandsTimeColor: '#bf00aa',
    commandsNickColor: '#ffffff',
    chatBoxColor: 'rgba(0,0,0,0.4)',
    chatScale: 1,
    miniMapSectorsColor: '#ffffff',
    miniMapSectorColor: '#01d9cc',
    miniMapGuidesColor: '#bf00aa',
    miniMapNickColor: '#ffffff',
    miniMapNickStrokeColor: '#000000',
    miniMapMyCellColor: '#ffffff',
    miniMapMyCellStrokeColor: '#bf00aa',
    miniMapTeammatesColor: '#01d9cc',
    miniMapDeathLocationColor: '#bf00aa',
    miniMapGhostCellsColor: '#ffffff',
    ////
    color: "#fff",
    //commanderImage : "https://i.imgur.com/wQKUDB3.png",
    //customServerImage1: "https://legendmod.ml/banners/IconCustomServer1.png",
    commanderImage: "https://legendmod.ml/banners/drawCommander.png",
    commanderImage1: "https://legendmod.ml/banners/drawCommander1.png",
    commanderImage2: "https://legendmod.ml/banners/drawCommander2.png",
    commanderImage3: "https://legendmod.ml/banners/drawCommander3.png",
    commanderImage4: "https://legendmod.ml/banners/drawCommander4.png",
    commanderImage5: "https://legendmod.ml/banners/drawCommander5.png",
    commanderImage6: "https://legendmod.ml/banners/iconJustWatchPro.png",
    commanderImageDyingLight: "https://legendmod.ml/banners/icondyinglightzombie.png",
    commanderImageDyingLightvirus: "https://legendmod.ml/banners/icondyinglightvirus.png",

    ////
    miniMapFont: 'ubuntu-bold',
    miniMapFontFamily: 'Ubuntu',
    miniMapFontWeight: 700,
    miniMapNickFont: 'ubuntu-bold',
    miniMapNickFontFamily: 'Ubuntu',
    miniMapNickFontWeight: 700,
    miniMapWidth: 240,
    miniMapTop: 24,
    miniMapSectorsOpacity: 0.1,
    miniMapNickSize: 11,
    miniMapNickStrokeSize: 2,
    miniMapMyCellSize: 7.5,
    miniMapMyCellStrokeSize: 4,
    miniMapTeammatesSize: 5.5,
    miniMapGhostCellsAlpha: 0.15,
    customBackground: '',
    customCursor: 'https://legendmod.ml/cursors/cursor_02.cur'
}

cimg2 = new Image;
cimg2.src = defaultSettings.commanderImage2;
cimg5 = new Image;
cimg5.src = defaultSettings.commanderImage5;
cimg6 = new Image;
cimg6.src = defaultSettings.commanderImage6;
//cimg7 = new Image;
//cimg7.src = 'https://legendmod.ml/banners/iconLcForCanvas.png';
function loadIconSpecialSkins(val){
	eval('window.' + val + ' = new Image');
	eval('window.' + val + '.src = "https://legendmod.ml/banners/' + val + '.png"')
}
/*
iconSpecialSkinEffectsCrown = new Image;
iconSpecialSkinEffectsCrown.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsCrown.png';
iconSpecialSkinEffectsMask = new Image;
iconSpecialSkinEffectsMask.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsMask.png';
iconSpecialSkinEffectsHat3 = new Image;
iconSpecialSkinEffectsHat3.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsHat3.png';
iconSpecialSkinEffectsVip = new Image;
iconSpecialSkinEffectsVip.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsVip.png';
iconSpecialSkinEffectsDdev = new Image;
iconSpecialSkinEffectsDdev.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsDdev.png';
iconSpecialSkinEffectsSunGlasses = new Image;
iconSpecialSkinEffectsSunGlasses.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsSunGlasses.png';
iconSpecialSkinEffectsYoutube = new Image;
iconSpecialSkinEffectsYoutube.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsYoutube.png';
iconSpecialSkinEffectsJellyFish = new Image;
iconSpecialSkinEffectsJellyFish.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsJellyFish.png';
iconSpecialSkinEffectsModerator = new Image;
iconSpecialSkinEffectsModerator.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsModerator.png';
iconSpecialSkinEffectsUSA = new Image;
iconSpecialSkinEffectsUSA.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsUSA.png';
iconSpecialSkinEffectsHeart = new Image;
iconSpecialSkinEffectsHeart.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsHeart.png';
iconSpecialSkinEffectsSword = new Image;
iconSpecialSkinEffectsSword.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsSword.png';
iconSpecialSkinEffectsSmoke = new Image;
iconSpecialSkinEffectsSmoke.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsSmoke.png';
iconSpecialSkinEffectsLegendclan = new Image;
iconSpecialSkinEffectsLegendclan.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsLegendclan.png';
iconSpecialSkinEffectsLegendclan2 = new Image;
iconSpecialSkinEffectsLegendclan2.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsLegendclan2.png';
iconSpecialSkinEffectsShiro = new Image;
iconSpecialSkinEffectsShiro.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsShiro.png';
iconSpecialSkinEffectsBird = new Image;
iconSpecialSkinEffectsBird.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsBird.png';
iconSpecialSkinEffectsButterfly = new Image;
iconSpecialSkinEffectsButterfly.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsButterfly.png';
iconSpecialSkinEffectsMouse = new Image;
iconSpecialSkinEffectsMouse.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsMouse.png';
iconSpecialSkinEffectsTurtle = new Image;
iconSpecialSkinEffectsTurtle.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsTurtle.png';
iconSpecialSkinEffectsAbsolutVodka = new Image;
iconSpecialSkinEffectsAbsolutVodka.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsAbsolutVodka.png';
iconSpecialSkinEffectsChemistry = new Image;
iconSpecialSkinEffectsChemistry.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsChemistry.png';
iconSpecialSkinEffectsJapan = new Image;
iconSpecialSkinEffectsJapan.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsJapan.png';
iconSpecialSkinEffectsJapan2 = new Image;
iconSpecialSkinEffectsJapan2.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsJapan2.png';
iconSpecialSkinEffectsKebab = new Image;
iconSpecialSkinEffectsKebab.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsKebab.png';
iconSpecialSkinEffectsMeditation = new Image;
iconSpecialSkinEffectsMeditation.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsMeditation.png';
iconSpecialSkinEffectsSplash = new Image;
iconSpecialSkinEffectsSplash.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsSplash.png';
iconSpecialSkinEffectsByzantium = new Image;
iconSpecialSkinEffectsByzantium.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsByzantium.png';
iconSpecialSkinEffectsClose = new Image;
iconSpecialSkinEffectsClose.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsClose.png';
iconSpecialSkinEffectsEarth = new Image;
iconSpecialSkinEffectsEarth.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsEarth.png';
iconSpecialSkinEffectsFootStep = new Image;
iconSpecialSkinEffectsFootStep.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsFootStep.png';
iconSpecialSkinEffectsForward = new Image;
iconSpecialSkinEffectsForward.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsForward.png';
iconSpecialSkinEffectsFriendsForever = new Image;
iconSpecialSkinEffectsFriendsForever.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsFriendsForever.png';
iconSpecialSkinEffectsFriendsForever2 = new Image;
iconSpecialSkinEffectsFriendsForever2.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsFriendsForever2.png';
iconSpecialSkinEffectsFriendsForever3 = new Image;
iconSpecialSkinEffectsFriendsForever3.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsFriendsForever3.png';
iconSpecialSkinEffectsPolice = new Image;
iconSpecialSkinEffectsPolice.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsPolice.png';
iconSpecialSkinEffectsPolice2 = new Image;
iconSpecialSkinEffectsPolice2.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsPolice2.png';
iconSpecialSkinEffectsUnrest = new Image;
iconSpecialSkinEffectsUnrest.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsUnrest.png';
iconSpecialSkinEffectsEagle = new Image;
iconSpecialSkinEffectsEagle.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsEagle.png';
iconSpecialSkinEffectsBobMarley = new Image;
iconSpecialSkinEffectsBobMarley.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsBobMarley.png';
iconSpecialSkinEffectsEinstein = new Image;
iconSpecialSkinEffectsEinstein.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsEinstein.png';
iconSpecialSkinEffectsDeadTable = new Image;
iconSpecialSkinEffectsDeadTable.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsDeadTable.png';


iconSpecialSkinEffectsBabyBoss = new Image;
iconSpecialSkinEffectsBabyBoss.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsBabyBoss.png';
iconSpecialSkinEffectsBabyBoss1 = new Image;
iconSpecialSkinEffectsBabyBoss1.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsBabyBoss1.png';
iconSpecialSkinEffectsGladiator = new Image;
iconSpecialSkinEffectsGladiator.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsGladiator.png';
iconSpecialSkinEffectsHero = new Image;
iconSpecialSkinEffectsHero.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsHero.png';
iconSpecialSkinEffectsHero1 = new Image;
iconSpecialSkinEffectsHero1.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsHero1.png';
iconSpecialSkinEffectsHero2 = new Image;
iconSpecialSkinEffectsHero2.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsHero2.png';
iconSpecialSkinEffectsKey = new Image;
iconSpecialSkinEffectsKey.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsKey.png';
iconSpecialSkinEffectsMetalOfHonor = new Image;
iconSpecialSkinEffectsMetalOfHonor.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsMetalOfHonor.png';
iconSpecialSkinEffectsPeaceMaker = new Image;
iconSpecialSkinEffectsPeaceMaker.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsPeaceMaker.png';
iconSpecialSkinEffectsSurvivor = new Image;
iconSpecialSkinEffectsSurvivor.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsSurvivor.png';
iconSpecialSkinEffectsTiger = new Image;
iconSpecialSkinEffectsTiger.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsTiger.png';
iconSpecialSkinEffectsPanicAtDisco = new Image;
iconSpecialSkinEffectsPanicAtDisco.src = 'https://legendmod.ml/banners/iconSpecialSkinEffectsPanicAtDisco.png';
*/
if (dyinglight1load == "yes") {
    cimgDyingLight = new Image;
    cimgDyingLight.src = defaultSettings.commanderImageDyingLight;
    //cimgDyingLightvirus = new Image;
    //cimgDyingLightvirus.src = defaultSettings.commanderImageDyingLightvirus;
}
/*
                cimgDyingLight1 = new Image;
                cimgDyingLight1.src = 'https://legendmod.ml/banners/icondyinglightzombie2.png';
                cimgDyingLight2 = new Image;
                cimgDyingLight2.src = 'https://legendmod.ml/banners/icondyinglightzombie3.png';
                cimgDyingLight3 = new Image;
                cimgDyingLight3.src = 'https://legendmod.ml/banners/icondyinglightzombie4.png';
                cimgDyingLight4 = new Image;
                cimgDyingLight4.src = 'https://legendmod.ml/banners/icondyinglightzombie5.png';
                cimgDyingLight5 = new Image;
                cimgDyingLight5.src = 'https://legendmod.ml/banners/icondyinglightzombiebig.png';
                cimgDyingLight6 = new Image;
                cimgDyingLight6.src = 'https://legendmod.ml/banners/icondyinglightvolaltile.png';
				*/


var SkinExplain = [{
        name: "imgur.com",
        url: "https://imgur.com/",
        example: "https://i.imgur.com/xdmUp5N.png",
        pattern: "https?://w+.imgur.com/w{6,}.(?:%file_ext%)??d*"
    },
    {
        name: "put.re",
        url: "https://put.re/",
        example: "https://s.put.re/iYHAW65g.png",
        pattern: "https?://w+.put.re/w{8,}.(?:%file_ext%)"
    },
    {
        name: "postimages.org",
        url: "https://postimages.org/",
        example: "https://i.postimg.cc/zzK0sRPg/xdmUp5N.png",
        pattern: "https?://w+.postimg.cc/w{8,}/w+.(?:%file_ext%)"
    }
];
var defaultmapsettings = {
    positionClass: "toast-bottom-left",
    isAlphaChanged: false,
    jellyPhisycs: false,
    virusSound: false,
    onlineStatus: true,
    potionsDrinker: true,
    //massBooster: false,
    quickResp: true,
    autoResp: false,
    spawnSpecialEffects: false,
    animatedRainbowColor: false,
    autoZoom: false,
    unlockedFPS: 4, //unlockedFPS: false,
    autoHideNames: true,
    autoHideMass: true,
    autoHideFood: false,
    autoHideFoodOnZoom: false,
    noNames: false,
    optimizedNames: true,
    hideMyName: false,
    hideTeammatesNames: false,
    showMass: true,
    showChat: true,
    showChatMyOwn: false,
    oneColoredSpectator: false,
    multiBoxShadow: false,
    multiKeepMoving: true,
    middleMultiView: false,
    middleMultiViewWhenClose: true,
    optimizedMass: true,
    shortMass: true,
    cellContours: false,
    virMassShots: true,
    hideMyMass: false,
    hideEnemiesMass: false,
    vanillaSkins: true,
    universalChat: true,
    customSkins: true,
    videoSkins: true,
    videoDestorted: false,
    videoSkinsMusic2: true,
    videoOthersSkinSoundLevelproportion: true,
    myTransparentSkin: false,
    myCustomColor: true,
    transparentCells: false,
    transparentViruses: true,
    transparentSkins: false,
    showGrid: true,
    showBgSectors: false,
    showMapBorders: true,
    showGhostCells: false,
    showGhostCellsInfo: false,
	stickyCell: false,
    //showPartyBots: false,
    showMiniMap: true,
    rotateMap: true,
    showMiniMapGrid: false,
    showMiniMapGuides: true,
    showExtraMiniMapGuides: true,
    showMiniMapGhostCells: true,
    oneColoredTeammates: false,
    optimizedFood: true,
    rainbowFood: true,
    oppColors: true,
    oppRings: true,
    virColors: false,
    splitRange: false,
    qdsplitRange: true, //Sonia2
    sdsplitRange: false, //Sonia2
    virusesRange: false,
    textStroke: false,
    namesStroke: true,
    massStroke: true,
    bubbleCursorTracker: false,
    bubbleInd: false,
    cursorTracking: false,
    FBTracking: true,
    //ingameSpectator2: false,
    //fullSpectator2: false,	
    teammatesInd: true,
    mouseSplit: false,
    mouseFeed: false,
    mouseWheelClick: false,
	mouseCommand4: false,
	mouseCommand5: false,
    mouseInvert: false,
    disableChat: false,
    coloredNicks: false,
    hideChat: false,
    chatSounds: true,
    chatEmoticons: true,
    showChatBox: false,
    showChatTranslation: false,
    hidecountry: false,
    showChatImages: true,
    showChatVideos: true,
    showTop5: true,
    showTargeting: true,
    showLbData: true,
    showTime: false,
    //normalLb: true,
    centeredLb: true,
    fpsAtTop: true,
    tweenMaxEffect: false,
    top5skins: true,
    showStats: true,
    showStatsMass: true,
    showStatsESTE: false,
    showStatsEMTE: false,
    showStatsMTE: false,
    showStatsTTE: false,
    showStatsPTE: false,
    showStatsSTE: false,
    showStatsN16: true,
    showStatsFPS: true,
    //showStatsPPS: true,
    showStatsRender: false,
    blockPopups: false,
    gameOverStats: false,
    streamMode: false,
    hideSkinUrl: false,
    showQuickMenu: true,
    showQuickBots: false,
    showSkinsPanel: true,
    animation: 120,
    macroFeeding: 80,
    reverseTrick: false,
    //hideSizes: 0,
    dominationRate: 4 / 3,
    dominatedRate: 3 / 4,
    profileNumber: 15,
    ////
    cameraSpeed: 7,
    commanderDelay: 1E3,
    suckAnimation: false,
	virusSpikes: false,
    virusGlow: false,
    borderGlow: false,
    limLB: 10,
    limTP: 5,
    ////
    //'zoomSpeedValue: .87,
    zoomSpeedValue2: -0.13,
    videoSkinSoundLevel: 1,
    leaderboardlimit: 20,
    teamboardlimit: 20,
    messageSound: 'https://legendmod.ml/sounds/notification_01.mp3',
    //                commandSound: 'https://legendmod.ml/sounds/notification_02.mp3'
    commandSound: 'https://legendmod.ml/sounds/chat-message.mp3',
    virusSoundurl: 'https://legendmod.ml/sounds/sound-gunshot.mp3',
    soundSplit: 'https://www.myinstants.com/media/sounds/quack_5.mp3',
	//
	leftClick: 'hk-macroFeed',
	rightClick: 'hk-split',
	middleClick: 'hk-multiboxswap',
	mouse4Click: 'hk-doubleSplit',
	mouse5Click: 'hk-split16',
	//
    FacebookIDs: ''
};
var profiles = [];
var ogarcopythelb = {
    nick: 'I<3Legendmod',
    clanTag: '℄',
    skinURL: '',
    color: defaultSettings.mainColor
};


var lang = 'en';
userLanguage = window.navigator.language || window.navigator.userLanguage;
if (userLanguage && displayText.hasOwnProperty(userLanguage)) {
    lang = userLanguage;
}
var textLanguage = displayText[lang];
defineChatCommand();
function defineChatCommand() {
	window.chatCommand = {
		comm0: textLanguage.comm0,
		comm1: textLanguage.comm1,
		comm2: textLanguage.comm2,
		comm3: textLanguage.comm3,
		comm4: textLanguage.comm4,
		comm5: textLanguage.comm5,
		comm6: textLanguage.comm6,
		comm7: textLanguage.comm7,
		comm8: textLanguage.comm8,
		comm9: textLanguage.comm9,
		comm10: textLanguage.comm10,
		comm11: textLanguage.comm11,
		comm12: textLanguage.comm12,
		comm13: textLanguage.comm13,
		comm14: textLanguage.comm14,
		comm15: textLanguage.comm15,
		comm16: textLanguage.comm16,
		comm17: textLanguage.comm17,
		comm18: textLanguage.comm18,
		comm19: textLanguage.comm19,
		comm20: textLanguage.comm20,
		comm21: textLanguage.comm21,
		comm22: textLanguage.comm22,
		comm23: textLanguage.comm23,
		comm24: textLanguage.comm24,
		comm25: textLanguage.comm25,
		comm26: textLanguage.comm26,
		comm27: textLanguage.comm27,
		comm28: textLanguage.comm28,
		comm29: textLanguage.comm29,
		comm30: textLanguage.comm30,
		comm31: textLanguage.comm31,
		comm32: textLanguage.comm32,
		comm33: textLanguage.comm33,
		comm34: textLanguage.comm34,
		comm35: textLanguage.comm35,
		comm36: textLanguage.comm36,
		comm37: textLanguage.comm37,
		comm38: textLanguage.comm38,
		comm39: textLanguage.comm39,
		comm40: textLanguage.comm40,
		comm41: textLanguage.comm41,
		comm42: textLanguage.comm42,
		comm43: textLanguage.comm43,
		comm44: textLanguage.comm44,
		comm45: textLanguage.comm45,
		comm46: textLanguage.comm46,
		comm47: textLanguage.comm47,
		comm48: textLanguage.comm48,
		comm49: textLanguage.comm49,
		comm50: textLanguage.comm50	
	}
}
//var thelegendmodproject = function(t, e, i) {
function thelegendmodproject() {
    var application;
    var o = null;
    var a = null;
    //a = null,
    /*    lang = 'en',
            userLanguage = window.navigator.language || window.navigator.userLanguage;
        if (userLanguage && displayText.hasOwnProperty(userLanguage)){
			lang = userLanguage;
		}
        var textLanguage = displayText[lang];*/
    //if (displayText[r].comm15 != undefined) {
    //console.log(textLanguage.comm15);
    //}
window.MouseClicks=[];
    Settings = {
        menuMainColorCSS: null,
        menuPanelColorCSS: null,
        menuTextlColorCSS: null,
        menuButtonsCSS: null,
        hudCSS: null,
        chatCSS: null,
        chatScaleCSS: null,
        cursorCSS: null,		
        loadThemeSettings() {
            let storage = null;
            if (window.localStorage.getItem('ogarioThemeSettings') !== null) {
                storage = JSON.parse(window.localStorage.getItem('ogarioThemeSettings'));
            }
            for (const setup in defaultSettings) {
                if (defaultSettings.hasOwnProperty(setup)) {
                    if (storage && storage.hasOwnProperty(setup)) {
                        defaultSettings[setup] = storage[setup];
                    }
                    if (ogario.hasOwnProperty(setup)) {
                        ogario[setup] = defaultSettings[setup];
                    }
                }
            }
        },
        saveThemeSettings() {
            window.localStorage.setItem('ogarioThemeSettings', JSON.stringify(defaultSettings));
        },
        restoreThemeSettings() {
            if (window.localStorage.getItem('ogarioThemeSettings') !== null) {
                window.localStorage.removeItem('ogarioThemeSettings');
                window.location.reload();
            }
        },
        addCustomCSS(name, css) {
            if (!this[name]) {
                this[name] = $("<style type='text/css'>").appendTo('head');
            }
            this[name].html(css);
        },
        addPresetBox(id, name, options, value, callback) {
            for (var option in $(id).append('<div class=\"preset-box\"><span class=\"title-box\">' + textLanguage[name] + '</span><div class=\"select-wrapper\"><select id=\"' + name + '\" class=\"form-control\"></select></div></div>'), options) {
                options.hasOwnProperty(option) && $('#' + name).append('<option value=\"' + option + '\">' + options[option]['name'] + '</option>');
            }
            $('#' + name).val(defaultSettings[value]);
            var app = this;
            $('#' + name).on('change', function() {
                var id = this.value;
                defaultSettings[value] = id;
                app[callback](id);
            });
        },
		addPresetBox2(id, name, options, value, callback) {
            for (var option in $(id).append('<label data-original-title="" title="">' +textLanguage[name] + '<div class=\"select-wrapper\" style="display:inline-block; width: 60%; float:right;"><select id=\"' + name + '\" class=\"form-control\"></select></div></label>'), options) {
                Object.values(options) && $('#' + name).append('<option value=\"' + option + '\">' + options[option]['label'] + '</option>');
				//options.hasOwnProperty(option) && $('#' + name).append('<option value=\"' + option + '\">' + options[option]['name'] + '</option>');
            }
            //$('#' + name).val(defaultSettings[value]);
            var app = this;
            $('#' + name).on('change', function() {
                var id = this.value;
				//console.log(id,name)
                window.MouseClicks[name] = id;
                app[callback](name);
            });
        },	
		addPresetBox3(id, name, options, value, callback) {
            for (var option in $(id).after('<div class=\"select-wrapper\" style="display:inline-block; width: 48%; margin-Left: 10px"><select id=\"' + name + '\" class=\"form-control\"></select></div>'), options) {
                Object.values(options) && $('#' + name).append('<option value=\"' + option + '\">' + options[option]['label'] + '</option>');
				//options.hasOwnProperty(option) && $('#' + name).append('<option value=\"' + option + '\">' + options[option]['name'] + '</option>');
            }
            //$('#' + name).val(defaultSettings[value]);
            var app = this;
            $('#' + name).on('change', function() {
                var id = this.value;
				//console.log(id,name)
                window.MouseClicks[name] = id;
                app[callback](name);
            });
        },			
        addColorBox(id, name, callback) {
            $(id).append('<div class=\"color-box\"><span class=\"title-box\">' + textLanguage[name] + '</span><div class=\"input-group ' + name + '-picker\"><input type=\"text\" value=\"' + defaultSettings[name] + '\" id=\"' + name + '\" class=\"form-control\" /><span class=\"input-group-addon\"><i></i></span></div></div>');
            if (callback) {
                var app = this;
                $(id + ' .' + name + '-picker').colorpicker({
                    'format': 'hex'
                }).on('changeColor.colorpicker', function(id) {
                    defaultSettings[name] = id.color.toHex();
                    ogario.hasOwnProperty(name) && (ogario[name] = defaultSettings[name]);
                    app[callback]();
                });
            } else $(id + ' .' + name + '-picker').colorpicker({
                'format': 'hex'
            }).on('changeColor.colorpicker', function(id) {
                defaultSettings[name] = id.color.toHex();
                if (ogario.hasOwnProperty(name)) {
                    ogario[name] = defaultSettings[name];
                }
            });
        },
        addRgbaColorBox(id, name, callback) {
            $(id).append('<div class=\"color-box\"><span class=\"title-box\">' + textLanguage[name] + '</span><div class=\"input-group ' + name + '-picker\"><input type=\"text\" value=\"' + defaultSettings[name] + '\" id=\"' + name + '\" class=\"form-control\" /><span class=\"input-group-addon\"><i></i></span></div></div>');
            if (callback) {
                var app = this;
                $(id + ' .' + name + '-picker').colorpicker({
                    'format': 'rgba'
                }).on('changeColor.colorpicker', function(ids) {
                    var color = ids.color.toRGB();
                    defaultSettings[name] = 'rgba(' + color['r'] + ',' + color['g'] + ',' + color['b'] + ',' + color['a'] + ')';
                    if (ogario.hasOwnProperty(name)) {
                        ogario[name] = defaultSettings[name];
                    }
                    app[callback]();
                });
            } else {
                (id + ' .' + name + '-picker').colorpicker({
                    'format': 'rgba'
                }).on('changeColor.colorpicker', function(ids) {
                    var color = ids.color.toRGB();
                    defaultSettings[name] = 'rgba(' + color['r'] + ',' + color['g'] + ',' + color['b'] + ',' + color['a'] + ')';
                    ogario.hasOwnProperty(name) && (ogario[name] = defaultSettings[name]);
                });
            }
        },
        addSliderBox(id, name, min, max, step, callback) {
            // $(id).append('<div class=\"slider-box\"><div class=\"box-label\"><span class=\"value-label\">' + textLanguage[name] + ': </span><span id=\"' + name + '-value\" class=\"value\">' + defaultSettings[name] + '</span></div><input id=\"' + name + '-slider\" type=\"range\" min=\"' + min + '\" max=\"' + max + '\" step=\"' + step + '\" value=\"' + defaultSettings[name] + '\"></div>');
            $(id).append(`<div class="slider-box">
                              <div class="box-label">
                                  <span class="value-label">
                                      ${textLanguage[name]}
                                  </span>
                                  <span id="${name}-value" class="value">
                                      ${defaultSettings[name]}
                                  </span>
                              </div>
                              <input id="${name}-slider" type="range" min="${min}" max="${max}" step="${step}" value="${defaultSettings[name]}">
                          </div>
                          `);
            if (callback) {
                var app = this;
                $('#' + name + '-slider').on('input', function() {
                    var t = parseFloat($(this).val());
                    $('#' + name + '-value').text(t);
                    defaultSettings[name] = t;
                    if (ogario.hasOwnProperty(name)) {
                        ogario[name] = t;
                    }
                    app[callback]();
                });
            } else $('#' + name + '-slider').on('input', function() {
                var t = parseFloat($(this).val());
                $('#' + name + '-value').text(t);
                defaultSettings[name] = t;
                if (ogario.hasOwnProperty(name)) {
                    ogario[name] = t;
                }
            });
        },
        addInputBox(id, name, holder, callback) {
            $(id).append('<div class=\"input-box\"><span class=\"title-box\">' + textLanguage[name] + '</span><input id=\"' + name + '\" class=\"form-control\" placeholder=\"' + holder + '\" value=\"' + defaultSettings[name] + '\" /></div>');
            var app = this;
            $('#' + name).on('input', function() {
                defaultSettings[name] = this.value;
                app[callback]();
            });
        },
        addCursorBox(id, url) {
            if (url === defaultSettings.customCursor) {
                $(id).append('<div class=\"cursor-box\"><a href=\"#\" class=\"active\"><img src=\"' + url + '\"></a></div>');
            } else {
                $(id).append('<div class=\"cursor-box\"><a href=\"#\"><img src=\"' + url + '\"></a></div>');
            }
        },
        setFont(id, fontFamily) {
            defaultSettings[id] = fontFamily;
            defaultSettings[id + 'Family'] = this.setFontFamily(fontFamily);
            defaultSettings[id + 'Weight'] = this.setFontWeight(fontFamily);
            if (ogario.hasOwnProperty(id + 'Family')) ogario[id + 'Family'] = defaultSettings[id + 'Family'];
            if (ogario.hasOwnProperty(id + 'Weight')) ogario[id + 'Weight'] = defaultSettings[id + 'Weight'];
        },
        addFontBox(id, name, callback) {
            $(id).append('<div class=\"font-box\"><span class=\"title-box\">' + textLanguage[name] + '</span><div class=\"select-wrapper\"><select id=\"' + name + '\" class=\"form-control\"></select></div></div>');
            $('#' + name).append('<option value=\"ubuntu\">Ubuntu</option><option value=\"ubuntu-bold\">Ubuntu Bold</option>');
            $('#' + name).append('<option value=\"roboto\">Roboto</option><option value=\"roboto-bold\">Roboto Bold</option>');
            $('#' + name).append('<option value=\"oswald\">Oswald</option><option value=\"oswald-bold\">Oswald Bold</option>');
            $('#' + name).append('<option value=\"shojumaru\">Shojumaru</option><option value=\"shojumaru-bold\">Shojumaru Bold</option>');
            $('#' + name).append('<option value=\"allura\">Allura</option><option value=\"allura-bold\">Allura Bold</option>');

            $('#' + name).val(defaultSettings[name]);
            var app = this;
            callback ? $('#' + name).on('change', function() {
                var appi = this.value;
                app.setFont(name, appi);
                app[callback]();
            }) : $('#' + name).on('change', function() {
                var appi = this.value;
                app.setFont(name, appi);
            });
        },
        setFontFamily(name) {
            var tempFont;
            if (name.indexOf('roboto') == 0) {
                tempFont = 'Roboto';
            } else if (name.indexOf('oswald') == 0) {
                tempFont = 'Oswald';
            } else if (name.indexOf('shojumaru') == 0) {
                //console.log('font: shojumaru');
                tempFont = 'Shojumaru';
            } else if (name.indexOf('allura') == 0) {
                //console.log('font: allura');
                tempFont = 'Allura';
            }
            //					else (if t.indexOf('ubuntu')){
            else {
                tempFont = 'Ubuntu';
            }

            return tempFont;
            //return -1 != t.indexOf('roboto') ? 'Roboto' : -1 != t.indexOf('oswald') ? 'Oswald' : 'Ubuntu';
        },
        setFontWeight(name) {
            if (name.indexOf('bold') != -1) {
                return 700;
            }
            return 400;
        },
        setThemeMenu() {
            //var t = this;
            $('#theme').append('<ul class=\"submenu-tabs\"><li class=\"theme-main-tab active\"><a href=\"#theme-main\" class=\"active ogicon-paint-format\" data-toggle=\"tab-tooltip\" title=\"' + textLanguage.basicTheming +
                '\"></a></li><li class=\"theme-menu-tab\"><a href=\"#theme-menu\" class=\"ogicon-menu\" data-toggle=\"tab-tooltip\" title=\"' + textLanguage.menuTheming +
                //
                //'\"></a></li><li class=\"theme-menu-tab\"><a href=\"#theme-menu\" class=\"ogicon-trophy\" data-toggle=\"tab-tooltip\" title=\"' + textLanguage.menuTheming +
                //
                '\"></a></li><li class=\"theme-hud-tab\"><a href=\"#theme-hud\" class=\"ogicon-display\" data-toggle=\"tab-tooltip\" title=\"' + textLanguage.hudTheming +
                '\"></a></li><li class=\"theme-chat-tab\"><a href=\"#theme-chat\" class=\"ogicon-bubbles\" data-toggle=\"tab-tooltip\" title=\"' + textLanguage.chatTheming +
                '\"></a></li><li class=\"theme-minimap-tab\"><a href=\"#theme-minimap\" class=\"ogicon-location2\" data-toggle=\"tab-tooltip\" title=\"' + textLanguage.miniMapTheming +
                '\"></a></li><li class=\"theme-images-tab\"><a href=\"#theme-images\" class=\"ogicon-compass\" data-toggle=\"tab-tooltip\" title=\"' + textLanguage.imagesTheming +
                '\"></a></li></ul><div id=\"theme-main\" class=\"submenu-panel\"></div><div id=\"theme-menu\" class=\"submenu-panel\"></div><div id=\"theme-hud\" class=\"submenu-panel\"></div><div id=\"theme-chat\" class=\"submenu-panel\"></div><div id=\"theme-minimap\" class=\"submenu-panel\"></div><div id=\"theme-images\" class=\"submenu-panel\"></div>');
            this.addPresetBox('#theme-main', 'themePreset', themePresets, 'preset', 'changeThemePreset');
            this.addColorBox('#theme-main', 'bgColor', 'setBgColor');
            this.addColorBox('#theme-main', 'bordersColor');
            this.addColorBox('#theme-main', 'borderGlowColor');
            this.addColorBox('#theme-main', 'gridColor');
            this.addColorBox('#theme-main', 'sectorsColor');
            this.addColorBox('#theme-main', 'namesColor');
            this.addColorBox('#theme-main', 'namesStrokeColor');
            this.addColorBox('#theme-main', 'massColor');
            this.addColorBox('#theme-main', 'massStrokeColor');
            this.addColorBox('#theme-main', 'virusColor');
            this.addColorBox('#theme-main', 'virusStrokeColor');
            this.addColorBox('#theme-main', 'mVirusColor');
            this.addColorBox('#theme-main', 'mVirusStrokeColor');
            this.addColorBox('#theme-main', 'virusGlowColor');
            this.addColorBox('#theme-main', 'foodColor', 'setFoodColor');
            this.addColorBox('#theme-main', 'teammatesIndColor', 'setIndicatorColor');
            this.addColorBox('#theme-main', 'cursorTrackingColor');
            this.addColorBox('#theme-main', 'splitRangeColor');
            this.addColorBox('#theme-main', 'enemyBSTEDColor'); //Sonia2
            this.addColorBox('#theme-main', 'enemyBSTEColor'); //Sonia2
            this.addColorBox('#theme-main', 'enemyBColor'); //Sonia2
            this.addColorBox('#theme-main', 'enemySColor'); //Sonia2
            this.addColorBox('#theme-main', 'enemySSTEColor'); //Sonia2
            this.addColorBox('#theme-main', 'enemySSTEDColor'); //Sonia2
            this.addColorBox('#theme-main', 'safeAreaColor');
            this.addColorBox('#theme-main', 'dangerAreaColor');
            this.addColorBox('#theme-main', 'ghostCellsColor');
            this.addFontBox('#theme-main', 'namesFont');
            this.addFontBox('#theme-main', 'massFont');
            this.addFontBox('#theme-main', 'sectorsFont');
            this.addSliderBox('#theme-main', 'sectorsX', 2, 10, 1);
            this.addSliderBox('#theme-main', 'sectorsY', 2, 10, 1);
            this.addSliderBox('#theme-main', 'sectorsFontSize', 200, 2000, 10);
            this.addSliderBox('#theme-main', 'namesScale', 0.5, 2, 0.1);
            this.addSliderBox('#theme-main', 'massScale', 1, 5, 1);
            this.addSliderBox('#theme-main', 'virMassScale', 1, 5, 1);
            this.addSliderBox('#theme-main', 'strokeScale', 1, 4, 0.1);
            this.addSliderBox('#theme-main', 'foodSize', 1, 50, 1, 'setFoodColor');
			this.addSliderBox('#theme-main', 'virusSpikesRatio', 0.03, 0.8, 0.01);
			this.addSliderBox('#theme-main', 'virusSpikesSize', 1, 60, 1);
            this.addSliderBox('#theme-main', 'virusStrokeSize', 2, 40, 1);
            this.addSliderBox('#theme-main', 'bordersWidth', 2, 200, 2);
            this.addSliderBox('#theme-main', 'borderGlowSize', 0, 40, 1);
            this.addSliderBox('#theme-main', 'virusGlowSize', 0, 40, 1);
            this.addSliderBox('#theme-main', 'sectorsWidth', 2, 200, 2);
            this.addSliderBox('#theme-main', 'cellsAlpha', 0.01, 0.99, 0.01);
            this.addSliderBox('#theme-main', 'skinsAlpha', 0.01, 0.99, 0.01);
            this.addSliderBox('#theme-main', 'virusAlpha', 0, 1, 0.01);
            this.addSliderBox('#theme-main', 'textAlpha', 0.1, 1, 0.01);
            this.addSliderBox('#theme-main', 'ghostCellsAlpha', 0.01, 0.99, 0.01);
			this.addPresetBox('#theme-main', 'indicators', indicatorMenus, 'indicators', 'changeIndicators');			
            this.addPresetBox('#theme-menu', 'menuPreset', themeMenus, 'menuPreset', 'changeMenuPreset');
            this.addSliderBox('#theme-menu', 'menuOpacity', 0.1, 1, 0.01, 'setMenuOpacity');
            this.addColorBox('#theme-menu', 'menuMainColor', 'setMenuMainColor');
            this.addColorBox('#theme-menu', 'menuBtnTextColor', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'menuPanelColor', 'setMenuPanelColor');
            this.addColorBox('#theme-menu', 'menuPanelColor2', 'setMenuPanelColor');
            this.addColorBox('#theme-menu', 'menuTextColor', 'setMenuTextColor');
            this.addColorBox('#theme-menu', 'menuTextColor2', 'setMenuTextColor');
            this.addColorBox('#theme-menu', 'btn1Color', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'btn1Color2', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'btn2Color', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'btn2Color2', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'btn3Color', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'btn3Color2', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'btn4Color', 'setMenuButtons');
            this.addColorBox('#theme-menu', 'btn4Color2', 'setMenuButtons');
            this.addInputBox('#theme-menu', 'menuBg', 'Image URL', 'setMenuBg');
            this.addColorBox('#theme-hud', 'hudMainColor', 'setHudColors');
            this.addRgbaColorBox('#theme-hud', 'hudColor', 'setHudColors');
            this.addColorBox('#theme-hud', 'hudTextColor', 'setHudColors');
            this.addColorBox('#theme-hud', 'statsHudColor', 'setHudColors');
            this.addColorBox('#theme-hud', 'timeHudColor', 'setHudColors');
            this.addColorBox('#theme-hud', 'top5MassColor', 'setHudColors');
            this.addColorBox('#theme-hud', 'lbMeColor', 'setHudColors');
            this.addColorBox('#theme-hud', 'lbTeammateColor2', 'setHudColors');
            this.addFontBox('#theme-hud', 'hudFont', 'setHudFont');
            var hudScaleLimit = 1.5
            if (window.screen.height <= 800) {
                hudScaleLimit = 0.9
            } else if (window.screen.height <= 992) {
                hudScaleLimit = 1
            } else if (window.screen.height <= 1080) {
                hudScaleLimit = 1.1
            }
            this.addSliderBox('#theme-hud', 'hudScale', 0.5, hudScaleLimit, 0.01, 'setHudScale');

            this.addRgbaColorBox('#theme-chat', 'messageColor', 'setChatColors');
            this.addColorBox('#theme-chat', 'messageTextColor', 'setChatColors');
            this.addColorBox('#theme-chat', 'messageTimeColor', 'setChatColors');
            this.addColorBox('#theme-chat', 'messageNickColor', 'setChatColors');
            this.addRgbaColorBox('#theme-chat', 'commandsColor', 'setChatColors');
            this.addColorBox('#theme-chat', 'commandsTextColor', 'setChatColors');
            this.addColorBox('#theme-chat', 'commandsTimeColor', 'setChatColors');
            this.addColorBox('#theme-chat', 'commandsNickColor', 'setChatColors');
            this.addRgbaColorBox('#theme-chat', 'chatBoxColor', 'setChatColors');
            this.addPresetBox('#theme-chat', 'chatPosition', chatPositions, 'chatPos', 'changeChatThemePosition');
            this.addSliderBox('#theme-chat', 'chatScale', 1, 2, 0.01, 'setChatScale');
            this.addColorBox('#theme-minimap', 'miniMapSectorsColor', 'setMiniMapSectorsColor');
            this.addColorBox('#theme-minimap', 'miniMapSectorColor');
            this.addColorBox('#theme-minimap', 'miniMapNickColor');
            this.addColorBox('#theme-minimap', 'miniMapNickStrokeColor');
            this.addColorBox('#theme-minimap', 'miniMapMyCellColor');
            this.addColorBox('#theme-minimap', 'miniMapMyCellStrokeColor');
            this.addColorBox('#theme-minimap', 'miniMapTeammatesColor');
            this.addColorBox('#theme-minimap', 'miniMapDeathLocationColor');
            this.addColorBox('#theme-minimap', 'miniMapGuidesColor');
            this.addColorBox('#theme-minimap', 'miniMapGhostCellsColor');
            this.addFontBox('#theme-minimap', 'miniMapFont', 'setMiniMapFont');
            this.addFontBox('#theme-minimap', 'miniMapNickFont');
            this.addSliderBox('#theme-minimap', 'miniMapWidth', 120, 400, 2, 'setMiniMapWidth');
            this.addSliderBox('#theme-minimap', 'miniMapSectorsOpacity', 0, 1, 0.01, 'setMiniMapSectorsOpacity');
            this.addSliderBox('#theme-minimap', 'miniMapNickSize', 8, 16, 1);
            this.addSliderBox('#theme-minimap', 'miniMapNickStrokeSize', 0, 6, 1);
            this.addSliderBox('#theme-minimap', 'miniMapMyCellSize', 4, 10, 0.5);
            this.addSliderBox('#theme-minimap', 'miniMapMyCellStrokeSize', 0, 10, 1);
            this.addSliderBox('#theme-minimap', 'miniMapTeammatesSize', 4, 10, 0.5);
            this.addSliderBox('#theme-minimap', 'miniMapGhostCellsAlpha', 0.01, 0.99, 0.01);
            this.addInputBox('#theme-images', 'customBackground', 'Image URL', 'setCustomBackground');
            this.addSliderBox('#theme-images', 'backgroundAlpha', 0, 1, 0.01);
            this.addPresetBox('#theme-images', 'graphics', graphicMenus, 'graphics', 'changeGraphics');
            this.addInputBox('#theme-images', 'customCursor', 'Cursor image URL', 'setCustomCursor');
            /*this.addInputBox('.facebook-panel', 'FacebookIDs', `e.g. 123456789012345:John K,543210987654321:Jimbo`, `setFBIDs`);*/
            for (var e = 'https://legendmod.ml/cursors/cursor_', i = 0; i < 42; i++) i < 9 ? this.addCursorBox('#theme-images', e + '0' + (i + 1) + '.cur') : this.addCursorBox('#theme-images', e + '' + (i + 1) + '.cur');
            $(document).on('click', '#theme-images .cursor-box a', function(e) {
                    e.preventDefault();
                    var i = $('img', this).attr('src');
                    defaultSettings.customCursor = i;
                    Settings.setCustomCursor();
                    $('#customCursor').val(i);
                    $('#theme-images .cursor-box a').removeClass('active');
                    $(this).addClass('active');
                }),
                $('#theme').append('<button class=\"btn btn-block btn-success btn-save\"\">' + textLanguage.saveSett + '</button>'),
                $(document).on('click', '#theme .btn-save', function(e) {
                    e.preventDefault();
                    var i = $(this);
                    i.text(textLanguage.saved);
                    Settings.saveThemeSettings();
                    setTimeout(function() {
                        i.text(textLanguage.saveSett);
                    }, 500);
                    ogarhusettings();
                    //ogarhusettingsImportExportMobile();
                });
            $('#theme').append('<div class=\"restore-settings\"><a href=\"#\">' + textLanguage.restoreThemeSettings + '</a></div>'),
                $(document).on('click', '#theme .restore-settings a', function(e) {
                    e.preventDefault(), Settings.restoreThemeSettings();
                }), $('.skin').colorpicker({
                    'format': 'hex',
                    'input': '#color'
                });
        },
        changePreset(names, theme) {
            if (theme[names]) {
                defaultSettings[names] = names;
                var names = theme[names];
            } else {
                return;
            }
            for (const name in names) {
                if (names.hasOwnProperty(name) && defaultSettings.hasOwnProperty(name)) {
                    defaultSettings[name] = names[name];
                    if (ogario.hasOwnProperty(name)) {
                        ogario[name] = defaultSettings[name];
                    }
                    //console.log(name)
                    if ($('#theme .' + name + '-picker')) {
                        $('#theme .' + name + '-picker').colorpicker('setValue', defaultSettings[name]);
                    }
                    if ($('#' + name + '-slider')) {
                        $('#' + name + '-slider').val(defaultSettings[name]).change();
                    }
                    if ($('input[type=text]#' + name) || $('select#' + name)) {
                        $('#' + name).val(defaultSettings[name]);
                    }
                }
            }
        },
        changeThemePreset(name) {
            this.changePreset(name, themePresets);
            this.setTheme();
        },
        changeleftCmd(name) {
			defaultmapsettings.leftClick = window.MouseClicks[name]
			application.saveSettings(defaultmapsettings, 'ogarioSettings');
        },	
        changerightCmd(name) {
			defaultmapsettings.rightClick = window.MouseClicks[name]
			application.saveSettings(defaultmapsettings, 'ogarioSettings');
        },	
        changemiddleCmd(name) {
			defaultmapsettings.middleClick = window.MouseClicks[name]
			application.saveSettings(defaultmapsettings, 'ogarioSettings');
        },	
        change4Cmd(name) {
			defaultmapsettings.mouse4Click = window.MouseClicks[name]
			application.saveSettings(defaultmapsettings, 'ogarioSettings');
        },	
        change5Cmd(name) {
			defaultmapsettings.mouse5Click = window.MouseClicks[name]
			application.saveSettings(defaultmapsettings, 'ogarioSettings');
        },			
        changeChatThemePosition(name) {
            this.changePreset(name, chatPositions);
            this.setChatPosition();
        },
        setFonts() {
            this.setFont('namesFont', defaultSettings.namesFont);
            this.setFont('massFont', defaultSettings.namesFont);
            this.setFont('sectorsFont', defaultSettings.sectorsFont);
        },
        setBgColor() {
            $('body').css('background-color', defaultSettings.bgColor);
        },
        setFoodColor() {
            if (defaultmapsettings.optimizedFood && drawRender) {
                drawRender.preDrawPellet();
            }
        },
        setIndicatorColor() {
            if (drawRender) {
                drawRender.preDrawIndicator();
            }
        },
        setCustomBackground() {
            if (defaultSettings.customBackground) {
                //$('body').css('background-image', 'url(' + defaultSettings.customBackground + ')')
                //$("#canvas").css('background-size', 'cover'); 
            } else {
                //$('body').css('background-image', 'none');
            }
        },
        setCustomCursor() {
            if (defaultSettings.customCursor) var css = '*{cursor:url(' + defaultSettings.customCursor + '), auto !important}';
            else css = '*{cursor: auto}';
            this.addCustomCSS('cursorCSS', css);
        },
        setMenu() {
            this.setMenuOpacity();
            this.setMenuMainColor();
            this.setMenuPanelColor();
            this.setMenuTextColor();
            this.setMenuButtons();
            this.setMenuBg();
        },	
		changeIndicators(value) {},	
        changeMenuPreset(name) {
            this.changePreset(name, themeMenus);
            this.setMenu();
        },
        changeGraphics(value) {
			
		},
        setMenuOpacity() {
            $('#helloContainer, #hotkeys, #exp-imp').css('opacity', defaultSettings.menuOpacity);
        },
        setMenuMainColor() {
            var css = '::-moz-selection{background-color:' + defaultSettings.menuMainColor + '!important}::selection{background-color:' + defaultSettings.menuMainColor + '!important}.menu-main-color,#quick-menu a:hover,.quick,.quick:focus,.menu-tabs a:hover,.menu-tabs .active,.submenu-tabs a:hover,.submenu-tabs .active,#stats center,#exp-imp h1{color:' + defaultSettings.menuMainColor + '}#exp-bar .progress-bar-striped,.quick:hover,.rangeslider__fill{background-color:' + defaultSettings.menuMainColor + '}#main-menu,.agario-side-panel,#hotkeys,#exp-imp{border-color:' + defaultSettings.menuMainColor + '}.ps-scrollbar-y{background-color:' + defaultSettings.menuMainColor + '!important}';
            this.addCustomCSS('menuMainColorCSS', css);
        },
        setMenuPanelColor() {
            var css = '#main-menu,.agario-side-panel,#hotkeys,#exp-imp{background-color: ' + defaultSettings.menuPanelColor + '}label:hover,.agario-panel input,#UserProfileID2a, .agario-panel select,.agario-side-panel input,.agario-side-panel select,.input-group-addon,.nick .input-group-btn,.skin .input-group-btn,#stream-mode,#hide-url,.menu-tabs a:hover,.menu-tabs .active,.submenu-tabs,#exp-bar .progress,#quick-menu a:hover,.quick,.select-wrapper,#hotkeys-cfg div.row:hover,#hotkeys-cfg .command-in,#exp-imp-settings textarea,.restore-settings{background-color: ' + defaultSettings.menuPanelColor2 + '}.agario-panel h5,.agario-side-panel h5,#stats h2,.menu-tabs,.submenu-tabs,#skins a.default,#stats hr,#hotkeys-cfg div.row, #exp-imp h1{border-color: ' + defaultSettings.menuPanelColor2 + '}.quick:hover,#skins a,#profiles{color:' + defaultSettings.menuPanelColor2 + '}input.stream-mode,input.hide-url{color:' + defaultSettings.menuPanelColor2 + '!important}';
            this.addCustomCSS('menuPanelColorCSS', css);
        },
        setMenuTextColor() {
            var css = '.agario-panel,.agario-side-panel,.agario-panel input,.agario-panel select,#UserProfileID2a, .agario-side-panel input,.agario-side-panel select,.input-group-addon,.dark .yt-username,#stream-mode,#hide-url,.menu-tabs a,.submenu-tabs a,#skins a.default:hover,#quick-menu a,#prev-profile.default:hover,#next-profile.default:hover,#statsText,#hotkeys,#hotkeys-cfg .command-in,#exp-imp{color:' + defaultSettings.menuTextColor + '}#skins a.default:hover{border-color:' + defaultSettings.menuTextColor + '}::-webkit-input-placeholder{color:' + defaultSettings.menuTextColor2 + '!important}::-moz-placeholder{color:' + defaultSettings.menuTextColor2 + '!important}#user-id-tag,#UserProfileID2a, #version-tag,#statsSubtext,#hotkeys-inst,#exp-imp textarea,.restore-settings a,.restore-settings a:hover{color:' + defaultSettings.menuTextColor2 + '}#hotkeys-cfg .command-in,#theme .color-box{border-color:' + defaultSettings.menuTextColor2 + '}';
            this.addCustomCSS('menuTextColorCSS', css);
        },
        setMenuButtons() {
            var css = 'a,a:hover{color:' + defaultSettings.btn1Color + '}.btn,#hotkeys-cfg .custom-key-in{color:' + defaultSettings.menuBtnTextColor + '}.btn-primary{background-color:' + defaultSettings.btn1Color + '!important}.btn-primary:active,.btn-primary:disabled,.btn-primary:focus,.btn-primary:hover{background-color:' + defaultSettings.btn1Color2 + '!important}.btn-success{background-color:' + defaultSettings.btn2Color + '!important}.btn-success:active,.btn-success:disabled,.btn-success:focus,.btn-success:hover{background-color:' + defaultSettings.btn2Color2 + '!important}.btn-warning{background-color:' + defaultSettings.btn3Color + '!important}.btn-warning:active,.btn-warning:disabled,.btn-warning:focus,.btn-warning:hover{background-color:' + defaultSettings.btn3Color2 + '!important}.btn-danger{background-color:' + defaultSettings.btn4Color + '!important}.btn-danger:active,.btn-danger:disabled,.btn-danger:focus,.btn-danger:hover{background-color:' + defaultSettings.btn4Color2 + '!important}#hotkeys-cfg .custom-key-in{background-color:' + defaultSettings.btn4Color2 + ';border-color:' + defaultSettings.btn4Color2 + '}';
            this.addCustomCSS('menuButtonsCSS', css);
        },
        setMenuBg() {
            $('#menuBg').val(defaultSettings.menuBg);
            if (defaultSettings.menuBg) {
                $('.menu-panel, .agario-side-panel, #hotkeys, #exp-imp').css('background-image', 'url(' + defaultSettings.menuBg + ')');
            } else {
                $('.menu-panel, .agario-side-panel, #hotkeys, #exp-imp').css('background-image', 'none');
            }
        },
        setHud() {
            this.setHudColors();
            this.setHudFont();
            this.setHudScale();
        },
        setHudColors() {
            var css = '.hud-main-color,#top5-hud a,#target-panel-hud a:hover,#target-panel-hud a.active,#message-menu a{color:' + defaultSettings.hudMainColor + '}.hud,.hud-b,#chat-emoticons{background-color:' + defaultSettings.hudColor + '}.hud,.hud-b,#top5-hud a:hover,#target-panel-hud a{color:' + defaultSettings.hudTextColor + '}.stats-hud-color{color:' + defaultSettings.statsHudColor + '}.time-hud-color{color:' + defaultSettings.timeHudColor + '}.top5-mass-color{color:' + defaultSettings.top5MassColor + '}#leaderboard-positions .me{color:' + defaultSettings.lbMeColor + '}#leaderboard-positions .teammate{color:' + defaultSettings.lbTeammateColor2 + '}';
            $('.top5-mass-bar').css('background-color', $('#hudMainColor')[0].value)
            this.addCustomCSS('hudCSS', css);
        },
        setHudFont() {
            this.setFont('hudFont', defaultSettings.hudFont);
            $('#overlays-hud').css({
                'font-family': defaultSettings.hudFontFamily,
                'font-weight': defaultSettings.hudFontWeight
            });
        },
        setHudScale() {
            var t = Math.round(20 * defaultSettings.hudScale);
            var e = Math.round(200 * defaultSettings.hudScale);
            var i = Math.floor(55 * defaultSettings.hudScale);
            var o = Math.floor(6 * defaultSettings.hudScale);
            var a = Math.floor(530 * defaultSettings.hudScale);
            var n = Math.floor(85 * defaultSettings.hudScale);
            var r = Math.floor(20 * defaultSettings.hudScale);

            $('#overlays-hud').css('font-size', t + 'px');
            $('#time-hud').width(e);
            $('#leaderboard-hud').css('transform', 'scale(' + defaultSettings.hudScale + ')');
            $('#top5-hud').css('transform', 'scale(' + defaultSettings.hudScale + ')');
            $('#time-hud').css('top', a + 'px');
            $('#pause-hud').css('top', n + 'px');
            $('#target-hud').css('padding-top', r + 'px');
        },
        setChat() {
            this.setChatColors();
            this.setChatScale();
        },
        setChatColors() {
            var css = '#message,#messages li,.toast-success{background-color:' + defaultSettings.messageColor + '}#message,.message-text,.toast-success .message-text{color:' + defaultSettings.messageTextColor + '}.message-nick,.mute-user,.mute-user:hover,.toast-success .message-nick,.toast .mute-user,.toast .mute-user:hover{color:' + defaultSettings.messageNickColor + '}.message-time{color:' + defaultSettings.messageTimeColor + '}.toast-warning{background-color:' + defaultSettings.commandsColor + '}.command-text,.toast-warning .command-text{color:' + defaultSettings.commandsTextColor + '}.command-nick,.toast-warning .command-nick,.toast-warning .mute-user,.toast-warning .mute-user:hover{color:' + defaultSettings.commandsNickColor + '}.command-time{color:' + defaultSettings.commandsTimeColor + '}#chat-box{background-color:' + defaultSettings.chatBoxColor + '}';
            this.addCustomCSS('chatCSS', css);
        },
        setChatScale() {
            var message = Math.round(14 * defaultSettings.chatScale);
            var toastContainer = Math.round(280 * defaultSettings.chatScale);
            var messageBox = Math.round(350 * defaultSettings.chatScale);
            var chatBox = Math.round(300 * defaultSettings.chatScale);
            var userList = Math.floor(14 * defaultSettings.chatScale);
            $('#message-box, #messages, #toast-container, #chat-box').css('font-size', message + 'px');
            $('#messages, #toast-container, #chat-box').width(toastContainer);
            $('#message-box').width(messageBox);
            $('#chat-box').height(chatBox);
            $('.user-list').css('padding-left', userList + 'px');
            var css = '#toast-container{width:' + toastContainer + 'px;font-size:' + message + 'px}';
            this.addCustomCSS('chatScaleCSS', css);
        },
        setMiniMap() {
            this.setMiniMapFont();
            this.setMiniMapWidth();
            this.setMiniMapSectorsOpacity();
        },
        switchOnlineStatus() {
            if (defaultmapsettings.onlineStatus == true) {
                window.changeOnline(1);
            } else {
                window.changeOnline(0);
            }
        },
        setMiniMapFont() {
            this.setFont('miniMapFont', defaultSettings.miniMapFont);
            if (application) {
                application.resetMiniMapSectors();
            }
        },
        setMiniMapWidth() {
            var t = defaultSettings.miniMapWidth / 200;
            defaultSettings.miniMapTop = Math.round(20 * t);
            $('#minimap-hud').css({
                'width': defaultSettings.miniMapWidth,
                'height': defaultSettings.miniMapWidth + defaultSettings.miniMapTop
            });
            if (application) {
                application.resetMiniMapSectors();
            }
        },
        setMiniMapSectorsColor() {
            if (application) {
                application.resetMiniMapSectors();
            }
        },
        setMiniMapSectorsOpacity() {
            $('#minimap-sectors').css('opacity', defaultSettings.miniMapSectorsOpacity);
        },
        setTheme() {
            this.setFonts();
            this.setBgColor();
            this.setCustomBackground();
            this.setCustomCursor();
            this.setMenu();
            this.setHud();
            this.setChat();
            this.setMiniMap();
        },
        setChatPosition() {
            if (defaultSettings.chatPos) {
                toastr.remove();
                toastr.options.positionClass = chatPositions[defaultSettings.chatPos].positionClass;
            }
        },
        init() {
            this.loadThemeSettings();
        }
    }

    //window.legendmod4 = languagetexts;
    window.legendmod5 = defaultmapsettings;

    var application = window.application = {
        name: 'LM express',
        version: 'v1',
        privateMode: false,
        protocolMode: true,
        publicIP: 'wss://wss.ogario.eu:3443',
        privateIP: null,
        updateInterval: 1000,
        updateTick: 0,
        updateMaxTick: 2,
        currentSector: '',
        miniMap: null,
        miniMapCtx: null,
        miniMapSectors: null,
        pi2: 2 * Math.PI,
        socket: null,
        cells: {},
        teamPlayers: [],
        parties: [],
        chatHistory: [],
        commandHistory: [],
        chatUsers: {},
        chatMutedUsers: {},
        chatMutedUserIDs: [],
        customSkinsCache: {},
        customSkinsMap: {},
        cacheQueue: [],
        cacheQueue2: [],
        cacheQueue3: [],
        cacheQueue4: [],
        cacheQueueSkinAnimated: [],
        deathLocations: [],
        playerID: null,
        playerMass: 0,
        selectedProfile: 0,
        selectedOldProfile: 0,
        lastDeath: 0,
        skipServerData: false,
        gameMode: ':ffa',
        region: '',
        partyToken: '',
        ws: '',
        serverIP: '',
        serverArena: '',
        tokenNeedToBtoa: false,
        serverToken: '',
        lastSentNick: '',
        lastSentClanTag: null,
        lastSentSkinURL: '',
        lastSentCustomColor: '',
        lastSentPartyToken: '',
        lastSentServerToken: '',
        lastMessageSentTime: Date.now(),
        rFps: 0,
        renderedFrames: 0,
        fpsLastRequest: null,
        statsHUD: null,
        leaderboardPositionsHUD: null,
        leaderboardDataHUD: null,
        activeParties: null,
        top5pos: null,
        top5totalMass: null,
        top5totalPlayers: null,
        top5limit: 5,
        timeHUD: null,
        questHUD: null,
        retryResp: 0,
        minimapText: '',
        canvasScale: 1,
        selectBiggestCell: true,
        noColors: false,
        skipStats: false,
        showQuest: false,
        showSplitInd: false,
        pause: false,
        spectatorFollow: false,
        targetID: 0,
        targetStatus: 0,
        targetNick: '',
        targetSkinURL: '',
        targeting: false,
        privateMiniMap: false,
        messageSound: null,
        commandSound: null,
        virusSound: null,
        virusSoundurl: null,
        FacebookIDs: null,
        feedInterval: null,
        blacklist: ['Senpa', 'Admin', 'xAzz', 'obobemnai'],
        brokenSkins: {
            'https://raw.githubusercontent.com/Yahnych/vanilla_skins/master/agar/Guitarist.png': 1,
            'https://raw.githubusercontent.com/Yahnych/vanilla_skins/master/agar/Dancer.png': 1
        },
        boostsInfo: {
            "mass_boost_3x_24h": {
                price: 990,
                name: "Mass 3X/24H"
            },
            "mass_boost_3x_1h": {
                price: 490,
                name: "Mass 3X/1H"
            },
            "mass_boost_2x_24h": {
                price: 790,
                name: "Mass 2X/24H"
            },
            "mass_boost_2x_1h": {
                price: 290,
                name: "Mass 2X/1H"
            },
            "xp_boost_3x_24h": {
                price: 990,
                name: "XP 3X/24H"
            },
            "xp_boost_3x_1h": {
                price: 490,
                name: "XP 3X/1H"
            },
            "xp_boost_2x_24h": {
                price: 790,
                name: "XP 2X/24H"
            },
            "xp_boost_2x_1h": {
                price: 290,
                name: "XP 2X/1H"
            }
        },
        replayData: [],
        replays: {
            r: []
        },
        replayMode: false,
        getPlayerX() {

            return ogario.playerX + ogario.mapOffsetX;
        },
        getPlayerY() {

            return ogario.playerY + ogario.mapOffsetY;
        },
        getMass() {

            return legendmod.playerMass
        },
        //for SPECT
        getghostX() {
            if (legendmod.playerPosition == 1 || legendmod.ghostCells.length == 0) { //Yahnych координати призраков или игрока если он топ1
                this.ghostX = legendmod.playerX + legendmod.mapOffsetX;
            } else { //Yahnych
                this.ghostX = legendmod.ghostCells[0].x + legendmod.mapOffsetX;
            }
            return this.ghostX;
        },
        getghostY() {
            if (legendmod.playerPosition == 1 || legendmod.ghostCells.length == 0) { //Yahnych координати призраков или игрока если он топ1
                this.ghostY = legendmod.playerY + legendmod.mapOffsetY;
            } else { //Yahnych
                this.ghostY = legendmod.ghostCells[0].y + legendmod.mapOffsetY;
            }
            return this.ghostY;
        },
        //
        feed() {
            if (window.core && window.core.eject) {
                window.core.eject();
            }
        },
        macroFeedPerm(on) {
            if (on) {
                if (this.feedIntervalPerm){ 
					clearInterval(this.feedIntervalPerm);
					this.feedIntervalPerm = null					
					return;
				}
                var app = this;
                this.feed();
                this.feedIntervalPerm = setInterval(function() {
                    app.feed();
                }, defaultmapsettings.macroFeeding);
            } 
        },		
        macroFeed(on) {
            if (on) {
                if (this.feedInterval) return;
                var app = this;
                this.feed();
                this.feedInterval = setInterval(function() {
                    app.feed();
                }, defaultmapsettings.macroFeeding);
            } else if (this.feedInterval) {
                clearInterval(this.feedInterval);
                this.feedInterval = null
            };
        },
        dance(on) {
            if (on) {
                LM.dance = true;
            } else {
                LM.dance = false;
            }
        },

        Botsplit() {
            if (window.core && window.core.Botsplit) window.core.Botsplit();
        },
        Botseject() {
            if (window.core && window.core.Botseject) window.core.Botseject();
        },
        doubleBotSplit() {
            var app = this;
            app.Botsplit();
            setTimeout(function() {
                app.Botsplit();
            }, 40);
        },
        popBotSplit() {
            var app = this;
            app.Botsplit();
            setTimeout(function() {
                app.Botsplit();
            }, 200);
        },
        splitBot16() {
            var app = this;
            app.Botsplit();
            setTimeout(function() {
                app.Botsplit();
            }, 40);
            setTimeout(function() {
                app.Botsplit();
            }, 80);
            setTimeout(function() {
                app.Botsplit();
            }, 120);
        },
        split() {
            if (window.core && window.core.split) window.core.split();
        },
        doubleSplit() {
            var app = this;
            app.split();
            setTimeout(function() {
                app.split();
            }, 40);
        },
        crazyDoubleSplit() {
            var app = this;
            window.lockPosition = true
            app.split();
            setTimeout(function() {
                app.split();
                window.lockPosition = false
            }, 40);
        },
        popSplit() {
            var app = this;
            app.split();
            setTimeout(function() {
                app.split();
            }, 200);
        },
        tripleSplit() {
            var app = this;
            //window.lockPosition = true
            app.split();
            setTimeout(function() {
                app.split();
            }, 40);
            setTimeout(function() {
                app.split();
                //window.lockPosition = false
            }, 80);
        },
        split16() {
            var app = this;
            app.split();
            setTimeout(function() {
                app.split();
            }, 40);
            setTimeout(function() {
                app.split();
            }, 80);
            setTimeout(function() {
                app.split();
            }, 120);
        },
        toggleSkins() {
            if (ogario.vanillaSkins && ogario.customSkins) {
                ogario.vanillaSkins = false;
            } else if (!ogario.vannillaSkins && ogario.customSkins) {
                ogario.vanillaSkins = true;
                ogario.customSkins = false;
            } else {
                ogario.vanillaSkins = true;
                ogario.customSkins = true;
            }
        },
        toggleCells() {
            this.selectBiggestCell = !this.selectBiggestCell;
            ogario.selectBiggestCell = this.selectBiggestCell;
        },
        setShowTop5() {
            defaultmapsettings.showTop5 = !defaultmapsettings.showTop5;
            this.setTop5();
        },
        setTop5() {
            if (defaultmapsettings.showTop5) {
                $('#top5-hud').show()
            } else {
                $('#top5-hud').hide();
            }
        },
        setShowTargeting() {
            defaultmapsettings.showTargeting = !defaultmapsettings.showTargeting;
            this.setTargetingHUD();
        },
        setTargetingHUD() {
            if (defaultmapsettings.showTargeting) {
                $('#target-hud, #target-panel-hud').show();
            } else {
                $('#target-hud, #target-panel-hud').hide();
            }
        },
        setShowTime() {
            defaultmapsettings.showTime = !defaultmapsettings.showTime;
            if (defaultmapsettings.showTime) {
                $('#time-hud').show();
                this.displayTime()
            } else {
                $('#time-hud').hide();
            }
        },
        setShowSplitRange() {
            defaultmapsettings.splitRange = !defaultmapsettings.splitRange;
            ogario.splitRange = defaultmapsettings.splitRange;
        },
        setShowGhostCellsInfo() {
            if (defaultmapsettings.showGhostCells == false || defaultmapsettings.showGhostCellsInfo == false) {
                defaultmapsettings.showGhostCellsInfo = true;
                defaultmapsettings.showGhostCells = true;
            } else {
                defaultmapsettings.showGhostCellsInfo = false;
                defaultmapsettings.showGhostCells = false;
            }

        },
        setAutoPlay() {
            if (legendmod.pause) {
                application && application.setPause()
            };
            if (window.autoPlay == false) {
                window.autoPlay = true;
                $('#pause-hud').text("AI (Striker & Jimboy3100) SkyNet v0.06");
                $('#pause-hud').show();
            } else {
                window.autoPlay = false;
                $('#pause-hud').text(textLanguage.pause);
                $('#pause-hud').hide();
            }
        },
        setShowSplitInd() {
            this.showSplitInd = !this.showSplitInd;
            defaultmapsettings.splitRange = this.showSplitInd;
            defaultmapsettings.oppRings = this.showSplitInd;
            ogario.splitRange = defaultmapsettings.splitRange;
            ogario.oppRings = defaultmapsettings.oppRings;
        },
        setShowTeammatesInd() {
            defaultmapsettings.teammatesInd = !defaultmapsettings.teammatesInd;
        },
        setShowOppColors() {
            defaultmapsettings.oppColors = !defaultmapsettings.oppColors;
            ogario.oppColors = defaultmapsettings.oppColors;
        },
        setShowSkins() {
            this.noSkins = !this.noSkins;
            if (window.core && window.core.setSkins) {
                window.core.setSkins(!this.noSkins)
            }
            ogario.showCustomSkins = !this.noSkins;
            this.displayChatInfo(!this.noSkins, 'showSkinsMsg');
        },
        setTransparentSkins() {
            defaultmapsettings.transparentSkins = !defaultmapsettings.transparentSkins;
            ogario.transparentSkins = defaultmapsettings.transparentSkins;
        },
        setShowStats() {
            $('#stats-hud').toggle();
        },
        setShowFood() {
            ogario.showFood = !ogario.showFood;
        },
        setShowHUD() {
            $('#overlays-hud').toggle();
        },
        setShowGrid() {
            defaultmapsettings.showGrid = !defaultmapsettings.showGrid;
        },
        setShowMiniMapGuides() {
            defaultmapsettings.showMiniMapGuides = !defaultmapsettings.showMiniMapGuides;
        },
        setShowLb() {
            if (this.gameMode === ':teams') {
                return;
            }
            $('#leaderboard-hud').toggle();
        },
        setShowBgSectors() {
            defaultmapsettings.showBgSectors = !defaultmapsettings.showBgSectors;
        },
        setHideSmallBots() {
            ogario.hideSmallBots = !ogario.hideSmallBots;
            this.displayChatInfo(!ogario.hideSmallBots, 'hideSmallBotsMsg');
        },
        setShowNames() {
            defaultmapsettings.noNames = !defaultmapsettings.noNames;
        },
        setHideTeammatesNames() {
            defaultmapsettings.hideTeammatesNames = !defaultmapsettings.hideTeammatesNames;
        },
        setShowMass() {
            defaultmapsettings.showMass = !defaultmapsettings.showMass;
        },
        setShowMiniMap() {
            defaultmapsettings.showMiniMap = !defaultmapsettings.showMiniMap;
            this.setMiniMap();
        },
        setMiniMap() {
            if (defaultmapsettings.showMiniMap) {
                $('#minimap-hud').show()
            } else {
                $('#minimap-hud').hide();
            }
        },
        setShowQuest() {
            if (':ffa' === this.gameMode) {
                this.showQuest = !this.showQuest;
                this.setQuest();
            }
        },
        setShowFullSpectator() {
            if (window.fullSpectator) {
                window.fullSpectator = false;
                LM.flushSpecsData();
            } else if (!window.fullSpectator) {
                window.fullSpectator = true;
                LM.addSpect();
            }
        },
        setShowIngameSpectator() {
            if (window.ingameSpectator) {
                window.ingameSpectator = false;
                LM.flushSpecsData();
            } else if (!window.fullSpectator) {
                window.ingameSpectator = true;
                LM.addSpect();
            }
        },
        setQuest() {
            if (this.showQuest && ':ffa' === this.gameMode) {
                $('#quest-hud').show();
            } else {
                $('#quest-hud').hide();
            }
        },
        toggleAutoZoom() {
            ogario.autoZoom = !ogario.autoZoom;
            this.displayChatInfo(ogario.autoZoom, 'autoZoomMsg');
        },
        resetZoom(on) {
            if (on) {
                ogario.zoomResetValue = 1;
                ogario.zoomValue = 1;
            } else {
                ogario.zoomResetValue = 0;
            }
        },
        setZoom(value) {
            ogario.zoomValue = value;
        },
        toggleDeath() {
            this.lastDeath--;
            if (this.lastDeath < 0) {
                this.lastDeath = this.deathLocations.length - 1;
            }
        },
        tryResp() {
            if (ogario.play || this.retryResp == 20) {
                this.retryResp = 0;
                return;
            }
            this.retryResp++;
            const app = this;
            setTimeout(() => {
                if ($('.btn-play-guest').is(':visible')) {
                    $('.btn-play-guest').click();
                } else {
                    $('.btn-play').click();
                }
                if (!ogario.play) {
                    app.tryResp();
                }
            }, 500);
        },
        quickResp() {
            if (defaultmapsettings.quickResp) {
                this.hideMenu();
                this.gameServerConnect(this.ws);
                ogario.play = false;
                this.tryResp();
            }
        },
        autoResp() {
            if (!defaultmapsettings.autoResp) {
                return;
            }
            this.setAutoResp();
            $('#overlays').stop().hide();
            if ($('.btn-play-guest').is(':visible')) {
                $('.btn-play-guest').click();
                return;
            }
            $('.btn-play').click();
        },
        setAutoResp() {
            if (defaultmapsettings.autoResp) {
                if (!$('#skipStats').prop('checked')) {
                    $('#skipStats').click();
                    this.skipStats = true;
                }
            }
        },
        toggleAutoResp() {
            defaultmapsettings.autoResp = !defaultmapsettings.autoResp;
            this.setAutoResp();
            this.displayChatInfo(defaultmapsettings.autoResp, 'autoRespMsg');
        },
        copyLb() {
            var input = $('<input>');
            $('body').append(input);
            input.val($('#leaderboard-positions').text()).select();
            try {
                document.execCommand('copy');
            } catch (ogarcopierlbcather) {}
            input.remove();
        },
        changeSpectatorMode() {
            this.spectatorFollow = !this.spectatorFollow;
            ogario.spectatorFollow = this.spectatorFollow;
            if (this.spectatorFollow && spects.length > 0 && spects[0].staticX == null && spects[0].isSpectateEnabled == true /*&& spects[0].isFreeSpectateEnabled==false*/ ) {
                spects[0].sendFreeSpectate();
            } else {
                void(0);
            }
        },
        setPause() {
            if (window.autoPlay) {
                if (application) application.setAutoPlay()
            };
            this.pause = !this.pause;
            ogario.pause = this.pause;
            if (this.pause) {
                ogario.resetTargetPosition();
                $('#pause-hud').show();
            } else {
                $('#pause-hud').hide();
            }
        },
        multiboxswap() {
            this.hideMenu()
            if (!spects.length) {
                //if (!legendmod.multiBoxPlayerExists){					
                addBox()
            } else if (!window.multiboxPlayerEnabledSaved) {
                if (!legendmod.play) {
                    play()
                }
                window.multiboxPlayerEnabledSaved = window.multiboxPlayerEnabled
                window.multiboxPlayerEnabled = null
            } else {
                window.multiboxPlayerEnabled = window.multiboxPlayerEnabledSaved
                window.multiboxPlayerEnabledSaved = null
            }
            if (spects.length && !legendmod.multiBoxPlayerExists) {
                window.fullSpectator = false
                LM.flushSpecsData()
                addBox()
                //toastr.warning("<b>[" + Premadeletter123 + "]:</b> " + "Multibox cannot start because Spectators have been enabled");
            } else if (spects.length && !window.multiboxPlayerEnabledSaved && !window.multiboxPlayerEnabled) { //handle error
                LM.flushSpecsData()
                addBox()
            }

        },
        multiboxFollowMouse() {
            if (!window.multiboxFollowMouse) {
                window.multiboxFollowMouse = true
            } else {
                window.multiboxFollowMouse = null
            }
        },
        setCenteredLb() {
            if (defaultmapsettings.centeredLb) {
                $('#leaderboard-hud').addClass('hud-text-center');
            } else {
                $('#leaderboard-hud').removeClass('hud-text-center');
            }
        },
        setVanillaSkins() {
            if (defaultmapsettings.vanillaSkins) {
                //defaultmapsettings.animateSkinsStart = setInterval(animateSkincheck, window.preSetanimateSkincheck);
                setTimeout(function() {
                    animateSkincheck()
                }, window.preSetanimateSkincheck);
            } else {
                application.flushSkinsMap();
                //animateSkinsStop();
                window.preSetanimateSkincheck = 6000;
            }
        },
        setUniversalChat() {
            if (defaultmapsettings.universalChat && $("#ao2t-hud").length && legendmod && legendmod.ws && legendmod.integrity) {
                $("#ao2t-hud").show();
            } else {
                $("#ao2t-hud").hide();
            }
        },
        setAnimatedRainbowColor() {
            if (defaultmapsettings.animatedRainbowColor && tcm2 && tcm2.f && typeof tcm2.f.override === 'function') {
                tcm2.f.override();
            } else {
                //toastr.info("Changes will fully be reflected after restart");
            }
        },
        //setNormalLb() {
        //defaultmapsettings.normalLb ? $('#leaderboard-hud h5').html(textLanguage.leaderboard) : $('#leaderboard-hud h5').html('legendmod');
        //},
        setFpsAtTop() {
            //defaultmapsettings.fpsAtTop ? $('#stats-hud').removeClass('hud-bottom').addClass('hud-top') : $('#stats-hud').removeClass('hud-top').addClass('hud-bottom');
            if (defaultmapsettings.fpsAtTop) {
                $('#stats-hud').removeClass('hud-bottom').addClass('hud-top');
            } else {
                $('#stats-hud').removeClass('hud-top').addClass('hud-bottom');
            }
        },
        setTweenMaxEffect() {
            if (defaultmapsettings.tweenMaxEffect) initTilt()
            //defaultmapsettings.tweenMaxEffect ? initTilt() : console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Restart needed...');
        },
        displayPartyBots() {
            setTimeout(function() {
                //if (defaultmapsettings.showPartyBots) {                   
                $(".quick.quick-bots.ogicon-trophy").show();
                /*} else {
                    $(".quick.quick-bots.ogicon-trophy").hide();
                }*/
            }, 50);
        },
        setBlockPopups() {
            if (this.protocolMode) {
                $('#block-warn').hide();
                return;
            }
            if (defaultmapsettings.blockPopups) {
                this.blockPopups();
            } else {
                this.unblockPopups();
            }
        },
        blockPopups() {
            $('#openfl-content, #openfl-overlay').hide();
            $('#openfl-content, #openfl-overlay').addClass('block-popups');
            $('#freeCoins, #gifting, #openShopBtn, #dailyQuests').prop('disabled', true);
            $('#block-warn').show();
        },
        unblockPopups() {
            $('#openfl-overlay.disabler').click();
            $('#openfl-content, #openfl-overlay').hide();
            $('#openfl-content, #openfl-overlay').removeClass('block-popups');
            $('#freeCoins, #gifting, #openShopBtn, #dailyQuests').prop('disabled', false);
            $('#block-warn').hide();
        },
        tempUnblockPopups() {
            if (defaultmapsettings.blockPopups) {
                this.unblockPopups();
            }
        },
        displayLeaderboard(position, data = '') {
            if (!this.leaderboardPositionsHUD) {
                return;
            }
            this.leaderboardPositionsHUD.innerHTML = position;
            this.leaderboardDataHUD.innerHTML = data;
        },
        displayStats() {
            if (defaultmapsettings.showStats) {
                var t = '';
                if (window.multiboxPlayerEnabled && spects[window.multiboxPlayerEnabled - 1]) {
                    if (defaultmapsettings.showStatsMass && spects[window.multiboxPlayerEnabled - 1].playerMass) {
                        //t += textLanguage.mass + ': ' + i.playerMass + ' | '
                        t += Languageletter49 + ': ' + spects[window.multiboxPlayerEnabled - 1].playerMass + ' | '
                    }
                    if (spects[window.multiboxPlayerEnabled - 1].playerScore) {
                        //t += textLanguage.score + ': ' + i.playerScore
                        t += Languageletter366 + ': ' + spects[window.multiboxPlayerEnabled - 1].playerScore
                    }
                    if (defaultmapsettings.showStatsN16 && spects[window.multiboxPlayerEnabled - 1].playerSplitCells) {
                        t += ' | ' + spects[window.multiboxPlayerEnabled - 1].playerSplitCells + '/16'
                    }
                    if (defaultmapsettings.showStatsESTE && spects[window.multiboxPlayerEnabled - 1].BSTE) {
                        t += ' | ◎◎➛◉: ' + spects[window.multiboxPlayerEnabled - 1].BSTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsEMTE && spects[window.multiboxPlayerEnabled - 1].BMTE) {
                        t += ' | ◎➛◉: ' + spects[window.multiboxPlayerEnabled - 1].BMTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsMTE && spects[window.multiboxPlayerEnabled - 1].MTE) {
                        t += ' | ◉➛◎: ' + spects[window.multiboxPlayerEnabled - 1].MTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsSTE && spects[window.multiboxPlayerEnabled - 1].STE) {
                        t += ' | ◉◉➛◎: ' + spects[window.multiboxPlayerEnabled - 1].STE //Sonia6
                    }
                    if (defaultmapsettings.showStatsTTE && spects[window.multiboxPlayerEnabled - 1].TTE) {
                        t += ' | ◉➚◉: ' + spects[window.multiboxPlayerEnabled - 1].TTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsPTE && spects[window.multiboxPlayerEnabled - 1].PTE) {
                        t += ' | ➚◎➘: ' + spects[window.multiboxPlayerEnabled - 1].PTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsFPS) {
                        t += ' | '
                    }
                } else if (ogario.play) {
                    if (defaultmapsettings.showStatsMass && ogario.playerMass) {
                        //t += textLanguage.mass + ': ' + i.playerMass + ' | '
                        t += Languageletter49 + ': ' + ogario.playerMass + ' | '
                    }
                    if (ogario.playerScore) {
                        //t += textLanguage.score + ': ' + i.playerScore
                        t += Languageletter366 + ': ' + ogario.playerScore
                    }
                    if (defaultmapsettings.showStatsN16 && ogario.playerSplitCells) {
                        t += ' | ' + ogario.playerSplitCells + '/16'
                    }
                    if (defaultmapsettings.showStatsESTE && ogario.BSTE) {
                        t += ' | ◎◎➛◉: ' + ogario.BSTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsEMTE && ogario.BMTE) {
                        t += ' | ◎➛◉: ' + ogario.BMTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsMTE && ogario.MTE) {
                        t += ' | ◉➛◎: ' + ogario.MTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsSTE && ogario.STE) {
                        t += ' | ◉◉➛◎: ' + ogario.STE //Sonia6
                    }
                    if (defaultmapsettings.showStatsTTE && ogario.TTE) {
                        t += ' | ◉➚◉: ' + ogario.TTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsPTE && ogario.PTE) {
                        t += ' | ➚◎➘: ' + ogario.PTE //Sonia6
                    }
                    if (defaultmapsettings.showStatsFPS) {
                        t += ' | '
                    }
                }
                if (defaultmapsettings.showStatsRender && defaultmapsettings.showStatsFPS) {
                    var color = '';
                    if (drawRender.averageRenderTime > 70) color = 'color:red'
                    else if (drawRender.averageRenderTime > 50) color = 'color:yellow'
                    else if (drawRender.averageRenderTime <= 50) color = 'color:green'
                    t += '💻: <span style=' + color + '>' + drawRender.averageRenderTime + '%</span>'
                    if (defaultmapsettings.showStatsFPS) {
                        t += ' | '
                    }
                }
                if (defaultmapsettings.showStatsFPS) {
                    t += 'FPS: ' + drawRender.fps;

                }
                /*if (defaultmapsettings.showStatsPPS) {
                	if (defaultmapsettings.showStatsFPS || ogario.play ) t += ` | `;
                	var color = ''
                	if(LM.pps<23 || LM.pps>29) color = 'color:#ff4c4c'
                	if(LM.pps<20 || LM.pps>32) color = 'color:red'
                	t += 'PPS: <span style=' + color + '>'+LM.pps+'</span>';
                }	*/
                this.statsHUD.innerHTML = t;
                //this.statsHUD.textContent = t;
                var app = this;
                setTimeout(function() {
                    app.displayStats();
                }, 250);
            } else $('#stats-hud').hide();
        },
        displayTime() {
            if (defaultmapsettings.showTime) {
                var time = new Date().toLocaleString();
                this.timeHUD.textContent = time;
                var app = this;
                setTimeout(function() {
                    app.displayTime();
                }, 1000);
            } else $('#time-hud').hide();
        },
        displayParties() {
            let text = '';
            for (let length = 0; length < this.parties.length; length++) {
                text += '<li><a href=\"https://agar.io/#' + this.parties[e] + '\" onclick=\"$(\'#party-token\').val(\'' + this.parties[e] + '\'); $(\'#join-party-btn-2\').click();\">https://agar.io/#' + this.parties[e] + '</a></li>';
            }
            if (text === '') {
                this.activeParties.className = 'no-parties';
            } else {
                this.activeParties.className = '';
            }
            this.activeParties.innerHTML = text;
        },
        /*
                    displayTop5() {
                        if (defaultmapsettings.showTop5) {
        					//console.log(.top5.length);
        					//console.log(.teamPlayers.length);
                            for (var t = '', e = 0, s = this.top5.length, o = 0; o < s; o++) e += this.top5[o].mass, o >= this['top5limit'] || (t += '<li><span class=\"cell-counter\" style=\"background-color: ' + this.top5[o].color + '\">' + (o + 1) + '</span>', defaultmapsettings.showTargeting && (t += '<a href=\"#\" data-user-id=\"' + this.top5[o].id + '\" class=\"set-target ogicon-target\"></a> '), t += '<span class=\"hud-main-color\">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + ']</span>', t += 					'<span class=\"top5-mass-color\">[' + this.shortMassFormat(this.top5[o].mass) + ']</span> ' + this.escapeHTML(this.top5[o].nick) + '</li>');
                            this['top5pos'].innerHTML = t, i.play && i.playerMass && (e += i.playerMass, s++), this.top5totalMass.textContent= this.shortMassFormat(e), this.top5totalPlayers.textContent= s;
                        }
                    },
                    setTop5limit(t) {
                        t && (this['top5limit'] = t);
                    },

                displayTop5() {
                  if (defaultmapsettings.showTop5) {
                    var pix_color = "";
                    var bufferString = 0;
                    var PL$29 = this.top5.length;
                    var entityType = 0;
                    for (; entityType < PL$29; entityType++) {
                      bufferString = bufferString + this.top5[entityType].mass;
                      if (!(entityType >= defaultmapsettings["limTP"])) {
                        pix_color = pix_color + ('<li id="player"><span id="pos-skin" style="background-color: ' + this.top5[entityType].color + '; width: 30px; height:30px; display: inline-block;"><img style="position: absolute; margin-left: 2px; margin-top: 2px; width: 26px; height:26px; display: inline-block;"  src = ' + (this.top5[entityType]["skin"] ? this.top5[entityType]["skin"] : "https://legendmod.ml/banners/icon32croped.ico.gif") + '" alt=""> ' +
        				'<span class=\"top5-mass-color\">[' + this.shortMassFormat(this.top5[entityType].mass) + ']</span> ' + this.escapeHTML(this.top5[entityType].nick) + '</span><span class=\"hud-main-color\">[' + this.calculateMapSector(this.top5[entityType].x, this.top5[entityType].y) +']</span><span id= "top5mass" class=""> ' +
                        this.shortMassFormat(this.top5[entityType].mass) + '</span></li>');
                      }
                    }
                    this.top5pos.innerHTML = pix_color;
                    if (i["play"] && i.playerMass) {
                      bufferString = bufferString + i.playerMass;
                      PL$29++;
                    }
                    this.top5totalMass.textContent= this.shortMassFormat(bufferString);
                    this.top5totalPlayers.textContent= PL$29;
                  }
                },
        */
        displayTop5() {
            if (defaultmapsettings.top5skins != true) {
                if (defaultmapsettings.showTop5) {
                    //console.log(.top5.length);
                    //console.log(.teamPlayers.length);
                    for (var t = '', e = 0, s = this.top5.length, o = 0; o < s; o++) {
                        e += this.top5[o].mass;
                        if (!(o >= defaultmapsettings.teamboardlimit && this.top5[o].mass > 1)) {
                            t = t + '<li style=\"height: 16px;"\><span>' + (o + 1) + '. </span>';
                            defaultmapsettings.showTargeting && (t += '<a href=\"#\" data-user-id=\"' + this.top5[o].id + '\" class=\"set-target ogicon-target\"></a> ');
                            //
                            this.w = this.top5[o].x;
                            this.u = this.top5[o].y;
                            /*
                            this.w = window.legendmod.vector[window.legendmod.vnr][0] ? legendmod.translateX(this.top5[o].x) : this.top5[o].x;
                            this.u = window.legendmod.vector[window.legendmod.vnr][1] ? legendmod.translateY(this.top5[o].y) : this.top5[o].y;   
                            */
                            //
                            var flag = false;
                            for (var et = 0; et < legendmod.ghostCells.length; et++) {
                                if (legendmod.leaderboard[et] && this.top5[o].nick == legendmod.leaderboard[et].nick) {
                                    if (flag == false && window.predictedGhostCells[et]) {
                                        //
                                        var w = window.predictedGhostCells[et].x;
                                        var u = window.predictedGhostCells[et].y;
                                        /*
                                        w = window.legendmod.vector[window.legendmod.vnr][0] ? legendmod.translateX(window.predictedGhostCells[e].x) : window.predictedGhostCells[e].x;
                                        u = window.legendmod.vector[window.legendmod.vnr][1] ? legendmod.translateY(window.predictedGhostCells[e].y) : window.predictedGhostCells[e].y;  		
                                        */
                                        //									
                                        //t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(window.predictedGhostCells[e].x, window.predictedGhostCells[e].y) + "]</span>");	
                                        t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(w + legendmod.mapOffsetX, u + legendmod.mapOffsetY) + "]</span>");
                                        flag = true;
                                    }
                                }
                            }                            //t += '<span class=\"hud-main-color\">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + ']</span>';
							
                            if (flag == false && (this.top5[o].lbgpi >= 0) || !LM.integrity) {
                                t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + "]</span>");
                            } 
							else if (flag == false && (this.calculateMapSector(this.top5[o].x, this.top5[o].y) == "C3" || legendmod.gameMode == ":party")) {
                                t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + "]</span>");
                            }
                            //temporary socket 3
                            else if (flag == false && this.top5[o].lbgpi == -2) {
                                if (this.top5[o].temp == true) {
                                    t = t + ('<span class="hud-main-color">[' + 'Temp. Socket' + "]</span>");
                                } else {
                                    t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + "]</span>");
                                }
                            }
                            t += '<span class=\"top5-mass-color\">[' + this.shortMassFormat(this.top5[o].mass) + ']</span> ' + this.escapeHTML(this.top5[o].nick) + '</li>';
                        }
                        this.top5pos.innerHTML = t,
                            ogario.play && ogario.playerMass && (e += ogario.playerMass, s++),
                            this.top5totalMass.textContent = this.shortMassFormat(e),
                            this.top5totalPlayers.textContent = s;
                    }
                }
            } 
			else {
                if (defaultmapsettings.showTop5) {
                    //temp
                    var tempTime = new Date().getTime();
                    Object.getOwnPropertyNames(application.teamPlayers).forEach(function(element) {
                        if (application.teamPlayers && application.teamPlayers[element] && application.teamPlayers[element].lbgpi == -2 && application.teamPlayers[element].mass > 1) {
                            //console.log(application.teamPlayers[element].lastUpdatedTime, tempTime);
                            if (application.teamPlayers[element].lastUpdatedTime && ((application.teamPlayers[element].lastUpdatedTime) - tempTime < 6000)) {
                                application.teamPlayers[element].mass = 1;
                                application.teamPlayers[element].alive = false;
                            } else {

                                application.top5.push(application.teamPlayers[element]);
                            }
                        }
                    });
                    //
                    var t = "";
                    var e = 0;
                    var s = this.top5.length;
                    var o = 0;
                    for (; o < s; o++) {
                        e = e + this.top5[o].mass;
                        if (!(o >= defaultmapsettings.teamboardlimit && this.top5[o].mass > 1)) {
                            /*
                                t = t + ('<li><a href="#" id="pos-skin" class= "set-target" data-user-id="' + this.top5[o].id + '"style="background-color: ' + this.top5[o].color + 
								'; width: 30px; height:30px; display: inline-block;"><img style="position: absolute; margin-left: 2px; margin-top: 2px; width: 26px; height:26px; display: inline-block;"  src = ' 
								+ (this.top5[o]["skin"] ? this.top5[o]["skin"] : "https://legendmod.ml/banners/icon32croped.ico.gif") + ' alt=""> ' + '</a><div style="margin-top: -30px; margin-left: 32px;">');*/
                            var teamboardskin = this.customSkinsCache[this.top5[o].skin + "_cached2"];
                            if (teamboardskin == null) {
                                teamboardskin = new Image();
                                teamboardskin.crossOrigin = 'anonymous';
                                teamboardskin.src = "https://legendmod.ml/banners/icon32croped.ico.gif";
                            }
                            t = t + ('<li><a href="#" id="pos-skin" class= "set-target" data-user-id="' + this.top5[o].id + '"style="background-color: ' + this.top5[o].color +
                                '; width: 30px; height:30px; display: inline-block;"><span style="position: absolute; margin-left: 2px; margin-top: 2px; width: 26px; height:26px; display: inline-block;" alt="">' +
                                teamboardskin.outerHTML + '</span>' + '</a><div style="margin-top: -30px; margin-left: 32px;">');
                            // t = t + ('<div><img src=' + teamboardskin.src + 'class="player-skin" style="border: solid 3px' + this.top5[o].color + '">' + '</a><div style="margin-top: -30px; margin-left: 32px;">');

                            /* if (defaultmapsettings["showTargeting"]) {
                              t = t + ('<a href="#" data-user-id="' + this.top5[o].id + '" class="set-target ogicon-target"></a> ');
                            } */
                            var flag = false;
                            for (var et = 0; et < legendmod.ghostCells.length; et++) {
                                if (legendmod.leaderboard[et] && this.top5[o].nick == legendmod.leaderboard[et].nick) {
                                    if (flag == false && window.predictedGhostCells[et]) {
                                        //
                                        var w = window.predictedGhostCells[et].x;
                                        var u = window.predictedGhostCells[et].y;
                                        /*
                                        w = window.legendmod.vector[window.legendmod.vnr][0] ? legendmod.translateX(window.predictedGhostCells[e].x) : window.predictedGhostCells[e].x;
                                        u = window.legendmod.vector[window.legendmod.vnr][1] ? legendmod.translateY(window.predictedGhostCells[e].y) : window.predictedGhostCells[e].y;  		
                                        */
                                        //									
                                        //t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(window.predictedGhostCells[e].x, window.predictedGhostCells[e].y) + "]</span>");	
                                        t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(w + legendmod.mapOffsetX, u + legendmod.mapOffsetY) + "]</span>");
                                        flag = true;
                                    }
                                }
                            }
                            if (flag == false && (this.top5[o].lbgpi >= 0) || !LM.integrity) {
                                t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + "]</span>");
                            } 
							else if (flag == false && (this.calculateMapSector(this.top5[o].x, this.top5[o].y) == "C3" || legendmod.gameMode == ":party")) {
                                t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + "]</span>");
                            }
                            //temporary socket 3
                            else if (flag == false && this.top5[o].lbgpi == -2) {
                                if (this.top5[o].temp == true) {
                                    t = t + ('<span class="hud-main-color">[' + 'Temp. Socket' + "]</span>");
                                } else {
                                    t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + "]</span>");
                                }
                            }
                            //t = t + ('<span class="hud-main-color">[' + this.calculateMapSector(this.top5[o].x, this.top5[o].y) + "]</span>");
                            //external script
                            if (!window.externalScriptMassBar[o]) window.externalScriptMassBar[o] = ""
                            // t = t + ('<span class="top5-mass-color">[' + this.shortMassFormat(this.top5[o].mass) + "]</span> " + this.escapeHTML(this.top5[o].nick) + "</div></li>" + window.externalScriptMassBar[o]);

                            let shortMassFormat = this.shortMassFormat(this.top5[o].mass)
                            let playersNickName = this.escapeHTML(this.top5[o].nick)

                            let totalMass = this.top5.map(top5 => top5.mass).reduce((accumulator, playerMass) => accumulator + playerMass)

                            t += (`<span class="top5-mass-color">
                                        [` + this.shortMassFormat(this.top5[o].mass) + `]
                                        <div style="color: ` + defaultSettings.hudTextColor + `; display: inline-block">` + playersNickName + `</div>
                                        <div class="top5-mass-bar-container">
                                            <div class="top5-mass-bar" style="width: ` + this.top5[o].mass / totalMass * 100 + `%; background-color:` + $('#hudMainColor')[0].value + `"></div>
                                        </div>
                                        </span>
                                    </div>`);
                        }
                    }
                    this.top5pos.innerHTML = t;
                    if (ogario.play && ogario.playerMass) {
                        e = e + ogario.playerMass;
                        s++;
                    }
                    this.top5totalMass.textContent = this.shortMassFormat(e);
                    this.top5totalPlayers.textContent = s;
                }
            }
        },
        /*
                    setTop5limit(t) {
                        t && (this['top5limit'] = t);
                    },
                    setTop5limit(canCreateDiscussions) {
                        if (canCreateDiscussions) {
                            this["top5limit"] = canCreateDiscussions;
                        }
                    }, */

        displayChatHistory(on) {
            if (on) {
                this.clearChatHistory(true);
                for (let length = 0; length < this.chatHistory.length; length++) {
                    $('#messages').append('<li><span class="message-nick">' + this.chatHistory[length].nick + ': </span><span class="message-text">' + this.chatHistory[length].message + '</span></li>');
                }
                return;
            }
            this.clearChatHistory(false);
        },
        clearChatHistory(on) {
            $('#messages').empty();
            if (on) {
                toastr.clear();
                if (defaultmapsettings.showChatBox) {
                    $('#chat-box .message').remove();
                    this.chatHistory.length = 0;
                }
            }
        },
        displayChatInfo(on, info) {
            if (on) {
                toastr.info(textLanguage[info + 'A']);
            } else {
                toastr.error(textLanguage[info + 'B']);
            }
        },
        setDisableChat() {
            defaultmapsettings.hideChat = defaultmapsettings.disableChat;
            this.setHideChat();
        },
        hideChat() {
            defaultmapsettings.hideChat = !defaultmapsettings.hideChat;
            this.setHideChat();
            this.displayChatInfo(!defaultmapsettings.hideChat, 'hideChatMsg');
        },
        setHideChat() {
            if (defaultmapsettings.hideChat) {
                $('#message-box').hide();
            }
            this.setShowChatBox();
        },
        setShowChatBox() {
            if (!defaultmapsettings.hideChat && defaultmapsettings.showChatBox) {
                $('#chat-box').show();
            } else {
                $('#chat-box').hide();
            }
        },
        enterChatMessage() {
            var messageBox = $('#message-box');
            var message = $('#message');
            if (messageBox.is(':visible')) {
                const value = message.val();
                if (value.length) {

                    //
                    //if (LM.ws.includes("imsolo.pro") && $("#clantag").val() == ""){
                    if (!LM.integrity && $("#clantag").val() == "") {
                        var view = application.createView(4 + 2 * value.length);
                        view.setUint8(0, 99);
                        view.setUint8(1, 0);
                        var length = 0
                        for (; length <= value.length + 1; length++) view.setUint16(2 + length, value.charCodeAt(length), true);
                        view.setUint8(length, 0);
                        legendmod.sendMessage(view)
                    }
                    //

                    this.sendChatMessage(101, value);
                    if (ogario.play) {
                        message.blur();
                        messageBox.hide();
                    }
                } else {
                    message.blur();
                    messageBox.hide();
                }
                message.val('');
            } else {
                messageBox.show();
                message.focus();
                message.val('');
            }
        },
        showMenu(value) {
            if (window.MC && window.MC.showNickDialog) {
                $('.ogario-menu').show();
                $('.menu-panel').hide();
                if (!ogario.play && !this.skipStats) {
                    $('#stats').show();
                } else {
                    $('#main-panel').show();
                }
                window.MC.showNickDialog(300);
                if ($('#oferwallContainer').is(':visible')) window.closeOfferwall();
                if ($('#videoContainer').is(':visible')) window.closeVideoContainer();
                return;
            }
            if (value) {
                $('#overlays').fadeIn(value);
            } else {
                $('#overlays').show();
            }
        },
        hideMenu(value) {
            if (window.MC && window.MC.showNickDialog) {
                $('.ogario-menu').hide();
                return;
            }
            if (value) {
                $('#overlays').fadeOut(value);
            } else {
                $('#overlays').hide();
            }
        },
        escapeHTML(string) {
            return String(string).replace(/[&<>"'\/]/g, function(event) {
                return escapeChar[event];
            });
        },
        checkSkinURL(url) {
            //return /^https?:\/\/i\.(?:imgur|hizliresim)\.com\/\w{6,8}\.(?:jpg|jpeg|png)\??\d*$/i .test(t) ? t.replace('http:', 'https:') : '';
            return url.replace('http:', 'https:');
            //return /^https?:\/\/(i|s))\.(?:imgur|hizliresim|put)\.(com|re)\/\w{6,8}\.(?:jpg|jpeg|png)\??\d*$/i .test(t) ? t.replace('http:', 'https:') : '';
        },
        loadSettings() {
            let settings = null;
            if (window.localStorage.getItem('ogarioSettings') !== null) {
                settings = JSON.parse(window.localStorage.getItem('ogarioSettings'));
            }
            for (const option in defaultmapsettings) {
                if (defaultmapsettings.hasOwnProperty(option)) {
                    if (settings && settings.hasOwnProperty(option)) {
                        defaultmapsettings[option] = settings[option];
                    }
                    if (ogario.hasOwnProperty(option)) {
                        ogario[option] = defaultmapsettings[option];
                    }
                }
            }
        },
        saveSettings(option, name) {
            window.localStorage.setItem(name, JSON.stringify(option));
        },
        exportSettings() {
            let options = {
                ogarioCommands: chatCommand,
                ogarioHotkeys: hotkeys,
                ogarioPlayerProfiles: profiles,
                ogarioSettings: defaultmapsettings,
                ogarioThemeSettings: defaultSettings

            };
            for (const option in options) {
                if (options.hasOwnProperty(option)) {
                    const checked = $('#export-' + option).prop('checked');
                    if (!checked) {
                        delete options[option];
                    }
                }
            }
            options = JSON.stringify(options);
            $('#export-settings').val(options);
            $('#import-settings').val('');
            options = null;
        },
        importSettings() {
            $('#import-settings').blur();
            let importValue = $('#import-settings').val();
            if (importValue) {
                importValue = JSON.parse(importValue);
                for (const value in importValue) {
                    if (importValue.hasOwnProperty(value)) {
                        const checked = $('#import-' + value).prop('checked');
                        if (!checked) {
                            continue;
                        }
                        window.localStorage.setItem(value, JSON.stringify(importValue[value]));
                    }
                }
                window.location.reload();
            }
        },
        restoreSettings() {
            if (window.localStorage.getItem('ogarioSettings') !== null) {
                window.localStorage.removeItem('ogarioSettings');
                window.location.reload();
            }
        },
        setSettings(id, checked) {
            if (defaultmapsettings.hasOwnProperty(id) && null !== checked) {
                //switch (defaultmapsettings[id] = checked, ogario.hasOwnProperty(id) && (ogario[id] = checked), id) {
                defaultmapsettings[id] = checked;
                if (ogario.hasOwnProperty(id)) {
                    ogario[id] = checked;
                }
                switch (id) {
                    case 'autoResp':
                        this.setAutoResp();
                        break;
                    case 'showMiniMap':
                        this.setMiniMap();
                        break;
                    case 'showMiniMapGrid':
                        this.resetMiniMapSectors();
                        break;
                    case 'disableChat':
                        this.setDisableChat();
                        break;
                    case 'chatSounds':
                        this.setChatSoundsBtn();
                        break;
                    case 'showChatBox':
                        this.setShowChatBox();
                        break;
                    case 'showTop5':
                        this.setTop5();
                        break;
                    case 'showTargeting':
                        this.setTargetingHUD();
                        break;
                    case 'showTime':
                        this.displayTime();
                        $('#time-hud').show();
                        break;
                    case 'centeredLb':
                        this.setCenteredLb();
                        break;
                    case 'vanillaSkins':
                        this.setVanillaSkins();
                        break;
                    case 'universalChat':
                        this.setUniversalChat();
                        break;
                    case 'animatedRainbowColor':
                        this.setAnimatedRainbowColor();
                        break;
                        //case 'normalLb':
                        //this.setNormalLb();
                        //break;
                    case 'fpsAtTop':
                        this.setFpsAtTop();
                        break;
                    case 'tweenMaxEffect':
                        this.setTweenMaxEffect();
                        break;
                        /*case 'showPartyBots':
                            this.displayPartyBots();
                            break;*/
                    case 'showStats':
                        this.displayStats();
                        $('#stats-hud').show();
                        break;
                    case 'blockPopups':
                        this.setBlockPopups();
                        break;
                }
                this.saveSettings(defaultmapsettings, 'ogarioSettings');
            }
        },
        profiling() {
            if (defaultmapsettings.profileNumber < 15) {
                $('#skins-panel').css("width", "190px");
            } else if (defaultmapsettings.profileNumber < 20) {
                $('#skins-panel').css("width", "280px");
            } else if (defaultmapsettings.profileNumber < 30) {
                $('#skins-panel').css("width", "370px");
            } else if (defaultmapsettings.profileNumber < 35) {
                $('#skins-panel').css("width", "460px");
            } else if (defaultmapsettings.profileNumber < 55) {
                $('#skins-panel').css("width", "550px");
            }
            ogarhusettings();
            //ogarhusettingsImportExportMobile();
        },
        loadProfiles() {
            if (null !== window.localStorage.getItem('ogarioPlayerProfiles')) {
                profiles = JSON.parse(window.localStorage.getItem('ogarioPlayerProfiles'))
                if (profiles.length < defaultmapsettings.profileNumber) { //fix for old players
                    //for (var t = 10; t < 15; t++) profiles.push({
                    for (var t = profiles.length; t < defaultmapsettings.profileNumber; t++) {
                        profiles.push({
                            'nick': 'Profile #' + (t + 1),
                            'clanTag': '',
                            'skinURL': '',
                            'color': defaultSettings.mainColor
                        });
                    }
                } else if (profiles.length > defaultmapsettings.profileNumber) {
                    //for (var t = 10; t < 15; t++) profiles.push({
                    var temp = profiles.length; //case profiles.length changes
                    for (var t = 0; t < temp - defaultmapsettings.profileNumber; t++) {
                        console.log(t);
                        profiles.pop();
                    }

                }
            } else {
                //for (var t = 0; t < 15; t++) profiles.push({
                for (var t = 0; t < defaultmapsettings.profileNumber; t++) {
                    profiles.push({
                        'nick': 'Profile #' + (t + 1),
                        'clanTag': '',
                        'skinURL': '',
                        'color': defaultSettings.mainColor
                    });
                }
            }
            application.saveSettings(profiles, 'ogarioPlayerProfiles');
            setTimeout(function() {
                application.profiling();

            }, 200)
            if (null !== window.localStorage.getItem('ogarioSelectedProfile')) {
                this.selectedProfile = JSON.parse(window.localStorage.getItem('ogarioSelectedProfile'));
            }
            if (null !== window.localStorage.getItem('ogarioSelectedOldProfile')) {
                this.selectedOldProfile = JSON.parse(window.localStorage.getItem('ogarioSelectedOldProfile'));
            }
            if (profiles[this.selectedProfile]) {
                ogarcopythelb.nick = profiles[this.selectedProfile].nick;
                //changed
                ogarcopythelb.clanTag = profiles[this.selectedProfile].clanTag;
                //ogarcopythelb.clanTag = profiles[this.selectedProfile].clanTag + "@";
                ogarcopythelb.skinURL = profiles[this.selectedProfile].skinURL;
                ogarcopythelb.color = profiles[this.selectedProfile].color;
            }
        },
        changeSkinPreview(e, t) {
            //console.log(e,t);
            if (!t || !e) {
                return;
            }
            if ("skin-preview" === t) { //or if ("skin-preview" === e)
                //console.log(e,e.src);

                if (e.src.includes(".mp4") || e.src.includes(".webm") || e.src.includes(".ogg")) { //console.log("stage 3a videos");
                    $("#skin-preview").children().remove();
                    $("#skin-preview").removeClass("default");
                    $("#skin-preview").append('<a href="#" id="skin-popover" data-toggle="popover" title="" data-html="true" data-content="<video src=\'' + e.src + "' width='350'>\"></a>");
                    $("#skin-popover").append('<video id="videoskinpreview" src=\'' + e.src + "' width='350' controls>\"></video>");
                    //						$("#skin-popover").popover();

                    //$("#skin-preview").append('<a href="#" id="skin-popover" data-toggle="popover" title="" data-html="true" data-content="<video src=\'' + t.src + "' width='500'>\"></a>");
                } else {
                    //console.log("default settings for images on changeSkinPreview")
                    $("#skin-preview").removeClass("default");
                    $("#skin-preview").append('<a href="#" id="skin-popover" data-toggle="popover" title="" data-html="true" data-content="<img src=\'' + e.src + "' width='500'>\"></a>");
                }
                $("#skin-popover").append($(e).fadeIn(1000));
                $("#skin-popover").popover();
            } else {
                if (e.src.includes(".mp4") || e.src.includes(".webm") || e.src.includes(".ogg")) { //console.log("stage 3b videos");
                    $("#" + t).removeClass("default");
                    $("#" + t).append($(e).fadeIn(1000));

                } else {
                    $("#" + t).removeClass("default");
                    $("#" + t).append($(e).fadeIn(1000));
                }
            }

        },
        setSkinPreview(t, e) {
            if (t.includes && (t.includes(".mp4") || t.includes(".webm") || t.includes(".ogg"))) {
                //if (t.includes(".mp4") || t.includes(".webm") || t.includes(".ogg")) {
                //console.log("stage 1 videos");

                if ($('#' + e).empty().addClass('default'), t && 0 != t.length) {
                    //console.log("stage 1 images/videos: " + t);
                    var app = this;
                    o = new Video();
                    o.crossOrigin = 'anonymous';
                    o.src = t;
                    // o = new Image();

                    //o.style.borderRadius = "25px";
                    setTimeout(function() {
                        //newo.onload = function() {
                        app.changeSkinPreview(o, e);
                        checkVideos3(o);
                        //};
                    }, 500);

                }
            } else {
                checktypeImgVid = new Image();

                //console.log("stage 1 images");

                if ($('#' + e).empty().addClass('default'), t && 0 != t.length) {
                    //console.log("stage 1 images/videos: " + t);
                    var app = this,
                        o = checktypeImgVid;
                    o.crossOrigin = 'anonymous',
                        o.src = t;
                    // o = new Image();

                    o.onload = function() {
                        app.changeSkinPreview(o, e);
                    };
                }
            }
        },
        setProfile() {
            var t = (profiles.length + this.selectedProfile - 1) % profiles.length,
                e = (this.selectedProfile + 1) % profiles.length;
            //console.log(profiles.length);

            this.setSkinPreview(profiles[t].skinURL, 'prev-profile');
            if (profiles[this.selectedProfile]) {
                this.setSkinPreview(profiles[this.selectedProfile].skinURL, 'skin-preview');
            }
            this.setSkinPreview(profiles[e].skinURL, 'next-profile');

            this.saveSettings(this.selectedProfile, 'ogarioSelectedProfile');
            this.saveSettings(this.selectedOldProfile, 'ogarioSelectedOldProfile');
            if (profiles[this.selectedProfile]) {
                $('#nick').val(profiles[this.selectedProfile].nick);
                $('#clantag').val(profiles[this.selectedProfile].clanTag);
                $('#skin').val(profiles[this.selectedProfile].skinURL);
                $('#color').val(profiles[this.selectedProfile].color);
                $('.skin').colorpicker('setValue', profiles[this.selectedProfile].color);
            }

            $('#skins a').removeClass('selected');
            $('#skins a[data-profile=\'' + this.selectedProfile + '\']').addClass('selected');
        },
        eraseProfileboxShadow() {
            for (i = 0; i < profiles.length; i++) {
                $("#profile-" + i).css('box-shadow', '');
            }
        },
        setProfileboxShadow() {
            for (i = 0; i < profiles.length; i++) {
                $("#profile-" + i).css('box-shadow', '');
            }
            $("#profile-" + this.selectedProfile).css('box-shadow', '0px 0px 20px' + profiles[this.selectedProfile].color);
            $("#profile-" + this.selectedOldProfile).css('box-shadow', '0px 0px 20px' + profiles[this.selectedOldProfile].color);
        },
        prevProfile() {
            this.selectedOldProfile = this.selectedProfile;
            this.setPlayerSettings();
            this.selectedProfile = (profiles.length + this.selectedProfile - 1) % profiles.length, this.setProfile();
            if (defaultmapsettings.multiBoxShadow) {
                this.setProfileboxShadow()
            } else {
                this.eraseProfileboxShadow()
            }
        },
        nextProfile() {
            this.selectedOldProfile = this.selectedProfile;
            this.setPlayerSettings();
            this.selectedProfile = (this.selectedProfile + 1) % profiles.length, this.setProfile();
            if (defaultmapsettings.multiBoxShadow) {
                this.setProfileboxShadow()
            } else {
                this.eraseProfileboxShadow()
            }
        },
        selectProfile(value) {
            this.selectedOldProfile = this.selectedProfile;
            this.setPlayerSettings();
            this.selectedProfile = parseInt(value);
            this.setProfile();
            if (defaultmapsettings.multiBoxShadow) {
                this.setProfileboxShadow()
            } else {
                this.eraseProfileboxShadow()
            }
        },
        addOption(id, name, text, checked) {
            $(id).append('<label><input type=\"checkbox\" id=\"' + name + '\" class=\"js-switch\"> ' + text + '</label>');
            $('#' + name).prop('checked', checked);
        },
        addOptions(options, section) {
            if (options) {
                $('#og-options').append('<div class=\"options-box ' + section + '\"><h5 class=\"menu-main-color\">' + textLanguage[section] + '</h5></div>');
                for (var i = 0; i < options.length; i++) {
                    var option = options[i];
                    if (defaultmapsettings.hasOwnProperty(option)) {
                        $('.' + section).append('<label>' + textLanguage[option] + ' <input type=\"checkbox\" class=\"js-switch\" id=\"' + option + '\"></label>');
                        $('#' + option).prop('checked', defaultmapsettings[option]);
                    }
                }
            }
        },
        addInputBox(id, name, holder, callback) {
            $(id).append('<div class=\"input-box\"><span class=\"title-box\">' + textLanguage[name] + '</span><input id=\"' + name + '\" class=\"form-control\" placeholder=\"' + holder + '\" value=\"' + defaultmapsettings[name] + '\" /></div>');
            var app = this;
            $('#' + name).on('input', function() {
                defaultmapsettings[name] = this.value, app[callback](),
                    app.saveSettings(defaultmapsettings, 'ogarioSettings');
            });
        },
        addSliderBox(id, name, min, max, step, callback) {
            $(id).append('<div class=\"slider-box\"><div class=\"box-label\"><span class=\"value-label\">' + textLanguage[name] + ': </span><span id=\"' + name + '-value\" class=\"value\">' + defaultmapsettings[name] + '</span></div><input id=\"' + name + '-slider\" type=\"range\" min=\"' + min + '\" max=\"' + max + '\" step=\"' + step + '\" value=\"' + defaultmapsettings[name] + '\"></div>');
            var app = this;
            callback ? $('#' + name + '-slider').on('input', function() {
                var t = parseFloat($(this).val());
                $('#' + name + '-value').text(t);
                defaultmapsettings[name] = t;
                if (ogario.hasOwnProperty(name)) ogario[name] = t;
                app[callback]();
                app.saveSettings(defaultmapsettings, 'ogarioSettings');
            }) : $('#' + name + '-slider').on('input', function() {
                var t = parseFloat($(this).val());
                $('#' + name + '-value').text(t);
                defaultmapsettings[name] = t;
                if (ogario.hasOwnProperty(name)) ogario[name] = t;
                app.saveSettings(defaultmapsettings, 'ogarioSettings');
            });
        },
        setLang() {
            if (lang !== 'pl') {
                return;
            }
            if (window.i18n_dict && window.i18n_dict.en) {
                for (var lang in window.i18n_dict.en) {
                    if (window.i18n_dict.en.hasOwnProperty(lang) && textLanguage.hasOwnProperty(lang)) {
                        window.i18n_dict.en[lang] = textLanguage[lang];
                    }
                }
            }
        },
        setMenu() {
            const app = this;
            document.title = this.name;
            $("#mainPanel").before('<div id="exp-bar" class="agario-panel"><span class="ogicon-user"></span><div class="agario-exp-bar progress"><span class="progress-bar-text"></span><div class="progress-bar progress-bar-striped" style="width: 0%;"></div></div><div class="progress-bar-star"></div></div><div id="main-menu" class="agario-panel"><ul class="menu-tabs"><li class="start-tab active"><a href="#main-panel" class="active ogicon-home" data-toggle="tab-tooltip" title="' +
                textLanguage.start + '"></a></li><li class="settings-tab"><a href="#og-settings" class="ogicon-cog" data-toggle="tab-tooltip" title="' + textLanguage.settings + '"></a></li><li class="theme-tab"><a href="#theme" class="ogicon-droplet" data-toggle="tab-tooltip" title="' + textLanguage.theme + '"></a></li><li class="hotkeys-tab"><a href="#" class="hotkeys-link ogicon-keyboard" data-toggle="tab-tooltip" title="' +
                textLanguage.hotkeys + '"></a></li><li class="music-tab"><a href="#music" class="ogicon-music" data-toggle="tab-tooltip" title="' + textLanguage.sounds + '"></a></li><li class="profile-tab"><a href="#profile" class="ogicon-user" data-toggle="tab-tooltip" title="' + textLanguage.profile + '"></a></li></ul><div id="main-panel" class="menu-panel"></div><div id="profile" class="menu-panel"></div><div id="og-settings" class="menu-panel"><div class="submenu-panel"></div></div><div id="theme" class="menu-panel"></div><div id="music" class="menu-panel"></div></div>');
            $("#main-panel").append('<a href="#" class="quick quick-menu ogicon-menu"></a><a href="#" class="quick quick-bots ogicon-trophy" style="display: none;"></a>' +
                '<a href="#" class="quick quick-replay ogicon-file-play"></a>' +
                '<a href="#" class="quick quick-skins ogicon-images"></a><div id="profiles"><div id="prev-profile"></div><div id="skin-preview"></div><div id="next-profile"></div></div>');
            $("#mainPanel div[role=form]").appendTo($("#main-panel"));
            $("#main-panel div[role=form] .form-group:first").remove();
            $("#nick").before('<input id="clantag" class="form-control" placeholder="Tag, e.g  \Lc" maxlength="10"><div class="input-group nick"></div>');
            $("#nick").appendTo($(".nick"));
            $(".nick").append('<span class="input-group-btn"><button id="stream-mode" class="btn active ogicon-eye"></button></span>');
            $(".nick").after('<div class="input-group skin"><input id="skin" class="form-control" placeholder="Manual direct skin URL" maxlength="150"><input type="hidden" id="color" value="' + ogarcopythelb.color + '" maxlength="7" /><span class="input-group-addon"><i></i></span><span class="input-group-btn"><button id="hide-url" class="btn active ogicon-eye" style="display: none"></button></span></div>');
            $('#stream-mode').before('<button id="opennamechars" class="btn btn-info" style="background-color: transparent;" onclick="opennamechars();return false;"><i class="fa fa-language"></i></button>');
            $('#opennamechars').tooltip({
                title: "Design Nickname Font",
                placement: "bottom"
            });
            $('#hide-url').before('<button id="openskinchanger" class="btn btn-info" style="background-color: transparent;" onclick="BeforeReportFakesSkin();return false;"><i class="fa fa-wpexplorer"></i></button>');
            $('#openskinchanger').attr('placeholder', 'Name').tooltip({
                title: "Flag the Fake's Skin",
                placement: "bottom"
            });
            $("#locationKnown, #locationUnknown").insertAfter($(".skin"));
            $("#region").before('<button class="btn btn-warning btn-server-info ogicon-cogs" style="display: none;"></button>');
            $(".btn-spectate, .btn-logout").appendTo("#agario-main-buttons");
            $("#agario-main-buttons").addClass("clearfix").before('<div id="server-info" class="form-group clearfix"><input id="server-ws" class="form-control" placeholder="Server WS" style="display: none;">' +
                '<button id="server-reconnect" class="btn btn-primary ogicon-redo2" style="display: none;"></button><input id="server-token" class="form-control" placeholder="Server token"><button id="server-join" class="btn btn-success" data-itr="page_join_party">Join</button></div>');
            $(".btn.btn-warning.btn-server-info.ogicon-cogs").after('<button id="server-reconnect" class="btn btn-success" style="display: inline-block; float: left; width: 11%; text-transform: capitalize;"><i class="fa fa-refresh"></i></button>');
            $("#server-join").after('<div id="ogario-party" class="clearfix"><input id="party-token" class="form-control" placeholder="Party token"></div>');
            $(".clearfix").show();
            $("#ogario-party").append('<button id="join-party-btn-2" class="btn btn-success" data-itr="page_join_party">Join</button><button id="create-party-btn-2" class="btn btn-primary" data-itr="page_create_party" style="display: none;">Create</button>');
            $("#pre-join-party-btn:first, #join-party-btn:first, #create-party-btn:first, #leave-party-btn:first, #joinPartyToken:first, .party-icon-back:first").appendTo($("#ogario-party"));
            $("#settingsChoice, #options").appendTo($("#og-settings .submenu-panel"));
            $("#stats").appendTo($("#main-menu")).addClass("menu-panel");
            $("#statsContinue").attr("id", "statsContinue2");
            $("#mainPanel").empty().remove();
            $(".center-container").addClass("ogario-menu");
            $(".center-container").append('<div id="menu-footer" class="menu-main-color"> <a href="https://legendmod.ml" target="_blank">legendmod.ml</a> | ' + this.version + ' <a href="https://legendmod.ml" class="release ogicon-info" target="_blank"></a></div>');
            $("#leftPanel, #rightPanel").addClass("ogario-menu").removeAttr("id");
            $(".agario-profile-panel, .agario-panel-freecoins, .agario-panel-gifting, .agario-shop-panel, #dailyquests-panel").appendTo($("#profile")).removeClass("agario-side-panel");
            $(".agario-profile-panel").after('<div id="block-warn">' + textLanguage.blockWarn + '<br><a href="#" id="unblock-popups">' + textLanguage.unblockPopups + "</a></div>");
            $("#exp-bar").addClass("agario-profile-panel"), $(".left-container").empty();
            //$(".agario-shop-panel").after('<div class="agario-panel ogario-yt-panel"><h5 class="menu-main-color">The Legend Mod Project</h5><div class="g-ytsubscribe" data-channelid="UCoj-ZStcJ0jLMOSK7FOBTbA" data-layout="full" data-theme="dark" data-count="default"></div></div>');

            $("#tags-container").appendTo($("#profile"));
            //$('.btn.btn-warning.btn-spectate.btn-needs-server').after('<button id="logoutbtn" onclick="logout(); return false;" class="btn btn-danger btn-logout" data-itr="page_logout">Logout</button>');
            //$(".btn-logout").appendTo($("#profile"));
            $(".left-container").append('<div id="quick-menu" class="agario-panel agario-side-panel"><a href="https://legendmod.ml/skins/" class="quick-more-skins ogicon-grin" target="_blank" data-toggle="tab-tooltip" data-placement="left" title="' + textLanguage.skins + '"></a>' +
                //'<a href="https://www.youtube.com/watch?v=CnIfNSpCf70" class="quick-yt ogicon-youtube2" id="legendid" target="_blank" data-toggle="tab-tooltip" data-placement="left" title="Legend Promo Video"></a>' +
                '<a id= "themesBtn" target="_blank" href="https://legendmod.ml/themes/" class="fa fa-tint" data-toggle="tab-tooltip" data-container="body" data-placement="left" title="" data-original-title="Themes"></a>' +
                //'<a id= "LegGoogleForm" class="fa fa-check-square-o" data-toggle="tab-tooltip" data-container="body" data-placement="left" title="" data-original-title="New Ideas & Statistics Form" onclick="legendformIframe();return false;"></a>' +
                '<a id= "ModInfoQuick" class="fa fa-info" data-toggle="tab-tooltip" data-container="body" data-placement="left" title="" data-original-title="Mod Info & Templates" onclick="openhelper();return false;"></a>' +
                '<a id= "ModReward" class="fa fa-gift " data-toggle="tab-tooltip" data-container="body" data-placement="left" title="" data-original-title="Reward day" onclick="LMrewardDay();return false;"></a>');
            //'<a id= "LegendClanDiscord" href="https://discord.gg/CbMkY77" target="_blank" class="fa fa-globe" data-toggle="tab-tooltip" data-container="body" data-placement="left" title="" data-original-title="Legend clan Discord"></a></div>');

            //<input type="number" id="captchaSpeed" value="1" step="1" placeholder="CPU cores" min=1 max=${CPUamount} spellcheck="false" style="display:inline-block;">
            //<span id="captchaErrors" style="display:inline-block;">Errors: <span id="captchaErrors1">0</span></span>
            //<div2><button id="instant" class="btn btn-success">Instant (only for testers)</button></div2>
            //var CPUamount=window.navigator.hardwareConcurrency-1;
            $(".left-container").append(`<div id="quick-bots" class="agario-panel agario-side-panel"><h2 id="botsInfo"></h2>									
					<h5 id="botsAuthor" class="main-color">Party bots</h5>
					<div id="botClient" style="margin-left:15px; margin-right:15px; font-family: Tahoma; color: rgb(255, 255, 255); z-index: 9999; border-radius: 5px; min-height: 16px; min-width: 200px; background-color: rgba(2, 0, 0, 0.4);">
					<div><b>Bot Count</b>: <span id="botCount" class="label label-info pull-right">Waiting</span></div>
					<b><div><b>ServerSlots</b>: <span id="slots" class="label label-info pull-right">Waiting</span></div>
					<b><div><b>Captcha tokens</b>: <span id="captchatokens" class="label label-info pull-right">0</span></div>
					</b></div>	
					<span id="statusTextBots">Status: <b id="userStatus">Disconnected</b></span>
					<span id="aiTextBots">Bots AI: <b id="botsAI">Disabled</b></span>
					<br>
					<input type="text" id="botsNameLM" placeholder="Bots Name" maxlength="15" spellcheck="false" style="display:inline-block;">
					<input type="number" id="botsAmount" placeholder="Bots Amount" min="1" max="190" spellcheck="false">

					
					<input type="text" id="botsRemoteIP" placeholder="ws://localhost:1337" maxlength="100" spellcheck="false">
					<br>
					<button id="connectBots" class="btn btn-success">Connect</button>
					<br>
					<button id="startBots" class="btn btn-primary btn" disabled>Start Bots</button>
					
					<button id="stopBots" class="btn btn-danger">Stop Bots</button>				
					<br><u><a href="https://github.com/jimboy3100/jimboy3100.github.io/tree/master/ExampleScripts/agario-bots2" target="_blank">Installation</a></u>	
					<u><a href="https://www.youtube.com/watch?v=rQMhxwIytro&feature=youtu.be" target="_blank">Tutorial video for PC node.js</a></u>	
					<u><a href="https://repl.it/@legendmod/party-bots" target="_blank">Repl.it VPS</a></u>	
					<u><a href="https://www.youtube.com/watch?v=xIupgFR7ZTY" target="_blank">Tutorial video for repl.it VPS</a></u>	
					<br>
					<div2><i>Tip:Connect more PC on the same Websocket, and keep them create tokens</i></div2>					
					</div>`);
            if (!this.protocolMode) $("#quick-menu").prepend('<a href="#" class="quick-shop ogicon-cart" data-toggle="tab-tooltip" data-placement="left" title="' + textLanguage.page_shop + '"></a><a href="#" class="quick-free-coins ogicon-coin-dollar" data-toggle="tab-tooltip" data-placement="left" title="' + textLanguage.page_menu_main_free_coins + '"></a><a href="#" class="quick-free-gifts ogicon-gift" data-toggle="tab-tooltip" data-placement="left" title="' + textLanguage.page_menu_main_gifts + '"></a><a href="#" class="quick-quests ogicon-trophy" data-toggle="tab-tooltip" data-placement="left" title="' + textLanguage.page_menu_main_dailyquests + '"></a>');
            $(".party-dialog, .partymode-info").remove();
            $(".agario-party-6").appendTo($(".center-container"));
            $(".right-container").empty();
            $(".right-container").append('<div class="agario-party"></div>');
            $(".agario-party-6").appendTo($(".agario-party")).addClass("agario-panel agario-side-panel");
            $(".agario-party h4, #cancel-party-btn").remove();
            $(".agario-party .btn").addClass("btn-sm");
            $(".right-container").append('<div id="skins-panel" class="agario-panel agario-side-panel"><div id="skins"></div><a href="https://legendmod.ml/skins/" id="more-skins" class="btn btn-block btn-success" target="_blank">' + textLanguage.moreSkins + "</a></div>");
            $(".btn-settings, .text-muted, .tosBox, .agario-promo, #agario-web-incentive, span[data-itr='page_option_dark_theme'], #options #darkTheme").remove();
            $("#advertisement, #adbg, #a320x250, #g320x250, #s320x250, #adsBottom").css("display", "none");
            $("#advertisement").removeClass("agario-panel"), $("#adsBottom").css({
                "z-index": "1",
                "opacity": "0",
                "bottom": "-100px"
            });
            $("#noNames, #showMass").remove();
            $("#og-settings .submenu-panel").append('<div id="og-options"></div>');
            //this.addOptions(["unlockedFPS"], "animationGroup");
            this.addOptions([], "animationGroup");

            this.addOptions(["autoZoom"], "zoomGroup");
            this.addOptions([], "boardGroup");
            this.addOptions(["quickResp", "autoResp", "spawnSpecialEffects"], "respGroup");
            this.addOptions(["noNames", "optimizedNames", "autoHideNames", "hideMyName", "hideTeammatesNames", "namesStroke"], "namesGroup");
            this.addOptions(["showMass", "optimizedMass", "autoHideMass", "hideMyMass", "hideEnemiesMass", "shortMass", "virusSpikes", "virMassShots", "massStroke", "virusSound", "potionsDrinker"], "massGroup");
            this.addOptions(["noSkins", "customSkins", "vanillaSkins", "jellyPhisycs", "suckAnimation", "videoSkins", "videoDestorted", "videoSkinsMusic2", "videoOthersSkinSoundLevelproportion"], "skinsGroup");
            this.addOptions(["optimizedFood", "autoHideFood", "autoHideFoodOnZoom", "rainbowFood"], "foodGroup");
            this.addOptions(["noColors", "myCustomColor", "myTransparentSkin", "transparentSkins", "transparentCells", "transparentViruses", "virusGlow", 'cellContours', "animatedRainbowColor"], "transparencyGroup");
            this.addOptions(["showGrid", "showBgSectors", "showMapBorders", "borderGlow"], "gridGroup");
            this.addOptions(["disableChat", "chatSounds", "chatEmoticons", "showChatImages", "showChatVideos", "showChatBox", "showChat", "showChatMyOwn", "showChatTranslation", "coloredNicks", "hidecountry", "universalChat"], "chatGroup");
            this.addOptions(["rotateMap", "showMiniMap", "showMiniMapGrid", "showMiniMapGuides", "showExtraMiniMapGuides", "showMiniMapGhostCells", "oneColoredTeammates"], "miniMapGroup");
            //            this.addOptions(["oppColors", "oppRings", "virColors", "splitRange", "qdsplitRange", "sdsplitRange", "virusesRange", "cursorTracking", "FBTracking", "bubbleInd", "bubbleCursorTracker", "onlineStatus", "teammatesInd", "showGhostCells", "showGhostCellsInfo", "reverseTrick", "showPartyBots"], "helpersGroup"); //Sonia2
            //this.addOptions(["oppColors", "oppRings", "virColors", "splitRange", "qdsplitRange", "sdsplitRange", "virusesRange", "cursorTracking", "FBTracking", "bubbleInd", "bubbleCursorTracker", "onlineStatus", "teammatesInd", "showGhostCells", "showGhostCellsInfo", "showPartyBots"], "helpersGroup"); //Sonia2
            this.addOptions(["oppColors", "oppRings", "virColors", "splitRange", "qdsplitRange", "sdsplitRange", "virusesRange", "cursorTracking", "FBTracking", "bubbleInd", "bubbleCursorTracker", "onlineStatus", "teammatesInd", "showGhostCells", "showGhostCellsInfo"], "helpersGroup"); //Sonia2
            //this.addOptions(["mouseSplit", "mouseFeed", "mouseInvert", "mouseWheelClick"], "mouseGroup");
			this.addOptions(["stickyCell", "mouseSplit", "mouseFeed", "mouseWheelClick", "mouseCommand4", "mouseCommand5"], "mouseGroup");
//	
			Settings.addPresetBox3('#mouseSplit', 'mouseSplit2', hotkeysCommand, 'preset', 'changeleftCmd');
			$("#mouseSplit2 option[value=" + defaultmapsettings.leftClick + "]").prop('selected', 'selected').change();
			Settings.addPresetBox3('#mouseFeed', 'mouseFeed2', hotkeysCommand, 'preset', 'changerightCmd');	
			$("#mouseFeed2 option[value=" + defaultmapsettings.rightClick + "]").prop('selected', 'selected').change();
			Settings.addPresetBox3('#mouseWheelClick', 'mouseWheelClick2', hotkeysCommand, 'preset', 'changemiddleCmd');	
			$("#mouseWheelClick2 option[value=" + defaultmapsettings.middleClick + "]").prop('selected', 'selected').change();		
			Settings.addPresetBox3('#mouseCommand4', 'mouseCommand42', hotkeysCommand, 'preset', 'change4Cmd');	
			$("#mouseCommand42 option[value=" + defaultmapsettings.mouse4Click + "]").prop('selected', 'selected').change();		
			Settings.addPresetBox3('#mouseCommand5', 'mouseCommand52', hotkeysCommand, 'preset', 'change5Cmd');	
			$("#mouseCommand52 option[value=" + defaultmapsettings.mouse5Click + "]").prop('selected', 'selected').change();					
//
            //this.addOptions(["showTop5", "showTargeting", "showLbData", "centeredLb", "normalLb", "fpsAtTop", "tweenMaxEffect"], "hudGroup"),
            this.addOptions(["showTop5", "showTargeting", "showLbData", "centeredLb", "fpsAtTop", "tweenMaxEffect", "top5skins"], "hudGroup");
            this.addOptions(["showStats", "showStatsMass", "showStatsESTE", "showStatsEMTE", "showStatsMTE", "showStatsSTE", "showStatsTTE", "showStatsPTE", "showStatsN16", "showStatsFPS", "showStatsRender", "gameOverStats", "showTime"], "statsGroup");
            this.addOptions(["oneColoredSpectator", "multiBoxShadow", "multiKeepMoving", "middleMultiViewWhenClose", "middleMultiView"], "multiBox");
            this.addOptions([], "macroGroup");
            this.addOptions([], "profiles");
            if (!this.protocolMode) {
                this.addOptions(["blockPopups"], "extrasGroup");
            } else {
                $("#noSkins, #noColors, #skipStats, #showQuest").addClass("js-switch-vanilla");
                //$(".skinsGroup h5").after('<label class="noSkins">' + textLanguage.noSkins + " </label>");
                //$("#noSkins").appendTo($(".noSkins")); 
                //$(".transparencyGroup h5").after('<label class="noColors">' + textLanguage.noColors + " </label>");
                //$("#noColors").appendTo($(".noColors"));
                $(".extrasGroup h5").after('<label class="skipStats">' + textLanguage.skipStats + " </label>");
                $("#skipStats").appendTo($(".skipStats"));
                $(".skipStats").after('<label class="showQuest">' + textLanguage.showQuest + " </label>");
                $("#showQuest").appendTo($(".showQuest"));
                $("#options").remove();
                $("#settingsChoice").appendTo($(".extrasGroup")).addClass("select-wrapper");
            }
            this.addSliderBox(".animationGroup", "animation", 5, 200, 1);

            this.addSliderBox(".zoomGroup", "zoomSpeedValue2", -0.90, 0.90, 0.01);
            this.addSliderBox(".skinsGroup", "videoSkinSoundLevel", 0, 1, 0.01);
            this.addSliderBox(".boardGroup", "leaderboardlimit", 10, 30, 5);
            this.addSliderBox(".boardGroup", "teamboardlimit", 5, 40, 5);

            this.addSliderBox(".profiles", "profileNumber", 10, 54, 1);
            this.addSliderBox(".macroGroup", "macroFeeding", 1, 160, 1);
            //this.addSliderBox(".massGroup", "hideSizes", 0, 37, 1);
            $("#og-settings").append('<button class="btn btn-block btn-success btn-export">' + textLanguage.exportImport + "</button>");
            $("#og-settings").append('<div class="restore-settings"><a href="#">' + textLanguage.restoreSettings + "</a></div>");
            $("#music").append('<div class="agario-panel radio-panel"><h5 class="menu-main-color">Radio (' + textLanguage.thanks + ')</h5><audio src="" controls></audio><span class="playlist"><span class="ogicon-file-music"></span> <a href="" target="_blank">' + textLanguage.playlist + "</a></span></div>");
            $("#music").append('<div class="agario-panel sounds-panel"><h5 class="menu-main-color">' + textLanguage.sounds + "</h5></div>");
            $("#music").append('<div class="agario-panel ogario-yt-panel"><h5 class="menu-main-color">Legend Clan (tag: \u24c2)</h5><div class="g-ytsubscribe" data-channelid="UCoj-ZStcJ0jLMOSK7FOBTbA" data-layout="full" data-theme="dark" data-count="default"></div></div>');
            /*$('#music').append('<div class="agario-panel facebook-panel"><h5 class="menu-main-color">' + 'Facebook' + '</h5></div>'),*/
            this.addInputBox(".sounds-panel", "messageSound", "Sound URL", "setMessageSound");
            this.addInputBox(".sounds-panel", "commandSound", "Sound URL", "setCommandSound");
            this.addInputBox(".sounds-panel", "virusSoundurl", "Sound URL", "setvirusSound");
            $("body").append('<div id="overlays-hud" data-gamemode=":ffa"><div id="stats-hud" class="hud stats-hud-color"></div> <div id="top5-hud" class="hud"><h5 class="hud-main-color" style="font-size: 19px">Team<span class="team-top"></span></h5><ol id="top5-pos"></ol><div id="top5-total"><span class="hud-main-color ogicon-users"></span> ' + //<div class="hud-main-color team-top-menu"><a href="#" data-limit="5" class="team-top-limit active">5</a> | <a href="#" data-limit="10" class="team-top-limit">10</a> | <a href="#" data-limit="100" class="team-top-limit">100</a></div><ol id="top5-pos"></ol><div id="top5-total"><span class="hud-main-color ogicon-users"></span> ' +
                textLanguage.totalPartyPlayers + ': <span id="top5-total-players" class="top5-mass-color">0</span>   <span class="hud-main-color ogicon-pacman"></span> ' +
                textLanguage.totalPartyMass + ': <span id="top5-total-mass" class="top5-mass-color">0</span></div></div> <div id="time-hud" class="hud time-hud-color"></div> <div id="pause-hud" class="hud">' +
                //textLanguage.pause + '</div> <div id="leaderboard-hud" class="hud-b"><h5 class="hud-main-color">legendmod.ml</h5><div id="leaderboard-data"></div><div id="leaderboard-positions"></div></div> <div id="btl-leaderboard-hud"><div class="hud hud-c"><span id="btl-players-status">Players ready</span>: <span id="btl-players-count">0</span></div></div> <div id="minimap-hud" class="hud-b"><canvas id="minimap-sectors"></canvas><canvas id="minimap"></canvas></div><div id="target-hud" class="hud"><div id="target-player"><span id="target-skin"><img src="https://legendmod.ml/banners/static/img/blank.png" alt=""> </span><span id="target-nick"></span><span id="target-status" class="hud-main-color">' + //class="hud-main-color">[' +
                textLanguage.pause + '</div> <div id="leaderboard-hud" class="hud-b"><h5 class="hud-main-color">' + textLanguage.leaderboard + '</h5><div id="leaderboard-data"></div><div id="leaderboard-positions"></div></div> <div id="btl-leaderboard-hud"><div class="hud hud-c"></div></div> <div id="minimap-hud" class="hud-b"><canvas id="minimap-sectors"></canvas><canvas id="minimap"></canvas></div><div id="target-hud" class="hud"><div id="target-player"><span id="target-skin"><img src="https://legendmod.ml/banners/static/img/blank.png" alt=""> </span><span id="target-nick"></span><span id="target-status" class="hud-main-color">' + //class="hud-main-color">[' +
                textLanguage.targetNotSet + '</span></div><div id="target-summary"></div></div><div id="target-panel-hud" class="hud">' +
                '<a href="#" id="set-debug" class="ogicon-location"></a>' +
                '<a href="#" id="set-fullSpectator" class="ogicon-eye"  style="display: none"></a>' +
                '<a href="#" id="set-ingameSpectator" class="ogicon-power"  style="display: none"></a>' +
                '<a href="#" id="fullscreenBtn" onclick="toggleFullScreen();"  class="ogicon-display"></a>' +
                '<a href="#" id="RotateLeft" onclick="rotateminimapsectors();"  class="ogicon-loop2"></a>' +
                '<a href="#" id="Bino" onclick="legendmod.sendFreeSpectate()"  class="ogicon-pacman"></a>' +
                '<a href="#" id="set-targeting" class="ogicon-target"></a>' +
                '<a href="#" id="set-private-minimap" class="ogicon-location2"></a>' +
                '<a href="#" id="cancel-targeting" class="ogicon-cancel-circle"></a>' +
                '<a href="#" id="change-target" class="ogicon-arrow-right"></a></div>' +
                '<div id="quest-hud" class="hud"></div> <div id="btl-hud" class="hud"></div></div>');
            $("body").append('<ul id="messages"></ul>');
            $("body").append('<div id="message-box"><div id="chat-emoticons"></div><div id="message-menu"><a href="#" class="chat-sound-notifications ogicon-volume-high"></a><a href="#" class="chat-active-users ogicon-user-check"></a><a href="#" class="chat-muted-users ogicon-user-minus"></a><a href="#" class="show-chat-emoticons ogicon-smile"></a></div><input type="text" id="message" class="form-control" placeholder="' +
                textLanguage.enterChatMsg + '..." maxlength="80"></div>');
            $("body").append('<div id="chat-box"></div>');
            for (const emoji in emoticonicons) {
                if (emoticonicons.hasOwnProperty(emoji)) {
                    $("#chat-emoticons").append('<img src="https://legendmod.ml/banners/emoticons/' + emoticonicons[emoji] + '" alt="' + emoji + '" class="emoticon">');
                }
            }
            $("body").append('<div id="exp-imp"><div id="exp-imp-menu"><button id="close-exp-imp" class="btn btn-danger">' + textLanguage.close + '</button></div><div id="exp-imp-settings"></div></div>');
            $("#exp-imp-settings").append("<h1>" + textLanguage.exportSettings + "</h1><h2>" + textLanguage.exportInfo + "</h2>");
            this.addOption("#exp-imp-settings", "export-ogarioCommands", textLanguage.commands, true);
            this.addOption("#exp-imp-settings", "export-ogarioHotkeys", textLanguage.hotkeys, true);
            this.addOption("#exp-imp-settings", "export-ogarioPlayerProfiles",
                textLanguage.profiles, true), this.addOption("#exp-imp-settings", "export-ogarioSettings", textLanguage.settings, true);
            this.addOption("#exp-imp-settings", "export-ogarioThemeSettings", textLanguage.theme, true);
            $("#exp-imp-settings").append('<textarea id="export-settings" class="form-control" rows="14" cols="100" spellcheck="false" readonly /><button id="export-settings-btn" class="btn btn-block btn-success">' + textLanguage.exportSettings + "</button>");
            $("#exp-imp-settings").append("<h1>" + textLanguage.importSettings + "</h1><h2>" +
                textLanguage.importInfo + "</h2>"), this.addOption("#exp-imp-settings", "import-ogarioCommands", textLanguage.commands, true);
            this.addOption("#exp-imp-settings", "import-ogarioHotkeys", textLanguage.hotkeys, true);
            this.addOption("#exp-imp-settings", "import-ogarioPlayerProfiles", textLanguage.profiles, true);
            this.addOption("#exp-imp-settings", "import-ogarioSettings", textLanguage.settings, true);
            this.addOption("#exp-imp-settings", "import-ogarioThemeSettings", textLanguage.theme, true);
            $("#exp-imp-settings").append('<textarea id="import-settings" class="form-control" rows="14" cols="100" spellcheck="false" /><button id="import-settings-btn" class="btn btn-block btn-success">' +
                textLanguage.importSettings + "</button>");
            if (Settings) Settings.setThemeMenu();
            /** @type {number} */
            var e = 0;
            for (; e < profiles.length; e++) {
                $("#skins").append('<div class="skin-box"><a href="#profile-' + e + '" id="profile-' + e + '" data-profile="' + e + '"></a></div>');
                this.setSkinPreview(profiles[e].skinURL, "profile-" + e);
                if (e == this.selectedProfile) {
                    $("#profile-" + e).addClass("selected");
                }
            }
        },
        setUI() {
            /*$("#instant").click(function() {			
            	if (!window.iframereplitCreated){
            		window.iframereplitCreated=true						
            	$("#instant").html('<iframe frameborder="0px" width="120px" height="40" src="https://repl.it/@legendmod/party-bots-CleverBots?lite=true"></iframe>')
            	toastr.info('<b>[' + Premadeletter123 + ']:</b> ' + 'If <font color="green"><b>GREEN</b></font> button appears, click it!');
            	if (legendmod.gameMode!="party"){
            		$("#create-party-btn-2").click()
            	}
            	setTimeout(function() {					
            		$("#botsRemoteIP").val("wss://party-bots-CleverBots--legendmod.repl.co")
            		window.SERVER_HOST="wss://party-bots-CleverBots--legendmod.repl.co"
            		$("#connectBots").click()
            	}, 8000);	
            	setTimeout(function() {
            		$("#startBots").click()
            	}, 10000);				
            	}
            });	*/
            var app = this;
            $(document).on("click", ".menu-tabs a", function(event) {
                event.preventDefault();
                app.switchMenuTabs($(this), "menu-panel");
            });
            $(document).on("click", ".submenu-tabs a", function(event) {
                event.preventDefault();
                app.switchMenuTabs($(this), "submenu-panel");
            });
            $(document).on("click", ".quick-menu", function(event) {
                event.preventDefault();
                defaultmapsettings.showQuickMenu = !defaultmapsettings.showQuickMenu;
                //defaultmapsettings.showQuickBots=false;
                app.saveSettings(defaultmapsettings, "ogarioSettings");
                app.setShowQuickMenu();
            });
            $(document).on("click", ".quick-bots", function(event) {
                event.preventDefault();
                defaultmapsettings.showQuickBots = !defaultmapsettings.showQuickBots;
                //defaultmapsettings.showQuickMenu=false;
                app.saveSettings(defaultmapsettings, "ogarioSettings");
                app.setShowQuickBots();
            });
            $(document).on("click", ".quick-replay", function(event) {
                event.preventDefault();
                BeforeReplay()
            });
            $(document).on("click", ".quick-skins", function(event) {
                event.preventDefault();
                defaultmapsettings.showSkinsPanel = !defaultmapsettings.showSkinsPanel;
                app.saveSettings(defaultmapsettings, "ogarioSettings");
                app.setShowSkinsPanel();
            });
            $(document).on(`click`, `#buy-boost`, event => {
                event.preventDefault();
                buyBoost($("#s-boost").val());
            });
            $(document).on(`click`, `#use-boost`, event => {
                event.preventDefault();
                useBoost($("#s-boost").val());
            });
            $(document).on("click", "#onlineStatus", event => {
                setTimeout(() => {
                    Settings.switchOnlineStatus()
                }, 500);
            });
            $(document).on(`click`, `#potions`, event => {
                event.preventDefault();
                var id = event.target.parentNode.id;
                if (id && LM.user.potionsStatus.hasOwnProperty(id)) {
                    var potion = LM.user.potionsStatus[id];
                    if (potion.status == 1) {
                        window.brewPotion(potion.slot);
                    } else if (potion.status == 3 || (potion.status == 2 && potion.expires - Date.now() < 0)) {
                        window.openPotion(potion.slot);
                    }
                }
            });
            $(document).on(`click`, `#player-skins`, event => {
                event.preventDefault();
                window.changeSkin(event.target.getAttribute("alt"))
            });
            /*$(document).on(`click`, `#copy-accID`, event => {
                event.preventDefault();
                const input = $(`<input>`);
                $(`body`).append(input);
                input.val($('.user-profile-id').text()).select();
                toastr.info("Copying ID to clipboard");
                try {
                   document.execCommand(`copy`);
                } catch (error) {
                   console.log("can't copy..")
                }
                input.remove();

            });	*/
            $(document).on("change", "#region", function() {
                app.region = this.value;
            });
            $(document).on("change", "#gamemode", function() {
                var dummy = this.value;
                if (":party" !== dummy) {
                    app.leaveParty();
                }
                app.gameMode = ogario.gameMode = dummy;
                app.setQuest();
            });
            $(document).on("change", "#quality", function() {
                app.getQuality(this.value);
                ogarhusettings();
                //ogarhusettingsImportExportMobile();
            });
            $(`#skin`).popover({
                html: true,
                placement: `bottom`,
                trigger: 'manual',
                animation: false
            });
            $(document).on(`input click`, `#skin`, function() {
                const value = this.value;
                app.setSkinPreview(value, `skin-preview`);
                app.setSkinPreview(value, `profile-` + app.selectedProfile);
            });
            $(document).on(`click`, '.skin .example-url a', function(event) {
                event.preventDefault();
                $(`#skin`).val(this.href).click();
            });
            $(document).on(`click`, `#overlays`, () => {
                if (!$(`.skin:hover`).length && !$('.skin-switch:hover').length) {
                    $(`#skin`).popover(`hide`);
                }
            });
            $(document).on(`click`, `.vanilla-skin-preview`, () => {
                if ($("#player-skins").is(":visible")) {
                    $("#player-skins").hide();
                } else {
                    $('#player-skins').show();
                }
            });
            $(document).on(`click`, `.agario-profile-picture`, () => {
                if ($("#user-stats").is(":visible")) {
                    $("#user-stats").hide();
                } else {
                    $('#user-stats').show();
                }
            });
            $(document).on(`click`, `#close-stats`, () => {
                $("#user-stats").hide();
            });
            $(document).on("input", "#skin", function() {
                var hexInputVal = this.value;
                app.setSkinPreview(hexInputVal, "skin-preview");
                app.setSkinPreview(hexInputVal, "profile-" + app.selectedProfile);
            });
            $(document).on("click", "#skins a", function(event) {
                event.preventDefault();
                app.selectProfile($(this).attr("data-profile"));
            });
            $(document).on("click", "#prev-profile", function() {
                app.prevProfile();
            });
            $(document).on("click", "#next-profile", function() {
                app.nextProfile();
            });
            $(document).on("click", "#stream-mode", function() {
                /** @type {boolean} */
                defaultmapsettings.streamMode = !defaultmapsettings.streamMode;
                app.saveSettings(defaultmapsettings, "ogarioSettings");
                app.setStreamMode();
            });
            $(document).on("click", "#hide-url", function() {
                /** @type {boolean} */
                defaultmapsettings.hideSkinUrl = !defaultmapsettings.hideSkinUrl;
                app.saveSettings(defaultmapsettings, "ogarioSettings");
                app.setHideSkinUrl();
            });
            $(document).on("click", ".btn-server-info", function() {
                $("#server-info").toggle();
            });
            $(document).on("click", "#server-connect", function() {
                app.gameServerConnect($("#server-ws").val());
            });
            $(document).on("click", "#server-reconnect", function() {
                app.gameServerReconnect();
            });
            $(document).on("click", "#server-join", function() {
                app.gameServerJoin($("#server-token").val());
            });
            $(document).on("change", "#og-options input[type='checkbox']", function() {
                var template = $(this);
                app.setSettings(template.attr("id"), template.prop("checked"));
            });
            $(document).on("change", ".js-switch-vanilla", function() {
                var template = $(this);
                var p = template.attr("id");
                if (void 0 !== app[p]) {
                    app[p] = template.prop("checked");
                    //if ("noSkins" === p) {
                    //ogario.showCustomSkin = !app.noSkins;
                    //}
                    //if ("showQuest" === p) {
                    //app.setQuest();
                    //}
                }
            });
            $(document).on("click", "#og-settings .restore-settings a", function(result) {
                result.preventDefault();
                app.restoreSettings();
            });
            $(document).on("click", "#og-settings .btn-export", function(result) {
                result.preventDefault();
                app.exportSettings();
                $("#exp-imp").fadeIn(500);
                $("#exp-imp-settings, #export-settings").perfectScrollbar("update");
            });
            $(document).on("click", "#close-exp-imp", function(event) {
                event.preventDefault();
                $("#exp-imp").fadeOut(500);
            });
            $(document).on("focus", "#export-settings", function() {
                    $(this).select();
                }),
                $(document).on("click", "#export-settings-btn", function(event) {
                    event.preventDefault();
                    app.exportSettings();
                });
            $(document).on("click", "#import-settings-btn", function(result) {
                result.preventDefault();
                app.importSettings();
            });
            $(document).on("click", "#unblock-popups", function(result) {
                result.preventDefault();
                app.unblockPopups();
            });
            $(document).on("click", "#openfl-overlay.disabler", function() {
                if (defaultmapsettings.blockPopups) {
                    app.blockPopups();
                }
            });
            $(document).on("click", "#openfl-content", function() {
                if (defaultmapsettings.blockPopups) {
                    var container = $(this);
                    setTimeout(function() {
                        if (!container.is(":visible")) {
                            app.blockPopups();
                        }
                    }, 1000);
                }
            });
            $(document).on("click", ".quick-shop", function(event) {
                event.preventDefault();
                app.unblockPopups();
                if (window.MC && window.MC.openShop) {
                    window.MC.openShop();
                }
            });
            $(document).on("click", ".quick-free-coins", function(event) {
                event.preventDefault();
                app.unblockPopups();
                if (window.MC && window.MC.showFreeCoins) {
                    window.MC.showFreeCoins();
                }
            });
            $(document).on("click", ".quick-free-gifts", function(event) {
                event.preventDefault();
                app.unblockPopups();
                if (window.MC && window.MC.showGifting) {
                    window.MC.showGifting();
                }
            });
            $(document).on("click", ".quick-quests", function(event) {
                event.preventDefault();
                app.unblockPopups();
                if (window.MC && window.MC.showQuests) {
                    window.MC.showQuests();
                }
            });

            $(document).on("click", "#set-debug", function(event) {
                event.preventDefault();
                app.setDebug();
            });
            $(document).on("click", "#set-fullSpectator", function(event) {
                event.preventDefault();
                app.setFullSpectator();
            });
            $(document).on("click", "#set-ingameSpectator", function(event) {
                event.preventDefault();
                app.setIngameSpectator();
            });
            $(document).on("click", "#set-targeting", function(event) {
                event.preventDefault();
                app.setTargeting();
            });
            $(document).on("click", "#cancel-targeting", function(event) {
                event.preventDefault();
                app.cancelTargeting();
            });
            $(document).on("click", "#set-private-minimap", function(event) {
                event.preventDefault();
                app.setPrivateMiniMap();
            });
            $(document).on("click", "#change-target", function(result) {
                result.preventDefault();
                app.changeTarget();
            });
            $(document).on("click", ".team-top-limit", function(event) {
                event.preventDefault();
                var template = $(this);
                /** @type {number} */
                var param = parseInt(template.attr("data-limit"));
                if (param) {
                    app.setTop5limit(param);
                    app.displayTop5();
                    $(".team-top").text(param);
                    $(".team-top-limit").removeClass("active");
                    template.addClass("active");
                }
            });
            $(document).on("click", "#top5-pos .set-target", function(event) {
                event.preventDefault();
                app.setTarget(parseInt($(this).attr("data-user-id")));
            });
            $(document).on("click", ".mute-user", function(event) {
                event.preventDefault();
                app.muteChatUser(parseInt($(this).attr("data-user-id")));
            });
            $(document).on("click", ".btn-mute-user", function() {
                var template = $(this);
                app.muteChatUser(parseInt(template.attr("data-user-id")));
                template.removeClass("btn-red btn-mute-user").addClass("btn-green btn-unmute-user").text(textLanguage.unmute);
            });
            $(document).on("click", ".btn-unmute-user", function() {
                var template = $(this);
                app.unmuteChatUser(parseInt(template.attr("data-user-id")));
                template.removeClass("btn-green btn-unmute-user").addClass("btn-red btn-mute-user").text(textLanguage.mute);
            });
            $(document).on("click", ".chat-sound-notifications", function(result) {
                result.preventDefault();
                /** @type {boolean} */
                defaultmapsettings.chatSounds = !defaultmapsettings.chatSounds;
                app.saveSettings(defaultmapsettings, "ogarioSettings");
                app.setChatSoundsBtn();
            });
            $(document).on("click", ".chat-active-users", function(event) {
                event.preventDefault();
                app.displayChatActiveUsers();
            });
            $(document).on("click", ".chat-muted-users", function(event) {
                event.preventDefault();
                app.displayChatMutedUsers();
            });
            $(document).on("click", ".show-chat-emoticons", function(result) {
                result.preventDefault();
                var template = $(this);
                var p = $("#chat-emoticons");
                p.toggle();
                if (p.is(":visible")) {
                    template.addClass("active");
                } else {
                    template.removeClass("active");
                    $("#message").focus();
                }
            });
            $(document).on("click", "#chat-emoticons .emoticon", function() {
                var d = $(this).attr("alt");
                var e = $("#message");
                var n = e.val();
                if (n.length + d.length <= 80) {
                    e.val(n + d);
                }
                e.focus();
            });
            this.statsHUD = document.getElementById("stats-hud");
            this.activeParties = document.getElementById("active-parties");
            this.top5pos = document.getElementById("top5-pos");
            this.top5totalMass = document.getElementById("top5-total-mass");
            this.top5totalPlayers = document.getElementById("top5-total-players");
            this.leaderboardPositionsHUD = document.getElementById("leaderboard-positions");
            this.leaderboardDataHUD = document.getElementById("leaderboard-data");
            this.timeHUD = document.getElementById("time-hud");
            this.questHUD = document.getElementById("quest-hud");
            $("#canvas").bind("contextmenu", function() {
                return false;
            });
            $(document).on("mouseup", ".btn", function() {
                $(this).blur();
            });
            $("[data-toggle='tab-tooltip']").tooltip({
                "trigger": "hover"
            });
            $(".submenu-panel, #chat-box, #exp-imp-settings, #export-settings, #import-settings").perfectScrollbar({
                "suppressScrollX": true
            });
            Array.prototype.slice.call(document.querySelectorAll(".js-switch")).forEach(function(remove) {
                new Switchery(remove, {
                    "color": defaultSettings.menuMainColor,
                    "size": "small"
                });
            });
            $("input[type='range']").rangeslider({
                "polyfill": false
            });
            toastr.options = {
                "newestOnTop": false,
                "positionClass": "toast-bottom-left",
                "timeOut": 15000
            };

        },
        switchMenuTabs(t, e) {
            var i = t.parent();
            if ('menu-panel' === e) {
                if (t.hasClass('hotkeys-link')) return;
                i.hasClass('profile-tab') && this.setBlockPopups();
            }
            t.addClass('active'),
                i.addClass('active'),
                i.siblings().removeClass('active'),
                i.siblings().find('a').removeClass('active');
            var o = t.attr('href');
            if ('submenu-panel' === e) {
                var a = $(o).parent().attr('id');
                $('#' + a + ' .submenu-panel').not(o).css('display', 'none');
            } else {
                try {
                    $('.menu-panel').not(o).css('display', 'none');
                } catch (error) {}
            }
            try {
                $(o).fadeIn(1000);
            } catch (error) {}
            ogarhusettings();
            //ogarhusettingsImportExportMobile();
            $('.submenu-panel').perfectScrollbar('update');
        },
        getDefaultSettings() {
            //this.noSkins = $("#noSkins").prop("checked");
            //this.noColors = $("#noColors").prop("checked");
            this.skipStats = $("#skipStats").prop("checked");
            this.showQuest = $("#showQuest").prop("checked");
            ogario.showCustomSkin = !defaultmapsettings.noSkins;
            if (null !== window.localStorage.getItem("scale_setting")) {
                var parseScaleSettings = JSON.parse(window.localStorage.getItem("scale_setting"));
                this.setCanvasScale(parseScaleSettings);
            } else {
                var quality = $("#quality").val();
                this.getQuality(quality);
            }
            if (null !== window.localStorage.getItem("location")) {
                this.region = window.localStorage.getItem("location");
                $("#region").val(this.region);
                if (window.MC && window.MC.setRegion) window.MC.setRegion(this.region)
            } else {
                this.region = $("#region").val()
            }
            this.setParty();
            if (":party" === this.gameMode && window.location.hash) $("#join-party-btn-2").click();
            Array.prototype.slice.call(document.querySelectorAll(".js-switch-vanilla")).forEach(function(remove) {
                new Switchery(remove, {
                    "color": defaultSettings.menuMainColor,
                    "size": "small"
                });
            });
            $("#nick").val(ogarcopythelb.nick).blur();
            $("#noNames").prop("checked", !defaultmapsettings.noNames);
            $("#showMass").prop("checked", defaultmapsettings.showMass);
            this.unlockButtons();
            this.setAutoResp();
            this.setQuest();
        },
        getQuality(value) {
            const ration = 'devicePixelRatio' in window;
            var defaultValue = 1;
            if (ration) {
                defaultValue = window.devicePixelRatio;
            }
            switch (value) {
                case 'High':
                    this.setCanvasScale(1);
                    break;
                case 'Medium':
                    this.setCanvasScale(0.9);
                    break;
                case 'Low':
                    this.setCanvasScale(0.75);
                    break;
                case 'VeryLow':
                    this.setCanvasScale(0.5);
                    break;
                default:
                    this.setCanvasScale(defaultValue);
            }
        },
        setCanvasScale(value) {
            this.canvasScale = value;
            ogario.canvasScale = value;
        },
        setStreamMode() {
            if (defaultmapsettings.streamMode) {
                $("#stream-mode").addClass("ogicon-eye-blocked");
                //$("#clantag, #nick, #party-token").addClass("stream-mode");
                $("#clantag, #nick, #skin").foggy();
            } else {
                $("#stream-mode").removeClass("ogicon-eye-blocked");
                //$("#clantag, #nick, #party-token").removeClass("stream-mode");
                $("#clantag, #nick, #skin").foggy(false);
            }
        },
        setHideSkinUrl() {
            if (defaultmapsettings.hideSkinUrl) {
                $("#hide-url").addClass("ogicon-eye-blocked");
                $("#skin").addClass("hide-url");
            } else {
                $("#hide-url").removeClass("ogicon-eye-blocked");
                $("#skin").removeClass("hide-url");
            }
        },
        setShowQuickMenu() {
            if (defaultmapsettings.showQuickMenu) {
                $("#quick-menu").fadeIn(500);
            } else {
                $("#quick-menu").fadeOut(500);
            }
            if (defaultmapsettings.showQuickBots) {
                $("#quick-bots").hide();
            }
        },
        setShowQuickBots() {
            if (defaultmapsettings.showQuickBots) {
                $("#quick-bots").fadeIn(500);
            } else {
                $("#quick-bots").fadeOut(500);
            }
            if (defaultmapsettings.showQuickBots) {
                $("#quick-menu").hide();
            }
        },
        setShowSkinsPanel() {
            if (defaultmapsettings.showSkinsPanel) {
                $("#skins-panel").fadeIn(500);
            } else {
                $("#skins-panel").fadeOut(500);
            }
        },
        unlockButtons() {
            $('.btn-play, .btn-play-guest, .btn-login-play, .btn-spectate').prop('disabled', false);
        },
        setMainButtons() {
            var app = this;
            $(document).on("click", ".btn-play, .btn-play-guest", function() {
                app.onPlay();
            });
            $(document).on("click", ".btn-spectate", function() {
                app.onSpectate();
            });
            $(document).on("click", "#create-party-btn-2", function() {
                app.onCreate();
            });
            $(document).on("click", "#join-party-btn-2", function() {
                app.skipServerData = true;
                app.joinParty();
                app.onJoin();
            });
            $("#closePartyAlert").click(function() {
                $("#helloContainer").attr("data-party-state", "0");
                //$("#helloContainer").attr("data-party-state", "6");
            })
            $(document).on("click", "#statsContinue2", function() {
                $("#stats, #main-panel").toggle();
            });
        },
        play() {
            if (window.noOgarioSocket) {
                console.log('New Socket 3 data sent');
                if (window.noOgarioSocket) {
                    //Socket3.send(JSON.stringify({ com: "sendPlayerSkinURL", nick: ogarcopythelb.nick, token: application.serverToken, tag: ogarcopythelb.clanTag, skin: ogarcopythelb.skinURL, color: ogarcopythelb.color, id: customLMID, x: application.getPlayerX(), y: application.getPlayerY(), mass: legendmod.playerMass}));
                    var temp = {
                        com: "sendPlayerSkinURL",
                        nick: ogarcopythelb.nick,
                        token: application.serverToken,
                        tag: ogarcopythelb.clanTag,
                        skin: ogarcopythelb.skinURL,
                        color: ogarcopythelb.color,
                        //id: customLMID,
                        //id: application.playerID,
                        id: window.unescape(window.encodeURIComponent(application.lastSentNick)),
                        x: application.getPlayerX(),
                        y: application.getPlayerY(),
                        mass: application.getMass()
                    };
                    if (Socket3 && Socket3.readyState == 1) {
                        Socket3.send(JSON.stringify({
                            //"toH": "legendmod",
                            "toH": $("#server-token").val() + "3",
                            "msg": temp
                        }));
                    }

                }
            }
            this.setPlayerSettings();
            this.setParty();
            if (this.isSocketOpen()) this.sendPartyData();
            else {
                this.connect();
                var app = this;
                setTimeout(function() {
                    app.sendPartyData();
                }, 1000);
            }
        },
        onPlay() {
            //                this.play(), this.hideMenu(), window.addKeyListeners && window.addKeyListeners(), defaultmapsettings.autoHideFood && (i.showFood = true), window['ga'] && window['ga']('create', 'UA-92655864-7', 'auto', 'ogarioTracker'), window['ga'] && window['ga']('ogarioTracker.send', 'pageview');
            this.play();
            this.hideMenu();
            if (window.addKeyListeners) {
                window.addKeyListeners();
            }
            if (defaultmapsettings.autoHideFood) {
                ogario.showFood = true
            };


        },
        onSpectate() {
            this.onJoin();
            this.sendPlayerJoin();
            this.hideMenu();
            if (window.addKeyListeners) {
                window.addKeyListeners();
            }
            if (defaultmapsettings.autoHideFood) {
                ogario.showFood = false;
            }
        },
        join() {
            this.setParty();
            this.setPlayerSettings();
            this.sendPartyData();
            this.sendPlayerDeath();
        },
        onJoin() {
            this.setParty();
            if (this.isSocketOpen()) this.join();
            else {
                this.connect();
                var app = this;
                setTimeout(function() {
                    app.join();
                    app.sendPlayerJoin();
                }, 1000);
            }
        },
        create() {
            this.setParty()
            if (this.partyToken) this.onJoin();
            else {
                var app = this;
                setTimeout(function() {
                    app.create();
                }, 100);
            }
        },
        onCreate() {
            this.setParty();
            if (this.partyToken) {
                this.onJoin();
                return;
            }
            const app = this;
            setTimeout(() => {
                app.create();
            }, 100);
        },
        onPlayerSpawn() {
            ogario.play = true;
            if (ogario.playerColor) {
                this.sendPlayerSpawn();
                this.cacheCustomSkin(ogarcopythelb.nick, ogario.playerColor, ogarcopythelb.skinURL);
                return;
            }
            const app = this;
            setTimeout(() => {
                app.onPlayerSpawn();
            }, 100);
            if (defaultmapsettings.spawnSpecialEffects) {
                setTimeout(function() {
                    ///////// trigger special effects
                    //console.log('Special effects stage 1');
                    ogario.spawnX = ogario.playerX;
                    ogario.spawnY = ogario.playerY;
                    LM.drawCommander = true;
                }, 110);
            }
            LegendModSpawn();
        },
        onPlayerDeath() {
            //
            pauseVideos();
            ogario.play = false;
            ogario.playerColor = null;
            ogario.foodIsHidden = false;
            ogario.playerMass = 0;
            ogario.playerScore = 0;
            ogario.playerSplitCells = 0;
            //this.showMenu(300);
            this.sendPlayerDeath();
            this.updateDeathLocations(ogario.playerX, ogario.playerY);
            this.unlockButtons();
            resetonkeydown();
            this.autoResp();

        },
        findOwnedVanillaSkin() {
            if (legendflags.includes(LowerCase(ogarcopythelb.nick))) {
                core.registerSkin(ogarcopythelb.nick, null, "https://legendmod.ml/agario/live/flags/" + LowerCase(ogarcopythelb.nick) + ".png", null);
            } else if (window.FreskinsMap && window.FreskinsMap.includes(LowerCase(ogarcopythelb.nick))) {
                for (var player = 0; player < window.FreeSkins.length; player++) {
                    if (LowerCase(ogarcopythelb.nick) == window.FreeSkins[player].id) {
                        core.registerSkin(ogarcopythelb.nick, null, "https://configs-web.agario.miniclippt.com/live/" + window.agarversion + window.FreeSkins[player].image, null);
                    }
                }
            } else if (!ogarcopythelb.skinURL && defaultmapsettings.vanillaSkins && window.UserVanillaSkin && window.EquippableSkins && !application.customSkinsMap[ogarcopythelb.nick]) {
                //console.log("1. skin_" + window.UserVanillaSkin);
                if (window.UserVanillaSkin.includes("skin_custom")) {
                    application.customSkinsMap[ogarcopythelb.nick] = window.UserVanillaSkin;
                    application.loadSkin(application.customSkinsCache, window.UserVanillaSkin);
                    //core.registerSkin(ogarcopythelb.nick, null, window.UserVanillaSkin, null);
                    //window.UserVanillaSkin=null;
                } else {
                    for (var player = 0; player < window.EquippableSkins.length; player++) {
                        if (window.EquippableSkins[player].productId == "skin_" + window.UserVanillaSkin && window.EquippableSkins[player].image != "uses_spine") {
                            //console.log("2. " + window.EquippableSkins[player].image);	
                            window.lastusednameforskin = ogarcopythelb.nick;
                            application.customSkinsMap[ogarcopythelb.nick] = "https://configs-web.agario.miniclippt.com/live/" + window.agarversion + window.EquippableSkins[player].image;
                            application.loadSkin(application.customSkinsCache, "https://configs-web.agario.miniclippt.com/live/" + window.agarversion + window.EquippableSkins[player].image);
                            //core.registerSkin(ogarcopythelb.nick, null, "https://configs-web.agario.miniclippt.com/live/" + window.agarversion + window.EquippableSkins[player].image, null);   
                            //window.UserVanillaSkin=null;								
                        }
                    }
                }
            } else {
                //console.log('findOwnedVanillaSkin failed execution')				
                if (!window.EquippableSkins && !window.findOwnedVanillaSkinOnce) {
                    window.findOwnedVanillaSkinOnce = true;
                    //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' findOwnedVanillaSkin: window.EquippableSkins not loaded');
                    setTimeout(function() {
                        application.findOwnedVanillaSkin();
                    }, 4000);
                }
            }
        },
        setPlayerSettings() {
            var nick = $('#nick').val();
            var tag = $('#clantag').val();
            var skin = $('#skin').val();
            var color = $('#color').val();
            ogarcopythelb.nick = nick;
            //changed
            ogarcopythelb.clanTag = tag.trim();
            //ogarcopythelb.clanTag = tag.trim() + "@";
            ogarcopythelb.skinURL = this.checkSkinURL(skin.trim());
            if (7 == color.length) {
                ogarcopythelb.color = color;
            }
            if (ogarcopythelb.clanTag.length > 0) {
                ogario.clanTag = ogarcopythelb.clanTag;
            }
            if (profiles[this.selectedProfile]) {
                profiles[this.selectedProfile].nick = ogarcopythelb.nick;
                profiles[this.selectedProfile].clanTag = ogarcopythelb.clanTag;
                profiles[this.selectedProfile].skinURL = ogarcopythelb.skinURL;
                profiles[this.selectedProfile].color = ogarcopythelb.color;
            }
            this.saveSettings(profiles, 'ogarioPlayerProfiles');
            this.findOwnedVanillaSkin();
        },
        loadSkin(img, url, animated) {
            var app = this;
            //console.log ("img:" + img + "url:" + url);
            if (!url.includes("4.0") && !url.includes("4.1") && !url.includes("4.2") && !url.includes("4.3")) {
                if (url && url.includes && (url.includes(".mp4") || url.includes(".webm") || url.includes(".ogv"))) {
                    img[url] = new Video();
                    //console.log("stage 2 videos");
                } else {
                    img[url] = new Image();
                }

                img[url].crossOrigin = 'anonymous';
                img[url].onload = function() {
                        if (this.complete &&
                            this.width &&
                            this.height &&
                            this.width <= 2000 && this.width > 0 &&
                            this.height <= 2000 && this.height > 0) {


                            if (animated == "animatedSkins") {
                                app.cacheQueueSkinAnimated.push(url);
                                if (1 == app.cacheQueueSkinAnimated.length) app.cacheSkinAnimated(app.customSkinsCache, animated)
                                app.cacheQueue2.push(url)
                                if (1 == app.cacheQueue2.length) app.cacheSkin2(app.customSkinsCache)
                            } else if (animated != "fbSkin") {
                                app.cacheQueue.push(url);
                                if (1 == app.cacheQueue.length) app.cacheSkin(app.customSkinsCache, animated)
                                app.cacheQueue2.push(url)
                                if (1 == app.cacheQueue2.length) app.cacheSkin2(app.customSkinsCache)
                                if (animated == true) app.cacheQueue3.push(url)
                                if (1 == app.cacheQueue3.length) app.cacheSkin3(app.customSkinsCache)
                            } else if (animated == "fbSkin") {
                                app.cacheQueue4.push(url)
                                if (1 == app.cacheQueue4.length) app.cacheSkin4(app.customSkinsCache)
                            }

                            //26/6/2020
                            //if (this && this.includes && (this.includes(".mp4") || this.includes(".webm") || this.includes(".ogv"))) {
                            //this.style.borderRadius = "50%";

                            //}
                            //
                            /*
						((app.cacheQueue.push(url),
                                1 == app.cacheQueue.length &&
                                app.cacheSkin(app.customSkinsCache, animated)),
                            (app.cacheQueue2.push(url),
                                1 == app.cacheQueue2.length &&
                                app.cacheSkin2(app.customSkinsCache)),
                            (animated == true  && app.cacheQueue3.push(url),
                                1 == app.cacheQueue3.length &&
                                app.cacheSkin3(app.customSkinsCache))
                            (animated == "fbSkin" && app.cacheQueue4.push(url),
                                1 == app.cacheQueue4.length &&
                                app.cacheSkin4(app.customSkinsCache))								
                        );*/
                        }

                    },
                    img[url].onerror = function() {
                        //console.log("error loading image: "+ url);
                        if (url && url.includes(window.EnvConfig.config_url)) {
                            url = "https://legendmod.ml/vanillaskins/" + url.split('/').pop(); //if CORS policy on miniclip images, use other source
                            //console.log("new destination is: " + url);
                            application.customSkinsMap[window.lastusednameforskin] = url;
                            application.loadSkin(img, url);
                            return url;

                        } else if (url && url.includes("https://legendmod.ml/vanillaskins/")) {
                            url = "https://legendmod.ml/nextvanillaskins/" + url.split('/').pop(); //if CORS policy on miniclip images, use other source
                            //console.log("new destination is: " + url);
                            application.customSkinsMap[window.lastusednameforskin] = url;
                            application.loadSkin(img, url);
                            return url;

                        }
                    };
                img[url].src = url;
            }
        },
        checkgraphics() {
            if (defaultSettings.graphics == "high") {
                application.graphics = 1
            } else if (defaultSettings.graphics == "medium") {
                application.graphics = 2
            } else if (defaultSettings.graphics == "low") {
                application.graphics = 4
            } else if (defaultSettings.graphics == "very_low") {
                application.graphics = 8
            }
        },
        cacheSkin(skinCache, animated) {
            //console.log(skinCache);  //////// return the image src
            if (0 != this.cacheQueue.length) {
                var e = this.cacheQueue.shift();
                if (e && !this.customSkinsCache[e + "_cached"]) {
                    var depth = 512;
                    this.checkgraphics();
                    if (application.graphics) {
                        depth = depth / application.graphics;
                    }
                    var i = document.createElement("canvas");
                    i.width = depth;
                    i.height = depth;
                    var $ = i.getContext("2d");
                    $.beginPath();
                    $.arc(depth / 2, depth / 2, depth / 2, 0, 2 * Math.PI, false);
                    $.clip();
                    try {
                        if (!animated) {
                            $.drawImage(this.customSkinsCache[e], 0, 0, depth, depth);
                        } else {
                            //console.log('was animated')
                            $.drawImage(this.customSkinsCache[e], 0, 0, this.customSkinsCache[e].width / 2, this.customSkinsCache[e].height, 0, 0, depth, depth);
                        }
                    } catch (error) {}
                    this.customSkinsCache[e + "_cached"] = new Image;
                    this.customSkinsCache[e + "_cached"].src = i.toDataURL();
                    i = null;
                    this.cacheSkin(this.customSkinsCache, animated);
                }
            }
        },
        cacheSkin2(skinCache) {
            if (0 != this.cacheQueue2.length) {
                var e = this.cacheQueue2.shift();
                if (e && !this.customSkinsCache[e + "_cached2"]) {
                    var depth = 64;
                    var i = document.createElement("canvas");
                    i.width = depth;
                    i.height = depth;
                    var $ = i.getContext("2d");
                    $.beginPath();
                    $.arc(depth / 2, depth / 2, depth / 2, 0, 2 * Math.PI, false);
                    $.clip();
                    try {
                        $.drawImage(this.customSkinsCache[e], 0, 0, depth, depth);
                    } catch (error) {}
                    this.customSkinsCache[e + "_cached2"] = new Image;
                    this.customSkinsCache[e + "_cached2"].src = i.toDataURL();
                    //this.customSkinsCache[e + "_cached"].src = i.toDataURL('image/jpeg', 0.1);
                    i = null;
                    this.cacheSkin2(this.customSkinsCache);
                }
            }
        },
        cacheSkin3(skinCache) {
            //console.log(skinCache);  //////// return the image src
            if (0 != this.cacheQueue3.length) {
                var e = this.cacheQueue3.shift();
                if (e && !this.customSkinsCache[e + "_cached3"]) {
                    var depth = 512;
                    this.checkgraphics();
                    if (application.graphics) {
                        depth = depth / application.graphics;
                    }
                    var i = document.createElement("canvas");
                    i.width = depth;
                    i.height = depth;
                    var $ = i.getContext("2d");
                    $.beginPath();
                    $.arc(depth / 2, depth / 2, depth / 2, 0, 2 * Math.PI, false);
                    $.clip();
                    try {
                        $.drawImage(this.customSkinsCache[e], this.customSkinsCache[e].width / 2, 0, this.customSkinsCache[e].width / 2, this.customSkinsCache[e].height, 0, 0, depth, depth);
                    } catch (error) {}
                    this.customSkinsCache[e + "_cached3"] = new Image;
                    this.customSkinsCache[e + "_cached3"].src = i.toDataURL();
                    i = null;
                    this.cacheSkin3(this.customSkinsCache);
                }
            }
        },
        cacheSkin4(skinCache) {
            //console.log(skinCache);  //////// return the image src
            if (0 != this.cacheQueue4.length) {
                var e = this.cacheQueue4.shift();
                if (e && !this.customSkinsCache[e + "_cached4"]) {
                    var depth = 512;
                    this.checkgraphics();
                    if (application.graphics) {
                        depth = depth / application.graphics;
                    }
                    var i = document.createElement("canvas");
                    i.width = depth;
                    i.height = depth;
                    var $ = i.getContext("2d");
                    $.beginPath();
                    $.arc(depth / 2, depth / 2, depth / 2, 0, 2 * Math.PI, false);
                    $.clip();
                    try {
                        $.drawImage(this.customSkinsCache[e], this.customSkinsCache[e].width / 2, 0, this.customSkinsCache[e].width / 2, this.customSkinsCache[e].height, 0, 0, depth, depth);
                    } catch (error) {}
                    this.customSkinsCache[e + "_cached4"] = new Image;
                    this.customSkinsCache[e + "_cached4"].src = i.toDataURL();
                    i = null;
                    this.cacheSkin4(this.customSkinsCache);
                }
            }
        },
        cacheSkinAnimated(skinCache, animated) {
            //console.log(skinCache);  //////// return the image src
            if (0 != this.cacheQueueSkinAnimated.length) {
                var e = this.cacheQueueSkinAnimated.shift();
                if (e && !this.customSkinsCache[e + "_cached" + skinCache]) {
                    var depth = 512;
                    this.checkgraphics();
                    if (application.graphics) {
                        depth = depth / application.graphics;
                    }
                    var i = document.createElement("canvas");
                    i.width = depth;
                    i.height = depth;
                    var $ = i.getContext("2d");
                    $.beginPath();
                    $.arc(depth / 2, depth / 2, depth / 2, 0, 2 * Math.PI, false);
                    $.clip();
                    try {
                        $.drawImage(this.customSkinsCache[e], 0, 0, depth, depth);
                    } catch (error) {}
                    this.customSkinsCache[e + "_cached" + skinCache] = new Image;
                    this.customSkinsCache[e + "_cached" + skinCache].src = i.toDataURL();
                    i = null;
                    this.cacheSkinAnimated(this.customSkinsCache, animated);
                }
            }
        },
        getCachedSkin(skinCache, skinMap) {
            if (skinCache[skinMap + '_cached3']) {
                var today = new Date();
                if (today.getSeconds() < 30) { //vanilla animated skins
                    return skinCache[skinMap + '_cached'] && skinCache[skinMap + '_cached'].complete && skinCache[skinMap + '_cached'].width ? skinCache[skinMap + '_cached'] : null;
                } else if (today.getSeconds() >= 30) {
                    return skinCache[skinMap + '_cached3'] && skinCache[skinMap + '_cached3'].complete && skinCache[skinMap + '_cached3'].width ? skinCache[skinMap + '_cached3'] : null;
                }
            }
            return skinCache[skinMap + '_cached'] && skinCache[skinMap + '_cached'].complete && skinCache[skinMap + '_cached'].width ? skinCache[skinMap + '_cached'] : null;

        },
        cacheCustomSkin(nick, color, skinUrl) {
            if (skinUrl) {
                var s = ':party' === this.gameMode ? nick + color : nick;
                //console.log("nick= " + nick);
                //console.log("color= " + color);
                if (s && (this.customSkinsMap[s] = skinUrl), this.customSkinsCache.hasOwnProperty(skinUrl)) return;
                this.loadSkin(this.customSkinsCache, skinUrl);
            }
        },
        checkSkinsMap(nick, color) {
            var mode = ':party' === this.gameMode ? nick + color : nick;
            //console.log(.customSkinsMap.hasOwnProperty(mode));
            return !!this.customSkinsMap.hasOwnProperty(mode);
        },
        getCustomSkin(nick, color) {
            //console.log("nick= " + nick);
            //console.log("color= " + color);				               
            if (':party' === this.gameMode && this.customSkinsMap[nick + "#000000"] && this.customSkinsMap[nick + "#000000"].includes("configs-web.agario.miniclippt.com/live/")) {
                //console.log('changed for',nick)
                color = "#000000";
            }
            if (!this.checkSkinsMap(nick, color)) return null;
            var mode = ':party' === this.gameMode ? nick + color : nick;
            return this.getCachedSkin(this.customSkinsCache, this.customSkinsMap[mode]);
        },
        calculateMapSector(t, xgh2, closeExpr = false) {
            if (!ogario.mapOffsetFixed) {
                return "";
            }
            /*
            if (closeExpr){
            	if (window.legendmod.vector[window.legendmod.vnr][0] || window.legendmod.vector[window.legendmod.vnr][1]){
            		closeExpr= closeExpr + legendmod.mapOffsetX
            		xgh2 = xgh2 + legendmod.mapOffsetY
            		//t = legendmod.untranslateX(t)
            		//t = legendmod.translateX(t - i.mapOffsetX)
            		//xgh2 = legendmod.untranslateY(xgh2)		
            		//xgh2 = legendmod.translateY(xgh2 - i.mapOffsetY)							
            	}
            }*/
            //var GearType = i.mapOffsetX + i.mapOffset;
            //var closingExpr = i.mapOffsetY + i.mapOffset;				
            var GearType = closeExpr ? ogario.mapOffsetX + LM.mapOffset : LM.mapOffset;
            var closingExpr = closeExpr ? ogario.mapOffsetY + LM.mapOffset : LM.mapOffset;
            //var n = Math.floor((xgh2 + closingExpr) / (ogario.mapSize / defaultSettings.sectorsY));
            var n = Math.floor((xgh2 + closingExpr) / (LM.mapSize / defaultSettings.sectorsY));
            var r = Math.floor((t + GearType) / (LM.mapSize / defaultSettings.sectorsX));
            //var r = Math.floor((t + GearType) / (ogario.mapSize / defaultSettings.sectorsX));
            window.calculateMapSector = n < 0 ? 0 : n >= defaultSettings.sectorsY ? defaultSettings.sectorsY - 1 : n;
            r = r < 0 ? 0 : r >= defaultSettings.sectorsX ? defaultSettings.sectorsX - 1 : r;
            String.fromCharCode(n + 65) + (r + 1);
            return n = n < 0 ? 0 : n >= defaultSettings.sectorsY ? defaultSettings.sectorsY - 1 : n, r = r < 0 ? 0 : r >= defaultSettings.sectorsX ? defaultSettings.sectorsX - 1 : r, String.fromCharCode(n + 65) + (r + 1);
        },
        shortMassFormat(value) {
            return value < 1000 ? value : Math.round(value / 100) / 10 + 'k';
        },
        updateDeathLocations(t, e) {
            if (ogario.mapOffsetFixed) {
                this.deathLocations.push({
                    "x": t + ogario.mapOffsetX,
                    "y": e + ogario.mapOffsetY
                });
                if (6 == this.deathLocations.length) {
                    this.deathLocations.shift();
                }
                this.lastDeath = this.deathLocations.length - 1;
            }
        },
        drawMiniMap() {
            if (ogario.mapOffsetFixed) {
                var t = defaultSettings.miniMapWidth;
                var e = defaultSettings.miniMapTop;
                var s = t + e;
                var o = t - 18;
                var a = e + 9.5;
                if (this.miniMap) {
                    this.miniMapCtx.clearRect(0, 0, t, s);
                } else {
                    this.miniMap = document.getElementById("minimap");
                    this.miniMapCtx = this.miniMap.getContext("2d");
                    this.miniMapCtx.ogarioCtx = true;
                    this.miniMap.width = t;
                    this.miniMap.height = s;
                }
                if (this.miniMap.width != t) {
                    this.miniMap.width = t;
                    this.miniMap.height = s;
                }
                //var n = o / ogario.mapSize;
                var n = o / LM.mapSize;
                var r = ogario.mapOffsetX + LM.mapOffset;
                var l = ogario.mapOffsetY + LM.mapOffset;
                if (this.drawSelectedCell(this.miniMapCtx),
                    //
                    this.w = ogario.playerX,
                    this.u = ogario.playerY,
                    /*
						this.w = window.legendmod.vector[window.legendmod.vnr][0] ? legendmod.translateX(i.playerX) : i.playerX,
						this.u = window.legendmod.vector[window.legendmod.vnr][1] ? legendmod.translateY(i.playerY) : i.playerY,  
*/
                    //						
                    //this.currentSector = this.calculateMapSector(i.playerX, i.playerY, true),
                    this.currentSector = this.calculateMapSector(this.w, this.u, true),

                    this.miniMapCtx.font = defaultSettings.miniMapFontWeight + ' ' + (e - 6) + 'px ' + defaultSettings.miniMapFontFamily,
                    this.miniMapCtx.fillStyle = defaultSettings.miniMapMyCellColor,
                    this.miniMapCtx.globalAlpha = 1,
                    this.miniMapCtx.fillStyle = defaultSettings.miniMapSectorColor,
                    this.miniMapCtx.fillText(this.currentSector, defaultSettings.miniMapWidth - 32, e),
                    //this.miniMapCtx.font = defaultSettings.miniMapFontWeight + " " + (e - 4) + "px " + defaultSettings.miniMapFontFamily,
                    //this.miniMapCtx.fillStyle = defaultSettings.miniMapSectorColor,
                    //this.miniMapCtx.fillText(this.currentSector, 10, e),
                    this.miniMapSectors || this.drawMiniMapSectors(defaultSettings.sectorsX, defaultSettings.sectorsY, o, s, a),
                    this.miniMapCtx.save(),
                    this.miniMapCtx.translate(9.5, a), ":battleroyale" === this.gameMode && drawRender && drawRender.drawBattleAreaOnMinimap(this.miniMapCtx, o, o, n, r, l),
                    defaultmapsettings.showMiniMapGhostCells) {
                    var h = ogario.ghostCells;
                    this.miniMapCtx.beginPath();
                    var c = 0;
                    for (; c < h.length; c++) {
                        if (!h[c].inView) {
                            var u = ~~((h[c].x + r) * n);
                            var d = ~~((h[c].y + l) * n);
                            this.miniMapCtx.moveTo(u, d);
                            this.miniMapCtx.arc(u, d, ~~(h[c].size * n), 0, this.pi2, false);
                        }
                    }
                    this.miniMapCtx.fillStyle = defaultSettings.miniMapGhostCellsColor;
                    this.miniMapCtx.globalAlpha = defaultSettings.miniMapGhostCellsAlpha;
                    this.miniMapCtx.shadowColor = defaultSettings.miniMapGhostCellsColor;
                    this.miniMapCtx.shadowBlur = 10;
                    this.miniMapCtx.shadowOffsetX = 0;
                    this.miniMapCtx.shadowOffsetY = 0;
                    this.miniMapCtx.fill();
                    this.miniMapCtx.globalAlpha = 1;
                    this.miniMapCtx.shadowBlur = 0;
                }
                if (defaultmapsettings.showMiniMapGuides) {
                    u = Math.round((ogario.playerX + r) * n);
                    d = Math.round((ogario.playerY + l) * n);
                    this.miniMapCtx.lineWidth = 1;
                    this.miniMapCtx.strokeStyle = defaultSettings.miniMapGuidesColor;
                    this.miniMapCtx.beginPath();
                    this.miniMapCtx.moveTo(u, 0);
                    this.miniMapCtx.lineTo(u, o - 1);
                    this.miniMapCtx.moveTo(0, d);
                    this.miniMapCtx.lineTo(o - 1, d);
                    this.miniMapCtx.stroke();
                }
                if (defaultmapsettings.showExtraMiniMapGuides) {
                    u = Math.round((ogario.playerX + r) * n);
                    d = Math.round((ogario.playerY + l) * n);

                    //draw the yellow on minimap
                    this.miniMapCtx.beginPath();
                    this.miniMapCtx.lineWidth = "1";
                    this.miniMapCtx.strokeStyle = defaultSettings.miniMapSectorColor;
                    var miniax = legendmod.canvasWidth / (legendmod.mapMaxX - legendmod.mapMinX) / legendmod.viewScale; //CORRECT
                    var miniay = legendmod.canvasHeight / (legendmod.mapMaxY - legendmod.mapMinY) / legendmod.viewScale; //CORRECT
                    var minidaxx = application.miniMapSectors.width * miniax;
                    var minidayy = application.miniMapSectors.width * miniay;

                    var fixminidaxx = u - (minidaxx / 2);
                    var fixminidayy = d - (minidayy / 2);

                    //if (fixminidaxx<0){ fixminidaxx=0; }
                    //if (fixminidayy<0){ fixminidayy=0; }
                    this.miniMapCtx.rect(fixminidaxx, fixminidayy, minidaxx, minidayy);
                    this.miniMapCtx.stroke();

                }
                //
                if (application.top5) {
                    for (var temp = 0; temp < application.top5.length; temp++) {
                        if (application.top5[temp].nick == LM.arrowFB[0].nick) {
                            LM.arrowFB[0].isIncluded = true
                        }
                    }
                }

                if (LM.arrowFB[0].visible && !LM.arrowFB[0].isIncluded) { //Yahnych
                    this.miniMapCtx.save()
                    this.miniMapCtx.beginPath();
                    this.miniMapCtx.arc((LM.arrowFB[0].x + r) * n, (LM.arrowFB[0].y + l) * n, defaultSettings.miniMapMyCellSize, 0, this.pi2, false);
                    this.miniMapCtx.closePath();
                    this.miniMapCtx.lineWidth = defaultSettings.miniMapMyCellStrokeSize;
                    this.miniMapCtx.strokeStyle = 'white';
                    this.miniMapCtx.stroke();
                    this.miniMapCtx.fillStyle = 'blue';
                    this.miniMapCtx.fill();
                    //if (LM.arrowFB[0].nick.length > 0) {
                    this.miniMapCtx.font = `${defaultSettings.miniMapNickFontWeight} ${defaultSettings.miniMapNickSize}px ${defaultSettings.miniMapNickFontFamily}`;
                    this.miniMapCtx.textAlign = 'center';
                    this.miniMapCtx.textBaseline = "bottom";
                    if (defaultSettings.miniMapNickStrokeSize > 0) {
                        this.miniMapCtx.lineWidth = defaultSettings.miniMapNickStrokeSize;
                        this.miniMapCtx.strokeStyle = defaultSettings.miniMapNickStrokeColor;
                        this.miniMapCtx.strokeText('🔹' + LM.arrowFB[0].nick + '🔹', (LM.arrowFB[0].x + r) * n, (LM.arrowFB[0].y + l) * n - (defaultSettings.miniMapTeammatesSize * 2 + 2.5));
                    }
                    this.miniMapCtx.fillStyle = defaultSettings.miniMapNickColor;
                    this.miniMapCtx.fillText('🔹' + LM.arrowFB[0].nick + '🔹', (LM.arrowFB[0].x + r) * n, (LM.arrowFB[0].y + l) * n - (defaultSettings.miniMapTeammatesSize * 2 + 2.5));
                    this.miniMapCtx.restore();
                    //}
                }
                //				
                if (this.miniMapCtx.beginPath(),
                    this.miniMapCtx.arc((ogario.playerX + r) * n, (ogario.playerY + l) * n,
                        defaultSettings.miniMapMyCellSize, 0, this.pi2, false),
                    this.miniMapCtx.closePath(),
                    defaultSettings.miniMapMyCellStrokeSize > 0 && (this.miniMapCtx.lineWidth = defaultSettings.miniMapMyCellStrokeSize,
                        this.miniMapCtx.strokeStyle = defaultSettings.miniMapMyCellStrokeColor,
                        this.miniMapCtx.stroke()),
                    this.miniMapCtx.fillStyle = defaultSettings.miniMapMyCellColor,
                    this.miniMapCtx.fill(),
                    this.teamPlayers.length) {
                    c = 0;
                    for (; c < this.teamPlayers.length; c++) {
                        this.teamPlayers[c].drawPosition(this.miniMapCtx, LM.mapOffset, n, this.privateMiniMap, this.targetID, application.teamPlayers[c].color);
                    }
                }
                if (this.deathLocations.length > 0) {
                    u = Math.round((this.deathLocations[this.lastDeath].x + LM.mapOffset) * n);
                    d = Math.round((this.deathLocations[this.lastDeath].y + LM.mapOffset) * n);
                    var f = Math.max(defaultSettings.miniMapMyCellSize - 2, 4);
                    this.miniMapCtx.lineWidth = 1;
                    this.miniMapCtx.strokeStyle = this.deathLocations.length - 1 == this.lastDeath ? defaultSettings.miniMapDeathLocationColor : "#FFFFFF";
                    this.miniMapCtx.beginPath();
                    this.miniMapCtx.moveTo(u - f, d);
                    this.miniMapCtx.lineTo(u + f, d);
                    this.miniMapCtx.moveTo(u, d - f);
                    this.miniMapCtx.lineTo(u, d + f);
                    this.miniMapCtx.stroke();
                }
                this.miniMapCtx.restore();
            }
        },
        drawMiniMapSectors(x, y, size, height, scale) {
            this.miniMapSectors = document.getElementById('minimap-sectors');
            const ctx = this.miniMapSectors.getContext('2d');
            ctx.ogarioCtx = true;
            this.miniMapSectors.width = size;
            this.miniMapSectors.height = height;
            ctx.fillStyle = '#FFFFFF';
            this.dTok(ctx, size - 1);
            drawRender.drawSectors(ctx, ogario.mapOffsetFixed, x, y, 0.5, scale, size - 0.5, height - 9.5, defaultSettings.miniMapSectorsColor, defaultSettings.miniMapSectorsColor, 1, false);
        },
        resetMiniMapSectors() {
            this.miniMapSectors = null;
        },
        drawSelectedCell(ctx) {
            if (ogario.play && ogario.playerSplitCells > 1 && (defaultmapsettings.splitRange || defaultmapsettings.oppColors || defaultmapsettings.oppRings || defaultmapsettings.showStatsSTE)) {
                ctx.fillStyle = '#FFFFFF';
                ctx.globalAlpha = this.selectBiggestCell ? 0.6 : 0.3;
                ctx.beginPath();
                ctx.arc(48, 15, 6, 0, this.pi2, false);
                ctx.closePath();
                ctx.fill();
                ctx.globalAlpha = this.selectBiggestCell ? 0.3 : 0.6;
                ctx.beginPath();
                ctx.arc(60, 15, 4, 0, this.pi2, false);
                ctx.closePath();
                ctx.fill();
            }
        },
        dTok(ctx, size) {
            ctx.font = defaultSettings.miniMapFontWeight + ' ' + (defaultSettings.miniMapTop - 6) + 'px ' + defaultSettings.miniMapFontFamily;
            ctx.textAlign = 'right';
            ctx.textBaseline = 'top';
            //ctx.fillText(minimapText, size, 7);
        },
        /*            drawTeammatesInd(ctx, e, i, s) {
                        this.indicator && ctx.drawImage(this.indicator, e - 45, i - s - 90);
                    }, 
        drawCellInfo(ctx, e, s, o, a, n, r, l, h, c, u, d) {
            //if (!n && !h && (ctx.globalAlpha = i.globalAlpha, defaultmapsettings.teammatesInd && d && !l && a <= 200 && this.drawTeammatesInd(ctx, s, o, a), !defaultmapsettings.noNames || defaultmapsettings.showMass)) {
            if (!n && !h && (ctx.globalAlpha = ogario.globalAlpha, defaultmapsettings.teammatesInd && d && !l && a <= 200 && drawRender.drawTeammatesInd(ctx, s, o, a), !defaultmapsettings.noNames || defaultmapsettings.showMass)) {
                var f = false;
                if (l || r || !(f = this.setAutoHideCellInfo(a)) || !defaultmapsettings.autoHideNames || !defaultmapsettings.autoHideMass) {
                    var m = null;
                    if (!this.cells.hasOwnProperty(e)) return (m = new ogarbasicassembly(s, o, r, l, defaultmapsettings.shortMass, defaultmapsettings.virMassShots)).setMass(a), m.setNick(c), void(this.cells[e] = m);
                    (m = this.cells[e]).update(s, o, a, r, l, c),
                        m.setDrawing(defaultmapsettings.optimizedNames, defaultmapsettings.optimizedMass, defaultmapsettings.shortMass, defaultmapsettings.virMassShots, defaultmapsettings.namesStroke, defaultmapsettings.massStroke),
                        m.setDrawingScale(ogario.viewScale, defaultSettings.namesScale, defaultSettings.massScale, defaultSettings.virMassScale, defaultSettings.strokeScale),
                        ctx.globalAlpha = defaultSettings.textAlpha, defaultmapsettings.noNames || f && defaultmapsettings.autoHideNames || l && defaultmapsettings.hideMyName || d && defaultmapsettings.hideTeammatesNames || m.drawNick(ctx, defaultSettings.namesColor, defaultSettings.namesFontFamily, defaultSettings.namesFontWeight, defaultSettings.namesStrokeColor),
                        !defaultmapsettings.showMass || f && defaultmapsettings.autoHideMass || l && defaultmapsettings.hideMyMass || defaultmapsettings.hideEnemiesMass && !l && !r || m.drawMass(ctx, defaultSettings.massColor, defaultSettings.massFontFamily, defaultSettings.massFontWeight, defaultSettings.massStrokeColor) && (window.ExternalScripts && !window.legendmod5.optimizedMass && m.drawMerge(ctx, defaultSettings.massColor, defaultSettings.massFontFamily, defaultSettings.massFontWeight, defaultSettings.massStrokeColor));
                }
            }
        },*/
        setVirusColor(size) {
            const floor = Math.floor(size * size / 100);
            if (floor > 183) {
                return '#C80000';
            }
            return defaultSettings.virusColor;
        },
        setVirusStrokeColor(size) {
            if (ogario.play && ogario.playerMaxMass != 0) {
                const floor = Math.floor(size * size / 100);
                const biggestCell = floor / (this.selectBiggestCell ? ogario.playerMaxMass : ogario.playerMinMass);
                if (biggestCell > 0.76) {
                    return '#FFDC00';
                }
                return '#C80000';
            }
            return defaultSettings.virusStrokeColor;
        },
        setAutoHideCellInfo(t) {
            return t <= 40 || ogario.viewScale < 0.5 && t < 550 && t < 25 / ogario.viewScale;
        },
        setParty() {
            let value = $('#party-token').val();
            this.gameMode = ogario.gameMode = $('#gamemode').val();
            this.setQuest();
            if (this.gameMode !== ':party' || !value) {
                return;
            }
            let newValue = value;
            if (value.indexOf('#') != -1) {
                value = value.split('#');
                newValue = value[1];
            }
            if (this.partyToken !== newValue) {
                this.partyToken = newValue;
                this.flushSkinsMap();
                this.flushChatData();
                this.cancelTargeting();
            }
        },
        createParty() {
            $('#create-party-btn').click();
        },
        joinParty() {
            const value = $('#party-token').val();
            if (!value) {
                return;
            }
            $('#pre-join-party-btn').click();
            $('.party-token').val(value);
            $('#join-party-btn').click();
        },
        leaveParty() {
            $('#party-token, .party-token').val('');
            $('#leave-party-btn').click();
        },
        closeParty() {
            $('#party-token, .party-token').val('');
            $('.party-icon-back').click();
        },
        flushData() {
            this.flushPartyData();
            this.flushSkinsMap();
            this.flushChatData();
            this.cancelTargeting();
            ogario.play = false;
            ogario.playerColor = null;
        },
        flushPartyData() {
            this.teamPlayers = [];
            this.parties = [];
            this.lastSentNick = '';
            this.lastSentClanTag = null;
            this.lastSentSkinURL = '';
            this.lastSentCustomColor = '';
            this.lastSentPartyToken = '';
            this.lastSentServerToken = '';
        },
        flushCells() {
            this.cells = {};
        },
        flushSkinsMap() {
            //
            //this.lastIP = localStorage.getItem("lastIP");
            //if (RecordedArenasSpecifications[this.lastIP]) window.RecordedArenasSpecifications[this.lastIP].push(this.customSkinsMap)
            //
            //if (window.temporaryRecordedProtocol2 && RecordedArenasSpecifications[window.temporaryRecordedProtocol2]) window.RecordedArenasSpecifications[window.temporaryRecordedProtocol2].push(JSON.stringify(this.customSkinsMap))
            if (window.temporaryRecordedProtocol && RecordedArenasSpecifications[window.temporaryRecordedProtocol]) window.RecordedArenasSpecifications[window.temporaryRecordedProtocol].push(JSON.stringify(this.customSkinsMap))
            this.customSkinsMap = {};
        },
        flushChatData() {
            this.chatUsers = {};
        },
        getWS(ws) {
            if (ws) {
                this.ws = ws;
                this.createServerToken();
                this.updateServerInfo();
                if (-1 == this.ws.indexOf('agar.io')) {
                    // fix disconnect?
                    //this.closeConnection();
                }
            }
        },
        recreateWS(token) {
            if (!token) return null;
            this.tokenNeedToBtoa = false
            var text = null;
            if (token.includes("replay")) {
                $('#region').val("Private")
                master.setRegion("Private");
                deleteGamemode(true);
                text = "wss://imsolo.pro.replay:2000"
                //core.connect("wss://imsolo.pro.replay:2000")
                window.replayToken = token
                var specialReplay
                if (token.includes("replay^")) {
                    specialReplay = token.split('^')[1]
                }

                setTimeout(function() {
                    $('#server-token').val(window.replayToken)
                    window.replayToken = null
                    //console.log("replay")
                    playReplayLM(specialReplay)

                }, 500);
                //return null
            } else if (/^[a-zA-Z0-9=+\/]{12,}$/.test(token)) {
                //var atobToken = atob(token);
                var atobToken = token;

                //ccse
                if (!text && atobToken.search(/agar\.io/) == -1) {
                    text = 'wss://' + atobToken;
                    //console.log("recreateWS case 1:" + text);
                    return text;
                }

                if (/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:[0-9]{1,4}/.test(atobToken)) {
                    text = 'wss://ip-' + atobToken.replace(/\./g, '-').replace(':', '.agar.io:');
                    //console.log("recreateWS case 2:" + text);
                }
            } else if (!text && /^[a-z0-9]{5,}$/.test(token)) {
                //console.log("recreateWS case 3:" + text);
                //text = 'wss://live-arena-' + token + '.tech.agar.io:80';
                //text = 'wss://live-arena-' + token + '.agar.io:80';
                text = 'wss://live-arena-' + token + '.agar.io:443'
            } else if (!token.includes("s://")) {
                this.tokenNeedToBtoa = true
                text = 'wss://' + token; //private servers
            } else {
                this.tokenNeedToBtoa = true
                text = token; //private servers
            }
            return text;
        },
        createServerToken() {
            this.tokenNeedToBtoa = false
            var matchOld = this.ws.match(/ip-\d+/);
            //var matchNew = this.ws.match(/live-arena-([\w\d]+)/);
            var matchNew = this.ws.match(/live-arena-([\w\d]+(\.tech)?)\.agar\.io/);
            var matchNew2 = this.ws.match(/livec-arena-([\w\d]+(\.tech)?)\.agar\.io\:[\w\d]+/); //original private servers
            var text = null;
            if (matchOld) {
                matchOld = this.ws.replace('.agar.io', '').replace(/-/g, '.').match(/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:[0-9]{1,4}/);
                //matchOld = this.ws.replace('.tech.agar.io', '').replace(/-/g, '.').match(/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:[0-9]{1,4}/);
                if (matchOld) {
                    this.serverIP = matchOld[0];
                    text = this.serverIP;
                    //text = btoa(this.serverIP);
                }
            }
            //ccse
            if (this.ws.search(/wss?:\/\//) > -1 && this.ws.search(/agar\.io/) == -1) {
                text = this.ws.match(/wss?:\/\/(.+)/)[1]
                this.tokenNeedToBtoa = true
                this.serverIP = text;
                //text = btoa(text);
                //console.log("createServerToken case 1:" + text);
            }

            if (!text && matchNew) {
                this.serverArena = matchNew[1];
                text = this.serverArena;
                //console.log("createServerToken case 2:" + text);
            }
            if (!text && matchNew2) {
                this.serverArena = matchNew2[0];
                text = this.serverArena;
                //console.log("createServerToken case 2:" + text);
            }
            if (text) {
                if (this.serverToken !== text) {
                    this.serverToken = text;
                    this.flushData();
                    this.flushCells();
                }
                this.partyToken = '';
                var matchPartyId = this.ws.match(/party_id=([A-Z0-9]{6})/);
                if (matchPartyId) {
                    this.partyToken = matchPartyId[1];
                    changeUrl('/#' + window.encodeURIComponent(this.partyToken));
                }
            }
        },
        updateServerInfo() {
            $('#server-ws').val(this.ws),
                $('#server-token').val(this.serverToken),
                $('#party-token, .party-token').val(this.partyToken);
        },
        gameServerConnect(ws) {
            if (!ws) {
                return;
            }
            this.skipServerData = true
            window.core && window.core.connect && window.core.connect(ws);
        },
        gameServerReconnect() {

            /*if (window.MC && window.MC.reconnect) {
                window.MC.reconnect();
                return;
            }*/
            //if ()
            if (!legendmod.integrity) {
                if ($('#gamemode option:selected').next().length > 0) {
                    $('#gamemode option:selected').next().prop('selected', 'selected').change();
                } else {
                    $('#gamemode option:first').prop('selected', 'selected').change();
                }
                //$('#gamemode option[value=34]').prop('selected', 'selected').change();
            } else if (legendmod.integrity) {
                if (window.master && window.master.reconnect) window.master.reconnect();
            }
        },
        gameServerJoin(token) {
            const ws = this.recreateWS(token);
            if (ws) {
                this.skipServerData = true;
                this.gameServerConnect(ws);
            }
        },
        connect() {
            this.closeConnection();
            this.flushData();
            this.setParty();
            //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Connecting to ogario socket'),
            if (this.privateMode && this.privateIP) {
                this.socket = new WebSocket(this.privateIP);
            } else {
                this.socket = new WebSocket(this.publicIP);
            }
            this.socket.ogarioWS = true;
            this.socket.binaryType = 'arraybuffer';
            var app = this;
            this.socket.onopen = () => {
                //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Ogario socket open:', application.publicIP);
                var buf = app.createView(3);
                buf.setUint8(0, 0);
                //console.log("socket",this.socket.url)
                //console.log("window.wsinjected",window.wsinjected)
                //if (!window.wsinjected) { //if delta socket injected
                    buf.setUint16(1, 401, true);
                //} else {
                //    buf.setUint16(1, 404, true);
                //}
                app.sendBuffer(buf);

                buf.setUint8(0, 5);
                buf.setUint16(1, 20, true);
                app.sendBuffer(buf);

                app.sendPartyData();
            }
            this.socket.onmessage = function(buf) {
                app.handleMessage(buf);
            }
            this.socket.onclose = function(buf) {
                //app.flushData();
                //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Socket close', buf);
            }
            this.socket.onerror = function(buf) {
                //app.flushData();
                console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Socket error', buf);
                window.noOgarioSocket = true;
            };

        },
        Socket3connect(srv) {
            //if (window.noOgarioSocket && typeof Socket3enabler !== 'undefined' && typeof Socket3enabler === 'function') {
            //setTimeout(function() {
            //Socket3enabler(window.legendmod.ws);
            if (Socket3) {
                Socket3.closeAndOpen();
            } else {
                Socket3enabler(window.legendmod.ws);
            }
            //}, 1000);
            //}
        },
        //Sonia6			
        SLGconnect(srv) {
            if (window.SLG3NumberTries < 2) {
                if (window.SLGconnected == null) {
                    window.SLGconnected = true; //do this only once	
                    this.SLGconnect2(srv);
                } else {
                    if (window.SLGsocket) {
                        window.SLGsocket.closeAndOpen();
                    }
                }
            }
        },
        SLGconnect2(srv) {
            this.closeSLGConnection();
            //var room = ogarcopythelb.clanTag + "-" + srv.match("-([A-Za-z0-9]{6,7})\.")[1];
            var room = $("#server-token").val();
            this.roomc = ogarcopythelb.clanTag;
            //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Connecting to SLG:', this.room);				
            //window.SLGsocket = new WebSocket("wss://connect.websocket.in/3Q-SoniaSLG_453dsV?room_id=" + this.room);
            window.SLGsocket = new WebSocket("wss://cloud.achex.ca/JIMBOY3200" + room);
            window.SLGsocket.binaryType = 'arraybuffer';
            app = this;
            window.SLGsocket.onopen = function() {
                window.SLG3NumberTries = 0;
                //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' SLG socket open:', room);
                //
                window.SLGsocket.send(JSON.stringify({
                    "auth": "JIM2" + customLMID,
                    //"auth": "JIM2" + application.playerID,
                    "password": "legendmod2"
                }));
                window.SLGsocket.send(JSON.stringify({
                    //"joinHub": "legendmod2"
                    "joinHub": $("#server-token").val()
                }));
                //					
            }
            window.SLGsocket.onmessage = function(e) {
                //console.log(e)
                application.handleSLGMessage(e);
            }
            window.SLGsocket.onclose = function(e) {
                //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' SLG socket close');
                //setTimeout(function() {
                if (window.SLG3NumberTries < 2) {
                    application.SLGconnect2(legendmod.ws)
                }
                //}, 1000)					
            }
            window.SLGsocket.onerror = function(e) {
                //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' SLG socket error', e);	
                window.SLG3NumberTries++;
                //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' SLG socket error');
            };
            window.SLGsocket.closeAndOpen = function(e) {
                window.SLGsocket.onclose = function(e) {
                    //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Previous SLG socket closed async');
                }
                if (window.SLG3NumberTries < 2) {
                    application.SLGconnect2(legendmod.ws)
                }
            };
        },
        closeConnection() {
            if (this.socket) {
                this.socket.onmessage = null;
                try {
                    this.socket.close();
                } catch (ogarcloseconlabel) {}
                this.socket = null;
            }
            //Sonia4
            if (window.SLGsocket) {
                window.SLGsocket.onmessage = null;
                try {
                    window.SLGsocket.close();
                } catch (ogarcloseconlabel) {}
                window.SLGsocket = null;
            }
            if (window.Socket3) {
                window.Socket3.onmessage = null;
                try {
                    window.Socket3.close();
                } catch (ogarcloseconlabel) {}
                window.Socket3 = null;
            }
        },
        //Sonia6
        closeSLGConnection() {
            if (window.SLGsocket) {
                window.SLGsocket.onmessage = null;
                try {
                    window.SLGsocket.close();
                } catch (ogarcloseconlabel) {}
                window.SLGsocket = null;
            }
        },
        reconnect() {
            this.setParty();
            var app = this;
            setTimeout(function() {
                app.connect();
            }, 1000);
        },
        switchServerMode() {
            if (this.privateIP) {
                this.privateMode = !this.privateMode;
                if (this.isSocketOpen()) {
                    this.closeConnection();
                    toastr.error("Zamkni\u0119to po\u0142\u0105czenie z serwerem!");
                }
                if (this.privateMode) {
                    toastr.info("Prze\u0142\u0105czono na serwer prywatny!");
                    $(".party-panel").show();
                } else {
                    toastr.info("Prze\u0142\u0105czono na serwer publiczny!");
                    $("#active-parties").empty();
                    $(".party-panel").hide();
                }
                this.onJoin();
                if (ogario.play) {
                    this.onPlayerSpawn();
                }
            }
        },
        isSocketOpen() {
            return null !== this.socket && this.socket.readyState === this.socket.OPEN;
        },
        //Sonia6 Below
        isSLGSocketOpen() {
            var state = false;
            if (window.SLGsocket) {
                state = window.SLGsocket.readyState === window.SLGsocket.OPEN;
            }
            return state;
        },
        writeUint32(data, value) {
            for (; !![];) {
                if ((value & -128) == 0) {
                    data.push(value);
                    return;
                } else {
                    data.push(value & 127 | 128);
                    value = value >>> 7;
                }
            }
        },
        createView(value) {
            return new DataView(new ArrayBuffer(value));
        },
        strToBuff(offset, str) {
            var view = this.createView(1 + 2 * str.length);
            view.setUint8(0, offset);
            for (var length = 0; length < str.length; length++) view.setUint16(1 + 2 * length, str.charCodeAt(length), true);
            return view;
        },
        sendBuffer(value) {
            this.socket.send(value.buffer);
        },
        //Sonia4
        sendSLG(i, t) {
            if (this.isSLGSocketOpen()) {
                //if (ogarcopythelb.clanTag != this.roomc) {
                //console.log("Sending failed. Reconnecting required..")
                //this.SLGconnect(window.legendmod.ws);
                //if (window.SLGsocket) {
                //window.SLGsocket.closeAndOpen();
                //}
                //return;
                //}
                var s = this.packSLG(i);
                if (s != null) {
                    //window.SLGsocket['send'](s + t);
                    var temp = s + t;
                    console.log(temp);
                    SLGsocket.send(JSON.stringify({
                        //"toH": "legendmod2",
                        "toH": $("#server-token").val(),
                        "msg": temp
                    }));
                }
            }
        },
        handleMessage(message) {
            this.readMessage(new DataView(message.data));
        },
        //Sonia4
        handleSLGMessage(message) {
            //this['SLGHandler'](t.data);
            var temp = message.data;
            //console.log(message.data);
            temp = JSON.parse(temp);
            //if (temp){
            //this['SLGHandler'](temp.msg);     
            this.SLGSimpleHandler(temp.msg);
            //}
        },
        readMessage(message) {
            switch (message.getUint8(0)) {
                case 0:
                    this.playerID = message.getUint32(1, true);
                    //this.playerID = message.getUint16(1, true);
                    break;
                case 1:
                    this.sendPlayerUpdate();
                    break;
                case 20:
                    this.updateTeamPlayer(message);
                    break;
                case 30:
                    this.updateTeamPlayerPosition(message);
                    break;
                case 96:
                    break;
                case 100:
                    this.readChatMessage(message);
            }
        },
        //Sonia4
        SLGHandler(message) {
            var packet = this.unpackSLG(message);
            if (packet == null) return;
            switch (message.charAt(0)) {
                case "R":
                    this.getSuperLegendSDATA(packet);
                    break;
                case "Q":
                    //this.getSLGQinfo(packet);
                    break;
            }
        },
        SLGSimpleHandler(message) {
            //console.log("recieve", message);
            if (message == null) {
                return;
            } else {
                var ids = window.decodeURIComponent(escape(message.t));
                //console.log(ids)
                //var id = this.checkPlayerID(ids);
                var id = this.checkPlayerNick(ids);
                if (null != id) {
                    //console.log("id found", id, s) ;

                    this.teamPlayers[id].lbgpi = parseInt(message.s);
                    //if (this.top5[id]){
                    //this.top5[id].lbgpi = parseInt(lbgpi); //
                    //}

                }
            }
        },
        //Sonia4
        packSLG(message) {
            message += this.packInt(this.playerID, 4);
            return message;
        },
        //Sonia4
        unpackSLG(message) {
            message = message.slice(1);
            return message;
        },
        //Sonia4
        getSLGID(message) {
            message = message.slice(0, 2)
            return this.unpackInt(message);
        },
        //Sonia4
        getSLGVal(message) {
            message = message.slice(2);
            return message;
        },
        sendPlayerState(state) {
            if (this.isSocketOpen()) {
                var view = this.createView(1);
                view.setUint8(0, state);
                this.sendBuffer(view);
            }
        },
        sendPlayerSpawn() {
            this.sendPlayerState(1);
        },
        sendPlayerDeath() {
            this.sendPlayerState(2);
        },
        sendPlayerJoin() {
            this.sendPlayerState(3);
        },
        sendPlayerData(offset, name, str) {
            if (this[name] !== null && this[name] === str) {
                return;
            }
            if (this.isSocketOpen()) {
                this.sendBuffer(this.strToBuff(offset, str));
                this[name] = str;
            }
        },
        sendPlayerNick() {
            this.sendPlayerData(10, 'lastSentNick', ogarcopythelb.nick);
        },
        sendPlayerClanTag() {
            this.sendPlayerData(11, 'lastSentClanTag', ogarcopythelb.clanTag);
        },
        sendPlayerSkinURL() {
            this.sendPlayerData(12, 'lastSentSkinURL', ogarcopythelb.skinURL);
        },
        sendPlayerCustomColorn() {
            this.sendPlayerData(13, 'lastSentCustomColor', ogarcopythelb.color);
        },
        sendPlayerColor() {
            if (this.isSocketOpen() && ogario.playerColor) {
                this.sendBuffer(this.strToBuff(14, ogario.playerColor));
            }
        },
        sendPartyToken() {
            this.setParty();
            this.sendPlayerData(15, 'lastSentPartyToken', this.partyToken);
        },
        sendServerToken() {
            var serverToken = this.tokenNeedToBtoa ? btoa(this.serverToken) : this.serverToken
            this.sendPlayerData(16, 'lastSentServerToken', serverToken);
        },
        sendServerJoin() {
            this.sendServerToken();
            this.sendPlayerJoin();
        },
        sendServerRegion() {
            if (this.region) {
                var region = this.region.split('-');
                if (this.isSocketOpen()) {
                    this.sendBuffer(this.strToBuff(17, region[0]));
                }
            }
        },
        sendServerGameMode() {
            var gamemode = 'FFA';
            switch (this.gameMode) {
                case ':battleroyale':
                    gamemode = 'BTR';
                    break;
                case ':teams':
                    gamemode = 'TMS';
                    break;
                case ':experimental':
                    gamemode = 'EXP';
                    break;
                case ':party':
                    gamemode = 'PTY';
            }
            if (this.isSocketOpen()) {
                this.sendBuffer(this.strToBuff(18, gamemode));
            }
        },
        sendServerData() {
            if (this.skipServerData) {
                this.skipServerData = false;
                return;
            }
            this.region = $('#region').val();
            this.gameMode = $('#gamemode').val();
            this.sendServerRegion();
            this.sendServerGameMode();
        },
        sendPartyData() {
            this.sendPlayerClanTag();
			
            this.sendPartyToken();
            this.sendServerToken();
            this.sendPlayerNick();
            //
            if (!$("#server-token").val().includes("replay") && window.RecordedArenasSpecifications[window.temporaryRecordedProtocol]) {
                window.RecordedArenasSpecifications[window.temporaryRecordedProtocol][3] = application.lastSentNick
            }
            //
        },
        sendPlayerUpdate() {
            if (this.isSocketOpen() && ogario.play && this.playerID && ogario.playerColor) {
                function encode(str) {
                    for (let length = 0; length < str.length; length++) {
                        view.setUint16(offset, str.charCodeAt(length), true);
                        offset += 2;
                    }
                    view.setUint16(offset, 0, true);
                    offset += 2;
                }
                let text = 41;
                text += ogarcopythelb.nick.length * 2;
                text += ogarcopythelb.skinURL.length * 2;
                var view = this.createView(text);
                view.setUint8(0, 20);
                view.setUint32(1, this.playerID, true);
                var offset = 5;
                encode(ogarcopythelb.nick);
                encode(ogarcopythelb.skinURL);
                encode(ogarcopythelb.color);
                encode(ogario.playerColor);
                this.sendBuffer(view);
            }
        },
        sendPlayerPosition() {
            if (this.isSocketOpen() && (ogario.play || LM.playerCellsMulti.length) && this.playerID) {
                const view = this.createView(17);
                view.setUint8(0, 30);
                view.setUint32(1, this.playerID, true);

                view.setInt32(5, this.getPlayerX(), true);
                view.setInt32(9, this.getPlayerY(), true);

                if (typeof ogario.playerMass !== 'undefined') {
                    view.setUint32(13, ogario.playerMass, true);
                } else {
                    view.setUint32(13, this.playerMass, true);
                }
                this.sendBuffer(view);
            }
        },
        packInt(x, m) {
            var s = "";
            if (m == 2) {
                s += String.fromCharCode(x)
            } else {
                var p = x / Math.pow(2, 16);
                var r = x % Math.pow(2, 16);
                s += String.fromCharCode(Math.floor(p));
                s += String.fromCharCode(Math.floor(r));
            }
            return s;
        },
        packFloat(x, m) {
            if (m == 2) {
                x = Math.floor(x * 100000);
            } else {
                x = Math.floor(x * 1000000000);
            }
            return this.packInt(x, m);
        },
        unpackInt(s) {
            var x = 0;
            if (s.length == 1) {
                x += s.charCodeAt(0);
            } else {
                x += s.charCodeAt(0) * Math.pow(2, 16);
                x += s.charCodeAt(1);
            }
            return x;
        },
        unpackFloat(s) {
            var x = this.unpackInt(s);
            if (s.length == 1) {
                x = x / 100000;
            } else {
                x = x / 1000000000;
            }
            return x;
        },
        getrel(x, axis) {
            var v = window.legendmod;
            if (axis == 0) return x / (v.mapMaxX - v.mapMinX);
            else return x / (v.mapMaxY - v.mapMinY);
        },
        getreal(x, axis) {
            var v = window.legendmod;
            if (axis == 0) return x * (v.mapMaxX - v.mapMinX) + v.mapMinX;
            else return x * (v.mapMaxY - v.mapMinY) + v.mapMinY;
        },
        sendSLGQinfo() {
            //return;
            var msg = "";
            var vlen = window.legendmod.viruses.length;
            msg += this.packInt(vlen, 2);
            for (var i = 0; i < vlen; i++) {
                var z = window.legendmod.viruses[i];
                msg += this.packInt(z.id, 4);
                msg += this.packFloat(this.getrel(z.x, 0), 4);
                msg += this.packFloat(this.getrel(z.y, 1), 4);
                msg += this.packInt(~~(z.size), 2);
            }
            var cmsg = "";
            var clen = 0;
            var cells = window.legendmod.cells;
            for (var i = 0; i < cells.length; i++) {
                var z = cells[i];
                if (!z.isVirus) {
                    cmsg += this.packInt(z.id, 4);
                    cmsg += this.packFloat(this.getrel(z.x, 0), 4);
                    cmsg += this.packFloat(this.getrel(z.y, 1), 4);
                    cmsg += this.packInt(~~(z.size), 2);
                    clen++;
                }
            }
            msg += this.packInt(clen, 2);
            msg += cmsg;

            //Here should be food part

            this.sendSLG("Q", msg);

            var today = new Date();
            var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds() + ":" + today.getMilliseconds();
            //console.log("Package Sent:",time)
        },
        getSLGQinfo(t) {
            //return ;
            var ids = this.getSLGID(t);
            var id = this.checkPlayerID(ids);
            console.log(t);
            if (null == id) return;
            var msg = this.getSLGVal(t);
            //Get viruses
            var vlen = this.unpackInt(msg.slice(0, 1));
            msg = msg.slice(1);
            var temp = [];
            for (var i = 0; i < vlen; i++) {
                var di = this.unpackInt(msg.slice(0, 2));
                var fx = this.unpackFloat(msg.slice(2, 4));
                var fy = this.unpackFloat(msg.slice(4, 6));
                var ds = this.unpackInt(msg.slice(6, 7));
                msg = msg.slice(7);
                var x = this.getreal(fx, 0);
                var y = this.getreal(fy, 1);
                var cellUpdateSLGCells = new ogarbasicassembly(di, x, y, ds, null, false, true, false, defaultmapsettings.shortMass, defaultmapsettings.virMassShots);
                cellUpdateSLGCells.time = this.time;
                cellUpdateSLGCells.isVirus = true;
                temp.push(cellUpdateSLGCells);
                if (!cellUpdateSLGCells.isInView()) {
                    if (legendmod.indexedCells.hasOwnProperty(e)) {
                        cellUpdateSLGCells = legendmod.indexedCells[e]
                        //legendmod.cells.push(cellUpdateSLGCells);													 
                    } else {
                        legendmod.indexedCells.push(cellUpdateSLGCells);
                    }
                }
                //cellUpdateSLGCells.removeCell();
            }
            this.teamPlayers[id].dvirs = temp;

            //Get normal cells
            var clen = this.unpackInt(msg.slice(0, 1));
            msg = msg.slice(1);
            var tempx = [];
            var cells = window.legendmod.cells;
            for (var i = 0; i < clen; i++) {
                var di = this.unpackInt(msg.slice(0, 2));
                var fx = this.unpackFloat(msg.slice(2, 4));
                var fy = this.unpackFloat(msg.slice(4, 6));
                var ds = this.unpackInt(msg.slice(6, 7));
                msg = msg.slice(7);
                var x = this.getreal(fx, 0);
                var y = this.getreal(fy, 1);
                var cellUpdateSLGCells = new ogarbasicassembly(di, x, y, ds, null, false, true, false, defaultmapsettings.shortMass, defaultmapsettings.virMassShots);
                cellUpdateSLGCells.isVirus = false;
                temp.push(cellUpdateSLGCells);
                if (!cellUpdateSLGCells.isInView()) {
                    if (legendmod.indexedCells.hasOwnProperty(e)) {
                        cellUpdateSLGCells = legendmod.indexedCells[e]
                        //legendmod.cells.push(cellUpdateSLGCells);													 
                    } else {
                        legendmod.indexedCells.push(cellUpdateSLGCells);
                    }
                }
                //cellUpdateSLGCells.removeCell();
            }
            this.teamPlayers[id].dcells = tempx;
            var today = new Date();
            var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds() + ":" + today.getMilliseconds();
            console.log("Package Received:", ids, id, time)

            //Here should be food part
        },
        sendSocket3Info(type, message) {
            if (Socket3 && Socket3.readyState == 1) {
                var temp = {
                    com: "info",
                    com2: type,
                    id: window.unescape(window.encodeURIComponent(application.lastSentNick)),
                    x: message,
                };
                Socket3.send(JSON.stringify({
                    "toH": $("#server-token").val() + "3",
                    "msg": temp
                }));
            }
        },
        sendSocket3Position() {
            if (ogario.play && window.noOgarioSocket && Socket3 && Socket3.readyState == 1) {
                var temp = {
                    com: "pos",
                    //id: customLMID,
                    //id: application.playerID,
                    id: window.unescape(window.encodeURIComponent(application.lastSentNick)),
                    x: application.getPlayerX(),
                    y: application.getPlayerY(),
                    mass: application.getMass()
                };
                Socket3.send(JSON.stringify({
                    //"toH": "legendmod",
                    "toH": $("#server-token").val() + "3",
                    "msg": temp
                }));
            }
        },
        //Sonia4
        sendSuperLegendSDATA() {
            if (ogario.play && this.playerID) {
                var s = "";
                s += window.legendmod.bgpi;
                this.sendSLG("R", s);
            }
        },
        sendSimpleLegendSDATA() {
            if (ogario.play && this.playerID) {
                //var t = this.playerID;
                var t = window.unescape(window.encodeURIComponent(application.lastSentNick));
                var s = window.legendmod.bgpi;
                if (this.isSLGSocketOpen()) {
                    if (ogarcopythelb.clanTag != this.roomc) {
                        console.log("Sending failed. Reconnecting required..")
                        //this.SLGconnect(window.legendmod.ws);
                        if (window.SLGsocket) {
                            window.SLGsocket.closeAndOpen();
                        }
                        return;
                    }
                    if (s != null) {
                        temp = {
                            "t": t,
                            "s": s
                        }
                        //console.log("send", temp)
                        if (SLGsocket && SLGsocket.readyState == 1) {
                            SLGsocket.send(JSON.stringify({
                                //"toH": "legendmod2",
                                "toH": $("#server-token").val(),
                                "msg": temp
                            }));
                        }
                    }
                }
            }
        },
        //Sonia4
        getSuperLegendSDATA(t) {
            var ids = this.getSLGID(t);
            var id = this.checkPlayerID(ids);
            if (null != id) {
                var s = this.getSLGVal(t);
                var lbgpi = s.slice(0, 1);
                this.teamPlayers[id].lbgpi = parseInt(lbgpi);
                //if (this.top5[id]){
                //this.top5[id].lbgpi = parseInt(lbgpi); //
                //}

            }
        },
        checkPlayerID(id) {
            if (id) {
                for (let length = 0; length < this.teamPlayers.length; length++) {
                    if (this.teamPlayers[length].id == id) {
                        return length;
                    }
                }
            }
            return null;
        },
        checkPlayerNick(nick) {
            if (nick)
                for (var length = 0; length < this.teamPlayers.length; length++)
                    if (this.teamPlayers[length].nick == nick) return length;
            return null;
        },
        checkPlayerChat(message) {
            if (message)
                for (var length = 0; length < this.teamPlayers.length; length++)
                    if (this.teamPlayers[length].id == message) return length;
            return null;
        },
        updateTeamPlayer(message) {
            function encode() {
                var text = "";
                for (;;) {
                    var string = message.getUint16(offset, true);
                    if (0 == string) {
                        break;
                    }
                    text = text + String.fromCharCode(string);
                    offset = offset + 2;
                }
                return offset = offset + 2, text;
            }

            var id = message.getUint32(1, true);
            var offset = 5;
            var nick = encode();
            var skinUrl = this.checkSkinURL(encode());
            var customColor = encode();
            var defaultColor = encode();
            var skinName = ":party" === this.gameMode ? nick + defaultColor : nick;
            var userId = this.checkPlayerID(id);
            if (null !== userId) {
                this.teamPlayers[userId].nick = nick;
                this.teamPlayers[userId].skinID = skinName;
                this.teamPlayers[userId].skinURL = skinUrl;
                this.teamPlayers[userId].setColor(defaultColor, customColor);
            } else {
                const map = new minimapCell(id, nick, skinName, skinUrl);
                map.setColor(defaultColor, customColor);
                this.teamPlayers.push(map);
            }

            //this.cacheCustomSkin(nick, defaultColor, skinUrl);
            if (!animatedskins[nick] || !defaultmapsettings.vanillaSkins) { //fix for animated skins to work
                this.cacheCustomSkin(nick, defaultColor, skinUrl);
            }
        },
        updateTeamPlayerPosition(message) {
            var e = message.getUint32(1, true),
                i = this.checkPlayerID(e);
            if (null !== i) {
                var s = message.getInt32(5, true),
                    o = message.getInt32(9, true),
                    a = message.getUint32(13, true);
                if (a > 249999) return; //to stop the spammer
                //if (a > 360000) return;
                var n = this.teamPlayers[i];
                n.x = s,
                    n.y = o,
                    n.mass = a,
                    n.alive = true,
                    n.updateTime = Date.now(),
                    this.targeting && this.targetID && e == this.targetID && this.updateTarget(n.nick, n.skinURL, s, o, n.mass, n.color, n.lbgpi);
            }
        },
        //Sonia3 Added 3 fuctions below
        dematrix(mat) {
            return !mat[0] && !mat[1] ? 0 : mat[0] && !mat[1] ? 1 : mat[0] && mat[1] ? 2 : 3;
        },
        setvnr(b) {
            window.legendmod.setrot = 1;
            window.legendmod.rotcnt = 0;
            var mat = window.legendmod.vector[window.legendmod.vnr];
            //window.legendmod.prevvnr = window.legendmod.vnr; //jimboy31001
            if ((b == 0 || b == 3) && (window.legendmod.bgpi == 1 || window.legendmod.bgpi == 2)) mat[0] = !mat[0];
            if ((b == 1 || b == 2) && (window.legendmod.bgpi == 0 || window.legendmod.bgpi == 3)) mat[0] = !mat[0];
            if ((b == 0 || b == 1) && (window.legendmod.bgpi == 2 || window.legendmod.bgpi == 3)) mat[1] = !mat[1];
            if ((b == 2 || b == 3) && (window.legendmod.bgpi == 1 || window.legendmod.bgpi == 0)) mat[1] = !mat[1];
            window.legendmod.vnr = this.dematrix(mat);
        },
        settechvnr(b) { //jimboy3100's 5/5/2020
            if (b == 0) {
                window.legendmod.vector[window.legendmod.vnr][1] = 0;
                window.legendmod.vector[window.legendmod.vnr][0] = 0;
            }
            if (b == 1) {
                window.legendmod.vector[window.legendmod.vnr][1] = 0;
                window.legendmod.vector[window.legendmod.vnr][0] = 1;
            }
            if (b == 2) {
                window.legendmod.vector[window.legendmod.vnr][1] = 1;
                window.legendmod.vector[window.legendmod.vnr][0] = 0;
            }
            if (b == 3) {
                window.legendmod.vector[window.legendmod.vnr][1] = 1;
                window.legendmod.vector[window.legendmod.vnr][0] = 1;
            }
        },
        updatevnr() {
            var mm = 0;
            var max = 4;
            for (var i = 0; i < this.teamPlayers.length; i++) {
                var k = this.teamPlayers[i];
                if (k.mass > mm) {
                    if (k.lbgpi <= 3 && k.lbgpi >= 0) {
                        mm = k.mass;
                        max = k.lbgpi;
                    }
                }
            }
            if (window.legendmod.gameMode != ":party" && mm > 0 && (!window.legendmod.play || mm > window.legendmod.playerMass) && max <= 3 && window.legendmod.bgpi <= 3 && !window.legendmod.setrot) {
                if (!spects.length) {
                    //console.log("\x1b[32m%s\x1b[34m%s\x1b[0m", consoleMsgLM, " VMR UPDATE:", window.legendmod.vnr, mm, window.legendmod.playerMass, max, window.legendmod.bgpi);
                    this.setvnr(max);
                    console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Map fixed with LM players. POS:', max);
                } else if (!window.announceSpectNotifOnce) {
                    window.announceSpectNotifOnce = true;
                    toastr.warning("<b>[" + Premadeletter123 + "]:</b> " + "Rotation can work only before the creation of Multi-Viewports");
                }
            }
        },
        updateTeamPlayers() {
            this.sendPlayerPosition();
            //this.sendSuperLegendSDATA();
            this.sendSimpleLegendSDATA(); //SEND ROTATION INFO

            //this.sendSLGQinfo(),

            this.chatUsers = {};
            this.top5 = []; //Sonia3
            this.updatevnr(); //Sonia3
            if (window.legendmod.delstate >= 0) { //Sonia3
                window.legendmod.delstate += 1; //Sonia3
                //if (window.legendmod.delstate > 3) window.legendmod.delstate = -1; //Sonia3
                if (window.legendmod.delstate > 3) window.legendmod.delstate = -1; //Sonia3
            } //Sonia3
            var t = 0;
            for (; t < this.teamPlayers.length; t++) {
                var e = this.teamPlayers[t];
                if (e.alive && Date.now() - e.updateTime >= 2000 || 0 == e.mass) {
                    e.alive = false;
                    if (this.targeting && this.targetID && e.id == this.targetID) {
                        this.setTargetStatus(2);
                    }
                }
                if (e.alive) {
                    this.top5.push({
                        "id": e.id,
                        "nick": e.nick,
                        "x": e.x,
                        "y": e.y,
                        "mass": e.mass,
                        "color": e.color,
                        "skin": e.skinURL,
                        "lbgpi": e.lbgpi
                    });
                    if (!this.isChatUserMuted(e.id)) {
                        this.addChatUser(e.id, e.nick);
                    }
                }
            }
            this.top5.sort(function(row, conf) {
                return conf.mass - row.mass;
            });
            this.displayTop5();

        },
        updateParties(t) {
            this.parties = [];
            for (var e = t.getUint8(1), i = 2, s = 0; s < e; s++) {
                for (var o = '';;) {
                    var a = t.getUint16(i, true);
                    if (0 == a) break;
                    o += String.fromCharCode(a), i += 2;
                }
                i += 2, this.parties.push(o);
            }
        },
        readChatMessage(t) {
            if (!defaultmapsettings.disableChat) {
                var time = new Date().toTimeString().replace(/^(\d{2}:\d{2}).*/, '$1');
                var caseof = t.getUint8(1); //caseof 101 or 102
                var plId = t.getUint32(2, true);
                var o = t.getUint32(6, true);
                if (!(this.isChatUserMuted(plId) || 0 != o && o != this.playerID && plId != this.playerID)) { //not for those
                    for (var msg = '', n = 10; n < t.byteLength; n += 2) {
                        var r = t.getUint16(n, true);
                        if (0 == r) break;
                        msg += String.fromCharCode(r);
                    }
                    var pattern = /.*s[^a-z]*e[^a-z]*n[^a-z]*p[^a-z]*a.*/i;
                    var pattern2 = /.*m[^a-z]*i[^a-z]*s[^a-z]*t[^a-z]*i.*/i;
                    var pattern3 = "𝕊𝕖𝕟𝕡𝕒.𝕚𝕠";
                    //var pattern = /.*(s).*e.*n.*p.*a.*/i;
                    //var pattern2 = /.*(m).*i.*s.*t.*i.*/i;
                    //var pattern = /.*(s|5).*e.*n.*p.*a.*/i;
                    if (!pattern.test(msg) && !pattern2.test(msg) && !msg.includes(pattern3)) {

                        if (legendmod.integrity || !LM.chatableServer) {
                            this.displayChatMessage(time, caseof, plId, msg);
                        }
                        //else if (!legendmod.integrity && application.chatHistory[application.chatHistory.length-1].message != msg.split(': ')[1]){
                        else if (!legendmod.integrity && $("#clantag").val() != "") {
                            this.displayChatMessage(time, caseof, plId, msg);
                        }
                    } else {
                        //console.log('Blocked: ' + msg)
                    }
                }
            }
        },
        sendChatMessage(type, message) {
            //console.log(type);console.log(message);
            if (!(Date.now() - this.lastMessageSentTime < 500 || 0 == message.length || 0 == ogarcopythelb.nick.length) && this.isSocketOpen()) {
                message = ogarcopythelb.nick + ': ' + message;
                var view = this.createView(10 + 2 * message.length);
                view.setUint8(0, 100),
                    view.setUint8(1, type),
                    view.setUint32(2, this.playerID, true),
                    view.setUint32(6, 0, true);
                for (var length = 0; length < message.length; length++) view.setUint16(10 + 2 * length, message.charCodeAt(length), true);
                this.sendBuffer(view),
                    this.lastMessageSentTime = Date.now();
            }
        },
        prepareCommand(command) {
            return command.replace('%currentSector%', this.currentSector);
        },
        sendCommand(command) {
            var prepareCommand = this.prepareCommand(chatCommand['comm' + command]);
            this.sendChatMessage(102, prepareCommand);

            //		
            //if (LM.ws.includes("imsolo.pro") && $("#clantag").val() == ""){
            if (!LM.integrity && $("#clantag").val() == "") {

                var view = application.createView(4 + 2 * prepareCommand.length);
                view.setUint8(0, 99);
                view.setUint8(1, 0);
                var length = 0
                for (; length <= prepareCommand.length + 1; length++) view.setUint16(2 + length, prepareCommand.charCodeAt(length), true);
                view.setUint8(length, 0);
                legendmod.sendMessage(view)
            }
            //
        },
        addChatUser(id, name) {
            this.chatUsers[id] = name;
        },
        getChatUserNick(id) {
            if (this.chatUsers.hasOwnProperty(id)) {
                return this.chatUsers[id];
            }
            return '';
        },
        muteChatUser(id) {
            if (id && !this.isChatUserMuted(id)) {
                var User = this.getChatUserNick(id);
                this.chatMutedUsers[id] = User;
                this.chatMutedUserIDs.push(id);
                toastr.error(textLanguage.userMuted.replace('%user%', '<strong>' + this.escapeHTML(User) + '</strong>') + ' <button data-user-id=\"' + id + '\" class=\"btn btn-xs btn-green btn-unmute-user\">' + textLanguage.unmute + '</button>');
            }
        },
        unmuteChatUser(id) {
            if (id) {
                var User = this.chatMutedUserIDs.indexOf(id);
                if (-1 != User) {
                    this.chatMutedUserIDs.splice(User, 1);
                    toastr.info(textLanguage.userUnmuted.replace("%user%", "<strong>" + this.escapeHTML(this.chatMutedUser[id]) + "</strong>"));
                    delete this.chatMutedUser[id];
                }
            }
        },
        isChatUserMuted(id) {
            if (this.chatMutedUserIDs.indexOf(id) != -1) {
                return true;
            }
            return false;
        },
        parseMessage(string) {
            var isImage = /\[img\](https?:\/\/i\.(?:imgur|hizliresim)\.com\/\w{6,8}\.(?:jpg|jpeg|png|gif)\??\d*)\[\/img\]/i;
            if (isImage.test(string)) return defaultmapsettings.showChatImages ? '<img src=\"' + string.match(isImage)[1].replace('http:', 'https:') + '\" style=\"width:100%;border:none;\">' : '';
            var url = /\[yt\]([\w-]{11})\[\/yt\]/i;
            if (url.test(string)) return defaultmapsettings.showChatVideos ? '<iframe type=\"text/html\" width=\"100%\" height=\"auto\" src=\"https://www.youtube.com/embed/' + string.match(url)[1] + '?autoplay=1&amp;vq=tiny\" frameborder=\"0\" />' : '';
            let escapedHtml = this.escapeHTML(string);
            if (defaultmapsettings.chatEmoticons) {
                escapedHtml = this.parseEmoticons(escapedHtml);
            }
            return escapedHtml;
        },
        parseEmoticons(string) {
            /*return String(string).replace(/\&lt\;3/g, '<3').replace(/(O\:\)|3\:\)|8\=\)|\:\)|\;\)|\=\)|\:D|X\-D|\=D|\:\(|\;\(|\:P|\;P|\:\*|\$\)|\<3|\:o|\(\:\||\:\||\:\\|\:\@|\|\-\)|\^\_\^|\-\_\-|\$\_\$|\(poop\)|\(fuck\)|\(clap\)|\(ok\)|\(victory\)|\(y\)|\(n\))/g, function(string) {
                return '<img src=\"https://legendmod.ml/banners/emoticons/' + d[string] + '\" alt=\"' + string + '\" class=\"emoticon\">';
            });*/
            //return String(string).replace(/\&lt\;3/g, '<3').replace(/℄/g, '℄ Legend Clan').replace(/(O\:\)|3\:\)|8\=\)|\:\)|\;\)|\=\)|\:D|X\-D|\=D|\:\(|\;\(|\:P|\;P|\:\*|\$\)|\<3|\:o|\(\:\||\:\||\:\\|\:\@|\|\-\)|\^\_\^|\-\_\-|\$\_\$|\(poop\)|\(fuck\)|\(clap\)|\(ok\)|\(victory\)|\(y\)|\(n\)|\(angry\)|\(clown\)|\(crazy\)|\(devil\)|\(devil2\)|\(fb\)|\(google\)|\(ghost\)|\(heel\)|\(kiss\)|\(lipstick\)|\(rage\)|\(teacher\)|\(together\)|\(toothy\)|\(evil\)|\(baby\)|\(wow\))/g, function(string) {
            return String(string).replace(/\&lt\;3/g, '<3').replace(/(O\:\)|3\:\)|8\=\)|\:\)|\;\)|\=\)|\:D|X\-D|\=D|\:\(|\;\(|\:P|\;P|\:\*|\$\)|\<3|\:o|\(\:\||\:\||\:\\|\:\@|\|\-\)|\^\_\^|\-\_\-|\$\_\$|\(poop\)|\(fuck\)|\(clap\)|\(ok\)|\(victory\)|\(y\)|\(n\)|\(angry\)|\(clown\)|\(crazy\)|\(devil\)|\(devil2\)|\(fb\)|\(google\)|\(ghost\)|\(heel\)|\(kiss\)|\(lipstick\)|\(rage\)|\(teacher\)|\(together\)|\(toothy\)|\(evil\)|\(baby\)|\(wow\))/g, function(string) {
                //console.log(d[string]);
                return '<img src=\"https://legendmod.ml/banners/emoticons/' + emoticonicons[string] + '\" alt=\"' + string + '\" class=\"emoticon\">';
            });

        },
        displayChatMessage(time, caseof, plId, msg) {
            var mcolor = ""

            //mcolor = "blue";
            if (0 != msg.length) {
                //console.log(msg);
                var a = msg.split(': ', 1).toString();
                n = this.parseMessage(msg.replace(a + ': ', ''));
                //coloredNicks
                if (defaultmapsettings.coloredNicks) {
                    if (legendmod.cellcolors[a]) {
                        mcolor = legendmod.cellcolors[a]
                    } else {
                        application.teamPlayers.forEach((found) => {
                            if (found.nick == a) {
                                mcolor = found.color
                            }
                        })
                    }
                }
                //
                if (!(0 == a.length || fancyCount2(a) > 15 || 0 == n.length)) {
                    //if (!(0 == a.length || a.length > 15 || 0 == n.length)) {
                    var r = '';
                    if (0 != plId && plId != this.playerID && (this.addChatUser(plId, a), r = '<a href=\"#\" data-user-id=\"' + plId + '\" class=\"mute-user ogicon-user-minus\"></a> '), a = this.escapeHTML(a), 101 == caseof) {

                        if (defaultmapsettings.showChatBox) return $('#chat-box').append('<div class=\"message\"><span class=\"message-time\">[' + time + '] </span>' + r + '<span class=\"message-nick\" style = "color:' + mcolor + '">' + a + ': </span><span class=\"message-text\">' + n + '</span></div>'),
                            $('#chat-box').perfectScrollbar('update'),
                            $('#chat-box').animate({
                                'scrollTop': $('#chat-box').prop('scrollHeight')
                            }, 500),
                            void(defaultmapsettings.chatSounds && this.playSound(this.messageSound));
                        defaultmapsettings.hideChat || (toastr.success('<span class=\"message-nick\" style = "color:' + mcolor + '">' + a + ': </span><span class=\"message-text\">' + n + '</span>' + r),
                                defaultmapsettings.chatSounds && this.playSound(this.messageSound)),
                            this.chatHistory.push({
                                'nick': a,
                                'message': n,
                                //
                                'time': Date.now()
                                //
                            }),
							this.chatHistory.length > window.chatLimit && this.chatHistory.shift();
                           // this.chatHistory.length > 15 && this.chatHistory.shift();
                    } else if (102 == caseof) {
                        if (defaultmapsettings.showChatBox) return $('#chat-box').append('<div class=\"message command\"><span class=\"command-time\">[' + time + '] </span>' + r + '<span class=\"command-nick\" style = "color:' + mcolor + '">' + a + ': </span><span class=\"command-text\">' + n + '</span></div>'),
                            $('#chat-box').perfectScrollbar('update'),
                            $('#chat-box').animate({
                                'scrollTop': $('#chat-box').prop('scrollHeight')
                            }, 500),
                            void(defaultmapsettings.chatSounds && this.playSound(this.commandSound));
                        defaultmapsettings.hideChat || (toastr.warning('<span class=\"command-nick\" style = "color:' + mcolor + '">' + a + ': </span><span class=\"command-text\">' + n + '</span>' + r),
                                defaultmapsettings.chatSounds && this.playSound(this.commandSound)),
                            this.commandHistory.push({
                                'nick': a,
                                'message': n,
                                //
                                'time': Date.now()
                                //
                            }),
                            this.commandHistory.length > 15 && this.commandHistory.shift();
                    } else $('#messages').append(msg);
                }
            }
        },
        displayUserList(users, activeUser, html, isMute, o) {
            var text = '';
            if (Object.keys(users).length) {
                for (var user in text += '<ol class=\"user-list\">', users) users.hasOwnProperty(user) && (text += '<li><strong>' + this.escapeHTML(users[user]) + '</strong> <button data-user-id=\"' + user + '\" class=\"btn btn-xs ' + html + '\">' + isMute + '</button></li>');
                text += '</ol>';
            } else text += textLanguage.none;
            toastr[o](text, activeUser, {
                'closeButton': true,
                'tapToDismiss': false
            });
        },
        displayChatActiveUsers() {
            this.displayUserList(this.chatUsers, textLanguage.activeUsers, 'btn-red btn-mute-user', textLanguage.mute, 'info');
        },
        displayChatMutedUsers() {
            this.displayUserList(this.chatMutedUsers, textLanguage.mutedUsers, 'btn-green btn-unmute-user', textLanguage.unmute, 'error');
        },
        preloadChatSounds() {
            this.setMessageSound();
            this.setCommandSound();
            this.setvirusSound();
        },
        setChatSoundsBtn() {
            if (defaultmapsettings.chatSounds) {
                $('.chat-sound-notifications').removeClass('ogicon-volume-mute2').addClass('ogicon-volume-high');
            } else {
                $('.chat-sound-notifications').removeClass('ogicon-volume-high').addClass('ogicon-volume-mute2');
            }
        },
        setMessageSound() {
            this.messageSound = this.setSound(defaultmapsettings.messageSound);
        },
        setCommandSound() {
            this.commandSound = this.setSound(defaultmapsettings.commandSound);
        },
        setvirusSound() {
            this.virusSoundurl = this.setSound(defaultmapsettings.virusSoundurl);
        },
        setSound(audio) {
            if (!audio) {
                return null;
            }
            return new Audio(audio);
        },
        /*            playSound(audio) {
                        //audio && audio.play && (audio.pause(), audio.currentTime = 0, audio.play());
                        //audio && audio.play && audio.play!==null && (audio.pause(), audio.currentTime = 0, audio.play());
                        audio.pause();
                        audio.currentTime = 0;
                        var nopromise = {
                            catch: new Function()
                        };
                        (audio.play() || nopromise).catch(function() {});
                    },
        */
        playSound(audio) {
            if (audio && audio.play) {
                audio.pause();
                audio.currentTime = 0;
                //audio.play();
                var nopromise = {
                    catch: new Function()
                };
                (audio.play() || nopromise).catch(function() {});
            }
        },
        setFBIDs() {
            this.FacebookIDs = defaultmapsettings.FacebookIDs;
            return this.FacebookIDs;
        },
        setDebug() {
            if (defaultmapsettings.debug) {
                defaultmapsettings.debug = false
            } else {
                defaultmapsettings.debug = true
            }
        },
        setFullSpectator() {
            if (window.fullSpectator) {
                window.fullSpectator = false
                LM.flushSpecsData()
            } else {
                window.fullSpectator = true
                LM.addSpect()
            }
        },
        setIngameSpectator() {
            if (window.ingameSpectator) {
                window.ingameSpectator = false
                LM.flushSpecsData()
            } else {
                window.ingameSpectator = true
                LM.addSpect()
            }
        },
        setTargeting() {
            if (this.targetID) {
                this.targeting = !this.targeting;
                ogario.targeting = this.targeting;
                this.setTargetingInfo();
            }
        },
        setTargetingInfo() {
            if (this.targeting) {
                $('#set-targeting').addClass('active');
                $('#target-status').show();
                if (this.targetStatus != 2) {
                    $('#target-summary').show();
                }
            } else {
                $('#set-targeting').removeClass('active');
                $('#target-summary, #target-status').hide();
            }
        },
        cancelTargeting() {
            this.setTargetStatus(0);
        },
        setPrivateMiniMap() {
            if (!this.targetID) {
                return;
            }
            this.privateMiniMap = !this.privateMiniMap;
            if (this.privateMiniMap) {
                $('#set-private-minimap').addClass('active');
            } else {
                $('#set-private-minimap').removeClass('active');
            }
        },
        setTarget(id) {
            const userId = this.checkPlayerID(id);
            if (userId !== null) {
                const teamPlayer = this.teamPlayers[userId];
                this.targetID = teamPlayer.id;
                this.updateTarget(teamPlayer.nick, teamPlayer.skinURL, teamPlayer.x, teamPlayer.y, teamPlayer.mass, teamPlayer.color);
                if (!teamPlayer.alive) {
                    this.setTargetStatus(2);
                    return;
                }
                this.setTargetStatus(1);
            } else {
                this.setTargetStatus(0);
            }
        },
        setTargetStatus(type) {
            switch (type) {
                case 0:
                    this.targetStatus = 0;
                    this.targetID = 0;
                    this.targetNick = '';
                    this.targetSkinURL = '';
                    this.targeting = false;
                    ogario.targeting = false;
                    this.privateMiniMap = false;
                    $('#target-skin, #target-nick, #target-summary').hide();
                    $("#target-hud").hide();
                    $('#target-status').show().text(textLanguage.targetNotSet);
                    $('#target-panel-hud a').removeClass('active'); //$('#target-status').show().text('[' + textLanguage.targetNotSet + ']'), $('#target-panel-hud a').removeClass('active');
                    break;
                case 1:
                    this.targetStatus = 1;
                    if (!this.targeting) {
                        this.targeting = true;
                        ogario.targeting = true;
                        $("#target-hud").show();
                        this.setTargetingInfo();
                    }
                    $('#target-skin, #target-nick, #target-status, #target-summary').show();
                    break;
                case 2:
                    //this.targetStatus = 2, $('#target-summary').hide(), $("#target-hud").show(), $('#target-status').show().text('[' + textLanguage.targetDead + ']'), i.resetTargetPosition();
                    this.targetStatus = 2;
                    $('#target-summary').hide();
                    $("#target-hud").show();
                    $('#target-status').show().text('[' + Languageletter369 + ']');
                    ogario.resetTargetPosition();
            }
        },
        changeTarget() {
            var targetId = this.checkPlayerID(this.targetID);
            for (target = null, length = 0; length < this.teamPlayers.length; length++)
                if (this.teamPlayers[length].alive) {
                    if (null === targetId) {
                        targetId = length;
                        break;
                    }
                    if (length < targetId && null === target) target = length;
                    else if (length > targetId) {
                        target = length;
                        break;
                    }
                }
            if (target !== null) {
                targetId = target;
            }
            if (targetId !== null) {
                this.setTarget(this.teamPlayers[targetId].id);
            } else {
                this.setTargetStatus(0);
            }
        },
        updateTarget(nick, skinUrl, x, y, mass, color, f) {
            ogario.setTargetPosition(x, y);
            if (this.targetNick !== nick) {
                this.targetNick = nick;
                $('#target-nick').html(this.escapeHTML(nick))
            }
            if (skinUrl) {
                if (this.targetSkinURL !== skinUrl) {
                    if (this.customSkinsCache.hasOwnProperty(skinUrl + '_cached')) {
                        $('#target-skin img').attr('src', skinUrl);
                        $('#target-skin img').css('border', '2px solid' + color);
                        this.targetSkinURL = skinUrl;
                    } else {
                        $('#target-skin img').attr('src', 'https://legendmod.ml/banners/static/img/blank.png')
                    }
                }
            }
            $('#target-status').text('[' + this.shortMassFormat(mass) + ']');
            var l = this.calculateMapSector(x, y);
            var text;
            html = textLanguage.targetDistance + ': <span class=\"hud-main-color\">' + ogario.targetDistance + ' [' + l + ']</span>';
            var flag = false;
            for (var j = 0; j < legendmod.ghostCells.length; j++) {
                if (legendmod.leaderboard[j] && this.targetNick == legendmod.leaderboard[j].nick) {

                    if (flag == false) {
                        text = application.calculateMapSector(window.predictedGhostCells[j].x + legendmod.mapOffsetX, window.predictedGhostCells[j].y + legendmod.mapOffsetY)
                        flag = true;
                    }
                }
            };
            if (flag == false && f >= 0) {
                text = this.calculateMapSector(x, y);
            } else if (flag == false && (this.calculateMapSector(x, y) == "C3" || legendmod.gameMode == ":party")) {
                text = this.calculateMapSector(x, y);
            } else if (flag == false) {
                text = "Unknown";
            };
            html = Languageletter367 + ': <span class=\"hud-main-color\">' + ogario.targetDistance + ' [' + text + ']</span>';
            if (ogario.play) {
                html += ' | ' + textLanguage.targetMass + ': <span class=\"hud-main-color\">' + this.shortMassFormat(mass + ogario.playerMass) + '</span>'
            }
            $('#target-summary').html(html);
            if (1 != this.targetStatus) {
                this.setTargetStatus(1);
            }
        },
        updateQuest() {
            if (!this.showQuest || this.gameMode !== ':ffa') {
                return;
            }
            if (window.MC && window.MC.getQuestProgressLabel) {
                this.questHUD.textContent = window.MC.getQuestProgressLabel();
            }
        },
        init() {
            this.loadSettings();
            this.loadProfiles();
            this.setLang();
            this.setMenu();
            this.setUI();
            if (Settings) {
                Settings.setTheme();
                Settings.setChatPosition();
            }
            this.setShowQuickMenu();
            this.setShowSkinsPanel();
            this.setProfile();
            this.setMainButtons();
            this.setStreamMode();
            this.setHideSkinUrl();
            this.setMiniMap();
            this.setAutoResp();
            this.setDisableChat();
            this.setShowChatBox();
            this.setTop5();
            this.setTargetingHUD();
            this.setQuest();
            this.displayTime();
            this.setCenteredLb();
            //this.setNormalLb();
            this.setVanillaSkins();
            this.setFpsAtTop();
            this.setTweenMaxEffect();
            this.displayStats();
            this.setBlockPopups();
            this.preloadChatSounds();
            this.setChatSoundsBtn();
            this.setFBIDs();
            if (defaultmapsettings.multiBoxShadow) {
                this.setProfileboxShadow()
            }
            var app = this;
            setInterval(function() {
                app.drawMiniMap();
            }, 33);
            setInterval(function() {
                if (typeof repeatSendingSpecialSkins === "function") {
                    repeatSendingSpecialSkins();
                }
            }, 10000);
            setInterval(function() {
                app.updateTeamPlayers();
                //application.sendSocket3Position(); // DO NOT SEND SECONDARY SOCKET POSITION
            }, this.updateInterval);
        }
    };

    function irenderfromagario() {
        this.txt = '',
            this.txtCanvas = null,
            this.txtCtx = null,
            this.color = '#FFFFFF',
            this.stroke = false,
            this.strokeWidth = 2,
            this.strokeColor = '#000000',
            this.font = '700 16px Ubuntu',
            this.fontFamily = 'Ubuntu',
            this.fontWeight = 700,
            this.fontSize = 16,
            this.margin = 3,
            this.scale = 1,
            this.quality = 1,
            this.measuredWidth = 0,
            this.redraw = false,
            this.remeasure = false,
            this.setTxt = function(ogariosettxtsetter) {
                if (this.txt !== ogariosettxtsetter) {
                    this.txt = ogariosettxtsetter;
                    this.redraw = true;
                    this.remeasure = true;
                }
            },
            this.setColor = function(ogariocolorsetter) {
                this.color !== ogariocolorsetter && (this.color = ogariocolorsetter,
                    this.redraw = true);
            },
            this.setStroke = function(ogariostrokesetter) {
                this.stroke !== ogariostrokesetter && (this.stroke = ogariostrokesetter,
                    this.redraw = true);
            },
            this.setStrokeWidth = function(ogariostrokewidthsetter) {
                this.stroke && this.strokeWidth != ogariostrokewidthsetter && (this.strokeWidth = ogariostrokewidthsetter,
                    this.redraw = true,
                    this.remeasure = true);
            },
            this.setStrokeColor = function(ogariostrokecolorsetter) {
                this.stroke && this.strokeColor !== ogariostrokecolorsetter && (this.strokeColor = ogariostrokecolorsetter,
                    this.redraw = true);
            },
            this.setFont = function() {
                this.font = this.fontWeight + ' ' + this.fontSize + 'px ' + this.fontFamily;
            },
            this.setFontFamily = function(ogariofontfamilysetter) {
                if (this.fontFamily !== ogariofontfamilysetter) {
                    this.fontFamily = ogariofontfamilysetter;
                    this.setFont();
                    this.redraw = true;
                    this.remeasure = true;
                }
            },
            this.setFontWeight = function(ogariofontweightsetter) {
                if (this.fontWeight != ogariofontweightsetter) {
                    this.fontWeight = ogariofontweightsetter;
                    this.setFont();
                    this.redraw = true;
                    this.remeasure = true;
                }
            },
            this.setFontSize = function(ogariofontsizesetter) {
                if (this.fontSize != ogariofontsizesetter) {
                    this.fontSize = ogariofontsizesetter;
                    this.margin = ~~(0.2 * ogariofontsizesetter);
                    this.setFont();
                    this.redraw = true;
                }
            },
            this.setScale = function(ogarioscalesetter) {
                if (this.scale != ogarioscalesetter) {
                    this.scale = ogarioscalesetter;
                    this.redraw = true;
                }
            },
            this.createCanvas = function() {
                this.txtCanvas || (this.txtCanvas = document.createElement('canvas'),
                    this.txtCtx = this.txtCanvas.getContext('2d'),
                    this.txtCtx.ogarioCtx = true);
            },
            this.setDrawing = function(ogarsetDrawinglabel1, ogarsetDrawinglabel2, ogarsetDrawinglabel3, ogarsetDrawinglabel4, ogarsetDrawinglabel5, ogarsetDrawinglabel6) {
                this.setColor(ogarsetDrawinglabel1);
                this.setFontFamily(ogarsetDrawinglabel2);
                this.setFontWeight(ogarsetDrawinglabel3);
                this.setStroke(ogarsetDrawinglabel4);
                this.setStrokeWidth(ogarsetDrawinglabel5);
                this.setStrokeColor(ogarsetDrawinglabel6);
            },
            this.measureWidth = function() {
                return this.remeasure && (this.txtCtx.font = this.fontWeight + ' 10px ' + this.fontFamily,
                        this.measuredWidth = this.txtCtx.measureText(this.txt).width,
                        this.remeasure = false),
                    ~~(this.fontSize / 10 * this.measuredWidth) + 2 * this.strokeWidth;
            },
            //
            this.measureWidthCustom = function(customTxt) {
                return customTxt && this.remeasure && (this.txtCtx.font = this.fontWeight + ' 10px ' + this.fontFamily,
                        this.measuredWidth = this.txtCtx.measureText(customTxt).width,
                        this.remeasure = false),
                    ~~(this.fontSize / 10 * this.measuredWidth) + 2 * this.strokeWidth;
            },
            //
            this.drawTxt = function(customTxt) {
                return this.createCanvas(),
                    this.redraw && (this.redraw = false,


                        this.txtCanvas.width = this.measureWidthCustom(customTxt),
                        this.txtCanvas.width = this.measureWidth(),
                        this.txtCanvas.height = this.fontSize + this.margin * 2,
                        this.txtCtx.font = this.font,
                        this.txtCtx.globalAlpha = 1,
                        this.txtCtx.lineWidth = this.strokeWidth,
                        this.txtCtx.strokeStyle = this.strokeColor,
                        this.txtCtx.fillStyle = this.color,
                        customTxt && this.stroke && this.txtCtx.strokeText(customTxt, this.strokeWidth, ~~(this.fontSize - this.margin * 0.5)),
                        !customTxt && this.stroke && this.txtCtx.strokeText(this.txt, this.strokeWidth, ~~(this.fontSize + this.margin * 0.5)),
                        customTxt && this.txtCtx.fillText(customTxt, this.strokeWidth, ~~(this.fontSize - this.margin * 0.5)),
                        !customTxt && this.txtCtx.fillText(this.txt, this.strokeWidth, ~~(this.fontSize + this.margin * 0.5))),
                    this.txtCanvas;
            };
    }
    //window.application = application;

    function ogarbasicassembly(id, e, s, size, color, isFood, isVirus, isPlayer, shortMass, virusMassShots) {
        //lylko
        this.points = []
        this.pointsVel = []
        this.maxPointRad = 0


        this.oldAlpha = 0;
        this.id = id;
        this.x = e;
        this.y = s;
        this.targetX = e;
        this.targetY = s;
        this.color = color;
        this.oppColor = null;
        this.size = size;
        this.targetSize = size;
        this.alpha = 1;
        this.nick = '';
        this.targetNick = '';
        this.nickCanvas = null;
        this.mass = 0;
        this.lastMass = 0;
        //			this.historyMass = [];
        //			this.historyX = [];
        //			this.historyY = [];
        this.kMass = 0;
        this.massCanvas = null;
        this.mergeCanvas = null;
        this.chatCanvas = null;
        this.massTxt = '';
        this.margin = 0;
        this.scale = 1;
        this.nickScale = 1;
        this.massScale = 1;
        this.virMassScale = 3;
        this.strokeScale = 1;
        this.fontSize = 26;
        this.nickSize = 26;
        this.lastNickSize = 0;
        this.massSize = 26;
        this.virMassSize = 26;
        this.nickStrokeSize = 3;
        this.massStrokeSize = 3;
        this.isFood = isFood;
        this.isVirus = isVirus;
        this.isPlayerCell = isPlayer;
        this.shortMass = shortMass;
        this.virMassShots = virusMassShots;
        this.rescale = false;
        this.redrawNick = true;
        this.redrawMass = true;
        this.redrawMerge = true;
        this.redrawChat = true;
        this.optimizedNames = false;
        this.optimizedMass = false;
        this.strokeNick = false;
        this.strokeMass = false;
        this.removed = false;
        this.redrawed = 0;
        this.time = 0;
        this.skin = null;
        this.pi2 = 2 * Math.PI;
        this.virusColor = null;
        this.virusStroke = null;
        //this.nHeight = 6;

        this.updateNumPoints = function() {
            //adjustment of the number of contacts
            var numPoints = this.size * drawRender.scale | 0;
            numPoints = Math.max(numPoints, 5);
            numPoints = Math.min(numPoints, 120);
            if (this.isVirus) numPoints = 100;
            while (this.points.length > numPoints) {
                var i = Math.random() * this.points.length | 0;
                this.points.splice(i, 1);
                this.pointsVel.splice(i, 1);
            }
            if (this.points.length == 0 && numPoints != 0) {
                this.points.push({
                    x: this.x,
                    y: this.y,
                    rl: this.size,
                    parent: this //?
                });
                this.pointsVel.push(Math.random() - 0.5);
            }
            while (this.points.length < numPoints) {
                var i = Math.random() * this.points.length | 0;
                var point = this.points[i];
                var vel = this.pointsVel[i];
                this.points.splice(i, 0, {
                    x: point.x,
                    y: point.y,
                    rl: point.rl,
                    parent: this
                });
                this.pointsVel.splice(i, 0, vel);
            }
        }
        this.sqDist = function(a, b) {
            return (a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y);
        }
        this.movePoints = function() {
            //console.log(this.id)
            var pointsVel = this.pointsVel.slice();
            var len = this.points.length;
            for (var i = 0; i < len; ++i) {
                var prevVel = pointsVel[(i - 1 + len) % len];
                var nextVel = pointsVel[(i + 1) % len];
                var newVel = (this.pointsVel[i] + Math.random() - 0.5) * 0.7;
                newVel = Math.max(Math.min(newVel, 10), -10);
                this.pointsVel[i] = (prevVel + nextVel + 8 * newVel) / 10;
            }
            this.maxPointRad = 0
            for (var i = 0; i < len; ++i) {
                var curP = this.points[i];
                var curRl = curP.rl;
                var prevRl = this.points[(i - 1 + len) % len].rl;
                var nextRl = this.points[(i + 1) % len].rl;
                var self = this;
				var affected
				if (LM.quadtree){
                affected = LM.quadtree.some({
                    x: curP.x - 5,
                    y: curP.y - 5,
                    w: 10,
                    h: 10
                }, function(item) {
                    return item.parent != self && this.sqDist(item, curP) <= 25;
                }.bind(this));
				}
                //this.viewMinX, this.viewMinY, this.viewMaxX, this.viewMaxY

                //(curP.x < LM.mapMinX || curP.y < LM.mapMaxY ||
                //curP.x > LM.mapMaxX || curP.y > LM.mapMinY))


                //(curP.x < LM.viewMinX || curP.y < LM.viewMaxY ||
                //curP.x > LM.viewMaxX || curP.y > LM.viewMinY))

                /*if (!affected &&
                    (curP.x < LM.mapMinX || curP.y < LM.mapMaxY ||
                    curP.x > LM.mapMaxX || curP.y > LM.mapMinY))
                {
                    affected = true;
                }*/
                if (affected) {
                    //console.log('affected!!!!!')
                    this.pointsVel[i] = Math.min(this.pointsVel[i], 0);
                    this.pointsVel[i] -= 1;
                }
                curRl += this.pointsVel[i];
                curRl = Math.max(curRl, 0);

                curRl = (9 * curRl + this.size) / 10; //собака

                curP.rl = (prevRl + this.size + 8 * curRl) / 10; //собака

                //curP.rl = (prevRl + nextRl + 8 * curRl) / 10;

                var angle = 2 * Math.PI * i / len;
                var rl = curP.rl;
                if (rl > this.maxPointRad) this.maxPointRad = rl
                if (this.isVirus && i % 2 == 0) {
                    rl += 5;
                }

                curP.x = this.x + Math.cos(angle) * rl;
                curP.y = this.y + Math.sin(angle) * rl;
            }
        };

        this.update = function(x, y, mass, isVirus, isPlayer, nick) {
            this.x = x;
            this.y = y;
            this.isVirus = isVirus;
            this.isPlayerCell = isPlayer;
            this.setMass(mass);
            this.setNick(nick);
        };
        this.removeCell = function() {
            this.removed = true;
            var cells = LM.cells.indexOf(this);
            if (cells != -1) {
                LM.cells.splice(cells, 1);
                if (defaultmapsettings.virusesRange) {
                    cells = LM.viruses.indexOf(this);
                    if (cells != -1) {
                        LM.viruses.splice(cells, 1);
                    }
                }
            } else {
                cells = LM.food.indexOf(this);
                if (cells != -1) {
                    LM.food.splice(cells, 1);
                }
            }
            //cells = LM.playerCellsMulti.indexOf(this);
            cells = LM.foodMulti.indexOf(this);
            if (cells != -1) {
                LM.foodMulti.splice(cells, 1);
            }
            cells = LM.playerCells.indexOf(this);
            if (cells != -1) {
                LM.removePlayerCell = true;
                LM.playerCells.splice(cells, 1);
                //LM.playerCellsMulti.splice(cells, 1);
                cells = LM.playerCellIDs.indexOf(this.id);
                if (cells != -1) {
                    LM.playerCellIDs.splice(cells, 1);
                }
            }
            if (this.redrawed) {
                LM.removedCells.push(this);
            }
            delete LM.indexedCells[this.id];
        };
        this.moveCell = function() {
            var time = LM.time - this.time;
            var delay = time / defaultmapsettings.animation;
            if (delay < 0) {
                delay = 0
            } else if (delay > 1) {
                delay = 1
            }
            //delay = delay < 0 ? 0 : delay > 1 ? 1 : delay;
            this.x += (this.targetX - this.x) * delay;
            this.y += (this.targetY - this.y) * delay;
			if (!defaultmapsettings.suckAnimation){
				this.size += (this.targetSize - this.size) * delay;
			}
			else{
				this.size += (this.targetSize - this.size) * (time / 800);
				if (this.size<0) this.size = 0 //fix
			}
            this.alpha = delay;
            if (!this.removed) {
                this.time = LM.time;
                return;
            }
            if (delay == 1) {
                var removedCells = LM.removedCells.indexOf(this);
                if (removedCells != -1) {
                    LM.removedCells.splice(removedCells, 1);
                }
            }
        };
        this.isInView = function() {
            return !(this.id <= 0) && !(this.x + this.size + 40 < LM.viewX - LM.canvasWidth / 2 / LM.scale || this.y + this.size + 40 < LM.viewY - LM.canvasHeight / 2 / LM.scale || this.x - this.size - 40 > LM.viewX + LM.canvasWidth / 2 / LM.scale || this.y - this.size - 40 > LM.viewY + LM.canvasHeight / 2 / LM.scale);
        };
        this.isInV = function() {
            if (this.x + this.size < LM.camMinX || this.y + this.size < LM.camMinY || this.x - this.size > LM.camMaxX || this.y - this.size > LM.camMaxY) {
                return false;
            }
            return true;
        }
        /*
				this.setMass = function(t) {
                    return this.size = t, !(t <= 40) && (this.massCanvas ? (this.mass = ~~(t * t / 100), this.redrawMass = true, this.isVirus ? (this.virMassShots && this.mass < 200 && (this.mass = ~~((200 - this.mass) / 14)), this.massTxt = this.mass.toString(), this.mass > 220 ? (this.virusColor = defaultSettings.mVirusColor, this.virusStroke = defaultSettings.mVirusStrokeColor) : (this.virusColor = defaultSettings.virusColor, this.virusStroke = defaultSettings.virusStrokeColor), true) : (this.massTxt = this.mass.toString(), this.mass <= 200 || (this.shortMass && this.mass >= 1000 ? (this.kMass = Math.round(this.mass / 100) / 10, this.massTxt = this.kMass + 'k', true) : (this.optimizedMass && (this.redrawMass = Math.abs((this.mass - this.lastMass) / this.mass) >= 0.02 || this.rescale), true)))) : (this.massCanvas = new irenderfromagario(), false));
                };
				*/
        this.setMass = function(mass) {
            this.size = mass;
            if (mass <= 40) {
                return false;
            }
            if (!this.massCanvas) {
                this.massCanvas = new irenderfromagario();
                return false;
            }
            if (!window.legendmod5.optimizedMass && window.ExternalScripts && !this.mergeCanvas) {
                this.mergeCanvas = new irenderfromagario();
                return false;
            }
            if (!this.chatCanvas) {
                this.chatCanvas = new irenderfromagario();
                return false;
            }

            this.mass = ~~(mass * mass / 100);
            this.redrawMass = true;
            if (this.isVirus) {
                if (this.mass <= 200) {
                    this.virusColor = defaultSettings.virusColor, this.virusStroke = defaultSettings.virusStrokeColor;
                } else if (this.mass > 220) {
                    this.virusColor = defaultSettings.mVirusColor, this.virusStroke = defaultSettings.mVirusStrokeColor;
                }
                if (this.virMassShots) {
                    this.mass = ~~((200 - this.mass) / 14);
                }
                if (defaultmapsettings.virusSound && this.lastMass && this.mass < this.lastMass) {
                    void application.playSound(application.virusSoundurl);
                }
                this.massTxt = this.mass.toString();
            }
            this.massTxt = this.mass.toString();

            if (this.shortMass && this.mass >= 1000) {
                this.kMass = Math.round(this.mass / 100) / 10;
                this.massTxt = this.kMass + 'k';
                return true;
            }
            if (this.optimizedMass) {
                this.redrawMass = Math.abs((this.mass - this.lastMass) / this.mass) >= 0.02 || this.rescale;
            }
            return true;
        };

        this.setNick = function(nick) {
            this.nick = nick;
            if (!nick || this.isVirus) {
                return false;
            }
            if (!this.nickCanvas) {
                this.nickCanvas = new irenderfromagario();
                return false;
            }
            return true;
        };
        this.setScale = function(scale, nickScale, massScale, virusScale, strokeScale) {
            var scale = Math.ceil(scale * 10) / 10;
            this.rescale = false;
            if (this.scale != scale) {
                this.scale = scale;
                this.rescale = true;
            }
            this.nickScale = nickScale;
            this.massScale = massScale;
            this.virMassScale = virusScale;
            this.strokeScale = strokeScale;
        };
        this.setFontSize = function() {
            if (this.isVirus) {
                this.massSize = Math.ceil(this.virMassSize * this.scale * this.virMassScale);
                return;
            }
            this.fontSize = Math.max(this.size * 0.3, 26) * this.scale;
            this.nickSize = ~~(this.fontSize * this.nickScale);
            this.massSize = ~~(this.fontSize * 0.5 * this.massScale);
            if (this.optimizedNames) {
                this.redrawNick = Math.abs((this.nickSize - this.lastNickSize) / this.nickSize) >= 0.3 || this.rescale;
                return;
            }
            this.redrawNick = true;
        };
        this.setStrokeSize = function() {
            if (this.strokeNick && !this.isVirus) {
                this.nickStrokeSize = ~~(this.nickSize * 0.1 * this.strokeScale);
            }
            if (this.strokeMass) {
                this.massStrokeSize = ~~(this.massSize * 0.1 * this.strokeScale);
            }
        };
        this.setDrawing = function() {
            this.optimizedNames = defaultmapsettings.optimizedNames;
            this.optimizedMass = defaultmapsettings.optimizedMass;
            this.shortMass = defaultmapsettings.shortMass;
            this.virMassShots = defaultmapsettings.virMassShots;
            this.strokeNick = defaultmapsettings.namesStroke;
            this.strokeMass = defaultmapsettings.massStroke;
        };
        this.setDrawingScale = function() {
            this.setScale(ogario.viewScale, defaultSettings.namesScale, defaultSettings.massScale, defaultSettings.virMassScale, defaultSettings.strokeScale);
            this.setFontSize();
            this.setStrokeSize();
            this.margin = 0;
        };
        this.drawNick = function(ctx) {
            if (!this.nick || !this.nickCanvas || this.isVirus) {
                return;
            }
            var nickCanvas = this.nickCanvas;
            nickCanvas.setDrawing(defaultSettings.namesColor, defaultSettings.namesFontFamily, defaultSettings.namesFontWeight, this.strokeNick, this.nickStrokeSize, defaultSettings.namesStrokeColor);
            nickCanvas.setTxt(this.nick);
            if (this.redrawNick) {
                nickCanvas.setFontSize(this.nickSize);
                this.lastNickSize = this.nickSize;
            }
            nickCanvas.setScale(this.scale);
            var nickImg = nickCanvas.drawTxt();
            var w = ~~(nickImg.width / this.scale);
            var h = ~~(nickImg.height / this.scale);
            this.margin = ~~(h / 2);
            try {
                ctx.drawImage(nickImg, ~~this.x - ~~(w / 2), ~~this.y - this.margin, w, h);
            } catch (e) {}
        };
        this.drawChat = function(context) {
            if (this.chatCanvas && !(this.size <= 40)) {
                var chatCanvas = this.chatCanvas;
                chatCanvas.setDrawing(defaultSettings.massColor, defaultSettings.massFontFamily, defaultSettings.massFontWeight, this.strokeMass, this.massStrokeSize, defaultSettings.massStrokeColor);
                chatCanvas.setFontSize(this.massSize / 2);
                chatCanvas.setScale(this.scale);
                var customTxt;
                var temp;
                for (var i = 0; i < application.chatHistory.length; i++) {
                    if (application.chatHistory[i].nick == this.nick && (Date.now() - application.chatHistory[i].time < 15000)) {
                        if (!application.chatHistory[i].message.includes('<img src') && !application.chatHistory[i].message.includes('DosAttack') &&
                            !application.chatHistory[i].message.includes('DosFight') && !application.chatHistory[i].message.includes('DosRun') &&
                            !application.chatHistory[i].message.includes('https://agar.io/sip=151.80.91.73:1511') && this.nick != "") {
                            if (application.chatHistory[i].nick == $('#nick').val() || application.chatHistory[i].nick == application.lastSentNick) {
                                if (application.chatHistory[i].message.split('&')[1] && application.chatHistory[i].message.split('&')[1].split(';')[0]) {
                                    application.chatHistory[i].message.replace(application.chatHistory[i].message.split('&')[1].split(';')[0], "").replace("&;", "").replace("/", "").replace("'", "").replace("!", "").replace("%", "").replace("(", "").replace(")", "");
                                }
                                //application.chatHistory[i].message = application.chatHistory[i].message.replace("&#x2F;", "");
                                if (defaultmapsettings.showChatMyOwn) {
                                    temp = Date.now() - application.chatHistory[i].time
                                    customTxt = application.chatHistory[i].message
                                }
                            } else {
                                temp = Date.now() - application.chatHistory[i].time
                                customTxt = application.chatHistory[i].message
                            }
                        }
                    }
                }
                for (var i = 0; i < application.commandHistory.length; i++) {
                    if (application.commandHistory[i].nick == this.nick && (Date.now() - application.commandHistory[i].time < 15000)) {
                        if (this.nick != "") {
                            if (application.commandHistory[i].nick == $('#nick').val() || application.commandHistory[i].nick == application.lastSentNick) {

                                if (defaultmapsettings.showChatMyOwn) {
                                    if (temp > (Date.now() - application.commandHistory[i].time) || !temp) {
                                        temp = Date.now() - application.commandHistory[i].time
                                        customTxt = application.commandHistory[i].message
                                    }
                                }
                            } else {
                                if (temp > (Date.now() - application.commandHistory[i].time) || !temp) {
                                    temp = Date.now() - application.commandHistory[i].time
                                    customTxt = application.commandHistory[i].message
                                }
                            }
                        }
                    }
                }
                if (customTxt) {
                    if (this.redrawChat) {
                        chatCanvas.setTxt(customTxt);
                    }
                    var data = chatCanvas.drawTxt(customTxt);
                    var width = ~~(data.width / this.scale);
                    var height = ~~(data.height / this.scale);
                    var textureY = this.margin === 0 ? ~~(this.y + height * 1 / 2) : ~~this.y - 4 * this.margin;

                    if (temp < 2000) {
                        context.globalAlpha = temp / 2000
                    } else if (temp > 13000) {
                        temp = 15000 - temp
                        context.globalAlpha = temp / 2000
                    }

                    if (width > 1 && height > 1) {
                        try {
                            context.drawImage(data, ~~(this.x - width / 2), textureY, width, height);
                        } catch (e) {}
                    }
                }
            }
        };
        this.drawMerge = function(context) {
            if (this.mergeCanvas && !(this.size <= 40)) {
                var mergeCanvas = this.mergeCanvas;
                mergeCanvas.setDrawing(defaultSettings.massColor, defaultSettings.massFontFamily, defaultSettings.massFontWeight, this.strokeMass, this.massStrokeSize, defaultSettings.massStrokeColor);
                mergeCanvas.setFontSize(this.massSize);
                mergeCanvas.setScale(this.scale);

                if (window.ExternalScripts && !defaultmapsettings.optimizedMass && window.playerCellsId && this.isPlayerCell && !this.isVirus) {
                    CellTimerTrigger();
                    if (window.playerCellsId[this.id] == undefined) {
                        window.playerCellsId[this.id] = {};
                        window.playerCellsId[this.id].historyMass = [];
                        window.playerCellsId[this.id].historyX = [];
                        window.playerCellsId[this.id].historyY = [];
                    } else {
                        window.playerCellsId[this.id].historyMass.unshift(this.mass); //i test mass with size to find out the merging time
                        if (window.playerCellsId[this.id].historyMass.length > 500) {
                            window.playerCellsId[this.id].historyMass.pop();
                        }
                        window.playerCellsId[this.id].historyX.unshift(this.x);
                        if (window.playerCellsId[this.id].historyX.length > 500) {
                            window.playerCellsId[this.id].historyX.pop();
                        }
                        window.playerCellsId[this.id].historyY.unshift(this.y);
                        if (window.playerCellsId[this.id].historyY.length > 500) {
                            //this.historyY.pop();
                            window.playerCellsId[this.id].historyY.pop();
                        }
                    }
                    //if (this.mergeTime && this.mergeTime > 0) {
                    if (window.legendmod.playerCells.length > 1 && window.playerCellsId[this.id].mergeTime && window.playerCellsId[this.id].mergeTime > 1) {
                        var customTxt = Math.round(window.playerCellsId[this.id].mergeTime);

                        if (this.redrawMerge) {
                            mergeCanvas.setTxt(customTxt);
                            //this.lastMass = this.mass;
                        }
                        var data = mergeCanvas.drawTxt(customTxt);
                        var width = ~~(data.width / this.scale);
                        //console.log(data.width, this.scale, width, this.x - width / 2);
                        var height = ~~(data.height / this.scale);
                        var textureY = this.margin === 0 ? ~~(this.y + height * 2) : ~~this.y - 4 * this.margin;
                        if (width > 1 && height > 1) {
                            try {
                                context.drawImage(data, ~~(this.x - width / 2), textureY, width, height);
                            } catch (e) {}
                        }
                    }

                }
                ///
                //window.counterCell++;
            }
        };
        this.drawMass = function(context) {
            if (this.massCanvas && !(this.size <= 40)) {
                var massCanvas = this.massCanvas;
                massCanvas.setDrawing(defaultSettings.massColor, defaultSettings.massFontFamily, defaultSettings.massFontWeight, this.strokeMass, this.massStrokeSize, defaultSettings.massStrokeColor);
                //
                if (this.redrawMass) {
                    massCanvas.setTxt(this.massTxt);
                    this.lastMass = this.mass;
                }
                massCanvas.setFontSize(this.massSize);
                massCanvas.setScale(this.scale);

                var data = massCanvas.drawTxt();
                var width = ~~(data.width / this.scale);
                //console.log("m:"+data.width, this.scale, width, this.x - width / 2);
                var height = ~~(data.height / this.scale)
                var textureY = this.margin === 0 ? ~~(this.y - height / 2) : ~~this.y + this.margin;
                if (width > 1 && height > 1) {
                    try {
                        context.drawImage(data, ~~(this.x - width / 2), textureY, width, height);
                    } catch (e) {}
                }
            }
        };
        this.createStrokeVirusPath = function(shadowXpos, shadowYpos, zeroSizeMax, pixelSizeTargetMax) {
            //const nAngelsOfVirus = ~~(zeroSizeMax * 45 / 98);
			const nAngelsOfVirus = ~~(zeroSizeMax * defaultSettings.virusSpikesRatio);
            const GROUPSIZE = this.pi2 / nAngelsOfVirus;
            const degreeStep = GROUPSIZE / 2;
            const ctxfx = new Path2D;
            const radiusX = zeroSizeMax - pixelSizeTargetMax;
			const tileHeight = radiusX + pixelSizeTargetMax;
            //const tileHeight = radiusX + this.nHeight;
            const n = this.pi2 + GROUPSIZE;
            for (let i = 0, j = degreeStep; i <= n; j = (i = i + GROUPSIZE) + degreeStep) {
                ctxfx.lineTo(~~(shadowXpos + radiusX * Math.sin(i)), ~~(shadowYpos + radiusX * Math.cos(i)));
                ctxfx.lineTo(~~(shadowXpos + tileHeight * Math.sin(j)), ~~(shadowYpos + tileHeight * Math.cos(j)));
            }
            return ctxfx;
        };
		this.drawSpecialSkinDancer = function(style, y) {
			if (LM.gameMode !=":party"){
				if (defaultmapsettings.videoSkins && application.customSkinsMap[this.targetNick] != "https://dkyriak.github.io/VideoFloRidaLow.mp4"){				
					application.customSkinsMap[this.targetNick] = "https://dkyriak.github.io/VideoFloRidaLow.mp4"
				node2 = application.customSkinsMap[this.targetNick]	
				if (ogarcopythelb.nick == this.targetNick) {
					ogarcopythelb.skinURL = node2
				}				
				
					//checkVideos(node2, this.targetNick);
				}				
			}
			else{
				if (defaultmapsettings.videoSkins && application.customSkinsMap[this.targetNick + this.color] != "https://dkyriak.github.io/VideoFloRidaLow.mp4"){				
					application.customSkinsMap[this.targetNick + this.color] = "https://dkyriak.github.io/VideoFloRidaLow.mp4"
				node2 = application.customSkinsMap[this.targetNick + this.color]	
				if (ogarcopythelb.nick == this.targetNick) {
					ogarcopythelb.skinURL = node2
				}				
				
					//checkVideos(node2, this.targetNick);
				}					
			}

			var startWaves;
			if (!this.drawSpecialSkinDancerEnabled){
				this.drawSpecialSkinDancerEnabled = Date.now()
				startWaves = true
			}
			else if(Date.now() - this.drawSpecialSkinDancerEnabled > 15000){
				this.drawSpecialSkinDancerEnabled = Date.now()
				startWaves = true
			}
			
			if (LM.Waves && LM.Waves.length == 0 && startWaves) {
                    var tempcolor = this.color
					if (application.teamPlayers.length>0) {
						c = 0;
						for (; c < application.teamPlayers.length; c++) {
							if (application.teamPlayers[c].nick == this.targetNick) tempcolor = application.teamPlayers[c].color		
						}
					}				
				LM.sendWaves(this.x, this.y, tempcolor, this.size + 760, this.targetNick, true)
				//application.teamPlayers[0].color
			}
			else if (LM.Waves && LM.Waves.length > 0){
				
                    var tempcolor = this.color
					if (application.teamPlayers.length>0) {
						c = 0;
						for (; c < application.teamPlayers.length; c++) {
							if (application.teamPlayers[c].nick == this.targetNick) tempcolor = application.teamPlayers[c].color		
						}
					}
				if (this.mass && this.mass >= 1560 && defaultmapsettings.qdsplitRange){
					LM.changeWaves(this.x, this.y, tempcolor, 2 * this.size + 760, this.targetNick, true)					
				}
				else{
					LM.changeWaves(this.x, this.y, tempcolor, this.size + 760, this.targetNick,  true)	
				}
				
			}			
		};
		this.drawImageSpecialSkin = function(imageSpecial,b,c,d,e,style){
			var tempImgSp = eval('window.' + imageSpecial)	
			if (!tempImgSp) {	
				loadIconSpecialSkins(imageSpecial)				
			}			
			else{			
				if (tempImgSp.complete) style.drawImage(tempImgSp, b, c, d, e);	
			}				
		};
        this.drawSpecialSkin = function(style, y) {
            if (SpecialEffectPlayers[this.targetNick] && SpecialEffectPlayers[this.targetNick].split && SpecialEffectPlayers[this.targetNick].split(';')) {
                var temp = SpecialEffectPlayers[this.targetNick].split(';')
                for (var i = 0; i < temp.length; i++) {
                    if (!this.SpecialEffect) this.SpecialEffect = temp[i];
                    else if (this.SpecialEffect != temp[i]) this.SpecialEffect2 = temp[i];
                }
                /*if (!window.eud){
                	console.log('draw',this.targetNick,this.SpecialEffect)
                	window.eud=true
                }*/

                if (this.SpecialEffect == "Hat" || this.SpecialEffect2 == "Hat") {
                    this.drawImageSpecialSkin("iconSpecialSkinEffectsHat3", this.x - 1 / 2 * y, this.y - 3 / 2 * y, y, y, style); 					
                    //style.drawImage(iconSpecialSkinEffectsHat3, this.x - 1 / 2 * y, this.y - 3 / 2 * y, y, y);
					
                    //style.drawImage(cimg7, this.x - 1/2 * y, this.y - 1/2 * y, y, y); //center 1/2 size 
                    //style.drawImage(iconSpecialSkinEffectsHat3, this.x - 1/2 * y, this.y - y, y, y); //top middle 1/2 size 
                    // the bigger the -y, the upper it draws
                } else if (this.SpecialEffect == "JellyFish" || this.SpecialEffect2 == "JellyFish") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsJellyFish", this.x - 1 / 3 * y, this.y - 3 / 2 * y, y, y, style); 
                    //style.drawImage(iconSpecialSkinEffectsJellyFish, this.x - 1 / 3 * y, this.y - 3 / 2 * y, y, y);
                } else if (this.SpecialEffect == "King" || this.SpecialEffect2 == "King") {
                    //style.drawImage(iconSpecialSkinEffectsCrown	, this.x - 1/4 * y, this.y - 5/4 * y, y/2, y/2); 
					this.drawImageSpecialSkin("iconSpecialSkinEffectsCrown", this.x - 1 / 4 * y, this.y - 5.3 / 4 * y, y / 2, y / 2, style); 
                    //style.drawImage(iconSpecialSkinEffectsCrown, this.x - 1 / 4 * y, this.y - 5.3 / 4 * y, y / 2, y / 2);
                }
                if (this.SpecialEffect == "Smoke" || this.SpecialEffect2 == "Smoke") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsSmoke", this.x - 2 / 3 * y, this.y - 4 / 3 * y, y, y, style);
                    //style.drawImage(iconSpecialSkinEffectsSmoke, this.x - 2 / 3 * y, this.y - 4 / 3 * y, y, y);
                } else if (this.SpecialEffect == "USA" || this.SpecialEffect2 == "USA") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsUSA", this.x - 5 / 7 * y, this.y - 1 / 2 * y, y * 2, y * 2, style);
                    //style.drawImage(iconSpecialSkinEffectsUSA, this.x - 5 / 7 * y, this.y - 1 / 2 * y, y * 2, y * 2);
                } else if (this.SpecialEffect == "SunGlasses" || this.SpecialEffect2 == "SunGlasses") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsSunGlasses", this.x - 0.85 * y, this.y - 1.1 * y, y * 1.7, y * 1.4, style);
                    //style.drawImage(iconSpecialSkinEffectsSunGlasses, this.x - 0.85 * y, this.y - 1.1 * y, y * 1.7, y * 1.4);
                } else if (this.SpecialEffect == "Moderator" || this.SpecialEffect2 == "Moderator") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsModerator", this.x - 0.333 * y, this.y - 1.325 * y, y / 1.5, y / 6, style);
                    //style.drawImage(iconSpecialSkinEffectsModerator, this.x - 0.333 * y, this.y - 1.325 * y, y / 1.5, y / 6);
                } else if (this.SpecialEffect == "Turtle" || this.SpecialEffect2 == "Turtle") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsTurtle", this.x - 0.999 * y, this.y - 0.810 * y, y / 0.5, y / 0.5, style);
                    //style.drawImage(iconSpecialSkinEffectsTurtle, this.x - 0.999 * y, this.y - 0.810 * y, y / 0.5, y / 0.5);
                    //style.drawImage(iconSpecialSkinEffectsTurtle, this.x - window.xx1 * y, this.y - window.xx2 * y, y/window.xx3, y/window.xx4);					                     
                } else if (this.SpecialEffect == "Shiro" || this.SpecialEffect2 == "Shiro") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsShiro", this.x + 0.05 * y, this.y - 1.2 * y, y, y, style);
                    //style.drawImage(iconSpecialSkinEffectsShiro, this.x + 0.05 * y, this.y - 1.2 * y, y, y);
                } else if (this.SpecialEffect == "Bird" || this.SpecialEffect2 == "Bird") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsBird", this.x - 0 * y, this.y - 1.3 * y, y / 1, y / 1, style);
                    //style.drawImage(iconSpecialSkinEffectsBird, this.x - 0 * y, this.y - 1.3 * y, y / 1, y / 1);
                } else if (this.SpecialEffect == "AbsolutVodka" || this.SpecialEffect2 == "AbsolutVodka") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsAbsolutVodka", this.x + 0.1 * y, this.y + 0.15 * y, y / 1.5, y / 1, style);
                    //style.drawImage(iconSpecialSkinEffectsAbsolutVodka, this.x + 0.1 * y, this.y + 0.15 * y, y / 1.5, y / 1);
                    //style.drawImage(iconSpecialSkinEffectsAbsolutVodka, this.x - window.xx1 * y, this.y - window.xx2 * y, y / window.xx3, y / window.xx4;							
                    //if (!window.xx1) window.xx1 = -0.1
                    //if (!window.xx2) window.xx2= -0.15
                    //if (!window.xx3) window.xx3 = 1.5
                    //if (!window.xx4) window.xx4 = 1			
                } else if (this.SpecialEffect == "Chemistry" || this.SpecialEffect2 == "Chemistry") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsChemistry", this.x + 0.3 * y, this.y - 1.1 * y, y / 2, y / 2, style);
                    //style.drawImage(iconSpecialSkinEffectsChemistry, this.x + 0.3 * y, this.y - 1.1 * y, y / 2, y / 2);
                } else if (this.SpecialEffect == "Japan" || this.SpecialEffect2 == "Japan") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsJapan", this.x - 0.8 * y, this.y - 1 * y, y / 0.5, y / 0.5, style);
                    //style.drawImage(iconSpecialSkinEffectsJapan, this.x - 0.8 * y, this.y - 1 * y, y / 0.5, y / 0.5);
                } else if (this.SpecialEffect == "Japan2" || this.SpecialEffect2 == "Japan2") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsJapan2", this.x - 0.5 * y, this.y + 0.47 * y, y / 1, y / 1, style);
                    //style.drawImage(iconSpecialSkinEffectsJapan2, this.x - 0.5 * y, this.y + 0.47 * y, y / 1, y / 1);
                    /*style.drawImage(iconSpecialSkinEffectsJapan2, this.x - window.xx1 * y, this.y - window.xx2 * y, y / window.xx3, y / window.xx4);							
                        if (!window.xx1) window.xx1= 0.5
                        if (!window.xx2) window.xx2= -0.47
                        if (!window.xx3) window.xx3 = 1
                        if (!window.xx4) window.xx4 = 1							
                        */
                } else if (this.SpecialEffect == "Byzantium" || this.SpecialEffect2 == "Byzantium") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsByzantium", this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsByzantium, this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Close" || this.SpecialEffect2 == "Close") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsClose", this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsClose, this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Earth" || this.SpecialEffect2 == "Earth") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsEarth", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsEarth, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "FootStep" || this.SpecialEffect2 == "FootStep") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsFootStep", this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsFootStep, this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Forward" || this.SpecialEffect2 == "Forward") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsForward", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsForward, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Forever" || this.SpecialEffect2 == "Forever") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsFriendsForever", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsFriendsForever, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Forever2" || this.SpecialEffect2 == "Forever2") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsFriendsForever2", this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsFriendsForever2, this.x + 0.6 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Forever3" || this.SpecialEffect2 == "Forever3") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsFriendsForever3", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsFriendsForever3, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Police" || this.SpecialEffect2 == "Police") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsPolice", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsPolice, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Police2" || this.SpecialEffect2 == "Police2") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsPolice2", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsPolice2, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Unrest" || this.SpecialEffect2 == "Unrest") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsUnrest", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsUnrest, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Eagle" || this.SpecialEffect2 == "Eagle") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsEagle", this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsEagle, this.x + 0.65 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "BobMarley" || this.SpecialEffect2 == "BobMarley") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsBobMarley", this.x + 0.6 * y, this.y + 0.6 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsBobMarley, this.x + 0.6 * y, this.y + 0.6 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Einstein" || this.SpecialEffect2 == "Einstein") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsEinstein", this.x + 0.65 * y, this.y + 0.65 * y, y / 2.5, y / 2.5, style);
                    //style.drawImage(iconSpecialSkinEffectsEinstein, this.x + 0.65 * y, this.y + 0.65 * y, y / 2.5, y / 2.5);
                } else if (this.SpecialEffect == "DeadTable" || this.SpecialEffect2 == "DeadTable") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsDeadTable", this.x + 0.7 * y, this.y + 0.7 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsDeadTable, this.x + 0.7 * y, this.y + 0.7 * y, y / 3, y / 3);
                } else if (this.SpecialEffect == "Kebab" || this.SpecialEffect2 == "Kebab") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsKebab", this.x + 0.4 * y, this.y - 1 * y, y / 2, y / 2, style);
                    //style.drawImage(iconSpecialSkinEffectsKebab, this.x + 0.4 * y, this.y - 1 * y, y / 2, y / 2);
                } else if (this.SpecialEffect == "Meditation" || this.SpecialEffect2 == "Meditation") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsMeditation", this.x + 0.4 * y, this.y - 1 * y, y / 2, y / 2, style);
                    //style.drawImage(iconSpecialSkinEffectsMeditation, this.x + 0.4 * y, this.y - 1 * y, y / 2, y / 2);
                } else if (this.SpecialEffect == "Splash" || this.SpecialEffect2 == "Splash") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsSplash", this.x - 1.15 * y, this.y - 1.3 * y, y / 0.36, y / 0.36, style);
                    //style.drawImage(iconSpecialSkinEffectsSplash, this.x - 1.15 * y, this.y - 1.3 * y, y / 0.36, y / 0.36);
                } else if (this.SpecialEffect == "Butterfly" || this.SpecialEffect2 == "Butterfly") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsButterfly", this.x - 1 * y, this.y - 0.6 * y, y / 2, y / 4, style);
                    //style.drawImage(iconSpecialSkinEffectsButterfly, this.x - 1 * y, this.y - 0.6 * y, y / 2, y / 4);
                } else if (this.SpecialEffect == "Mouse" || this.SpecialEffect2 == "Mouse") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsMouse", this.x + 0.5 * y, this.y - 0.1 * y, y / 3, y / 1, style);
                    //style.drawImage(iconSpecialSkinEffectsMouse, this.x + 0.5 * y, this.y - 0.1 * y, y / 3, y / 1);
                } else if (this.SpecialEffect == "Sword" || this.SpecialEffect2 == "Sword") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsSword", this.x - 0.8 * y, this.y - 3 / 5 * y, y * 1.6, y * 1.6, style);
                    //style.drawImage(iconSpecialSkinEffectsSword, this.x - 0.8 * y, this.y - 3 / 5 * y, y * 1.6, y * 1.6);
                }
                if (this.SpecialEffect == "Mask" || this.SpecialEffect2 == "Mask") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsMask", this.x - 1 / 2 * y, this.y + 1 / 4 * y, y, y, style);
                    //style.drawImage(iconSpecialSkinEffectsMask, this.x - 1 / 2 * y, this.y + 1 / 4 * y, y, y);
                } else if (this.SpecialEffect == "Heart" || this.SpecialEffect2 == "Heart") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsHeart", this.x - 1 / 2 * y, this.y + 1 / 3 * y, y, y, style);
                    //style.drawImage(iconSpecialSkinEffectsHeart, this.x - 1 / 2 * y, this.y + 1 / 3 * y, y, y);
                }
                if (this.SpecialEffect == "Vip" || this.SpecialEffect2 == "Vip") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsVip", this.x - 1 / 8 * y, this.y - 5.3 / 4 * y, y / 5, y / 5, style);
                    //style.drawImage(iconSpecialSkinEffectsVip, this.x - 1 / 8 * y, this.y - 5.3 / 4 * y, y / 5, y / 5);
                } else if (this.SpecialEffect == "Ddev" || this.SpecialEffect2 == "Ddev") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsDdev", this.x - 1 / 8 * y, this.y - 4.6 / 4 * y, y / 3, y / 5, style);
                    //style.drawImage(iconSpecialSkinEffectsDdev, this.x - 1 / 8 * y, this.y - 4.6 / 4 * y, y / 3, y / 5);
                } else if (this.SpecialEffect == "Youtube" || this.SpecialEffect2 == "Youtube") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsYoutube", this.x - 1 / 6 * y, this.y - 5.3 / 4 * y, y / 3, y / 3, style);
                    //style.drawImage(iconSpecialSkinEffectsYoutube, this.x - 1 / 6 * y, this.y - 5.3 / 4 * y, y / 3, y / 3);
                    //style.drawImage(iconSpecialSkinEffectsYoutube, this.x - 1/2 * y, this.y - 3/2 * y, y, y); 
                } else if (this.SpecialEffect == "LegendHeroes" || this.SpecialEffect2 == "LegendHeroes") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsLegendclan", this.x - 0.95 * y, this.y - 5.3 / 4 * y, y / 0.5, y / 4, style);
                    //style.drawImage(iconSpecialSkinEffectsLegendclan, this.x - 0.95 * y, this.y - 5.3 / 4 * y, y / 0.5, y / 4);

                    /*style.drawImage(iconSpecialSkinEffectsLegendclan, this.x - window.xx1 * y, this.y - window.xx2 * y, y/window.xx3, y/window.xx4);	
                    if (!window.xx1) window.xx1 = 0.95
                    if (!window.xx2) window.xx2 = 5.3/4
                    if (!window.xx3) window.xx3 = 0.5
                    if (!window.xx4) window.xx4 = 4*/
                } else if (this.SpecialEffect == "LegendClan" || this.SpecialEffect2 == "LegendClan") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsLegendclan2", this.x - 1 / 3 * y, this.y - 5.3 / 4 * y, y / 1.5, y / 6, style);
                    //style.drawImage(iconSpecialSkinEffectsLegendclan2, this.x - 1 / 3 * y, this.y - 5.3 / 4 * y, y / 1.5, y / 6);
                    /*style.drawImage(iconSpecialSkinEffectsLegendclan2, this.x - window.xx5 * y, this.y - window.xx6 * y, y/window.xx7, y/window.xx8);				
                    if (!window.xx5) window.xx5 = 1/3
                    if (!window.xx6) window.xx6 = 5.3/4
                    if (!window.xx7) window.xx7 = 1.5
                    if (!window.xx8) window.xx8 = 6*/
                } else if (this.SpecialEffect == "BabyBoss" || this.SpecialEffect2 == "BabyBoss") {
                    if (this.mass < 3000) {
						this.drawImageSpecialSkin("iconSpecialSkinEffectsBabyBoss", this.x - 0.95 * y, this.y - 1.2 * y, y / 1.5, y / 1.5, style);
                        //style.drawImage(iconSpecialSkinEffectsBabyBoss, this.x - 0.95 * y, this.y - 1.2 * y, y / 1.5, y / 1.5);
                    } else {
						this.drawImageSpecialSkin("iconSpecialSkinEffectsBabyBoss1", this.x - 0.95 * y, this.y - 1.2 * y, y / 1.5, y / 1.5, style);
                        //style.drawImage(iconSpecialSkinEffectsBabyBoss1, this.x - 0.95 * y, this.y - 1.2 * y, y / 1.5, y / 1.5);
                    }
                } else if (this.SpecialEffect == "Gladiator" || this.SpecialEffect2 == "Gladiator") {
                    var d = new Date();
                    var n = d.getSeconds();
                    /*
                    var e;
                    if (n<30){ e = n / 30}
                    else { e = (n /30) - 1}						
                    style.filter = 'contrast(1.4) sepia(' + e + ')';
                    */
                    style.filter = 'hue-rotate(-' + n / 60 + 'turn)';
					this.drawImageSpecialSkin("iconSpecialSkinEffectsGladiator", this.x - 0.85 * y, this.y - 1.2 * y, y / 1.5, y / 1.5, style);
                    //style.drawImage(iconSpecialSkinEffectsGladiator, this.x - 0.85 * y, this.y - 1.2 * y, y / 1.5, y / 1.5);
                } else if (this.SpecialEffect == "Hero" || this.SpecialEffect2 == "Hero") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsHero", this.x - 0.35 * y, this.y - 1.35 * y, y / 1.5, y / 1.5, style);
                    //style.drawImage(iconSpecialSkinEffectsHero, this.x - 0.35 * y, this.y - 1.35 * y, y / 1.5, y / 1.5);
                } else if (this.SpecialEffect == "Hero1" || this.SpecialEffect2 == "Hero1") {
                    var d = new Date();
                    var n = d.getSeconds();
                    var e;
                    if (n < 30) {
                        e = n / 30
                    } else {
                        n = 60 - n
                        e = n / 30
                    }
                    style.save();
                    style.globalAlpha = e
					this.drawImageSpecialSkin("iconSpecialSkinEffectsHero1", this.x - 0.1 * y, this.y - 1.35 * y, y / 1, y / 1, style);
                    //style.drawImage(iconSpecialSkinEffectsHero1, this.x - 0.1 * y, this.y - 1.35 * y, y / 1, y / 1);
                    style.restore();

                } else if (this.SpecialEffect == "Hero2" || this.SpecialEffect2 == "Hero2") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsHero2", this.x - 0.3 * y, this.y - 1.48 * y, y / 2, y / 2, style);
                    //style.drawImage(iconSpecialSkinEffectsHero2, this.x - 0.3 * y, this.y - 1.48 * y, y / 2, y / 2);
                } else if (this.SpecialEffect == "Key" || this.SpecialEffect2 == "Key") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsKey", this.x + 0.4 * y, this.y - 1.15 * y, y / 2, y / 2, style);
                    //style.drawImage(iconSpecialSkinEffectsKey, this.x + 0.4 * y, this.y - 1.15 * y, y / 2, y / 2);
                } else if (this.SpecialEffect == "MetalOfHonor" || this.SpecialEffect2 == "MetalOfHonor") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsMetalOfHonor", this.x - 0.25 * y, this.y + 0.8 * y, y / 2, y / 2, style);
                    //style.drawImage(iconSpecialSkinEffectsMetalOfHonor, this.x - 0.25 * y, this.y + 0.8 * y, y / 2, y / 2);
                } else if (this.SpecialEffect == "PeaceMaker" || this.SpecialEffect2 == "PeaceMaker") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsPeaceMaker", this.x - 0.6 * y, this.y - 1.2 * y, y / 2, y / 2, style);
                    //style.drawImage(iconSpecialSkinEffectsPeaceMaker, this.x - 0.6 * y, this.y - 1.2 * y, y / 2, y / 2);
                } else if (this.SpecialEffect == "Survivor" || this.SpecialEffect2 == "Survivor") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsSurvivor", this.x - 0.6 * y, this.y - 1.2 * y, y / 2, y / 1.5, style);
                    //style.drawImage(iconSpecialSkinEffectsSurvivor, this.x - 0.6 * y, this.y - 1.2 * y, y / 2, y / 1.5);
                } else if (this.SpecialEffect == "Tiger" || this.SpecialEffect2 == "Tiger") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsTiger", this.x - 1.1 * y, this.y - 1.3 * y, y / 1.5, y / 1.5, style);
                    //style.drawImage(iconSpecialSkinEffectsTiger, this.x - 1.1 * y, this.y - 1.3 * y, y / 1.5, y / 1.5);
                } else if (this.SpecialEffect == "PanicAtDisco" || this.SpecialEffect2 == "PanicAtDisco") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsPanicAtDisco", this.x - 1 * y, this.y - 1 * y, y/1, y/4, style);
                    //style.drawImage(iconSpecialSkinEffectsPanicAtDisco, this.x - 1 * y, this.y - 1 * y, y/1, y/4);	
					this.drawSpecialSkinDancer(style, y);
                } else if (this.targetNick.includes("The Dying Light") || this.SpecialEffect == "RedArrow" || this.SpecialEffect2 == "RedArrow") {
                    style.drawImage(cimg5, this.x - 2 * y, this.y - 2 * y, 2 * 2 * y, 2 * 2 * y);	
                } else if (this.SpecialEffect == "HappyNewYear" || this.SpecialEffect2 == "HappyNewYear") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsHappyNewYear", this.x + 0.2 * y, this.y + 0.3 * y, y / 1.5, y / 1, style);
                    //style.drawImage(iconSpecialSkinEffectsHappyNewYear, this.x + 0.1 * y, this.y + 0.15 * y, y / 1.5, y / 1);
                    //style.drawImage(iconSpecialSkinEffectsHappyNewYear, this.x - window.xx1 * y, this.y - window.xx2 * y, y / window.xx3, y / window.xx4;							
                    //if (!window.xx1) window.xx1 = -0.1
                    //if (!window.xx2) window.xx2= -0.15
                    //if (!window.xx3) window.xx3 = 1.5
                    //if (!window.xx4) window.xx4 = 1	
                } else if (this.SpecialEffect == "Coffee" || this.SpecialEffect2 == "Coffee") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsCoffee", this.x + 0.2 * y, this.y + 0.3 * y, y / 1.5, y / 1, style);					
                } else if (this.SpecialEffect == "ThanksGivings" || this.SpecialEffect2 == "ThanksGivings") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsThanksGivings", this.x + 0.2 * y, this.y + 0.3 * y, y / 1.5, y / 1, style);
                } else if (this.SpecialEffect == "ChristmasTree" || this.SpecialEffect2 == "ChristmasTree") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsChristmasTree", this.x + 0.4 * y, this.y + 0.2 * y, y / 1.5, y / 1, style);
                } else if (this.SpecialEffect == "SantaHat" || this.SpecialEffect2 == "SantaHat") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsSantaHa", this.x - 1.05 * y, this.y + 1.5 * y, y / 1.5, y / 1, style);
                } else if (this.SpecialEffect == "Flag4July" || this.SpecialEffect2 == "Flag4July") {
					this.drawImageSpecialSkin("iconSpecialSkinEffectsUSAFlag4July", this.x - 0.9 * y, this.y + 1.1 * y, y / 1.5, y / 1, style);				
                } else if (this.SpecialEffect == "WhiteArrow" || this.SpecialEffect2 == "WhiteArrow") {
                    //style.drawImage(cimg2, this.x - y * 2, this.y - 2 * y, 2 * 2 * y, 2 * 2 * y);

                    var today = new Date();
                    try {
                        if (!window.testAnimatCells) {
                            if (!window.testAnimCell) {
                                var ab = today.getTime() / 1000
                                if (!window.abam) {
                                    window.abam = ab
                                }
                                if (!window.abah) {
                                    window.abah = today.getHours()
                                }
                                ab = ab - window.abam;
                                if (today.getHours() == window.abah && ab < 5) {
                                    style.drawImage(cimg5, this.x - (1.5 + 2 * ab) * y, this.y - (1.5 + 2 * ab) * y, (1.5 + 2 * ab) * 2 * y, (1.5 + 2 * ab) * 2 * y);
                                } else {
                                    window.testAnimatCells = true;
                                }
                            }
                        } else {
                            style.drawImage(cimg2, this.x - 2 * y, this.y - 2 * y, 2 * 2 * y, 2 * 2 * y);
                        }
                    } catch (e) {}
                }
            }
        }
        this.draw = function(style, cellMoved) { //this function draws each cell/virus/food 1 time only
            if ((LM.hideSmallBots && this.size <= 36) || this.invisible == true) {
                return;
            }
            //					
            style.save();


            this.redrawed++;
            if (cellMoved) {
                this.moveCell();
            }
            if (this.removed) {
                style.globalAlpha *= 1 - this.alpha;
            }
            var value = style.globalAlpha;
            var s = false;
            var y = this.isFood ? this.size + defaultSettings.foodSize : this.size;
            style.beginPath()

            //26/7/2020
            if (LM.ws.includes("replay") && window.replayGreyScale) {
                style.filter = 'grayscale(100%)';
            } else if (LM.ws.includes("replay") && window.replaySepia) {
                style.filter = 'sepia(100%)';
            } else if (LM.ws.includes("replay") && window.replayHueRotate) {
                style.filter = 'hue-rotate(90deg)';
            }
            //style.filter='grayscale(100%)';
            //
			
            if (defaultmapsettings.jellyPhisycs && this.points.length) {
                var point = this.points[0];
                style.moveTo(point.x, point.y);
                for (var i = 0; i < this.points.length; ++i) {
                    var point = this.points[i];
                    style.lineTo(point.x, point.y);
                }
            } 
			else if (defaultmapsettings.jellyPhisycs && this.isVirus) {
                style.lineJoin = "miter"
                var pointCount = 120;
                var incremental = this.pi2 / pointCount;
                style.moveTo(this.x, this.y + this.size + 3);
                for (var i = 1; i < pointCount; i++) {
                    var angle = i * incremental;
                    var dist = this.size - 3 + (i % 2 === 0) * 6;
                    style.lineTo(
                        this.x + dist * Math.sin(angle),
                        this.y + dist * Math.cos(angle)
                    )
                }
                style.lineTo(this.x, this.y + this.size + 3);
            } else style.arc(this.x, this.y, y, 0, this.pi2, false);

            style.closePath();
			if (window.hi) return


            //if (style.arc(this.x, this.y, y, 0, this.pi2, false), style.closePath(), this.isFood) {
            //    return style.fillStyle = this.color, style.fill(), void style.restore();
            //}						
            if (!defaultmapsettings.jellyPhisycs) {
                if (this.isVirus) {
                    //console.log("is not jelly");
                    /*if (dyinglight1load == "yes") {
                        try {
                            style.drawImage(cimgDyingLightvirus, this.x - 0.8 * this.size, this.y - 0.8 * this.size, 1.6 * this.size, 1.6 * this.size);
                        } catch (e) {}
                    }*/
                    if (defaultmapsettings.transparentViruses) {
                        style.globalAlpha *= defaultSettings.virusAlpha;
                        s = true;
                    }
					if (defaultmapsettings.virColors && LM.play) {
						style.fillStyle = application.setVirusColor(y); 
						style.strokeStyle = application.setVirusStrokeColor(y);
					}
					else{ 
						style.fillStyle = this.virusColor 
						style.strokeStyle = this.virusStroke	
					}
					style.fill()
					if (s) {
                        style.globalAlpha = value;
                        s = false;
                    }
					style.lineWidth = defaultSettings.virusStrokeSize
					if (defaultmapsettings.virusGlow){
                        style.shadowBlur = defaultSettings.virusGlowSize;
                        style.shadowColor = defaultSettings.virusGlowColor;						
					}
					if (defaultmapsettings.virusSpikes){
						style.stroke(this.createStrokeVirusPath(this.x, this.y, this.size - 2, defaultSettings.virusSpikesSize))
					}
					else{
						style.stroke()
					}
                    if (defaultmapsettings.showMass) {
                        this.setDrawing();
                        this.setDrawingScale();
                        this.setMass(this.size);
                        this.drawMass(style);
                    }					
					style.restore();
                    return;
					/*
                    return defaultmapsettings.transparentViruses && (style.globalAlpha *= defaultSettings.virusAlpha, s = true), 
					defaultmapsettings.virColors && LM.play ? (style.fillStyle = application.setVirusColor(y), style.strokeStyle = application.setVirusStrokeColor(y)) : (style.fillStyle = this.virusColor, 
					style.strokeStyle = this.virusStroke), 
					style.fill(), 
					s && (style.globalAlpha = value, s = false), 
					style.lineWidth = defaultSettings.virusStrokeSize, 
					defaultmapsettings.virusGlow ? (style.shadowBlur = defaultSettings.virusGlowSize, style.shadowColor =
                        defaultSettings.virusGlowColor) : "yeet", 
						defaultmapsettings.virusSpikes ? style.stroke(this.createStrokeVirusPath(this.x, this.y, this.size - 2, defaultSettings.virusSpikesSize)) : style.stroke(),
						//defaultmapsettings.virusSpikes ? style.stroke(this.createStrokeVirusPath(this.x, this.y, this.size - 2, 6)) : style.stroke(),
						//style.stroke(this.createStrokeVirusPath(this.x, this.y, this.size - 2, 6)), 
						defaultmapsettings.showMass && 
						(this.setDrawing(), this.setDrawingScale(), defaultmapsettings.virusGlow ? style.shadowBlur = 0 : "yote",
                        this.setMass(this.size), this.drawMass(style), (window.ExternalScripts && !window.legendmod5.optimizedMass)), void style.restore();
						*/
                }
            } 
			else {
                if (this.isVirus) {
                    //console.log("is jelly");
                    if (defaultmapsettings.transparentViruses) {
                        style.globalAlpha *= defaultSettings.virusAlpha;
                        defaultmapsettings.isAlphaChanged = true;
                    }
                    if (defaultmapsettings.virColors && LM.play) {
                        style.fillStyle = application.setVirusColor(y);
                        style.strokeStyle = application.setVirusStrokeColor(y);
                    } else {
                        style.fillStyle = defaultSettings.virusColor;
                        style.strokeStyle = defaultSettings.virusStrokeColor;
                    }
                    style.fill();
                    if (defaultmapsettings.isAlphaChanged) {
                        style.globalAlpha = defaultSettings.cellsAlpha;
                        defaultmapsettings.isAlphaChanged = false;
                    }
                    style.lineWidth = defaultSettings.virusStrokeSize;
                    if (defaultmapsettings.virusGlow) {
                        style.shadowBlur = defaultSettings.virusGlowSize;
                        style.shadowColor = defaultSettings.virusGlowColor;
                    }
                    style.stroke();
                    if (defaultmapsettings.showMass) {
                        this.setDrawing();
                        this.setDrawingScale();
                        this.setMass(this.size);
                        this.drawMass(style);
                        /*if (window.ExternalScripts && !window.legendmod5.optimizedMass) {
                            this.drawMerge(style);
                        }
                        if (defaultmapsettings.showChat) {
                            this.drawChat(style);
                        }*/
                    }
                    style.restore();
                    return;
                }
            }
            if (defaultmapsettings.transparentCells) {
                style.globalAlpha *= defaultSettings.cellsAlpha;
                s = true;
            }
            var color = this.color;
            if (LM.play || LM.playerCellsMulti.length) {
                if (this.isPlayerCell || this.playerCellsMulti) {
                    if (defaultmapsettings.myCustomColor && ogarcopythelb.color && LM.gameMode != ":teams") {
                        color = ogarcopythelb.color;
                    }
                } else {
                    if (defaultmapsettings.oppColors && !defaultmapsettings.oppRings && !this.isFood) {
                        color = this.oppColor;
                    }
                }
            }
            if (window.multiboxPlayerEnabled && this.isPlayerCellMulti && this.spectator && LM.play) {
                style.lineWidth = 20; ///
                style.strokeStyle = this.color; ///
                style.stroke(); //
            } else if (!window.multiboxPlayerEnabled && this.isPlayerCell && legendmod.multiBoxPlayerExists && !this.spectator && LM.play) {
                style.lineWidth = 20; ///
                style.strokeStyle = this.color; ///
                style.stroke(); //
            } else if (!window.multiboxPlayerEnabled && this.spectator && !this.isPlayerCellMulti && this.nick != "" && this.nick == profiles[application.selectedProfile].nick && LM.play) {
                style.lineWidth = 20; ///
                style.strokeStyle = this.color; ///
                style.stroke(); //
            }
            if (defaultmapsettings.cellContours) {
                style.lineWidth = 20; ///
                style.strokeStyle = this.color; ///
                style.stroke(); ///
            } else {
                style.fillStyle = color;
                style.fill();
            }
            //}
            if (s) {
                style.globalAlpha = value;
                s = false;
            }
            /*if (dyinglight1load != "yes"){
                            style.globalAlpha = 1;
                            s = false;
						}*/
            var node = null;



            if (defaultmapsettings.multiBoxShadow && this.targetNick != null && (this.targetNick == profiles[application.selectedOldProfile].nick || this.targetNick == profiles[application.selectedProfile].nick) && LM.playerCellsMulti && legendmod.playerCellsMulti.length) {
                if (legendmod.play && legendmod.playerCellsMulti) {
                    if (this.targetNick == profiles[application.selectedOldProfile].nick) {
                        style.shadowBlur = 40;
                        style.shadowColor = profiles[application.selectedOldProfile].color;
                    } else if (this.targetNick == profiles[application.selectedProfile].nick) {
                        style.shadowBlur = 40;
                        style.shadowColor = profiles[application.selectedProfile].color;
                    }
                }
            }
            //lylko
            if (defaultmapsettings.customSkins && LM.showCustomSkins) {
                node = application.getCustomSkin(this.targetNick, this.color);
                if (node) {
                    if ((defaultmapsettings.transparentSkins || LM.play && defaultmapsettings.oppColors) && !(this.isPlayerCell && !defaultmapsettings.myTransparentSkin) || this.isPlayerCell && defaultmapsettings.myTransparentSkin) {
                        style.globalAlpha *= defaultSettings.skinsAlpha;
                        //s = true;
                    }
                    if (legendmod.gameMode != ":teams") {
                        if (defaultmapsettings.jellyPhisycs) {
                            var lineWidth = Math.max(~~(y / 50), 10);
                            style.save();
                            style.clip();
                            this.maxPointRad && (y = this.maxPointRad);
                            try {
                                style.drawImage(node, this.x - y - lineWidth, this.y - y - lineWidth, 2 * y + lineWidth * 2, 2 * y + lineWidth * 2);
                            } catch (e) {}
                            style.globalCompositeOperation = 'luminosity';

                            style.lineWidth = lineWidth
                            style.strokeStyle = color;
                            style.stroke();
                            style.globalCompositeOperation = '';
                            style.restore();

                        } else {
                            try {
                                style.drawImage(node, this.x - y, this.y - y, 2 * y, 2 * y); //all skin drawing
                            } catch (e) {}
                        }
                        if (defaultmapsettings.FBTracking) {
                            var nodeFb = application.customSkinsMap[this.targetNick + "facebookskin"];
                            if (nodeFb && application.customSkinsCache[nodeFb + "_cached4"]) {
                                var temp = nodeFb + "_cached4";
                                var nodeFB = application.customSkinsCache[temp];
                                //console.log("found fb name: " + this.targetNick + " src: " + temp);
                                try {
                                    style.drawImage(nodeFB, this.x - 1 / 2 * y, this.y - y, y, y);
                                } catch (e) {}
                            }
                        }
                        //this.drawSpecialSkin(style, y)
                    }
                } 
				else {
                    if (defaultmapsettings.videoSkins) {
						var node2;
						if (LM.gameMode !=":party"){
							node2 = application.customSkinsMap[this.targetNick];
						}
						else{
							node2 = application.customSkinsMap[this.targetNick + this.color];
						}
                        if (node2) {
                            if (node2.includes(".mp4") || node2.includes(".webm") || node2.includes(".ogv")) {
                                checkVideos(node2, this.targetNick);
                                try {
                                    style.save();
                                    style.clip();
                                    if (defaultmapsettings.videoDestorted) {
                                        var temp = window.videoSkinPlayer[node2].videoWidth / window.videoSkinPlayer[node2].videoHeight;
                                        style.drawImage(window.videoSkinPlayer[node2], this.x - y, this.y - y * temp, 2 * y, 2 * y * temp);
                                    } else {
                                        style.drawImage(window.videoSkinPlayer[node2], this.x - y, this.y - y, 2 * y, 2 * y);
                                    }
                                    style.restore();
                                } catch (e) {}
                            }
                        }
                    }
                    if (dyinglight1load == "yes" && node == null && this.targetNick.includes(LM.playerNick) == false && !this.isFood && this.mass > 12) {
                        try {
                            style.drawImage(cimgDyingLight, this.x - y, this.y - y, 2 * y, 2 * y);
                        } catch (e) {}
                    }
                }
				this.drawSpecialSkin(style, y)
            }
            if (defaultmapsettings.teammatesInd && !this.isPlayerCell && y <= 800 &&
                window.teammatenicks && this.targetNick != "" &&
                (window.teammatenicks.includes(this.targetNick))) {
                drawRender.drawTeammatesInd(style, this.x, this.y, y)
            }

            if (defaultmapsettings.noNames && !defaultmapsettings.showMass || cellMoved) {
                //return;
            } else {
                var recursive = false;
                if (!(!this.isPlayerCell && (recursive = application.setAutoHideCellInfo(y)) && defaultmapsettings.autoHideNames && defaultmapsettings.autoHideMass)){
                    this.setDrawing();
                    this.setDrawingScale();
                    style.globalAlpha *= defaultSettings.textAlpha;
                    if (!(defaultmapsettings.noNames || recursive && defaultmapsettings.autoHideNames || this.isPlayerCell && defaultmapsettings.hideMyName || node && defaultmapsettings.hideTeammatesNames)) {
                        if (this.setNick(this.targetNick)) {
                            this.drawNick(style);
                        }
                    }
                    if (!(!defaultmapsettings.showMass || recursive && defaultmapsettings.autoHideMass || this.isPlayerCell && defaultmapsettings.hideMyMass || defaultmapsettings.hideEnemiesMass && !this.isPlayerCell && !this.isVirus)) {
                        if (this.setMass(this.size)) {

                            this.drawMass(style);
                            if (window.ExternalScripts && !window.legendmod5.optimizedMass) {
                                this.drawMerge(style);
                            }
                            if (defaultmapsettings.showChat) {
                                this.drawChat(style);
                            }
                        }
                    }
                }

            }
            style.restore();
        }
    }
    window.legendmod1 = ogarbasicassembly;


    if (null !== localStorage.getItem("ogarioProtocolVersion")) {
        //console.log('ProtocolVersion changed to,' + localStorage.getItem("ogarioProtocolVersion"))
        master.protocolVersion = localStorage.getItem("ogarioProtocolVersion");
    }
    var LM = {
        integrity: true,
        quadtree: null,
        updateQuadtree: function(cells) {
            var w = drawRender.canvasWidth / drawRender.scale;
            var h = drawRender.canvasHeight / drawRender.scale;
            var x = (this.viewX - w / 2);
            var y = (this.viewY - h / 2);
            this.quadtree = new PointQuadTree(x, y, w, h, 32);
            for (var i = 0; i < cells.length; ++i) {
                var cell = cells[i];
                for (var n = 0; n < cell.points.length; ++n) {
                    this.quadtree.insert(cell.points[n]);
                }
            }
        },
        isFreeSpectate: false,
        isSpectateEnabled: false,
        ws: null,
        socket: null,
        protocolKey: null,
        clientKey: null,
        connectionOpened: false,
        accessTokenSent: false,
        //clientVersion: 30604,
        clientVersion: master.clientVersion,
        protocolVersion: master.protocolVersion,
        //clientVersionString: '3.6.4',
        clientVersionString: master.clientVersionString,
        xsupportprotoversion: master.xsupportprotoversion,
        time: Date.now(),
        serverTime: 0,
        serverTimeDiff: 0,
        //loggedInTime: 0,
        mapSize: 14142, //14142.13562
        mapOffset: 7071, //7071.067811865476
        mapMinX: -7071,
        mapMinY: -7071,
        mapMaxX: 7071,
        mapMaxY: 7071,

        mapOffsetX: 0,
        mapOffsetY: 0,
        mapOffsetFixed: false,
        viewMinX: 0,
        viewMinY: 0,
        viewMaxX: 0,
        viewMaxY: 0,
        //
        camMaxX: 0,
        camMaxY: 0,
        camMinX: 0,
        camMinY: 0,
        //
        canvasWidth: 0,
        canvasHeight: 0,
        canvasScale: 1,
        indexedCells: {},
        cells: [],
        removedCells: [],
        food: [],
        viruses: [],
        cellcolors: [],
        playerCells: [],
        playerCellIDs: [],
        playerCellsMulti: [],
        fbOnline: [],
        arrowFB: [{}],
        Waves: [],
        ghostCells: [],
        playerX: 0,
        playerY: 0,
        playerXMulti: 0,
        playerYMulti: 0,
        playerSize: 0,
        playerMass: 0,
        totalPlayerMassBigFFA: 0,
        totalPlayerMass: 0,
        playerMaxMass: 0,
        playerMinMass: 0,
        playerScore: 0,
        playerSplitCells: 0,
        playerColor: null,
        playerNick: '',
        playerPosition: 0,
        //playerPositionMulti: null,
        leaderboard: [],
        biggerSTEDCellsCache: [], //Sonia
        biggerSTECellsCache: [],
        biggerCellsCache: [],
        smallerCellsCache: [],
        STECellsCache: [],
        STEDCellsCache: [], //Sonia
        SSCellsCache: [],
        STE: 0,
        autoZoom: false,
        zoomValue: 0.1,
        viewX: 0,
        viewY: 0,
        scale: 1,
        viewScale: 1,
        clientX: 0,
        clientY: 0,
        cursorX: 0,
        cursorY: 0,
        targetX: 0,
        targetY: 0,
        targetDistance: 0,
        ////
        cRadius: 10,
        cAngle: 4,
        cAngle1: 0,
        cAngle2: 0,
        cAlpha: 1,
        drawCommander: 0,
        ////
        battleRoyale: {
            state: 0,
            players: 0,
            startTime: 0,
            shrinkTime: 0,
            timeLeft: 0,
            x: 0,
            y: 0,
            radius: 0,
            targetX: 0,
            targetY: 0,
            targetRadius: 0,
            maxRadius: 11313,
            rank: [],
            playerRank: 0,
            joined: false
        },
        play: false,
        pause: false,
        targeting: false,
        removePlayerCell: false,
        showCustomSkins: true,
        showFood: true,
        foodIsHidden: false,
        selectBiggestCell: true,
        hideSmallBots: false,
        pressedKeys: {},
        dance: false,
        chatableServer: false,
        connect(t) {
            //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Connecting to game server:', t);
            var app = this;
            setTimeout(function() {
                application.Socket3connect(t);
                if (defaultmapsettings.rotateMap) {
                    application.SLGconnect(t);
                }
                pauseVideos()
                if (typeof Universalchatfix === 'function') {
                    Universalchatfix()
                    preEmbPassword()
                }
            }, 100);
            window.legendmod.vnr = 0; //Sonia3
            window.legendmod.bgpi = 4; //Sonia3
            window.legendmod.lbgpi = 4; //Sonia3
            window.legendmod.vector = [
                [0, 0],
                [1, 0],
                [1, 1],
                [0, 1]
            ]; //Sonia3
            window.legendmod.setrot = false; //Sonia3
            window.legendmod.delstate = -1; //Sonia3			
            this.closeConnection();
            this.flushCellsData();
            this.protocolKey = null;
            this.clientKey = null;
            this.accessTokenSent = false;
            this.connectionOpened = false;
            this.mapOffsetFixed = false;
            this.leaderboard = [];
            this.ws = t;
            this.integrity = this.ws.indexOf('agar.io') > -1; // 2020 JIMBOY3100 
            if (window.userBots.startedBots) window.connectionBots.send(new Uint8Array([1]).buffer)
            window.userBots.isAlive = false
            window.userBots.macroFeedInterval = null
            this.socket = new WebSocket(t);
            this.socket.binaryType = 'arraybuffer';
            this.socket.onopen = function() {
                app.onOpen();
            };
            this.socket.onmessage = function(t) {
                app.onMessage(t);
            };
            this.socket.onerror = function(t) {
                app.onError(t);
            };
            this.socket.onclose = function(t) {
                app.onClose(t);
            };
            application.getWS(this.ws);
            application.sendServerJoin();
            application.sendServerData();
            application.displayLeaderboard('');
            application.displayPartyBots();
            application.setUniversalChat();
            application.setAnimatedRainbowColor();


            if (window.master && window.master.onConnect) {
                window.master.onConnect();
            }
            this.play = false //fix

            this.totalPlayerMass = parseInt(localStorage.getItem("totalPlayerMass"));
            if (this.totalPlayerMass == "NaN" || !this.totalPlayerMass) this.totalPlayerMass = 0 //fix
            if (this.ws.includes("imsolo.pro:2102")) { //4 times bigger 600 users limit
                this.totalPlayerMassBigFFA = parseInt(localStorage.getItem("totalPlayerMassBigFFA"));
                if (this.totalPlayerMassBigFFA == "NaN" || !this.totalPlayerMassBigFFA) this.totalPlayerMassBigFFA = 0 //fix
            }
            this.replayfunctions();

        },
        onOpen() {
            //console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Game server socket open');
            this.time = Date.now();
            if (!window.customProtol) window.customProtol = 6
            if (!window.customClient) window.customClient = 1

            var view = this.createView(5);
            view.setUint8(0, 254);
            if (!this.integrity) {
                view.setUint32(1, window.customProtol, true);
                window.gameBots.protocolVersion = window.customProtol
            } else {
                view.setUint32(1, this.protocolVersion, true);
                window.gameBots.protocolVersion = master.protocolVersion;
            } 
			//			
            //if (LM.ws.includes("imsolo.pro") || window.protocol6){ view.setUint32(1, 6, true); } //protocol 6 and 5
            //else if (window.protocol5){ view.setUint32(1, 5, true); } // Protocol 5


            this.sendMessage(view);
            view = this.createView(5);
            view.setUint8(0, 255);
            if (!this.integrity) {
                view.setUint32(1, window.customClient, true);
                window.gameBots.clientVersion = window.customClient
				
				if (LM.ws.includes("cellz.io")){
					this.sendMessage(view);
					view.setUint8(0, 80);
				}			
            } //protocol 6 and 5
            else {
                view.setUint32(1, this.clientVersion, true);
                window.gameBots.clientVersion = this.clientVersion
            } 
			
			//
            //if (LM.ws.includes("imsolo.pro") || window.protocol6){ view.setUint32(1, 1, true); } //protocol 6 and 5
            //else if (window.protocol5){ view.setUint32(1, 1332175218, true); } // Protocol 5

            this.sendMessage(view);
            this.connectionOpened = true;
        },
        onMessage(message) {

            //console.log(message.data)
            message = new DataView(message.data);
            if (this.protocolKey) {
                message = this.shiftMessage(message, this.protocolKey ^ this.clientVersion);
            }
            this.handleMessage(message);


        },
        onError(t) {
            console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Game server socket error');
            this.flushCellsData();
            if (window.master && window.master.onDisconnect) {
                window.master.onDisconnect();
            }
        },
        onClose(t) {
            console.log('\x1b[32m%s\x1b[34m%s\x1b[0m', consoleMsgLM, ' Game server socket close');
            this.flushCellsData();
            if (window.master && window.master.onDisconnect) {
                window.master.onDisconnect();
            }
        },
        replayfunctions() {
            if (window.replayTimeOuts.length && !this.ws.includes("replay")) {
                for (var i = 0; i < window.replayTimeOuts; i++) {
                    clearTimeout(window.replayTimeOuts[i])
                }
                window.replayTimeOuts = []
            } else if (!this.ws.includes("replay") && $('#pause-hud').text() == "Loading...") {
                $('#pause-hud').text(textLanguage.pause);
                $('#pause-hud').hide()
            }
            //if (!window.RecordedProtocol[$("#server-token").val()]){
            //console.log('a'+$("#server-token").val())		
            //window.temporaryRecordedProtocol2 = window.temporaryRecordedProtocol
            if (!$("#server-token").val().includes("replay") && !$("#server-token").val().includes("imsolo.pro:2109/")) {
                if (window.RecordedArenasSpecifications[$("#server-token").val()]) {
                    for (var i = 1; i < 10; i++) {
                        if (!window.RecordedArenasSpecifications[$("#server-token").val() + '(' + i + ')']) {
                            window.temporaryRecordedProtocol = $("#server-token").val() + '(' + i + ')'
                            break;
                        } else {

                        }
                    }
                } else {
                    window.temporaryRecordedProtocol = $("#server-token").val()
                }
                window.catholicCalculator = 0
                window.RecordedProtocol[window.temporaryRecordedProtocol] = []
                window.RecordedProtocolArenas.push(window.temporaryRecordedProtocol)
                window.RecordedArenasSpecifications[window.temporaryRecordedProtocol] = [Date.now(), application.gameMode, application.region, $("#nick").val()]
            }


            //}				
        },
        closeConnection() {
            if (this.socket) {
                this.socket.onopen = null;
                this.socket.onmessage = null;
                this.socket.onerror = null;
                this.socket.onclose = null;
                try {
                    this.socket.close();
                } catch (error) {}
                this.socket = null;
                this.ws = null;
            }
        },
        isSocketOpen() {
            return this.socket !== null && this.socket.readyState === this.socket.OPEN;
        },
        createView(t) {
            return new DataView(new ArrayBuffer(t));
        },
        sendBuffer(data) {
            this.socket.send(data.buffer);
        },
        sendMessage(message) {
            if (this.connectionOpened && this.integrity) {
                if (!this.clientKey) {
                    return;
                }
                message = this.shiftMessage(message, this.clientKey);
                this.clientKey = this.shiftKey(this.clientKey);
            }
            /*jimboy3100
            if (window.LMdebug){
            	window.tempoo = new window.buffer.Buffer(message.buffer)
            	if (window.tempoo[0]==102){ 
            		window.tempoo2 = new window.buffer.Buffer(window.tempoo.buffer)	
            		console.log(window.tempoo2)
            	}					
            }*/
            this.sendBuffer(message);
        },
        sendAction(action) {

            if (!this.isSocketOpen()) {
                return;
            }
            const view = this.createView(1);
            view.setUint8(0, action);
            this.sendMessage(view);
        },
        sendSpectate() {
            this.isSpectateEnabled = true;
            this.sendAction(1);
        },
        sendFreeSpectate() {
            this.isFreeSpectate = !this.isFreeSpectate;
            this.sendAction(18);
        },
        sendBotEject() {
            //this.sendPosition();
            this.sendAction(23);
        },
        sendBotSplit() {
            //this.sendPosition();
            this.sendAction(22);
        },
        sendEject() {
            this.sendPosition();
            this.sendAction(21);
        },
        sendSplit() {
            this.sendPosition();
            this.sendAction(17);
        },
        sendFBIDS(data) { //Yahnych
            var friendsIDs = "";

            var pIDs = application.FacebookIDs.split(',');
            for (let length = 0; length < pIDs.length; length++) {
                if (friendsIDs.length == 0) {
                    friendsIDs += pIDs[length].split(':')[0];
                } else {
                    friendsIDs += "|" + pIDs[length].split(':')[0];
                }
            }
            for (let length = 0; length < data.length; length++) {
                if (friendsIDs.length == 0) {
                    friendsIDs += data[length].id
                } else {
                    friendsIDs += "|" + data[length].id
                }
            }
            friendsIDs = unescape(encodeURIComponent(friendsIDs));
            const view = this.createView(2 + friendsIDs.length);
            view.setUint8(0, 5);
            for (let length = 0; length < friendsIDs.length; length++) {
                view.setUint8(1 + length, friendsIDs.charCodeAt(length));
            }
            view.setUint8(friendsIDs.length + 1, 0);
            this.sendMessage(view);

        },
        sendNick(nick) {

            var self = this
            this.playerNick = nick;

            var sendSpawn = function(token) {
                //var token = grecaptcha.getResponse();
                nick = window.unescape(window.encodeURIComponent(self.playerNick));
                var view = self.createView(1 + nick.length + 1 + token.length + 1);
                var pos = 1
                //"℄🌀".codePointAt(length)
                for (let length = 0; length < nick.length; length++, pos++) view.setUint8(pos, nick.codePointAt(length))
                //for (let length = 0; length < nick.length; length++, pos++) view.setUint8(pos, nick.charCodeAt(length))
                pos++
                for (let length = 0; length < token.length; length++, pos++) view.setUint8(pos, token.codePointAt(length))
                //for (let length = 0; length < token.length; lengt
